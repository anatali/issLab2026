
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Protobook &#8212; protobook 1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="protobook documentation" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="protobook">
<h1>Protobook<a class="headerlink" href="#protobook" title="Permalink to this heading">¶</a></h1>
<p>Questo testo è stato redatto usando RestructredText e Sphinx e
generato con <strong>make html</strong> o <strong>make latexpdf</strong></p>
</section>
<section id="preludio">
<h1>Preludio<a class="headerlink" href="#preludio" title="Permalink to this heading">¶</a></h1>
<p>L’idea di <strong>Ingegneria</strong> pone enfasi sulla</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">costruzione</span> <span class="n">consapevole</span> <span class="n">e</span> <span class="n">motivata</span> <span class="n">di</span> <span class="n">artefatti</span> <span class="n">basata</span> <span class="n">su</span> <span class="n">analisi</span><span class="p">,</span> <span class="n">progettazione</span><span class="p">,</span>
<span class="n">sviluppo</span><span class="p">,</span>  <span class="n">distribuzione</span> <span class="n">e</span> <span class="n">manutenzione</span> <span class="n">di</span> <span class="n">prodotti</span>
</pre></div>
</div>
<p>Gli <em>ingegneri del software</em> sono abituati ad avvelersi di molti diversi strumenti per costruire
<a class="reference internal" href="#sistemi-software"><span class="std std-ref">Sistemi software</span></a>: linguaggi di programmazione, framework, librerie, ambienti di sviluppo, etc.</p>
<p>Oggi esiste un nuovo, potente strumento: le Chat basate su <em>Intelligenza Artificiale- (**IA*</em>).</p>
<p>Sempre più spesso, le IA generative (come ChatGPT, Gemini, Claude, ecc.) vengono utilizzate per assistere
gli sviluppatori nel processo di scrittura del codice, nella generazione di documentazione e molto altro.</p>
<p>Ad esempio, posso chiedere a ChatGPT di generare un programma  che realizza il gioco
<a class="reference external" href="https://it.wikipedia.org/wiki/Gioco_della_vita">Conway Life</a>. A tal fine imposto il seguente <strong>prompt</strong>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&quot;Genera un programma che implementa il gioco di Conway Life.
 Il programma deve utilizzare una griglia 10x10 e visualizzare
 lo stato della griglia ad ogni iterazione.
 Includi commenti esplicativi nel codice.&quot;
</pre></div>
</div>
<ul class="simple">
<li><p>Il risultato di questa rochiesta a <strong>ChatGpt</strong> è un programma <a href="#id12"><span class="problematic" id="id13">*</span></a>Python- riportato in  <a class="reference external" href="https://github.com/anatali/protobook/blob/main/material/source/code/ConwayLife.py">ConwayLife.py</a>.</p>
</li>
</ul>
<p>Posso anche ottenere una versione in JavaScript, specificando questa rihiesta nel prompt. Il file <a class="reference external" href="https://github.com/anatali/protobook/blob/main/material/source/code/conway25JsGemini.js">conway25Gemini.js</a>.
riporta il risultato del codice generato da <strong>Gemini</strong>.</p>
<p>Modificando ulteriormente il prompt, è possibile generare programmi che eseguono il gioco in un browser web,
utilizzando <code class="docutils literal notranslate"><span class="pre">HTML5</span></code> e <a class="reference external" href="https://www.w3schools.com/html/html5_canvas.asp">canvas</a> per la visualizzazione grafica o che utilizzano librerie grafiche come <a href="#id14"><span class="problematic" id="id15">*</span></a>Pygame-
per una visualizzazione più avanzata in Python.</p>
<section id="c-e-ancora-possibilita-di-lavoro">
<h2>C’è ancora possibilità di lavoro?<a class="headerlink" href="#c-e-ancora-possibilita-di-lavoro" title="Permalink to this heading">¶</a></h2>
<p>E’ noto che quando una attività diventa riproducibile da una macchina, cessa di avere valore per gli
esseri umani e, automaticamente cessano di avere valore le persone che continuano a
svolgere quell’attività.</p>
<p>Dunque, la professione del costruttore di software rischia di essere messa in crisi.
Proviamo a chiedere alla IA ‘cosa ne pensa’:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&quot;L&#39;avvento della IA generativa potrebbe mettere in crisi la professione
 del programmatore di computer.
 Vorrei avere una panoramica delle ragioni che possono rendere meno probabile
 questo fenomeno  o, meglio, le attività nel campo della costruzione del software
 che possono ancora essere svolte in modo migliore da un essere umano&quot;
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Risponde Gemini</p>
<blockquote>
<div><p>È vero che l’avvento dellIA Generativa** ha sollevato preoccupazioni sulla professione di programmatore.</p>
<p>Tuttavia, la maggior parte degli esperti concorda che l’IA sia destinata a diventare uno
strumento di potenziamento piuttosto che un sostituto completo, soprattutto nelle fasi
più critiche e astratte del ciclo di vita del software.</p>
<p>Ecco una panoramica delle attività in cui l’essere umano mantiene un vantaggio distintivo
e in cui è meno probabile che venga sostituito dall’IA.</p>
</div></blockquote>
<p><strong>Comprensione del Dominio e Astrazione</strong></p>
<p>L’IA generativa (come ChatGPT o Gemini o Copilot) eccelle nella <strong>traduzione sintattica</strong> (scrivere codice da istruzioni chiare), ma fallisce nella <strong>comprensione semantica</strong> profonda del dominio aziendale o scientifico.</p>
<ul class="simple">
<li><p><strong>Identificazione del Problema Reale:</strong> Un ingegnere del software umano è fondamentale per interagire con il cliente,
comprendere i requisiti ambigui, definire i <em>casi limite</em> (edge cases) e distinguere ciò che il cliente <em>vuole</em>
da ciò di cui il cliente <em>ha bisogno</em>. L’IA può scrivere codice per una funzione, ma non può ancora guidare una
riunione di <em>discovery</em> per definire i modelli di business.</p></li>
<li><p><strong>Architettura e Design a Livello Olistico</strong> : L’IA può generare codice per singoli componenti o <a class="reference external" href="https://en.wikipedia.org/wiki/Microservices">Microservizi</a>,
ma la creazione di unarchitettura software** coerente, scalabile, e che rispetti vincoli di costo e tempo
(<em>Design Patterns, Olarchia, Coreografia vs. Orchestrazione</em>) richiede un giudizio e una visione sistemica
che l’IA non possiede.</p></li>
</ul>
<p><strong>Gestione della Complessità e Integrazione</strong></p>
<p>I sistemi software reali sono raramente applicazioni <em>greenfield</em> (nuove da zero);
sono complessi intrecciati di sistemi legacy, API di terze parti e vincoli operativi.</p>
<ul class="simple">
<li><p><strong>Integrazione di Sistemi Legacy:</strong> Il codice generato dall’IA è spesso ottimale, ma si scontra con la necessità di integrarsi con un codice legacy vecchio di 20 anni, spesso non documentato e con <em>side effects- non ovvi. Solo un umano può **decifrare e manutenere*</em> in modo sicuro queste interfacce complesse.</p></li>
<li><p><strong>Debug di Sistemi Distribuiti:</strong> Identificare la causa radice di un <em>bug</em>
in un sistema distribuito (che coinvolge rete, database, latenza e interazioni asincrone)
richiede ragionamento causale e ipotesi basate su esperienza, non solo sul pattern matching del codice.</p></li>
</ul>
<p><strong>Fattore Umano ed Etica</strong></p>
<p>La programmazione non è solo un esercizio tecnico, ma un atto sociale, etico e di gestione del rischio.</p>
<ul class="simple">
<li><p><strong>Responsabilità Etica e Legale:</strong> Chi è responsabile se un codice generato dall’IA causa danni (es. in un sistema finanziario o medico)? L’ingegnere umano mantiene la <strong>responsabilità finale</strong> per la validazione, il test e l’implementazione sicura del codice.</p></li>
<li><p><strong>Leadership e Mentoring:</strong> L’IA non può gestire un team, mediare conflitti, fare <a href="#id16"><span class="problematic" id="id17">*</span></a>mentoring- a sviluppatori junior, o difendere una decisione tecnica davanti a stakeholder non tecnici. Queste sono soft skills cruciali nella professione.</p></li>
</ul>
<p><strong>Attività Specifiche in cui l’Umano eccelle</strong></p>
<p>Ecco le aree dove il programmatore sposta il suo valore aggiunto:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 28%" />
<col style="width: 72%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Area di Attività</strong></p></td>
<td><p><strong>Ruolo Umano Distintivo</strong></p></td>
</tr>
<tr class="row-even"><td><p><em>Ingegneria dei Requisiti</em></p></td>
<td><p>Interazione diretta con gli utenti, conversione di necessità vaghe in specifiche
tecniche formali (definizione dell’obiettivo).</p></td>
</tr>
<tr class="row-odd"><td><p><em>Architettura Software</em></p></td>
<td><p>Selezione del paradigma (OOP, Funzionale, Olonico), progettazione di schemi di
database e definizione delle interfacce tra i macro-servizi.</p></td>
</tr>
<tr class="row-even"><td><p><em>Validazione e Test Strategico</em></p></td>
<td><p>Non solo scrivere unit test (che l’IA può fare),
ma definire <strong>scenari di test complessi</strong> e non banali, test di carico e strategie di <em>chaos engineering</em>.</p></td>
</tr>
<tr class="row-odd"><td><p><em>Sicurezza e Hardening</em></p></td>
<td><p>Identificazione di vulnerabilità logiche e attacchi a livello di business.
L’IA può scrivere codice, ma un umano deve garantire la <strong>robustezza contro gli intenti malevoli</strong>.</p></td>
</tr>
<tr class="row-even"><td><p><em>Innovazione e Ricerca</em></p></td>
<td><p>L’IA è addestrata su dati esistenti (ciò che è stato fatto).
La creazione di <strong>nuovi algoritmi</strong>, paradigmi o linguaggi di programmazione per risolvere problemi non ancora risolti
sembra richiedere ancora creatività umana.</p></td>
</tr>
</tbody>
</table>
<p>In conclusione, l’IA Generativa solleverà il programmatore dai compiti di scrittura di
codice <em>boilerplate</em> e di <em>routine</em> (codifica), ma amplificherà la necessità di concentrarsi
sulla <strong>soluzione dei problemi</strong>, sulla <strong>gestione della complessità</strong> e sul <strong>giudizio etico-architetturale</strong>.</p>
<p>La professione non scompare, ma si <strong>eleva</strong> da programmatore a <strong>ingegnere del software di sistema</strong>.</p>
</div>
</section>
</section>
<section id="cosa-si-intende-per-sistema">
<h1>Cosa si intende per Sistema<a class="headerlink" href="#cosa-si-intende-per-sistema" title="Permalink to this heading">¶</a></h1>
<p><strong>Overview</strong></p>
<p>Si introduce il concetto fondamentale di sistema non come una definizione formale univoca,
ma come un insieme organizzato di elementi interconnessi volti a raggiungere uno scopo specifico.
Questo capitolo funge da ponte concettuale per passare dalla visione del software come semplice algoritmo
alla comprensione dei moderni ecosistemi distribuiti.
I punti salienti del capitolo includono:</p>
<ul class="simple">
<li><p>Tassonomia dei sistemi: Viene proposta una classificazione basata sulla prevedibilità e sulla linearità, distinguendo tra sistemi semplici (prevedibili e lineari), complicati (decomponibili e analizzabili da esperti), complessi (caratterizzati da emergenza e non linearità) e caotici (impossibili da prevedere a lungo termine).</p></li>
<li><p>Classificazione per natura: si distinguono diverse tipologie di enti sistemici, dalle macchine (sistemi chiusi e deterministici) ai sistemi cibernetici (regolati dal feedback), fino agli agenti (autonomi e orientati a obiettivi) e agli organismi (sistemi aperti, dinamici e capaci di autorganizzazione).</p></li>
<li><p>Prospettive di descrizione: Un sistema può essere analizzato attraverso una visione BlackBox (focalizzata sull’interazione e sulle interfacce pubbliche), una visione WhiteBox (che ne esamina struttura, comportamento e interazioni interne) o una visione sistemica.</p></li>
<li><p>Il principio “More is different”: Viene enfatizzato che, con l’aumento della dimensione e delle interconnessioni,
il sistema acquisisce proprietà globali non riducibili alla somma delle singole parti (proprietà emergenti).
Per l’ingegnere del software, ciò significa che il focus non è su cosa fanno i componenti, ma come interagiscono.</p></li>
<li><p>Sistemi complessi e software moderno: Il software contemporaneo è descritto come un ecosistema di servizi e attori che possiede le stesse proprietà dei sistemi complessi naturali: distribuzione, autonomia, adattabilità e sensibilità alla topologia delle reti.</p></li>
<li><p>Teoria delle reti e Sinergetica: Vengono introdotti strumenti formali come la teoria dei grafi e la sinergetica di Haken per modellare l’auto-organizzazione e comprendere le dinamiche collettive (come la sincronizzazione e la resilienza) nei sistemi distribuiti.</p></li>
</ul>
<p>In sintesi, il capitolo stabilisce che la costruzione di sistemi software moderni richiede di superare
l’approccio riduzionista a favore di una visione olistica,
indispensabile per progettare comportamenti emergenti e robustezza in ambienti dinamici.</p>
<hr class="docutils" />
<p>Il termine ‘sistema’ deriva da una parola greca che significa “ciò che è posto insieme” o “un insieme organizzato”.</p>
<p>Non esiste una singola definizione formale universalmente accettata di <strong>“sistema”</strong> poichè
la parola evoca un concetto categoriale che assume significati diversi in fisica, ingegneria, biologia,
sociologia, informatica.</p>
<p>Un prima, possibile definizione ‘informale’ può essere:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Un sistema è un insieme di elementi interconnessi o interagenti,
organizzati in modo coerente per raggiungere un determinato scopo
(o per svolgere una funzione specifica).`
</pre></div>
</div>
<section id="descrivere-e-classificare">
<h2>Descrivere e classificare<a class="headerlink" href="#descrivere-e-classificare" title="Permalink to this heading">¶</a></h2>
<p>Descrivere significa <strong>selezionare e organizzare informazione</strong>
per rappresentare un oggetto o un sistema <strong>in modo utile</strong>, spesso <em>compattato</em>,
privilegiando <strong>relazioni e regole</strong> rispetto a elenchi e dettagli.</p>
<p>Una descrizione può assumere la forma di una <strong>classificazione</strong>, cioè:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>classificare = assegnare ogni elemento di un insieme
a una categoria, in base a criteri scelti.
</pre></div>
</div>
<p>Dobbiamo essere consapevoli che
ogni classificazione è <strong>costruita</strong>, e
dipende dagli <strong>scopi</strong> e dalla <strong>cultura</strong> dell’osservatore.
Non esistono categorie “naturali” e assolute:
<em>decidere cosa distinguere e aggregare</em> è sempre <strong>interpretazione</strong>.
Le categorie non “esistono” nelle cose. Le creiamo noi per raggiungere uno scopo.</p>
<p>Nel tentativo di comprendere il mondo, si è affermata una tassonomia molto diffusa che distingue
i sistemi in <em>semplici, complicati, complessi e caotici</em>.
Questa classificazione permette di riconoscere la <em>natura</em> di un sistema
e di scegliere gli strumenti più adatti per analizzarlo o progettarlo.</p>
<p>Questa tassonomia serve non tanto per incasellare i sistemi, quanto per:
guidare il modo in cui li <strong>modelliamo</strong>, quali strumenti formali utilizziamo
e quali aspettative abbiamo sul loro comportamento.</p>
<p>A ciascuna delle categorie possiamo far corrispondere una diversa classe di fenomeni
e diverse possibili azioni di governo.</p>
</section>
<section id="sistemi-semplici">
<span id="id18"></span><h2>Sistemi semplici<a class="headerlink" href="#sistemi-semplici" title="Permalink to this heading">¶</a></h2>
<p><strong>Caratteristica</strong>: comportamento prevedibile, descrivibile con poche regole lineari; facile da modellare e prevedere.</p>
<p>I sistemi semplici provocano fenomeni semplici. Il principio causa-effetto indica,
a partire dall’effetto, qual è la causa che lo determina.</p>
<p><strong>Azioni</strong>: Un’azione di intervento sul sistema consiste nell’applicare un protocollo risolutivo predefinito.
E’ il regno delle persone <strong>executive</strong> che applicanon <strong>Best Practices</strong>.
<em>Esempio</em>: hostess di un aereo.</p>
</section>
<section id="sistemi-complicati">
<span id="id19"></span><h2>Sistemi complicati<a class="headerlink" href="#sistemi-complicati" title="Permalink to this heading">¶</a></h2>
<p><strong>Caratteristica</strong>:  Molti elementi e molte relazioni, ma ingegnerizzabile— decomponibile, prevedibile;
molte possibili casue per un dato fenomeno.</p>
<p>Questi sistemi provocano fenomeni complicati, per i quali occorre studio e analisi.</p>
<p><strong>Azioni</strong>: Un’azione di intervento consiste nell’analizzare le possibili cause, pianificare l’intervento
risolutivo e realizzarlo.
Sono necessarie persone <strong>expert</strong> capaci di definire a priori
un modello di funzionamento, in base al quale pianificare l’intevento.
<em>Esempio</em>: pilota di un aereo a motore.</p>
</section>
<section id="sistemi-complessi">
<span id="id20"></span><h2>Sistemi complessi<a class="headerlink" href="#sistemi-complessi" title="Permalink to this heading">¶</a></h2>
<p><strong>Caratteristica</strong>:  Molti elementi, relazioni non lineari, adattamento, emergenza;
il comportamento non è predicibile solo dalle parti, ma emerge dalle interazioni.</p>
<p>Un sistema complesso non può essere ‘controllato’; può al massimo essere ‘perturbato’.</p>
<p><strong>Azioni</strong>:  Un’azione di intervento non può essere basata su un modello a-priori, ma richiede l’azione come
scelta/scommessa, apprendimento (degli effetti) e adattamento continuo (<strong>try and learn</strong>).
<em>Esempio</em>: pilota di un aliante.</p>
<p>E’ l’azione (<strong>agency</strong>) costruttiva a generare conoscenza. Quando non si conosce il
modello di comportamento di un fenomeno, <strong>agire</strong> significa sperimentare e questo
per gli esseri umani (dice il biologo <em>Stuart Kauffman</em>) significa generare nuovi artefatti e modelli
chiamando in causa competenze e approcci diversi, con una proliferazione di attività eterogenee.</p>
</section>
<section id="sistemi-caotici">
<span id="id21"></span><h2>Sistemi caotici<a class="headerlink" href="#sistemi-caotici" title="Permalink to this heading">¶</a></h2>
<p><strong>Caratteristica</strong>:  Estremamente sensibile alle condizioni iniziali (effetto farfalla);
può essere anche “semplice” dal punto di vista strutturale, ma
impossibile da prevedere a lungo termine.</p>
<p>Per i sistemi che provocano fenomeni caotici non c’è mai ripetizione di alcuna traiettoria
e non è possibile apprendimento.</p>
<p><strong>Azioni</strong>:  L’unica strategia è azione-adattamento continuo.
<em>Esempio</em>: pilota che cerca di atterrare in condizioni meteo avverse.</p>
<section id="macchine-agenti-organismi">
<h3>Macchine, agenti, organismi<a class="headerlink" href="#macchine-agenti-organismi" title="Permalink to this heading">¶</a></h3>
<p>Per un ingegnere (del software, ma non solo) è anche utile introdurre una ultriore distinazione/classificazione
tra sistemi, distinguendo tra <em>macchine, agenti, agenti intelligenti e organismi</em>.
Ma prima, premettiamo alcune puntualizzazioni:</p>
<ul class="simple">
<li><p><strong>Le categorie non sono necessariamente disgiunte né nette</strong>: un sistema può trovarsi “a metà” tra macchina e agente
oppure tra agente e agente intelligente, a seconda delle caratteristiche reali.</p></li>
<li><p><strong>Dipendenza dalla scala di osservazione</strong>: un “organismo” visto dall’esterno può mostrarsi come “molti agenti intelligenti”
o come “un agente intelligente”: la classificazione dipende da <strong>chi osserva</strong>, <strong>come osserva</strong>, e <strong>perché</strong>.</p></li>
<li><p><strong>Arbitrarietà e finalità</strong>: come per ogni classificazione, le categorie riflettono aspettative progettuali o analitiche:
cambiano se vogliamo modellare un software, un sistema biologico, un network sociale, un ecosistema.</p></li>
<li><p><strong>Pericolosità di antropomorfismi</strong>: attribuire “intelligenza”, “vita”, “autonomia” a sistemi software è
spesso metaforico: bisogna chiarire cosa intendiamo con quei termini, per evitare ambiguità o aspettative irrealistiche.</p></li>
</ul>
<section id="macchina">
<span id="id22"></span><h4>Macchina<a class="headerlink" href="#macchina" title="Permalink to this heading">¶</a></h4>
<p>Una macchina è un sistema chiuso, deterministico e creato artificialmente per raggiungere un obiettivo specifico.</p>
<p>Sistema fatto di parti che esistono l’una per l’altra.</p>
<p>Spesso non varia il proprio comportamento se non in modi predeterminati.</p>
<p>Le relazioni tra le parti sono lineari e l’analisi è di tipo scompositivo (riduzionistico).
La modifica di una macchina è di tipo reattivo (si aggiunge o toglie una parte)</p>
</section>
<section id="sistema-cibernetico">
<span id="id23"></span><h4>Sistema cibernetico<a class="headerlink" href="#sistema-cibernetico" title="Permalink to this heading">¶</a></h4>
<p>Un sistema cibernetico è un sistema che regola il proprio comportamento tramite meccanismi di controllo e retroazione (feedback),
adattandosi alle variazioni dell’ambiente per mantenere uno stato o conseguire uno scopo.</p>
<p>Il termine cibernetica deriva da una parola greca che significa “timoniere”, “colui che guida”.</p>
<p>Norbert Wiener (1894-1964), matematico statunitense, è considerato il padre della cibernetica.
Per Wiener, ciò che accomuna sistemi naturali e artificiali è la capacità di:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>percepire → confrontare → correggere
</pre></div>
</div>
<p>Il ciclo percezione → controllo → azione → percezione è l’essenza del sistema cibernetico,
che offre modelli generaleidi regolazione e controllo capaci di unificare
biologia, ingegneria, matematica, neuroscienze,
formalizzando il concetto di <strong>feedback</strong>.**</p>
</section>
<section id="agente">
<span id="id24"></span><h4>Agente<a class="headerlink" href="#agente" title="Permalink to this heading">¶</a></h4>
<p>Sistema (hardware-software) che interagisce con un ambiente: percepisce input (sensori o messaggi),
produce output (attuatori o messaggi), ha un ciclo percezione - azione.</p>
<p>Opera in modo autonomo e prende decisioni senza essere controllato.</p>
<p>Ogni agente è un sistema cibernetico avanzato.
Non ogni sistema cibernetico è un agente.</p>
<p>L’idea di Russell &amp; Norvig è
che un agente sia un sistema che mappa percezioni in azioni per massimizzare una misura di performance.</p>
<p>Questa definizione generalizza l’idea cibernetica:
i sistemi di Wiener erano soprattutto regolatori;
gli agenti introducono scelte orientate al futuro.</p>
<p>Occorrono precise assunzioni:</p>
<ul>
<li><p>Esistenza di un <strong>ambiente con regolarità</strong>: se l’ambiente fosse completamente caotico
<em>nessuna strategia sarebbe possibile</em></p></li>
<li><p>Esistenza di <strong>obiettivi</strong> (<strong>telos</strong> Aristotelico) e metriche di successo: un agente senza obiettivo è una macchina.
Gli obiettivi possono esseere espliciti (goal logici), normativi,
funzioni di utilità nella Reinforcement Learning (RL)</p></li>
<li><p>Capacità di <strong>previsione</strong> e (spesso) <strong>modello del mondo</strong>:
<strong>modelli espliciti</strong> (mondo rappresentato → GOFAI),
<strong>stimatori statistici</strong> (policy without model → RL),
<strong>pattern reattivi</strong> (modello implicito → <a class="reference external" href="https://it.wikipedia.org/wiki/Stigmergia">Stigmergia</a>)</p>
<p>Il modello può essere <strong>interno o distribuito</strong>.
Nelle società di agenti l’ambiente stesso può essere <em>parte della memoria collettiva</em>.</p>
</li>
</ul>
</section>
<section id="agente-intelligente">
<span id="id25"></span><h4>Agente intelligente<a class="headerlink" href="#agente-intelligente" title="Permalink to this heading">¶</a></h4>
<p>Un agente dotato di capacità di decisione flessibile, adattamento, ragionamento o apprendimento:
cioè un sistema che, oltre a reagire, elabora conoscenza, valuta opzioni, può perseguire obiettivi.</p>
<p>Risulta efficace in una varietà di situazioni/ambienti.</p>
<p>Una defizione data da <strong>Albus</strong> nel 1991 è: agente capce di agire in modo appropriato in un abiente incerto
(ma regolare) dove le azioni appropriate sono quelle che aumentano la possibilià di successo.</p>
</section>
<section id="organismo">
<span id="id26"></span><h4>Organismo<a class="headerlink" href="#organismo" title="Permalink to this heading">¶</a></h4>
<p>Un organismo è un sistema aperto, dinamico che interagisce con l’ambiente e si adatta ad esso.</p>
<p>Sistema (vivente) le cui parti esistono anche l’una per mezzo dell’altra.</p>
<p>Esibisce <em>autopoiesi, omeostasi, adattamento evolutivo, autorganizzazione</em>:
un insieme di sottosistemi integrati, capace di mantenerne l’identità, di auto-regolarsi, di evolvere.</p>
<p>Le relazioni tra le parti sono non lineari, con feedback complessi e l’analisi è di tipo olistico
(si privilegia il tutto).</p>
<p>La modifica di una organismo è di tipo proattivo/evolutivo (si auto-organizza).</p>
</section>
</section>
</section>
<section id="come-si-descrive-un-sistema">
<span id="id27"></span><h2>Come si descrive un sistema<a class="headerlink" href="#come-si-descrive-un-sistema" title="Permalink to this heading">¶</a></h2>
<p>La descrizione di un sistema può essere affrontata da diverse prospettive: una visione interna
(analitica o <strong>WhiteBox</strong>  o <em>come è fatto</em>),
una visione esterna (o <strong>BlackBox</strong> o <em>come si usa</em>)
e una visione <strong>globale</strong> o <em>sistemica</em> per sistema complessi,
che descrive le proprietà ‘emergenti’.</p>
<section id="visione-blackbox">
<span id="id28"></span><h3>Visione BlackBox<a class="headerlink" href="#visione-blackbox" title="Permalink to this heading">¶</a></h3>
<p>La ‘visione’ dall’esterno di un sistema è lagata al modo con cui è possibile interagire
(scambiare informazione) con il sistema.</p>
<ul>
<li><p>La semantica Black Box di un <strong>sistema fisico</strong>  è la funzione matematica o l’equazione differenziale
che lega l’Input all’Output nel tempo.</p>
<p>Una funzione del tipo <code class="docutils literal notranslate"><span class="pre">O(t)</span> <span class="pre">=</span> <span class="pre">f(I(t))</span></code> definisce il
significato del sistema per l’osservatore.
Questo approccio è fondamentale per la Progettazione di <em>Sistemi di Controllo</em>, dove il controllore
(l’osservatore) deve interagire con la Black Box basandosi esclusivamente
sui segnali di ingresso e uscita per manipolare il suo comportamento.</p>
</li>
<li><p>La semantica Black Box di un <strong>sistema software</strong>, è legata all’output emesso dal sistema
sollecitato da un certo input; un osservatore del sistema non è interessato
quanti thread Java, quali protocolli di routing o quali algoritmi
il sistema utilizza internamente.</p>
<p>L’interazione è legata
al concetto di <strong>Interfaccia Pubblica</strong> del sistema
(ad esempio, le API REST di un servizio, la <em>Interface- di un object</em>, la <em>signature</em>- di una funzione).
Questa interfaccia funge da contratto tra il sistema e il mondo esterno, stabilendo l’unico
modo permesso per scambiare informazioni.</p>
<p>L’atto di nascondere i dettagli implementativi ed esporre solo il comportamento essenziale è noto
come <strong>Astrazione</strong> o Occultamento dell’Informazione (<strong>Information Hiding</strong>).</p>
</li>
</ul>
</section>
<section id="visione-whitebox">
<span id="id29"></span><h3>Visione WhiteBox<a class="headerlink" href="#visione-whitebox" title="Permalink to this heading">¶</a></h3>
<p>Per descrivere un sistema ‘dall’interno’ occorrono <strong>almeno tre dimensioni</strong>:
la dimensione <strong>strutturale</strong>, la dimensione della <strong>interazione</strong> e la dimensione
del <strong>comportamento</strong> dei singoli componenti.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 15%" />
<col style="width: 40%" />
<col style="width: 45%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Struttura</strong></p></td>
<td><p>Descrive la disposizione fisica o logica degli elementi; i nodi e i collegamenti.
Risponde a: Quanti sono? Come sono connessi?</p></td>
<td><p>Distingue tra sistemi semplici (poche connessioni) e sistemi complicati o complessi (molte connessioni).</p></td>
</tr>
<tr class="row-even"><td><p><strong>Comportamento</strong></p></td>
<td><p>Descrive Le regole interne e le capacità di elaborazione di ogni singolo elemento del sistema.
Risponde a: Cosa fa ogni parte?</p></td>
<td><p>Distingue i componenti rigidi/prevedibili da quelli autonomi/adattativi (essenziale per l’autoorganizzazione).</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Interazione</strong></p></td>
<td><p>Descrive la natura, la forza e la frequenza degli scambi di informazione/energia tra i componenti.
Risponde a: Come si influenzano a vicenda?</p></td>
<td><p>Cruciale per distinguere complicato (interazioni lineari e fisse) da complesso (interazioni non lineari e dinamiche) e caotico (estrema sensibilità).</p></td>
</tr>
</tbody>
</table>
</section>
<section id="visione-sistemica">
<h3>Visione sistemica<a class="headerlink" href="#visione-sistemica" title="Permalink to this heading">¶</a></h3>
<p>Questo livello descrive le proprietà che appaiono solo quando il sistema viene visto nel suo insieme,
quali la resilienza, l’adattabilità, il grado di prevedibilità e le proprietà emergenti.</p>
<p>E’ un livello di descrizione tipico dei sistemi complessi, indipendente dal tipo di componente. Pone
il focus su pattern di interazione, topologie, coordinazione, flussi informativi.</p>
<section id="more-is-different">
<span id="id30"></span><h4>More is different<a class="headerlink" href="#more-is-different" title="Permalink to this heading">¶</a></h4>
<p>Quando un sistema cresce in dimensione, diventa diverso in natura.
<em>Philip W. Anderson</em> sintetizza gia nel 1972 questa idea con il celebre motto <strong>“More is different”</strong>.
L’aumento del numero di elementi porta all’emergere di proprietà globali non prevedibili analizzando
i singoli componenti.</p>
<p>Le proprietà di un insieme di molti elementi non sono riducibili alla somma delle proprietà dei singoli elementi.</p>
<p>Tali proprietà richiedono un diverso linguaggio descrittivo, focalizzato sulle interazioni
e sugli schemi collettivi, aprendo la strada a una visione sistemica del software.
Per sistemi complessi software — come gli ecosistemi di servizi distribuiti o gli insiemi massivi di attori —
questa visione è oggi indispensabile per comprendere e progettare comportamenti emergenti, robustezza e adattamento.</p>
<p>La frase di Anderson diventa anche un principio di progettazione:</p>
<p>Quando i componenti diventano molti, ciò che conta non è cosa fanno, ma come interagiscono</p>
</section>
</section>
</section>
<section id="perche-i-sistemi-complessi">
<h2>Perchè i sistemi complessi<a class="headerlink" href="#perche-i-sistemi-complessi" title="Permalink to this heading">¶</a></h2>
<p>Per un ingegnere del software è necessario avere consapevolezza di cosa sia un sistema complesso
perchè:</p>
<ul class="simple">
<li><p>i sistemi software moderni non sono solo più macchine gerarchiche e deterministiche:
sono ecosistemi di servizi, microservizi, agenti, attori, componenti autonomi.</p></li>
<li><p>il software moderno è quindi distribuito, eterogeneo, autonomo, adattivo, connesso in rete:
cioè possiede molte delle proprietà osservate nei sistemi complessi naturali.</p></li>
</ul>
<p>Mentre il ‘pensiero sistemico’ iniziò la sua ascesa negli anni Venti del secolo scoro,
la scienza ha cominciato a parlare esplicitamente e a fondo di “sistemi complessi” con le teorie di <em>Prigogine</em>
(anni Settanta)
e con l’emergere della matematica non lineare (caos, frattali, dinamica dei sistemi,
formalizzata dagli anni Ottanta in poi), portando alla nascita della <strong>Scienza della Complessità</strong> negli anni Novanta.</p>
<p>Si può usare la metafora di una montagna: per molti anni la scienza ha concentrato l’attenzione sulla “<strong>fisica dell’ordine</strong>”
(sistemi semplici) e sulla “<strong>fisica del disordine</strong>” (sistemi con moltissime variabili non correlate),
lasciando la “complessità organica” (la vetta del monte) in gran parte inesplorata fino alla fine del <code class="docutils literal notranslate"><span class="pre">XX</span></code> secolo.</p>
<p>La possibilità di <em>scalare la vetta della complessità</em> si è aperta con l’avvento dei computer e delle nuove
tecniche matematiche, che hanno permesso di esplorare la “scala mesoscopica” dei fenomeni biologici e sociali.</p>
<p>Alcuni tratti ricorrenti in questo nuovo campo disciplinare sono riassunti nella tabella che segue:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Tratto distintivo</p></th>
<th class="head"><p>Significato</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Molte entità interagenti</p></td>
<td><p>Un sistema è composto da un gran numero di componenti autonomi che agiscono localmente.</p>
<p><strong>Esempi:</strong> Formicai, reti di microservizi, reti neurali biologiche o artificiali.</p>
</td>
</tr>
<tr class="row-odd"><td><p>Interazioni non lineari</p></td>
<td><p>Le interazioni non si sommano in modo proporzionale: piccole cause possono produrre grandi effetti e viceversa.</p>
<p><strong>Esempi:</strong> Mappa logistica, epidemie, amplificazione in reti sociali.</p>
</td>
</tr>
<tr class="row-even"><td><p>Retroazioni (feedback)</p></td>
<td><p>Gli effetti delle azioni dei componenti ritornano a influenzarli, creando cicli di amplificazione o stabilizzazione.</p>
<p><strong>Esempi:</strong> Controllo ormonale, circuiti di feedback nei sistemi autonomi e nei sistemi ecologici.</p>
</td>
</tr>
<tr class="row-odd"><td><p>Auto-organizzazione</p></td>
<td><p>L’ordine globale emerge spontaneamente dalle interazioni locali, senza un controllo centralizzato.</p>
<p><strong>Esempi:</strong> Sincronizzazione delle lucciole, flocking degli uccelli, clustering spontaneo in robotica swarm.</p>
</td>
</tr>
<tr class="row-even"><td><p>Transizioni ordine/disordine</p></td>
<td><p>Il sistema può passare bruscamente da stati stabili a stati caotici o viceversa, spesso in corrispondenza di soglie critiche.</p>
<p><strong>Esempi:</strong> Transizioni di fase nella materia, collasso di reti infrastrutturali, criticalità auto-organizzata.</p>
</td>
</tr>
<tr class="row-odd"><td><p>Emergenza di pattern globali</p></td>
<td><p>Comportamenti collettivi non prevedibili dalle singole parti, ma derivanti dalle loro interazioni.</p>
<p><strong>Esempi:</strong> Pattern del Game of Life, onde di traffico, comportamenti collettivi nei social network.</p>
</td>
</tr>
</tbody>
</table>
<p>Inoltre:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Tratto distintivo</p></th>
<th class="head"><p>Significato</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Adattamento</p></td>
<td><p>Il sistema modifica la propria struttura o comportamento in risposta all’ambiente o a pressioni interne.</p>
<p><strong>Esempi:</strong> Algoritmi genetici, ecosistemi, sistemi software self-adaptive.</p>
</td>
</tr>
<tr class="row-odd"><td><p>Sensibilità alla topologia delle interazioni</p></td>
<td><p>La forma della rete di connessioni influisce profondamente sulla dinamica del sistema.</p>
<p><strong>Esempi:</strong> Reti small-world (diffusione rapida), reti scale-free (robuste ma fragili ai nodi-hub), reti multilivello.</p>
</td>
</tr>
<tr class="row-even"><td><p>Dinamiche collettive lontane dall’equilibrio</p></td>
<td><p>Il sistema opera in condizioni non stazionarie, mantenute da flussi costanti di energia, materia o informazione.</p>
<p><strong>Esempi:</strong> Reazioni chimiche oscillanti (Belousov–Zhabotinsky), mercati finanziari, sistemi distribuiti event-driven.</p>
</td>
</tr>
</tbody>
</table>
<section id="la-sinergetica">
<h3>La sinergetica<a class="headerlink" href="#la-sinergetica" title="Permalink to this heading">¶</a></h3>
<p>Una delle cornici interpretative fondamentali per comprendere la natura dei sistemi complessi
è la <a class="reference external" href="https://en.wikipedia.org/wiki/Synergetics_(Haken)">sinergetica</a>, introdotta da <strong>Hermann Haken</strong>, l’invetore del <em>Laser</em>.</p>
<p>La sinergetica descrive come l’auto-organizzazione emerga tramite parametri d’ordine,
modi instabili e il principio di asservimento, secondo cui il comportamento collettivo domina
e coordina quello dei singoli componenti.
E’ uno dei “ponti” più eleganti tra:</p>
<ul class="simple">
<li><p>fenomeni fisici quali: auto-organizzazione, emergenza, dinamiche collettive, transizioni ordine/disordine,
asservimento</p></li>
</ul>
<p>e</p>
<blockquote>
<div><ul class="simple">
<li><p>l’ingegneria di sistemi autonomi e distribuiti, in cui un insieme di microservizi o attori autonomi
può generare spontaneamente <em>parametri d’ordine</em> quali sincronizzazione, consenso, oscillazioni, propagazioni,
<em>asservimento</em> tramite orchestrazione e coreografia, <em>transizioni critiche</em> collegabili
alla resilienza dei microservizi, ai circuit breakers, alle cascading failures, alle reti scale-free.</p></li>
</ul>
</div></blockquote>
<p>Il video: <a class="reference external" href="https://www.youtube.com/watch?v=p4jwj8IJjNg">Il Sorprendente Segreto della Sincronizzazione</a> fornisce una panoramica di alcuni
interessanti (e fondamentali) fenomeni di sincornizzazione naturale.
Se ne consiglia vivamente la visione.</p>
</section>
<section id="id31">
<h3>Teoria delle reti<a class="headerlink" href="#id31" title="Permalink to this heading">¶</a></h3>
<p>Un modo ritenuto efficace per descrivere sistemi (complessi) e la loro dimensione
globale/emergente è ricorrere ai modelli di rete (o teoria dei grafi).</p>
<section id="griglie-e-grafi">
<h4>Griglie e grafi<a class="headerlink" href="#griglie-e-grafi" title="Permalink to this heading">¶</a></h4>
<p>Una <strong>griglia</strong>, o reticolo regolare (lattice), è un tipo specifico di grafo caratterizzato da una
topologia altamente regolare e locale.:</p>
<ul class="simple">
<li><p>ogni nodo è collegato allo stesso numero fisso di vicini (es. <code class="docutils literal notranslate"><span class="pre">4</span></code> in una griglia <code class="docutils literal notranslate"><span class="pre">2D</span></code>, <code class="docutils literal notranslate"><span class="pre">6</span></code> in una 3D)</p></li>
<li><p>l’informazione si diffonde lentamente e in modo prevedibile</p></li>
<li><p>non mostrano un’emergenza forte o un comportamento a “piccolo mondo”;
descrivono sistemi complicati o al massimo semplici-complessi.</p></li>
</ul>
<p>Un <strong>grafo</strong> generico non ha restrizioni sulla sua topologia</p>
<ul class="simple">
<li><p>il numero di connessioni per nodo varia enormemente</p></li>
<li><p>possono esistere “salti” o hub che collegano nodi lontani</p></li>
<li><p>descrivono sistemi complessi e autoorganizzati.
Mostrano emergenza, resilienza e vulnerabilità (dipendente dalla topologia).</p></li>
</ul>
<p>La teoria delle reti basata su grafi è la <strong>grammatica formale della complessità</strong>, e permette di spostare la discussione
dalla specificità dei componenti (Java, router, gene) alla topologia che determina il comportamento globale
(complesso, autoorganizzato, caotico).</p>
<p>Ad esempio, modelli che descrivono come l’organizzazione (l’ordine) emerge in reti complesse sono:</p>
<ol class="arabic simple">
<li><p><strong>Reti Casuali</strong> (<em>Erdős-Rényi</em>)</p></li>
</ol>
<blockquote>
<div><p>Queste reti servono da base di confronto. Le connessioni sono disposte in modo puramente casuale.</p>
<ul class="simple">
<li><p><strong>Limitazione</strong>: Non descrivono adeguatamente la maggior parte dei sistemi reali
(Internet, reti biologiche, reti sociali) che hanno strutture molto più organizzate.</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p><strong>Reti a Piccolo Mondo</strong> (<em>Watts e Strogatz</em>)</p></li>
</ol>
<blockquote>
<div><p>Le <a class="reference external" href="https://en.wikipedia.org/wiki/Small-world_network">Small world network</a> hanno un alto coefficiente di clustering (i miei amici sono amici tra loro,
come nelle reti sociali) ma anche una corta distanza media tra i nodi
(di veda la proprietà dei <a class="reference external" href="https://it.wikipedia.org/wiki/Sei_gradi_di_separazione">sei gradi di sperazione</a>).</p>
<ul class="simple">
<li><p><strong>Significato</strong>: Favoriscono la diffusione efficiente dell’informazione o delle malattie.</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p><strong>Reti Scale-Free</strong> (<em>Barabási-Albert</em>)</p></li>
</ol>
<blockquote>
<div><p>Questo è il modello che meglio descrive Internet e molte reti biologiche.</p>
<ul class="simple">
<li><p><strong>Caratteristica</strong>: La distribuzione dei gradi dei nodi segue una legge di potenza.
Ci sono pochissimi nodi con un numero estremamente elevato di collegamenti (gli hub)
e molti nodi con pochissimi collegamenti.</p></li>
<li><p><strong>Meccanismo</strong>: Nascono da un meccanismo di <strong>preferential attachment</strong>
(effetto San Matteo: “i ricchi diventano più ricchi”).</p></li>
<li><p>Proprietà Emergenti:</p>
<ul>
<li><p><strong>Robustezza</strong>: La rete è estremamente resistente al fallimento casuale dei nodi
(perché la maggior parte dei nodi non sono hub).</p></li>
<li><p><strong>Vulnerabilità</strong>: È estremamente vulnerabile a un attacco mirato contro gli hub.</p></li>
</ul>
</li>
</ul>
</div></blockquote>
</section>
</section>
</section>
</section>
<section id="modelli-formali">
<h1>Modelli formali<a class="headerlink" href="#modelli-formali" title="Permalink to this heading">¶</a></h1>
<p><strong>Per descrivere qualcosa occorre un linguaggio.</strong></p>
<p>La necessità di modellare l’imprevedibile e l’emergente ha richiesto, nel caso dei sistemi
fisici,  nuovi strumenti matematici e, nel caso dei sistemi software, nuovi paradigmi computazionali.</p>
<p>Per i <strong>sistemi fisici</strong>, la <em>nuova matematica</em> è basata su dinamica non lineare (attrattori, biforcazioni, caos),
automi cellulari e sistemi discreti, teoria dei frattali, teoria delle reti complesse,
sinergetica.
Questi formalismi non sostituiscono la matematica classica, ma la estendono e la rendono applicabile
a fenomeni emergenti con molti gradi di libertà.</p>
<p>In modo analogo, per i <strong>sistemi software</strong>
l’approccio  classico alla progettazione e costruzione di sistemi (OOP + <a href="#id168"><span class="problematic" id="id169">`UML`_</span></a> + programmazione sequenziale/imperativa)
risulta insufficiente per affrontare problemi in cui vi sono molti componenti che operano
come enti autonomi che interagiscono scambiandosi messaggi, in assenza di memoria comune.</p>
<p>Al concetto di <strong>oggetto</strong> come tipico componente-base per  molti linguaggi general purpose (<strong>GPL</strong>)
<strong>occorre affiancare</strong> oggi concetti quali  <strong>attore</strong> e <strong>agente</strong> come enti autonomi che interagiscono a messaggi.
Questi concetti permettono di ‘disgregare’ le tradizionali <strong>architetture monolitiche</strong> dei sistemi a favore
di archietture distribuite, quali quelle, oggi molto diffuse,  basate su
<strong>microservizi</strong>.</p>
<section id="il-motto-di-alan-kay">
<span id="id32"></span><h2>Il motto di Alan Kay<a class="headerlink" href="#il-motto-di-alan-kay" title="Permalink to this heading">¶</a></h2>
<p>Come ingegneri del software, è ncessario capire i dettagli e le motivazioni della continua evoluzione
dei linguaggi di programmazione, assumendo il quadro concettuale di riferimento enfatizzato da <a class="reference external" href="https://en.wikipedia.org/wiki/Alan_Kay">Alan Kay</a>
(il promotore del linguaggio <strong>Smalltalk</strong>, uno dei progenitori della <em>OOP</em>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Un</span> <span class="n">linguaggio</span> <span class="n">di</span> <span class="n">programmazione</span> <span class="n">è</span> <span class="n">come</span> <span class="n">ali</span> <span class="n">per</span> <span class="n">i</span> <span class="n">nostri</span> <span class="n">pensieri</span><span class="p">,</span>
<span class="n">ma</span> <span class="n">è</span> <span class="n">anche</span> <span class="n">le</span> <span class="n">catene</span> <span class="n">che</span> <span class="n">non</span> <span class="n">ci</span> <span class="n">permettono</span>  <span class="n">di</span> <span class="n">volare</span> <span class="n">più</span> <span class="ow">in</span> <span class="n">alto</span><span class="o">.</span>
</pre></div>
</div>
<p>Questo riassume l’idea che i linguaggi (di programmazione, ma non solo) ci consentono di <strong>esprimere concetti</strong> che altrimenti
sarebbero inesprimibili (le <strong>ali</strong>), ma le loro limitazioni intrinseche (la loro sintassi/semantica) possono
impedirci (le <strong>catene</strong>) di concepire soluzioni più radicali o potenti .</p>
</section>
<section id="dai-modelli-ai-linguaggi">
<h2>Dai modelli ai linguaggi<a class="headerlink" href="#dai-modelli-ai-linguaggi" title="Permalink to this heading">¶</a></h2>
<p>L’evoluzione dei linguaggi di programmazione (<code class="docutils literal notranslate"><span class="pre">LdP</span></code>) si fonda  su una lunga storia di idee matematiche
che hanno cercato di definire in modo preciso che cosa significhi <strong>calcolare</strong>.
Prima ancora che il software esistesse come disciplina autonoma, matematici, logici e filosofi
si trovarono di fronte a un quesito fondamentale:
<strong>esiste un limite intrinseco a ciò che una procedura meccanica può fare?</strong></p>
<p>La risposta a questa domanda richiedeva di esplicitare che cosa fosse, esattamente,
una “procedura meccanica”. Ovvero: un <strong>modello formale</strong> del calcolo.</p>
<p>È in questo contesto che nasce, negli <strong>anni ‘30</strong> del Novecento, la <strong>Macchina di Turing</strong>
(proposta da <a class="reference external" href="https://it.wikipedia.org/wiki/Alan_Turing">Alan M. Turing</a>),
insieme ad altri formalismi equivalenti proposti quasi in parallelo:</p>
<ul class="simple">
<li><p>il <span class="math notranslate nohighlight">\(\lambda\)</span> <strong>calcolo</strong> di Alonzo Church,</p></li>
<li><p>le <strong>funzioni ricorsive</strong> di Gödel, Herbrand e Kleene,</p></li>
<li><p>i <strong>sistemi di riscrittura</strong> di Post e Markov.</p></li>
</ul>
<p>Pur diversi nella forma, questi modelli condividono una sorprendente convergenza:
definiscono tutti la stessa classe di funzioni calcolabili. Da qui il <strong>teorema di Church-Turing</strong>
e la tesi filosofica omonima: tutte le nozioni ragionevoli di “calcolo effettivo” coincidono.</p>
<p>Questa prima stagione dei formalismi nasce dunque <strong>prima dei linguaggi di programmazione</strong>,
e non per scopi ingegneristici, ma <strong>per rispondere a domande di logica matematica e fondamenti</strong>:
cosa può essere calcolato? cosa non può esserlo? cosa significa <em>“algoritmo”</em>?</p>
<p>I primi linguaggi di programmazione, come <code class="docutils literal notranslate"><span class="pre">Fortran</span></code>, <code class="docutils literal notranslate"><span class="pre">Lisp</span></code>, <code class="docutils literal notranslate"><span class="pre">Algol</span></code>, arriveranno <em>dopo</em>,
come reinterpretazione pragmatica dei formalismi astratti.
In alcuni casi (come <code class="docutils literal notranslate"><span class="pre">Lisp</span></code>) il riferimento alla teoria è diretto;
in altri (come <code class="docutils literal notranslate"><span class="pre">C</span></code> o <code class="docutils literal notranslate"><span class="pre">Java</span></code>) è implicito.</p>
</section>
<section id="macchine-astratte">
<h2>Macchine astratte<a class="headerlink" href="#macchine-astratte" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Spesso si qualifica il comportamento di un componente facendo riferimento a tipi diversi di
<span class="blue">macchine astratte</span>, iniziando dalla
<a href="#id170"><span class="problematic" id="id171">`Turing Machine`_</span></a> (<strong>TM</strong>), che individua, in stile imperativo, le mosse-base (<em>primitive</em>)
di un automa che permette di <span class="remark">realizzare qualunque calcolo</span> (!).</p></td>
<td><a class="reference internal image-reference" href="_images/TuringMachine.PNG"><img alt="_images/TuringMachine.PNG" class="align-center" src="_images/TuringMachine.PNG" style="width: 100%;" /></a>
</td>
</tr>
</tbody>
</table>
<p>Un tipo meno potente di macchina astratta rispetto alla <strong>TM</strong> è il <a href="#id172"><span class="problematic" id="id173">`pushdown automaton`_</span></a> (<strong>PDA</strong>) che però è l’automa
di riferimento per il riconoscimento delle frasi di un inguaggio con <em>sintassi context-free</em>, di tipo 2 nella
<a class="reference external" href="https://it.wikipedia.org/wiki/Gerarchia_di_Chomsky">gerarchia di Chomsky</a> , che introdurremo nella sezione <a class="reference internal" href="#macchine-astratte-per-riconoscere-linguaggi"><span class="std std-ref">Macchine astratte per riconoscere linguaggi</span></a>.</p>
</section>
<section id="la-macchina-di-minsky">
<h2>La Macchina di Minsky<a class="headerlink" href="#la-macchina-di-minsky" title="Permalink to this heading">¶</a></h2>
<p>La macchina di Turing (TM) definisce un insiene di mosse con riferimento a un nastro e una testina.
Una classe di macchine astratte che si dimostrano equivalente alla TM è quella
delle macchine a registro o <a class="reference external" href="https://en.wikipedia.org/wiki/Counter_machine">Counter machine</a>.
Una macchina di questa classe possiede un numero finito (<code class="docutils literal notranslate"><span class="pre">N</span></code>) di registri (contatori)
(chiamati <code class="docutils literal notranslate"><span class="pre">R_1,</span> <span class="pre">R_2,...,</span> <span class="pre">R_N</span></code>).</p>
<p>La <em>Macchina di Minsky</em> è stata proposta da
<a class="reference external" href="https://en.wikipedia.org/wiki/Marvin_Minsky">Marvin Minsky</a> nel <strong>1961</strong>, dimostrando
soli due registri (<code class="docutils literal notranslate"><span class="pre">N=2</span></code>) bastano per
simulare qualsiasi TM (e quindi eseguire qualsiasi algoritmo).</p>
<p>La <em>Macchina di Minsky</em> è caratterizzata da solo due tipi di istruzioni:</p>
<blockquote>
<div><table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 35%" />
<col style="width: 65%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>INC(R_i, j)</strong></p></td>
<td><p>Incrementa il registro <code class="docutils literal notranslate"><span class="pre">R_i</span> <span class="pre">di</span> <span class="pre">1.</span> <span class="pre">Salta</span> <span class="pre">all'istruzione</span> <span class="pre">j</span></code>. (Senza condizione)</p></td>
</tr>
<tr class="row-even"><td><p><strong>DEC_JUMP(R_i, j, k)</strong></p></td>
<td><p>Se il registro <code class="docutils literal notranslate"><span class="pre">R_i</span> <span class="pre">&gt;</span> <span class="pre">0,</span> <span class="pre">decrementalo</span> <span class="pre">di</span> <span class="pre">1</span> <span class="pre">e</span> <span class="pre">salta</span> <span class="pre">all'istruzione</span> <span class="pre">j</span></code>.
Altrimenti (se <code class="docutils literal notranslate"><span class="pre">R_i</span> <span class="pre">=</span> <span class="pre">0</span></code>), salta all’istruzione <code class="docutils literal notranslate"><span class="pre">k</span></code></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Notiamo come questo modo di esprimere le operazioni elementari che stanno alla base del calcolo
è più vicina alla nostra idea di computer come macchina capace di eseguire un insieme di
mosse elementari, funzionando come <strong>interprete</strong> del <a class="reference external" href="https://it.wikipedia.org/wiki/Linguaggio_assembly">Linguaggio assembly</a>.</p>
</section>
<section id="problemi-non-riducibili-indecidibili">
<h2>Problemi non riducibili (Indecidibili)<a class="headerlink" href="#problemi-non-riducibili-indecidibili" title="Permalink to this heading">¶</a></h2>
<p>Vi sono problemi per cui è stato dimostrato che una TM (o formulazioni equivalenti) <strong>non</strong>
può produrre una risposta in un tempo finito. Tra i più noti di questi ricordiamo:</p>
<ul class="simple">
<li><p>Il Problema dell’Arresto (<strong>Halting Problem</strong>):
Data una descrizione di un programma (o TM) e il suo input, esisterà un algoritmo in grado di
determinare se quel programma terminerà (si arresterà) o continuerà a funzionare indefinitamente
(loop infinito)?</p></li>
<li><p>Il Problema della Decidibilità (<strong>Entscheidungsproblem</strong>):
Esiste un algoritmo che possa decidere, data una proposizione logica espressa nella logica del primo ordine,
se quella proposizione è universalmente valida (vera in ogni modello)?</p></li>
<li><p>Equivalenza dei Linguaggi Liberi dal Contesto (<strong>CFG Equivalence</strong>):
Date due grammatiche libere dal contesto (CFG), generano esattamente lo stesso linguaggio?</p></li>
</ul>
<p>L’<em>Entscheidungsproblem</em> fu posto da <a class="reference external" href="https://it.wikipedia.org/wiki/David_Hilbert">David Hilbert</a> nel <code class="docutils literal notranslate"><span class="pre">1928</span></code>. Sotto la guida di <em>Hilbert</em>,
<a class="reference external" href="https://it.wikipedia.org/wiki/John_von_Neumann">John von Neumann</a>, nei suoi anni giovanili, si fece portabandiera dell’approccio assiomatico della matematica,
riconoscendo subito il valore dei contributi di   <a class="reference external" href="https://it.wikipedia.org/wiki/Kurt_G%C3%B6del">Kurt Gödel</a> (Teoremi di incompletezza )
che evidenziarono l’impossibilità di conseguire una dimostrazione completa della coerenza
dell’aritmetica nel contesto del pensiero matematico.</p>
<p>L’indecidibilità di un problema <code class="docutils literal notranslate"><span class="pre">P_2</span></code> viene di solito dimostrata riducendolo a un problema <code class="docutils literal notranslate"><span class="pre">P_1</span></code>
che è già noto come indecidibile.</p>
<p>La maggior parte delle prove di indecidibilità nel campo dei linguaggi di programmazione o
delle proprietà dei programmi fa riferimento a un potente strumento formale basato sul concetto di riduzione:
il <a class="reference external" href="https://it.wikipedia.org/wiki/Teorema_di_Rice">Teorema di Rice</a>.</p>
<section id="il-teorema-di-rice">
<h3>Il Teorema di Rice<a class="headerlink" href="#il-teorema-di-rice" title="Permalink to this heading">¶</a></h3>
<p>Il Teorema afferma che:</p>
<p>Qualsiasi proprietà <em>non banale</em> sul linguaggio (o sulla funzione) calcolato da una
Macchina di Turing è indecidibile.</p>
<ul class="simple">
<li><p><strong>Proprietà</strong>: Una caratteristica che un programma può avere
(es. “termina sempre”, “stampa sempre 10 numeri”, “non entra mai in loop”).</p></li>
<li><p><strong>Non banale</strong>: Una proprietà che non è posseduta da tutti i programmi né da nessun programma.
(Ad esempio, “essere un programma” è banale; “essere un programma che calcola <span class="math notranslate nohighlight">\(\pi\)</span> è non banale).</p></li>
</ul>
<p>Esempio: Vogliamo dimostrare che decidere se un programma <code class="docutils literal notranslate"><span class="pre">C++</span></code> stamperà “Hello World” è indecidibile.</p>
<p>Definiamo la proprietà <code class="docutils literal notranslate"><span class="pre">P</span></code>: “Il programma stampa ‘Hello World’.
<code class="docutils literal notranslate"><span class="pre">P</span></code> è non banale (esiste un programma che lo fa, e uno che non lo fa).
Per il Teorema di Rice, la decisione se un dato programma possiede la proprietà <code class="docutils literal notranslate"><span class="pre">P</span></code> è indecidibile.
Non si può costruire un algoritmo generale per questo.</p>
</section>
</section>
<section id="cosa-significa-costruire">
<h2>Cosa significa ‘costruire’<a class="headerlink" href="#cosa-significa-costruire" title="Permalink to this heading">¶</a></h2>
<p>Dunque, i formalismi servono non solo per costruire, ma anche per <strong>sapere cosa possiamo o non possiamo ottenere</strong>:</p>
<p>Questi limiti sono fondamentali per gli ingegneri: <strong>modellano il territorio</strong> in cui è possibile progettare.</p>
<p>Sulla base dei concetti introdotti, possiamo cercare di catturare meglio il significato del temine <em>‘costruire’</em>
nell’ambito del software:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Costruire</span> <span class="n">significa</span> <span class="n">combinare</span> <span class="n">elementi</span> <span class="n">di</span> <span class="n">base</span> <span class="n">secondo</span> <span class="n">regole</span> <span class="n">definite</span>
<span class="n">per</span> <span class="n">ottenere</span> <span class="n">nuove</span> <span class="n">entità</span> <span class="n">o</span> <span class="n">comportamenti</span><span class="o">.</span>
<span class="n">Quando</span> <span class="n">queste</span> <span class="n">combinazioni</span> <span class="n">sono</span> <span class="n">lineari</span><span class="p">,</span> <span class="n">otteniamo</span> <span class="n">strutture</span> <span class="n">prevedibili</span><span class="o">.</span>
<span class="n">Quando</span> <span class="n">invece</span> <span class="n">le</span> <span class="n">interazioni</span> <span class="n">tra</span> <span class="n">componenti</span> <span class="n">generano</span> <span class="n">proprietà</span> <span class="n">non</span> <span class="n">deducibili</span>
<span class="n">dai</span> <span class="n">singoli</span><span class="p">,</span> <span class="n">la</span> <span class="n">costruzione</span> <span class="n">diventa</span> <span class="n">sorgente</span> <span class="n">di</span> <span class="n">complessità</span> <span class="n">ed</span> <span class="n">emergenza</span><span class="o">.</span>
</pre></div>
</div>
<p>Notiamo che gli elementi-base nella costruzione di sistemi software sono le istruzioni interpretabili
da un computer, che , per la tesi di Church Turing, definiscono anche di fatto ciò che è ‘costruibile’
mediante il softwware.</p>
<section id="computazionalmente-completo">
<span id="id33"></span><h3>Computazionalmente completo<a class="headerlink" href="#computazionalmente-completo" title="Permalink to this heading">¶</a></h3>
<p>In informatica teorica si usa spesso il concetto di <strong>Turing completezza</strong>:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Un linguaggio è Turing-completo (<em>Computazionalmente completo</em>) se può simulare qualsiasi macchina di Turing.</p>
</div>
<p>Questo significa che:</p>
<ul class="simple">
<li><p>può <strong>leggere</strong> e <strong>scrivere</strong> memoria arbitraria</p></li>
<li><p>può eseguire <strong>controllo del flusso</strong> (cicli, ramificazioni, ricorsione)</p></li>
<li><p>può comporre operazioni in modo <strong>illimitato</strong></p></li>
</ul>
<p>I GPL conservano queste proproetà anche quando offrono la capacità di
costruire sistemi basati su componenti quali oggetti attori, etc.
Ciascun componente viene <em>alla fine</em> eseguito
(grazie ai compilatori e interpreti)
da istruzioni macchina e dunque mantiene la Turing-completezza del sistema.</p>
<p>Ci sono modelli di calcolo o anche:ref:<cite>Domain-Specific Languages (DSL)</cite>  <strong>deliberatamente</strong> non universali,
per tre motivi principali:</p>
<ul class="simple">
<li><p><strong>Verificabilità</strong> : SL reattivi senza ricorsione → analisi statica garantita</p></li>
<li><p><strong>Sicurezza</strong>:   Smart Contracts (e.g., Tezos Michelson) → prevenzione infinite loops</p></li>
<li><p><strong>Semplificazione concettuale</strong>  DSL dichiarativi per configurazione (SQL senza ricorsione)</p></li>
</ul>
</section>
</section>
<section id="teoria-algoritmica-dell-informazione">
<span id="id34"></span><h2>Teoria Algoritmica dell’Informazione<a class="headerlink" href="#teoria-algoritmica-dell-informazione" title="Permalink to this heading">¶</a></h2>
<p>La <strong>Teoria Algoritmica dell’Informazione</strong> (<strong>AIT</strong>) può essere vista come la versione “metrica”
della teoria di Turing.
Se Turing si occupava di ciò che può essere fatto (<strong>possibilità</strong>), la AIT si occupa di quanto costa farlo
in termini di bit (<strong>complessità</strong>). In sintesi:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Teoria della Computabilità</strong></p></td>
<td><p><strong>Teoria Algoritmica dell’Informazione</strong></p></td>
</tr>
<tr class="row-even"><td><p>Si chiede: “Esiste un algoritmo per questo?”</p></td>
<td><p>Si chiede: “Qual è l’algoritmo più breve per questo?”</p></td>
</tr>
<tr class="row-odd"><td><p>Si concentra sull’esistenza del calcolo.</p></td>
<td><p>Si concentra sulla compressione del calcolo.</p></td>
</tr>
<tr class="row-even"><td><p>Risultato chiave: Il Problema dell’Arresto.</p></td>
<td><p>Risultato chiave: L’Incomputabilità della Complessità.</p></td>
</tr>
</tbody>
</table>
<p>Fondata negli anni ‘60 da <em>Andrej Kolmogorov</em>, <em>Gregory Chaitin</em> e <em>Ray Solomonoff</em>,
la <strong>AIT</strong> definisce l’informazione non come una probabilità statistica (come faceva Shannon),
ma come <strong>struttura e contenuto</strong>.  Riportiamone i punti salienti:</p>
<p>Questa transizione dalla filosofia di Platone alla <strong>Teoria Algoritmica dell’Informazione (AIT)</strong> è il coronamento logico del tuo ragionamento. Se Platone cercava l’essenza delle cose nel mondo delle Idee, l’AIT la cerca nella <strong>lunghezza del programma più breve</strong> capace di generare quella cosa.</p>
<p>Fondata negli anni ‘60 da <strong>Andrej Kolmogorov</strong>, <strong>Gregory Chaitin</strong> e <strong>Ray Solomonoff</strong>,
questa teoria definisce l’informazione non come una probabilità statistica (come faceva Shannon),
ma come <strong>struttura e contenuto</strong>.</p>
<p>Riportiamo i punti concettuali salienti:</p>
<ul>
<li><p><strong>La Complessità di Kolmogorov</strong></p>
<blockquote>
<div><p>Il concetto cardine è che la complessità di un oggetto (come una configurazione del gioco <span class="xref std std-ref">Conway Game of Life</span>)
è definita dalla <strong>lunghezza del programma più breve che lo può produrre</strong>.</p>
<p>K(s) = min { <a href="#id166"><span class="problematic" id="id167">|p|</span></a> : U(p) = s }</p>
<p>Dove s è la stringa, p è il programma e U è una macchina di Turing universale.</p>
<ul class="simple">
<li><p><strong>Bassa Complessità (Senso):</strong> Una griglia piena di “Block” stabili ha una  molto bassa,
perché si può scrivere: <cite>“Disegna un quadrato ogni 5 pixel”</cite>.</p></li>
<li><p><strong>Alta Complessità (Caos):</strong> Una griglia di rumore casuale ha una K altissima, perché l’unico modo
per descriverla è elencare lo stato di ogni singolo cella: <cite>“Cella 1 viva, 2 morta, 3 morta…”</cite>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>La Casualità come Incomprimibilità</strong></p>
<p>Per l’AIT, un oggetto è <strong>casuale</strong> se non può essere compresso.
Se non trovi un algoritmo più breve della stringa stessa per descriverla, allora quella stringa non ha “senso”
o “struttura” logica; è rumore puro.</p>
<p>Questo si ricollega al fatto che il “senso” emerge quando l’osservatore trova una <strong>compressione algoritmica</strong>
(una regola) in ciò che vede. Vedere un “Glider” è un atto di compressione: invece di 5 bit sparsi,
si ‘vede’ un’unica “entità” che si muove.</p>
</li>
<li><p><strong>L’Induzione di Solomonoff e il Rasoio di Occam</strong></p>
<p>Solomonoff ha usato l’AIT per formalizzare matematicamente il Rasoio di Occam. La teoria dice che:</p>
<p>“Tra tutte le ipotesi che spiegano i dati osservati, quella più probabile è la più corta
(quella con la minore complessità algoritmica).”</p>
<p>Nel <span class="xref std std-ref">Conway Game of Life</span>, se si vede uno schema che sembra muoversi,
il cervello sceglie l’ipotesi “È un oggetto semovente” perché è algoritmicamente più semplice che pensare
“Sono centinaia di pixel indipendenti che cambiano stato per puro caso in modo coordinato”.
<strong>Il ‘sensoì è la spiegazione più economica.</strong></p>
</li>
<li><p><strong>Il Numero Omega di Chaitin</strong></p>
<p>Gregory Chaitin ha portato la teoria verso l’ignoto con , la “probabilità di arresto”. <span class="math notranslate nohighlight">\(\Omega\)</span>
è un numero reale che esprime la probabilità che un programma generato casualmente si fermi.</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\Omega\)</span> è <strong>incalcolabile</strong> e racchiude in sé la soluzione a ogni problema matematico.</p></li>
<li><p>Rappresenta il limite estremo della conoscenza: esiste una saggezza (informazione) che nessuna logica può estrarre in modo sistematico.</p>
<p><strong>Senza un osservatore che cerchi la compressione, l’universo è solo una stringa incomprimibile di bit casuali.</strong></p>
</li>
</ul>
</li>
<li><p><strong>Il Problema della “Non-Computabilità”</strong></p>
<p>Un punto critico discusso nella letteratura del 2025 è che la complessità di Kolmogorov è non computabile
(non esiste un algoritmo generale per trovarla sempre).
Questo riflette l’idea di Dennett secondo cui non esiste una “prospettiva divina” per identificare tutti i pattern;
la loro scoperta dipende dalla nostra capacità (limitata ma efficace) di trovare scorciatoie matematiche
e predittive nel caso dei dati.</p>
</li>
<li><p><strong>La Complessità di Kolmogorov come Misura della Realtà</strong></p>
<ul class="simple">
<li><p><strong>Definizione di Pattern</strong>: Negli studi recenti, un pattern dennettiano è definito come una descrizione
compressa dei dati. Se un sistema ha una complessità di Kolmogorov (K(x)) significativamente inferiore
alla lunghezza dei dati grezzi, allora quel sistema contiene un “real pattern”.</p></li>
<li><p><strong>Ontologia algoritmica</strong>: La realtà di un’entità (come un “glider” nel Gioco della Vita) non dipende
dalla sua sostanza, ma dal fatto che l’algoritmo per descrivere il sistema diventa drasticamente
più corto se includiamo quel pattern nella nostra “ontologia”.</p></li>
</ul>
</li>
<li><p><strong>Il Modello del “Minimum Description Length” (MDL)</strong></p>
<p>Nel volume del 2026 di Dennett <em>Real Patterns in Science and Nature</em> (MIT Press), i ricercatori utilizzano
il principio del <em>Minimum Description Length</em> per risolvere il dibattito tra realismo e strumentalismo:</p>
<ul class="simple">
<li><p><strong>Pattern e Rumore</strong>: MDL permette di bilanciare la precisione (aderenza ai dati) e la semplicità
(brevità della descrizione).</p></li>
<li><p><strong>Criterio di Oggettività</strong>: Un pattern è considerato “reale” se e solo se la sua inclusione nel modello
riduce la lunghezza totale della descrizione, pur “pagando” il costo di ignorare un po’ di rumore.</p></li>
</ul>
</li>
</ul>
<section id="applicazione-all-intelligenza-artificiale">
<h3>Applicazione all’Intelligenza Artificiale<a class="headerlink" href="#applicazione-all-intelligenza-artificiale" title="Permalink to this heading">¶</a></h3>
<p>Ricerche pubblicate tra il 2025 e l’inizio del 2026 collegano i pattern di Dennett al funzionamento
dei Large Language Models (LLM):</p>
<ul class="simple">
<li><p><strong>Emergenza</strong>: Le capacità di ragionamento “zero-shot” dei modelli transformer sono interpretate
come l’estrazione di pattern reali (strutture semantiche e logiche) da moltitudini di dati grezzi.</p></li>
<li><p><strong>Codifica Predittiva</strong>: La mente umana e l’IA sono viste come “motori di compressione”
che estraggono pattern reali per minimizzare l’errore di previsione, una tesi che unifica
l’epistemologia di Dennett con le neuroscienze computazionali moderne.</p></li>
</ul>
</section>
</section>
<section id="perche-la-storia-non-si-e-fermata-a-turing">
<h2>Perché la storia non si è fermata a Turing<a class="headerlink" href="#perche-la-storia-non-si-e-fermata-a-turing" title="Permalink to this heading">¶</a></h2>
<p>Con l’evoluzione dei computer, è diventato evidente che i sistemi reali non si riducono a
funzioni matematiche che trasformano un input in un output.</p>
<section id="evoluzione-del-concetto-di-ccmputazione">
<h3>Evoluzione del concetto di Ccmputazione<a class="headerlink" href="#evoluzione-del-concetto-di-ccmputazione" title="Permalink to this heading">¶</a></h3>
<p>Dal <code class="docutils literal notranslate"><span class="pre">1940</span></code> al <code class="docutils literal notranslate"><span class="pre">1970</span></code>, il computer era visto essenzialmente come l’implementazione fisica della Macchina di Turing
o della Macchina di Von Neumann. A un computer veniva affidato il compito di eseguire un <strong>Algoritmo</strong>,
cioè una sequenza finita e ben definita di istruzioni per risolvere un problema specifico o eseguire un calcolo.</p>
<p>Un computer classico (CPU) opera eseguendo istruzioni codificate (linguaggio macchina),
agendo come un <strong>interprete di un linguaggio formale</strong>.
Ogni livello software (dal linguaggio di alto livello fino al microcodice) è un’astrazione
che viene <em>interpretata in istruzioni più fondamentali</em> (elementi di base).</p>
<p>Dopo il <code class="docutils literal notranslate"><span class="pre">1970</span></code>, con l’avvento dei sistemi interattivi, delle reti e di Internet,
i problemi da risolvere non erano più solo di calcolo, ma di organizzazione e interazione con il mondo reale,
con gli utenti e con altre macchine. Vi sono state ‘forze’ che hanno sprinto
verso nuove frontiere:</p>
<ul class="simple">
<li><p><strong>Complessità Crescente</strong>: I programmi sono diventati troppo grandi per essere gestiti come un unico algoritmo,
portando alla necessità di modularità, astrazione e occultamento dell’informazione, come negli oggetti software
e nei (micro)servizi.</p></li>
<li><p><strong>Requisiti di Interazione</strong>: L’informatica si è spostata dal calcolo puro all’interazione continua
(sistemi operativi, reti, database, interfacce utente).
La “correttezza” non è solo la correttezza algoritmica, ma la correttezza comportamentale in un ambiente dinamico.</p></li>
<li><p><strong>Ingegneria del Software</strong>: Si è riconosciuta la necessità di discipline ingegneristiche per gestire
l’intero ciclo di vita del software, superando la sola logica algoritmica.</p></li>
</ul>
<p>Emergono nuove esigenze:</p>
<ul class="simple">
<li><p><strong>concorrenza</strong> e processi che evolvono in parallelo;</p></li>
<li><p><strong>comunicazione</strong> tra entità autonome;</p></li>
<li><p><strong>distribuzione</strong> e assenza di una memoria centrale;</p></li>
<li><p><strong>mobilità</strong> di codici e canali;</p></li>
<li><p><strong>stocasticità</strong> e incertezza;</p></li>
<li><p><strong>comportamenti globali emergenti</strong> da interazioni locali.</p></li>
</ul>
<p>La <em>Macchina di Turing</em> non basta più per descrivere questi fenomeni.
Non è sbagliata: è solo <strong>inadatta</strong> al nuovo dominio.</p>
<p>Il concetto di computazione si è amplia progressivamente, passando dall’idea di calcolo
simbolico/algoritmico a nuove forme, quali:</p>
<ul class="simple">
<li><p><strong>Computazione come processo strutturato</strong> (anni 60-80) in cui La computazione non è più solo trasformazione di simboli,
ma organizzazione di processi concettuali, legati alla evoluzione del software (Programmazione strutturata, oop, etc.).</p></li>
<li><p><strong>Computazione come concorrenza e comunicazione</strong> (anni 70-oggi) in cui computazione diventa interazione, non più solo calcolo
e calcolare significa “scambiare informazione”, non eseguire funzioni matematiche</p></li>
<li><p><strong>Computazione come sistema complesso</strong> (anni 90-oggi) in cui la la computazione viene vista come
entità che cooperano o competono, eventi asincroni, comportamento emergente, auto-organizzazione</p></li>
</ul>
<p>I paradimgi computazionali oggi studiati
dal <a class="reference external" href="https://en.wikipedia.org/wiki/Natural_computing">Natural computing</a> , vengono astratti da fenomenic naturali diversi come
l’auto-organizzazione, l’evoluzione Darwiniana, il comportamento di gruppo (Swarm intelligence),
il sistema immunitario, fino alla idea (<em>Zuse-Fredlink</em>) che l’informazione
sia più fondamentale della materia o dell’energia e che l’universo stesso sia un computer
quantistico (<em>Seth LLyod</em>) che computa il suo proprio comportamento.</p>
<p>Si assiste così a una esplosione di nuovi formalismi, ognuno dei quali nasce per rispondere a una “forza storica” precisa:</p>
<ul class="simple">
<li><p><strong>la concorrenza</strong> → <a class="reference external" href="https://en.wikipedia.org/wiki/Calculus_of_communicating_systems">CCS</a> (Milner) e <a class="reference external" href="https://en.wikipedia.org/wiki/Communicating_sequential_processes">CSP</a> (Hoare), <span class="math notranslate nohighlight">\(\pi\)</span>-calcolo (<a class="reference external" href="https://it.wikipedia.org/wiki/Pi_calcolo">Pi calcolo</a>);</p></li>
<li><p><strong>il comportamento reattivo</strong> → automi, transizione di stato, model checking;</p></li>
<li><p><strong>la computazione distribuita</strong> → Actor Model (Hewitt, Agha), Join Calculus;</p></li>
<li><p><strong>la mobilità</strong> → Mobile Ambients (Cardelli), <span class="math notranslate nohighlight">\(\pi\)</span>-calcolo mobile;</p></li>
<li><p><strong>il caso e la variabilità</strong> → <span class="math notranslate nohighlight">\(\pi\)</span>-calcolo stocastico (Priami), Markov Processes;</p></li>
<li><p><strong>la computazione globale</strong> → Field Calculus, Aggregate Computing (Beal, Viroli).</p></li>
</ul>
<p>In ognuno di questi casi, il formalismo nasce <em>prima</em> dei linguaggi di programmazione che ne derivano.
Ad esempio:</p>
<ul class="simple">
<li><p><strong>Lisp</strong> come incarnazione del <span class="math notranslate nohighlight">\(\lambda\)</span>-calcolo;</p></li>
<li><p><strong>Erlang, Akka, Orleans</strong> come discendenti dell’Actor Model;</p></li>
<li><p><strong>Go, Rust async, CSP libraries</strong> ispirate a CSP;</p></li>
<li><p><strong>Proto, Scafi</strong> ispirati al Field Calculus;</p></li>
<li><p><strong>AmbientTalk, Klaim</strong> ispirati alla mobilità dei processi.</p></li>
</ul>
</section>
<section id="verso-la-definizione-di-sistemi-che-calcolano">
<h3>Verso la definizione di ‘sistemi che calcolano’<a class="headerlink" href="#verso-la-definizione-di-sistemi-che-calcolano" title="Permalink to this heading">¶</a></h3>
<p>Una estrema sintesi dell’evoluzione storica è che si passa:</p>
<ol class="arabic simple">
<li><p><strong>dal calcolo come trasformazione di funzioni</strong>,</p></li>
<li><p><strong>al calcolo come parallelismo  e interazione</strong>,</p></li>
<li><p><strong>al calcolo come comportamento collettivo</strong>,</p></li>
<li><p><strong>al calcolo come fenomeno emergente</strong>.</p></li>
</ol>
<p>Questo cambiamento è profondamente legato alla trasformazione dell’ingegneria del software:
oggi non costruiamo più singoli algoritmi, ma <strong>sistemi distribuiti</strong>,  <strong>microservizi</strong>,
<strong>reti di attori</strong>, <strong>sistemi complessi software</strong>.</p>
</section>
<section id="alcuni-dei-promotori">
<h3>Alcuni dei promotori<a class="headerlink" href="#alcuni-dei-promotori" title="Permalink to this heading">¶</a></h3>
<p>Dalla <em>Macchina di Turing</em> ai calcoli concorrenti, fino ai modelli per sistemi complessi,
la storia dei formalismi è la storia dell’evoluzione della computazione stessa:
da operazioni meccaniche a fenomeni collettivi autonomi.</p>
<p>Ricordiamo alucni degli studiosi che hanno aperto le diverse strade che oggi possiamo percorrere:</p>
<ul class="simple">
<li><p><strong>Alan Turing</strong>,  la computazione come processo meccanico sequenziale.</p></li>
<li><p><strong>Alonzo Church</strong>,  la computazione come trasformazione simbolica (<span class="math notranslate nohighlight">\(\lambda\)</span>-calcolo).</p></li>
<li><p><strong>Stephen Kleene</strong>, <strong>Gödel</strong>, <strong>Herbrand</strong>, computazione come ricorsione.</p></li>
<li><p><strong>Emil Post</strong>, <strong>Markov</strong>, riscrittura e manipolazione di stringhe.</p></li>
<li><p><strong>Robin Milner</strong>, <strong>Tony Hoare</strong>, processi concorrenti e comunicazione.</p></li>
<li><p><strong>Carl Hewitt</strong>, <strong>Gul Agha</strong>, attori come entità autonome.</p></li>
<li><p><strong>Luca Cardelli</strong>, <strong>Andrew Gordon</strong>, mobilità e confini (<em>Ambient Calculus</em>).</p></li>
<li><p><strong>Luca Cardelli</strong>, <strong>Gierz</strong>, <strong>Milner</strong>, transizioni di stato e sistemi dinamici.</p></li>
<li><p><strong>Radhika Nagpal</strong>, <strong>Beal</strong>, <strong>Viroli</strong>, computazione di campo e self-organization.</p></li>
<li><p><strong>Christopher Langton</strong>, <strong>Stuart Kauffman</strong>, <strong>Per Bak</strong>, sistemi complessi e auto-organizzazione.</p></li>
</ul>
<p>Queste figure non hanno solo inventato formalismi:
hanno introdotto <strong>nuovi modi di pensare</strong> il calcolo.</p>
</section>
<section id="oltre-la-macchina-di-von-neumann">
<h3>Oltre la macchina di Von Neumann<a class="headerlink" href="#oltre-la-macchina-di-von-neumann" title="Permalink to this heading">¶</a></h3>
<p>GPU TPU?</p>
<p>L’architettura di Von Neumann — processore centrale (CPU) + memoria separata + esecuzione sequenziale di istruzioni —
rimane il modello di riferimento per la maggior parte dei computer moderni.
Tuttavia, pone limiti ben noti:</p>
<ul class="simple">
<li><p>buona flessibilità generale</p></li>
<li><p>colli di bottiglia nell’accesso alla memoria</p></li>
<li><p>limitata parallelizzazione</p></li>
<li><p>inefficienza energetica con carichi massivamente paralleli</p></li>
</ul>
<p>Da qui deriva la nascita di <strong>nuove architetture</strong>, orientate a superarne i limiti su compiti specifici.
Non è questa le sede per entrare nei dettagki di queste nuove architetture. Riportiamo solo un
quadro sintetico delle alternative oggi più diffuse:</p>
<blockquote>
<div><table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Architettura</strong></p></td>
<td><p><strong>Paradigma</strong></p></td>
<td><p><strong>Applicazioni</strong></p></td>
<td><p><strong>Limitazioni</strong></p></td>
</tr>
<tr class="row-even"><td><p><strong>GPU</strong></p></td>
<td><p>SIMD/SIMT massivo</p></td>
<td><p>Grafica, ML, fisica</p></td>
<td><p>Poco efficiente per logica complessa</p></td>
</tr>
<tr class="row-odd"><td><p><strong>TPU</strong></p></td>
<td><p>Matrici / systolic arrays</p></td>
<td><p>Inferenza e training AI</p></td>
<td><p>Poco efficiente per logica complessa</p></td>
</tr>
<tr class="row-even"><td><p><strong>Quantum</strong></p></td>
<td><p>Superposizione e entanglement</p></td>
<td><p>Problemi esponenziali selezionati</p></td>
<td><p>Rumore, scalabilità, algoritmi specifici</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="quantum-computer">
<span id="id35"></span><h3>Quantum computer<a class="headerlink" href="#quantum-computer" title="Permalink to this heading">¶</a></h3>
<p>La computazione legata sulle leggi  della <a class="reference external" href="https://it.wikipedia.org/wiki/Meccanica_quantistica">Meccanica quantistica</a>
(avanzata da <em>Richard Feynman</em> nel <code class="docutils literal notranslate"><span class="pre">1982</span></code> e poi formalizata da  <em>David Deutsch</em> nel <code class="docutils literal notranslate"><span class="pre">1985</span></code>)
ha promosso lo sviluppo del  <strong>Computer Quantistico (QC)</strong> e del <a class="reference external" href="https://en.wikipedia.org/wiki/Quantum_computing">Quantum computing</a>.</p>
<p>Una convergenza di idee emerse tra la fine degli anni ‘70 e l’inizio degli anni ‘80,
è culminata con l’indicazione di <em>Richard Feynman</em> (<code class="docutils literal notranslate"><span class="pre">1982</span></code>) che un computer basato sulle leggi della
meccanica quantistica potesse essere lo strumento necessario per simulare altri sistemi quantistici.</p>
<p>Su qusta base,
nel <code class="docutils literal notranslate"><span class="pre">1985</span></code>, <em>David Deutsch</em>  formalizzò l’idea di una Macchina di Turing Universale Quantistica,
dimostrando che i principi quantistici potevano essere applicati all’elaborazione dell’informazione,
aprendo la via all’idea di <strong>Computer Quantistico (QC)</strong>.</p>
<p>Nel <code class="docutils literal notranslate"><span class="pre">1994</span></code>, <em>Peter Shor</em> sviluppò
di un algoritmo quantistico in grado di fattorizzare numeri interi in modo esponenzialmente
più veloce dei migliori algoritmi classici.</p>
<p>Da quello momento, la ricerca nel campo del calcolo quantistico è progredita rapidamente,
portando allo sviluppo di prototipi di computer quantistici e alla sperimentazione di
algoritmi quantistici per problemi specifici.</p>
<p>Mentre la programmazione classica lavora con istruzioni che cambiano lo stato da <code class="docutils literal notranslate"><span class="pre">0</span></code> a <code class="docutils literal notranslate"><span class="pre">1</span></code> o viceversa,
la programmazione quantistica lavora con i <strong>qubit</strong>:</p>
<ul class="simple">
<li><p>Un qubit esiste in una sovrapposizione di stati, una combinazione probabilistica di 0 e 1.</p></li>
<li><p>Programmare un QC significa controllare e manipolare queste probabilità per allineare gli stati
quantistici in modo che, al momento della misurazione, lo stato desiderato (la soluzione)
abbia la probabilità massima.</p></li>
</ul>
<p>Ciò che rende il computer quantistico qualitativamente diverso da un computer classico
è l’<strong>entanglement</strong>.</p>
<p>L’entanglement è una correlazione quantistica che si verifica quando lo stato di due o più qubit
è così profondamente legato che non è possibile descrivere lo stato di ciascun qubit indipendentemente,
anche se sono separati da grandi distanze.</p>
<p>Quando un algoritmo quantistico crea entanglement tra <code class="docutils literal notranslate"><span class="pre">N</span></code> qubit, non sta semplicemente lavorando su <code class="docutils literal notranslate"><span class="pre">N</span></code>
bit indipendenti. Sta lavorando su un unico stato quantistico collettivo che può codificare
<code class="docutils literal notranslate"><span class="pre">2^N</span></code> combinazioni classiche contemporaneamente.</p>
<p>Questo significa che, grazie all’entanglement, le porte quantistiche (<strong>Quantum Gates</strong>)
applicate durante l’elaborazione
modificano simultaneamente tutte e <code class="docutils literal notranslate"><span class="pre">2^N</span></code> le possibili soluzioni.
Questo è il fondamento del parallelismo quantistico che accelera esponenzialmente la risoluzione
di alcuni problemi.</p>
<p>La programmazione quantistica viene eseguita utilizzando linguaggi o framework come Qiskit (IBM) o Cirq (Google),
che traducono istruzioni ad alto livello  in circuiti di <em>Quantum Gates</em>.</p>
<p>Ovviamente, la computazione quantistica apre nuove prospettive e nuovi campi di ricerca teorica
e applicate.
Tuttavia, allo stato attuale,
il computer quantistico non sostituisce quello classico, ma fornisce una capacità di calcolo
qualitativamente diversa per specifiche classi di problemi.</p>
<p>Il calcolo di un QC è probabilistico, unitario e non clonabile (No-Cloning Theorem).</p>
<p>alla <em>programmazione quantistica</em> basata su linguaggi o framework come <strong>Qiskit</strong> (IBM) o <strong>Cirq</strong> (Google),
che traducono istruzioni ad alto livello in circuiti di <a class="reference external" href="https://en.wikipedia.org/wiki/Quantum_logic_gate">Quantum Gates</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>La crescente miniaturizzazione dei transistor che compongono un computer  ‘classico’
implica l’insorgere di alcuni fenomeni spiegabili solo con la <a class="reference external" href="https://it.wikipedia.org/wiki/Meccanica_quantistica">Meccanica quantistica</a>.
Ricordiamo al proposito il <strong>Tunneling Quantistico</strong>:</p>
<ul class="simple">
<li><p>responsabile di correnti di dispersione (<strong>leakage current</strong>), che generano calore e sprecano energia.</p></li>
<li><p>usato per spostare gli elettroni dentro e fuori le “floating gate” che
intrappolando elettroni in modo da paermettere
la memorizzazione dei dati nelle <strong>memorie flash</strong> (usate negli <code class="docutils literal notranslate"><span class="pre">SSD</span></code> e nei telefoni).</p></li>
</ul>
</div>
</section>
</section>
<section id="modelli-formali-necessari-ma-non-sufficienti">
<h2>Modelli formali: necessari ma non sufficienti<a class="headerlink" href="#modelli-formali-necessari-ma-non-sufficienti" title="Permalink to this heading">¶</a></h2>
<p>I modelli formali sono importanti perché
isolano l’essenza concettuale dei sistemi permettendo di capirli,
compararli e verificarli in modo rigoroso e universale.</p>
<p>I modelli formali sul calcolo non sono sufficienti perché non dicono <strong>come</strong> realizzare efficientemente
un sistema: sono i <strong>linguaggi di programmazione</strong> che colmano il divario, traducendo principi astratti
in meccanismi concreti, efficienti e utilizzabili nella pratica.</p>
<p>Consideriamo, ad esempio, il il <strong>processo</strong>, spesso introdotto come concetto fondamentale legato
alla computazione.</p>
<p>In <strong>CSP</strong>, <span class="math notranslate nohighlight">\(\pi calcolo\)</span> <strong>calcolo</strong>, ecc.:</p>
<ul class="simple">
<li><p>ciò che esiste sono <strong>processi matematici</strong>, non thread o coroutine;</p></li>
<li><p>un processo è un’entità astratta, definita da un insieme di transizioni o eventi;</p></li>
<li><p>lo stato del processo cambia tramite regole formali (“esegue un evento”, “comunica”, “si sincronizza”).</p></li>
</ul>
<p>In questi modelli:</p>
<ul class="simple">
<li><p><strong>non esistono stack</strong>,</p></li>
<li><p><strong>non esistono scheduler</strong>,</p></li>
<li><p><strong>non esiste il concetto di sospensione volontaria</strong> come <cite>yield</cite> o <cite>await</cite>,</p></li>
<li><p><strong>non c’è distinzione tra thread pesante o coroutine leggera</strong>.</p></li>
</ul>
<p>CSP dice:</p>
<ul class="simple">
<li><p>Esistono processi che comunicano per canali, in modo sincrono.</p></li>
</ul>
<p>Il <span class="math notranslate nohighlight">\(\pi\)</span>-calcolo dice:</p>
<ul class="simple">
<li><p>I processi possono scambiarsi anche canali, supportando mobilità.</p></li>
</ul>
<p>Ma nessuno dei due dice:</p>
<ul class="simple">
<li><p>come si deve gestire lo stack,</p></li>
<li><p>come evitare di creare migliaia di thread pesanti,</p></li>
<li><p>come sospendere una funzione senza bloccare un thread OS.</p></li>
</ul>
<p>Per implementare <em>processi concettuali</em> a basso costo, servivano meccanismi pragmatici.
Tradizionalmente, il concetto di processo è realizzato usando
<em>Thread</em> del sistema operativo o <em>Thread più leggeri</em> gestiti da <em>scheduler</em>.
Tuttavia questi, di solito: <strong>i)</strong> richiedono molta memoria (stack da ~1 MB) <strong>ii)</strong>
sono gestiti da kernel <strong>iii)</strong> hanno costi elevati di switching.</p>
<p>La possibilità pratica di attivare processi si riduce quindi a poche migliaia di <em>Thread</em> in uno stesso
sistema, mentre molte applicazioni moderne richiedono <strong>decine o centinaia di migliaia di attività concorrenti</strong>.</p>
<p>Meccanismi implementativi quali le <strong>callback</strong>
o le <strong>promesse/future</strong> si sono rivelati non ideali
(problema del “callback hell” e della frammentazione del codice).</p>
<p>Un concetto/meccanismo che risale agli albori dell’informatica —
introdotto negli <strong>anni ‘60</strong> come meccanismo di cooperazione tra routine —
poi quasi dimenticato con l’affermarsi dei <em>thread di sistema</em>
è quello di <strong>coroutine</strong>.</p>
<p>Questo meccanismo viene oggi riscoperto e potenziato perché fornisce una soluzione più leggera,
espressiva ed efficiente alla crescente esigenza di concorrenza su larga scala.</p>
</section>
<section id="la-coroutine-un-nuovo-vecchio-concetto">
<span id="id36"></span><h2>La coroutine un nuovo vecchio concetto<a class="headerlink" href="#la-coroutine-un-nuovo-vecchio-concetto" title="Permalink to this heading">¶</a></h2>
<p>La “rinascita” delle coroutine nasce dagli stessi problemi che avevano motiva la loro invenzione
negli anni ‘60:</p>
<ul class="simple">
<li><p>la necessità di gestire altissima concorrenza
(i thread OS sono troppo pesanti per scalare a centinaia di migliaia o milioni di attività)</p></li>
<li><p>la necessità di scrivere codice asincrono leggibile
(superare callback hell, future annidati, codice frammentato)</p></li>
<li><p>la necessità di modelli di concorrenza più sicuri
(riduzione di deadlock e race, privilegiando message passing)</p></li>
</ul>
<p>Introdotte in linguaggi pionieristici come <strong>Simula 67</strong> (uno dei padri della <strong>OOP</strong> e
dei primi concetti di concorrenti cooperativi), <strong>Modula-2</strong> e <strong>Modula-3</strong>
(di <a class="reference external" href="https://it.wikipedia.org/wiki/Niklaus_Wirth">Niklaus Wirth</a>, padre Anche del linguaggio <strong>Pascal</strong> )
e alcune versioni evolute del <em>Lisp</em>,
il concetto è stato oggi riscoperto e potenziato perché fornisce una soluzione più leggera,
espressiva ed efficiente alla crescente esigenza di concorrenza su larga scala.</p>
<p>Esso ritorna in linguaggi come:</p>
<ul class="simple">
<li><p>Go (goroutine, 2009)</p></li>
<li><p>Kotlin (coroutine suspend, 2017)</p></li>
<li><p>Python async/await (2015)</p></li>
<li><p>Java virtual threads (Loom), che di fatto sono coroutine del linguaggio (2023)</p></li>
<li><p>C# async/await (2012)</p></li>
<li><p>JavaScript async/await (2017)</p></li>
</ul>
</section>
<section id="un-esempio-csp-e-go">
<h2>Un esempio: CSP e GO<a class="headerlink" href="#un-esempio-csp-e-go" title="Permalink to this heading">¶</a></h2>
<p><strong>CSP</strong> (<em>Communicating Sequential Processes</em>) è un modello formale introdotto da <strong>Tony Hoare (1978)</strong>
per descrivere sistemi concorrenti.
È usato per <a href="#id37"><span class="problematic" id="id38">*</span></a>specificare, analizzare e verificare- protocolli di comunicazione tra processi.</p>
<p>Riportimo un quadro sintetico delle idee fondamentali di CSP</p>
<ul class="simple">
<li><p>Comunicazione sincrona per messaggi</p></li>
<li><p>Canali come entità di prima classe</p></li>
<li><p>Composizione parallela dei processi</p></li>
<li><p>Nessuna memoria condivisa</p></li>
<li><p>Sincronizzazione implicita nella comunicazione</p></li>
<li><p>Modello matematico verificabile</p></li>
</ul>
<section id="csp-processi-sequenziali">
<h3>CSP: Processi sequenziali<a class="headerlink" href="#csp-processi-sequenziali" title="Permalink to this heading">¶</a></h3>
<p>Le caratteristiche chiave di CSP (in sintesi) sono:</p>
<blockquote>
<div><table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Caratteristica</strong></p></td>
<td><p><strong>Descrizione</strong></p></td>
</tr>
<tr class="row-even"><td><p>Processi sequenziali</p></td>
<td><p>Il sistema è formato da <strong>processi</strong>, ciascuno dei quali è sequenziale: esegue azioni una dopo l’altra.</p></td>
</tr>
<tr class="row-odd"><td><p>Comunicazione per canali</p></td>
<td><ul>
<li><p>La comunicazione è <strong>sincrona</strong>: chi invia e chi riceve devono essere entrambi pronti
→ la comunicazione “si completa insieme”.</p></li>
<li><p>Il canale è un’astrazione matematica: niente buffer (di default).</p>
<p>Esempio :</p>
</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>P = c ! x     // processo P invia x sul canale c
Q = c ? y     // processo Q riceve un valore su c
</pre></div>
</div>
<p>La comunicazione avviene solo quando entrambi i processi sono pronti.</p>
</td>
</tr>
<tr class="row-even"><td><p>Composizione concorrente</p></td>
<td><p>La concorrenza si ottiene tramite <strong>composizione parallela</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">||</span> <span class="n">Q</span>
</pre></div>
</div>
<p>P e Q eseguono in parallelo e devono <em>sincronizzarsi</em> sugli eventi comuni.</p>
</td>
</tr>
<tr class="row-odd"><td><p>Scelta</p></td>
<td><p>Ci sono due tipi di scelta:</p>
<ul class="simple">
<li><p><strong>Scelta esterna</strong> (determinata dall’ambiente)</p></li>
<li><p><strong>Scelta interna</strong> (non osservabile)</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>Verifica formale</p></td>
<td><p>CSP fornisce un <em>algebra formale</em> per ragionare su:</p>
<ul class="simple">
<li><p>deadlock</p></li>
<li><p>livelock</p></li>
<li><p>race conditions</p></li>
<li><p>equivalenza comportamentale</p></li>
</ul>
<p>È molto usato in contesti safety-critical.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="come-csp-ha-influenzato-go">
<h3>Come CSP ha influenzato Go<a class="headerlink" href="#come-csp-ha-influenzato-go" title="Permalink to this heading">¶</a></h3>
<p>Il linguaggio <strong>Go</strong>, creato da Google (Pike, Thompson, Griesemer),
incorpora esplicitamente concetti provenienti da CSP.</p>
<p>La frase di Rob Pike è celebre:</p>
<p><strong>Do not communicate by sharing memory; instead, share memory by communicating.</strong></p>
<p>Go reinterpreta CSP in modo <strong>pragmatico</strong>, rendendolo adatto alla programmazione industriale.
Le principali differenze sono riassunte nella seguente tabella:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|</span> <span class="n">Elemento</span>         <span class="o">|</span> <span class="n">CSP</span>                      <span class="o">|</span> <span class="n">Go</span>                             <span class="o">|</span>
<span class="o">|</span> <span class="o">----------------</span> <span class="o">|</span> <span class="o">------------------------</span> <span class="o">|</span> <span class="o">------------------------------</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Comunicazione</span>    <span class="o">|</span> <span class="n">Sincrona</span>                 <span class="o">|</span> <span class="n">Sincrona</span> <span class="o">+</span> <span class="n">buffer</span> <span class="p">(</span><span class="n">asincrona</span><span class="p">)</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">Semantica</span>        <span class="o">|</span> <span class="n">Matematica</span><span class="p">,</span> <span class="n">formale</span>      <span class="o">|</span> <span class="n">Pratica</span><span class="p">,</span> <span class="n">implementativa</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">Processi</span>         <span class="o">|</span> <span class="n">Astratti</span><span class="p">,</span> <span class="n">infiniti</span>       <span class="o">|</span> <span class="n">Goroutine</span><span class="p">,</span> <span class="n">mappate</span> <span class="n">su</span> <span class="n">thread</span>   <span class="o">|</span>
<span class="o">|</span> <span class="n">Verifica</span> <span class="n">formale</span> <span class="o">|</span> <span class="n">Centrale</span>                 <span class="o">|</span> <span class="n">Non</span> <span class="n">è</span> <span class="n">obiettivo</span> <span class="k">del</span> <span class="n">linguaggio</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Scopo</span>            <span class="o">|</span> <span class="n">Specifica</span> <span class="n">e</span> <span class="n">modellazione</span> <span class="o">|</span> <span class="n">Programmazione</span> <span class="n">applicativa</span>     <span class="o">|</span>
</pre></div>
</div>
<p>Go <strong>si ispira</strong> a CSP, ma <strong>non è una sua implementazione formale</strong>.</p>
<section id="go-routine-come-processi-csp">
<h4>Go-routine come “processi CSP”<a class="headerlink" href="#go-routine-come-processi-csp" title="Permalink to this heading">¶</a></h4>
<p>Le <strong>goroutine</strong> sono entità concorrenti leggere, analoghe ai <em>processi di CSP</em>:
indipendenti, sequenziali, comunicano tramite canali.</p>
<p>I canali di Go sono ispirati direttamente ai canali CSP</p>
<p>Nei canali Go:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ch</span> <span class="o">:=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="nb">int</span><span class="p">)</span>
</pre></div>
</div>
<p>la comunicazione può essere <strong>bloccante</strong> (sincrona), come in CSP.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ch</span> <span class="o">&lt;-</span> <span class="n">x</span>   <span class="o">//</span> <span class="n">invio</span>
<span class="n">y</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">ch</span> <span class="o">//</span> <span class="n">ricezione</span>
</pre></div>
</div>
<p>Il completamento avviene solo quando entrambi sono pronti (<em>sincronizzazione implicita</em>, come in CSP).</p>
<p>Ma Go introduce una differenza importante: i canali <strong>possono essere bufferizzati</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="nb">int</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>Dunque in Go, la comunicazione può essere anche <em>asincrona</em>, quindi più flessibile.</p>
</section>
<section id="select">
<h4>Select<a class="headerlink" href="#select" title="Permalink to this heading">¶</a></h4>
<p>La Select di Go deriva dalla scelta esterna di CSP</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="p">{</span>
  <span class="k">case</span> <span class="n">x</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">ch1</span><span class="p">:</span>
      <span class="o">...</span>
  <span class="k">case</span> <span class="n">ch2</span> <span class="o">&lt;-</span> <span class="n">y</span><span class="p">:</span>
      <span class="o">...</span>
  <span class="n">default</span><span class="p">:</span>
      <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Questo è la versione di Go dell’operatore di <em>scelta esterna di CSP</em>.</p>
</section>
<section id="composizione-concorrente">
<h4>Composizione concorrente<a class="headerlink" href="#composizione-concorrente" title="Permalink to this heading">¶</a></h4>
<p>La frase CSP: <code class="docutils literal notranslate"><span class="pre">`P</span> <span class="pre">||</span> <span class="pre">Q`</span></code></p>
<p>diventa in Go:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">go</span> <span class="n">f</span><span class="p">()</span>   <span class="o">//</span> <span class="n">esegue</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">parallelo</span>
</pre></div>
</div>
<p>La concorrenza nasce dalla creazione di <em>goroutine</em> indipendenti.</p>
</section>
<section id="assenza-di-memoria-condivisa-esplicita">
<h4>Assenza di memoria condivisa “esplicita”<a class="headerlink" href="#assenza-di-memoria-condivisa-esplicita" title="Permalink to this heading">¶</a></h4>
<p>Go permette la memoria condivisa, ma lo <em>stile idiomatico</em> promuove il modello CSP:</p>
<ul class="simple">
<li><p>evitare il locking manuale</p></li>
<li><p>preferire canali ai mutex</p></li>
</ul>
</section>
</section>
</section>
<section id="famiglie-di-formalismi">
<h2>Famiglie di formalismi<a class="headerlink" href="#famiglie-di-formalismi" title="Permalink to this heading">¶</a></h2>
<p>Nel corso della storia dell’informatica teorica, i formalismi si sono evoluti in risposta
a esigenze sempre nuove: definire cosa significhi calcolo, modellare la concorrenza,
gestire sistemi distribuiti non affidabili, comprendere il ruolo della mobilità,
descrivere l’emergenza di comportamenti globali.</p>
<p>Questa evoluzione ha dato vita a una serie di <em>famiglie</em> di formalismi, ciascuna caratterizzata
da un’idea guida, da un ambito di applicazione privilegiato e da risultati teorici
che ne precisano potere espressivo e limiti.</p>
<p>L’insieme delle famiglie  mostra come i formalismi non siano strumenti puramente accademici:
sono la <strong>grammatica fondamentale</strong> con cui l’ingegneria del software comprende e progetta sistemi
sempre più complessi, autonomi, distribuiti e adattivi.</p>
<p>Ogni famiglia è nata in risposta a una tensione storica concreta, e ogni risultato teorico
ha contribuito a definire il perimetro del possibile e dell’impossibile in informatica.</p>
<p>Vediamo una sintetica panoramica di queste principali famiglie.</p>
<section id="formalismi-funzionali">
<h3>Formalismi funzionali<a class="headerlink" href="#formalismi-funzionali" title="Permalink to this heading">¶</a></h3>
<p>La prima grande famiglia è quella dei formalismi funzionali, nata negli <strong>anni ‘30</strong> con Alonzo Church e la definizione
del <span class="math notranslate nohighlight">\(\lambda\)</span> <strong>calcolo</strong>. L’idea fondamentale è che la computazione possa essere vista
come <em>applicazione di funzioni a valori</em>, senza memoria mutabile né effetti collaterali.</p>
<p>Questa visione è profondamente radicata nella logica matematica e nella teoria delle funzioni ricorsive.</p>
<p>Questa famiglia di formalismi serve principalmente a:</p>
<p>I formalismi funzionali servono principalmente a:</p>
<ul class="simple">
<li><p>descrivere la computazione in modo puramente simbolico,</p></li>
<li><p>ragionare su trasformazioni e riduzioni,</p></li>
<li><p>garantire proprietà come la <em>referential transparency</em>,</p></li>
<li><p>dimostrare equazioni e invarianti senza preoccuparsi dello stato.</p></li>
</ul>
<p>Sono fondamentali per discipline come la programmazione funzionale, gli strumenti di ottimizzazione
dei compilatori e i linguaggi basati su funzioni pure (<code class="docutils literal notranslate"><span class="pre">Haskell</span></code>, <code class="docutils literal notranslate"><span class="pre">ML</span></code>).</p>
<p><em>Principali risultati teorici</em></p>
<ul class="simple">
<li><p><strong>Equivalenza Church–Turing</strong>: il <span class="math notranslate nohighlight">\(\lambda\)</span>-calcolo è Turing-completo.</p></li>
<li><p><strong>Teorema di Church–Rosser (confluenza)</strong>: l’ordine di riduzione delle espressioni non influisce sul risultato finale (se questo esiste).</p></li>
<li><p><strong>Indecidibilità della normalizzazione</strong>: non si può decidere in generale se un termine del <span class="math notranslate nohighlight">\(\lambda\)</span>-calcolo ha una forma normale.</p></li>
<li><p><strong>Sistema di tipi</strong>: introduzione dei tipi semplici (Church) e dei sistemi polimorfi, fondamentali per linguaggi moderni.</p></li>
</ul>
<p>Questi risultati fondano l’intera disciplina della programmazione funzionale moderna.</p>
</section>
<section id="formalismi-concorrenti">
<h3>Formalismi concorrenti<a class="headerlink" href="#formalismi-concorrenti" title="Permalink to this heading">¶</a></h3>
<p>A partire dagli <strong>anni ‘60 e ‘70</strong>, con lo sviluppo dei sistemi time-sharing, emerge il problema
della <strong>concorrenza</strong>. Robin Milner, Tony Hoare ed altri introducono formalismi che trattano
i processi <em>non</em> come funzioni, ma come entità dinamiche in comunicazione.</p>
<p>Nascono così <strong>CSP</strong>, <strong>CCS</strong> e, più tardi, il <span class="math notranslate nohighlight">\(\pi\)</span> <strong>calcolo</strong>.</p>
<p>Questa famiglia di formalismi serve principalmente a:</p>
<p>Questi formalismi servono a:</p>
<ul class="simple">
<li><p>modellare processi che evolvono in parallelo,</p></li>
<li><p>formalizzare comunicazioni sincrone/asincrone,</p></li>
<li><p>verificare sicurezza (deadlock-freedom) e liveness,</p></li>
<li><p>definire equivalenze comportamentali (bisimulazione),</p></li>
<li><p>ragionare sul nondeterminismo operativo.</p></li>
</ul>
<p>Sono indispensabili per sistemi real-time, middleware concorrenti, modelli actor
e linguaggi come <code class="docutils literal notranslate"><span class="pre">Erlang</span></code>, <code class="docutils literal notranslate"><span class="pre">Occam</span></code>, <code class="docutils literal notranslate"><span class="pre">Go</span></code> (canali CSP-like).</p>
<p><em>Principali risultati teorici</em></p>
<ul class="simple">
<li><p><strong>Bisimulazione</strong> (Milner, Park): due processi sono equivalenti se non distinguibili da un osservatore esterno.</p></li>
<li><p><strong>Teoria delle transizioni strutturali</strong>: permette di definire formalmente il comportamento di
processi complessi con regole modulari.</p></li>
<li><p><span class="math notranslate nohighlight">\(\pi\)</span> <strong>calcolo Turing-completo</strong> con scambio dinamico di canali.</p></li>
<li><p><strong>Risultati di impossibilità</strong>: certi pattern di mobilità non sono esprimibili in CCS senza estensioni.</p></li>
</ul>
<p>Questi risultati segnano il passaggio decisivo dal calcolo come funzione al calcolo come <em>interazione</em>.</p>
</section>
<section id="formalismi-distribuiti">
<h3>Formalismi distribuiti<a class="headerlink" href="#formalismi-distribuiti" title="Permalink to this heading">¶</a></h3>
<p>Con lo sviluppo delle reti (ARPANET, Internet) emerge la necessità di modellare sistemi
in cui nessun processo possiede un punto di vista globale. <em>Hewitt</em> introdusse l’<strong>Actor Model</strong>
già negli <strong>anni ‘70</strong></p>
<p>Questa famiglia di formalismi serve principalmente a:</p>
<ul class="simple">
<li><p>modellare comunicazione asincrona senza memoria condivisa;</p></li>
<li><p>trattare fallimenti, partizioni di rete, ritardi imprevedibili;</p></li>
<li><p>descrivere algoritmi distribuiti e protocolli;</p></li>
<li><p>caratterizzare il comportamento di  microservizi e cluster.</p></li>
</ul>
<p><em>Principali risultati teorici</em></p>
<ul class="simple">
<li><p><strong>Teorema FLP (Fischer-Lynch-Paterson)</strong>: impossibile garantire consenso deterministico
in un sistema asincrono con un fallo possibile.</p></li>
<li><p><strong>Teorema CAP</strong>: impossibile garantire contemporaneamente <strong>Consistenza, Disponibilità e Tolleranza alla Partizione</strong>.</p></li>
<li><p><strong>Determinismo con attori isolati</strong>: gli attori sono Turing-completi ma con un forte controllo sull’interferenza.</p></li>
</ul>
<dl class="simple">
<dt>Questi risultati hanno avuto impatto diretto sul design dei sistemi cloud e delle architetture a</dt><dd><p>microservizi.</p>
</dd>
</dl>
</section>
<section id="formalismi-per-la-mobilita">
<h3>Formalismi per la mobilità<a class="headerlink" href="#formalismi-per-la-mobilita" title="Permalink to this heading">¶</a></h3>
<p>L’attenzione alla <strong>mobilità</strong> (di codice, processi, canali) emerge negli <strong>anni ‘90</strong> con gruppi
come quello di <em>Luca Cardelli</em> e <em>Andrew Gordon</em>. Nascono così formalismi come il <strong>Mobile Ambients</strong> e
le estensioni mobili del <span class="math notranslate nohighlight">\(\pi\)</span>-calcolo.</p>
<p>Questa famiglia di formalismi serve principalmente a:</p>
<ul class="simple">
<li><p>descrivere sistemi che cambiano struttura dinamicamente;</p></li>
<li><p>modellare agenti mobili, protocolli ad hoc, migrazione di processi;</p></li>
<li><p>rappresentare reti pervasive o IoT.</p></li>
</ul>
<p><em>Principali risultati teorici</em></p>
<ul class="simple">
<li><p><strong>Il mobile</strong> <span class="math notranslate nohighlight">\(\pi\)</span> <strong>calculus</strong> è più espressivo di <strong>CCS</strong>;</p></li>
<li><p><strong>alcune proprietà di sicurezza sono indecidibili</strong> in ambienti mobili;</p></li>
<li><p><strong>gerarchie di potere espressivo</strong> tra modelli nominali e strutturali;</p></li>
<li><p><strong>equivalenza con automi di mobilità</strong> in vari casi.</p></li>
</ul>
<p>Questi formalismi sono fondamentali nella modellazione di sistemi IoT e mobile-cloud.</p>
</section>
<section id="formalismi-stocastici">
<h3>Formalismi stocastici<a class="headerlink" href="#formalismi-stocastici" title="Permalink to this heading">¶</a></h3>
<p>La necessità di modellare comportamenti probabilistici, biologici o di rete porta alla
nascita (<strong>anni 2000</strong>) del <span class="math notranslate nohighlight">\(\pi\)</span> <strong>calcolo stocastico</strong>, delle <strong>CTMC</strong> (<em>continuous-time Markov chain</em>)
e <strong>DTMC</strong> (<em>Discrete-time Markov chain</em>),
dei modelli Markoviani e dei sistemi probabilistici.</p>
<p>Questa famiglia di formalismi serve principalmente a:</p>
<ul class="simple">
<li><p>descrivere sistemi soggetti a rumore, variabilità o fallimenti probabilistici;</p></li>
<li><p>associarne tempi medi, probabilità di stati, rischi;</p></li>
<li><p>supportare model checking probabilistico.</p></li>
</ul>
<p><em>Principali risultati teorici</em></p>
<ul class="simple">
<li><p><strong>ergodicità</strong> e <strong>stazionarietà</strong> delle catene di Markov;</p></li>
<li><p><strong>decidibilità</strong> del model checking probabilistico su <code class="docutils literal notranslate"><span class="pre">DTMC/CTMC</span></code> finite;</p></li>
<li><p><strong>indecidibilità</strong> per modelli con memoria illimitata;</p></li>
<li><p><strong>calcolo Turing-completo</strong> in alcune estensioni probabilistiche del <span class="math notranslate nohighlight">\(\lambda\)</span>-calcolo.</p></li>
</ul>
<p>Questi formalismi sono oggi fondamentali per sistemi autonomi, robotics e protocolli di rete.</p>
</section>
<section id="formalismi-field-based-e-global-behavior">
<h3>Formalismi field-based e global behavior<a class="headerlink" href="#formalismi-field-based-e-global-behavior" title="Permalink to this heading">¶</a></h3>
<p>Dagli <strong>anni 2000-2010</strong> nasce una nuova esigenza: modellare <strong>comportamenti globali emergenti</strong>
a partire da moltissime entità locali.
È la famiglia dei formalismi “a campo”, come il <strong>Field Calculus</strong>, il linguaggio <strong>Proto</strong>,
e le estensioni <strong>aggregate computing</strong>.</p>
<p>Questa famiglia di formalismi serve principalmente a:</p>
<ul class="simple">
<li><p>descrivere sistemi auto-organizzanti;</p></li>
<li><p>modellare propagazione, stabilizzazione e gradienti;</p></li>
<li><p>controllare comportamenti globali senza un coordinatore centrale;</p></li>
<li><p>formalizzare sistemi complessi su larga scala: swarm robotics, reti self-organizing, large IoT.</p></li>
</ul>
<p><em>Principali risultati teorici</em></p>
<ul class="simple">
<li><p><strong>equivalenza del field calculus</strong> con un <span class="math notranslate nohighlight">\(\lambda\)</span> <strong>calcolo distribuito</strong> strutturato su spazio e tempo;</p></li>
<li><p><strong>teoremi di stabilizzazione</strong> in presenza di mobilità e fallimenti;</p></li>
<li><p><strong>limiti della computazione spaziale</strong>: impossibile ottenere global properties con vicinato insufficiente;</p></li>
<li><p><strong>convergenza garantita</strong> per classi di programmi auto-stabilizzanti.</p></li>
</ul>
<p>Questa famiglia rappresenta il ponte più diretto tra sistemi complessi naturali e sistemi complessi software.</p>
</section>
<section id="formalismi-per-sistemi-complessi-e-dinamiche-non-lineari">
<h3>Formalismi per sistemi complessi e dinamiche non lineari<a class="headerlink" href="#formalismi-per-sistemi-complessi-e-dinamiche-non-lineari" title="Permalink to this heading">¶</a></h3>
<p>Modelli come <strong>automi cellulari</strong>, <strong>agent-based models</strong>, <strong>reti complesse</strong> e <strong>sistemi dinamici non lineari</strong>
derivano da un’altra tradizione: fisica, biologia, teoria del caos. Il tema centrale è la <em>dinamica collettiva</em>.</p>
<p>Questa famiglia di formalismi serve principalmente a:</p>
<ul class="simple">
<li><p>analizzare emergenze non lineari;</p></li>
<li><p>studiare caos, biforcazioni, auto-organizzazione;</p></li>
<li><p>modellare popolazioni di agenti, ecosistemi artificiali, fenomeni di sincronizzazione.</p></li>
</ul>
<p><em>Principali risultati teorici</em></p>
<ul class="simple">
<li><p><strong>Turing-completezza</strong> dell’automa cellulare <a class="reference external" href="https://en.wikipedia.org/wiki/Rule_110">Rule 110</a>;</p></li>
<li><p><strong>Teorema di Li-Yorke</strong>: il caos è inevitabile in certi sistemi dinamici;</p></li>
<li><p><strong>criticitá auto-organizzata</strong> (Bak, Tang, Wiesenfeld) produce distribuzioni a legge di potenza;</p></li>
<li><p><strong>limiti alla predicibilità</strong> (sensibilità alle condizioni iniziali).</p></li>
</ul>
<p>Questi formalismi ispirano tecniche di simulazione su larga scala e modelli per “sistemi complessi software”.</p>
</section>
</section>
</section>
<section id="i-linguaggi">
<h1>I linguaggi<a class="headerlink" href="#i-linguaggi" title="Permalink to this heading">¶</a></h1>
<p>E’ importante avere chiara la distinzione tra <em>linguaggio naturale</em> e <em>linguaggio di programmazione</em>
e il ruolo che questo può avere nella definizione e costruzione di oggetti e ‘sistemi artificiali’.</p>
<section id="linguaggi-naturali">
<h2>Linguaggi naturali<a class="headerlink" href="#linguaggi-naturali" title="Permalink to this heading">¶</a></h2>
<p>Il linguaggio naturale (<strong>LN</strong>) come l’italiano, l’inglese, ecc. è lo strumento primario
degli esseri umani per interagire con il mondo e per <em>categorizzarlo</em>.
Il suo ruolo non è solo descrittivo, ma anche costitutivo e sociale, in quanto
un <code class="docutils literal notranslate"><span class="pre">LN</span></code> non è un semplice specchio che riflette oggetti esistenti.</p>
<p>Un <code class="docutils literal notranslate"><span class="pre">LN</span></code> è piuttosto un filtro categoriale che organizza e rende gestibile un flusso continuo di percezioni.
Le impostazioni filosofiche estreme suggeriscono che l’esistenza degli “oggetti” come li conosciamo
(con i loro confini e le loro identità) è un prodotto di questo filtro linguistico.
In questa visione, gli oggetti non esistono “in sé” ma solo come costrutti mentali e si pone il problema di
cosa sia “reale”.</p>
<p>Nonostante la sua potenza, il linguaggio naturale presenta alcune caratteristiche limitative:</p>
<ol class="arabic simple">
<li><p><strong>Vaghezza e Ambiguità</strong>: Molte parole hanno confini sfocati (<em>fuzzy boundaries</em>).
Non esiste un confine netto che determini, ad esempio, quando un “cespuglio” diventi un “albero”
o quando un “sasso” sia abbastanza grande da essere chiamato “roccia”. Questo è il limite della precisione.</p></li>
<li><p><strong>Dipendenza dal Contesto</strong>: La descrizione di un oggetto è sempre incompleta e dipendente dal contesto.
Descrivere un “tavolo” in fisica richiede la massa e la composizione molecolare;
descriverlo in un negozio di mobili richiede lo stile e il prezzo. Nessuna descrizione è totale.</p></li>
<li><p><strong>Problema del Riferimento</strong>: Il linguaggio non può esaurire tutte
le proprietà di un oggetto. Possiamo solo riferirci a un sottoinsieme di proprietà (<strong>l’intensione</strong>)
per identificare la collezione di oggetti (<strong>l’estensione</strong>).</p></li>
</ol>
<p>Gli oggetti reali (<strong>things-in-themselves</strong>) possono esistere fisicamente (cioè, esistono atomi e onde),
ma la loro divisione in categorie discrete e utilizzabili (es. “pianta”, “bottiglia”, “confine”, “matrimonio”)
è un atto imposto dal linguaggio e dalla cultura.</p>
<p>Per molti, non c’è un modo “oggettivo” di dividere il mondo in oggetti.
L’atto di riferimento linguistico a un oggetto è sempre vincolato al sistema linguistico e concettuale
che stiamo usando (la cosiddetta <em>underdetermination of reference</em> del filosofo  <a class="reference external" href="https://it.wikipedia.org/wiki/Willard_Van_Orman_Quine">Willard Van Orman Quine</a>).</p>
<p>In ogni caso, diverse evidenze empiriche indicano che
un <code class="docutils literal notranslate"><span class="pre">LN</span></code> influenza o orienta l’attenzione e la cognizione, rendendo più facile o frequente pensare in certi modi.
Ad esempio, il linguaggio fornisce le categorie che gli umani usano
per interpretare e comunicare la realtà dello spazio e del tempo e queste sono diverse in
contesti culturali diversi (<a class="reference external" href="https://it.wikipedia.org/wiki/Ipotesi_di_Sapir-Whorf">Ipotesi Sapir-Whorf</a>).</p>
<p>Tuttavia, l’ambiguità delle frasi dei linguaggi naturali
(ad esempio: <em>“Ho visto un uomo su una pianta col cannocchiale”</em>)
sono caratteristiche intrinseche e necessarie per la flessibilità e l’espressione umana
e può anche essere vista come un vantaggio:</p>
<ol class="arabic simple">
<li><p><strong>Efficienza e Velocità di Trasmissione</strong>. utilizzando la conoscenza condivisa e il contesto.</p></li>
<li><p><strong>Creatività, Espressione Artistica e Ironia</strong>. Nuovi significati e usi delle parole emergono
proprio grazie alla loro flessibilità e ambiguità, consentendo al linguaggio di evolvere
per adattarsi a nuove realtà sociali e tecnologiche.</p></li>
<li><p><strong>Flessibilità e Adattabilità Sociale</strong>.</p>
<ul class="simple">
<li><p>Mantenere relazioni positive, di negoziare o di evitare il conflitto.</p></li>
<li><p>Identificazione del Contesto (Pragmatica): L’ambiguità ci costringe a interagire
con l’ambiente e con l’altro per risolverla.</p></li>
<li><p>Il processo di disambiguazione contestuale è una funzione cruciale della nostra
intelligenza e della nostra capacità di adattarci a situazioni diverse.</p></li>
</ul>
</li>
</ol>
</section>
<section id="i-large-language-models">
<h2>I Large Language Models<a class="headerlink" href="#i-large-language-models" title="Permalink to this heading">¶</a></h2>
<p>Gli ormai onnipresenti <strong>Large Language Models</strong> (<strong>LLM</strong>) si fondano su concetti di statistica e probabilità
applicate al linguaggio naturale.</p>
<p>Un <strong>LLM</strong> è una rete neurale trasformatrice (<strong>Transformer</strong>), addestrata su miliardi di parole e testi
provenienti da Internet, libri e altre fonti.</p>
<p>Il modello non lavora su singole lettere o parole intere, ma su <strong>token</strong>
(una parola intera, una parte di una parola, un segno di punteggiatura o uno spazio).</p>
<p>Quando il modello elabora un <em>token</em> nel <strong>prompt</strong> dato in input dall’utente, non lo guarda isolatamente,
ma valuta quanto sono importanti tutti gli altri token nel prompt per “dare significato” al token corrente.
Questo modo di procedere è denominato <strong>attenzione</strong> e costruisce una
rappresentazione numerica finale del prompt che include il contesto e l’importanza di ogni parte
del testo di input.</p>
<p>L’ultima rappresentazione numerica del prompt funge da stato iniziale.
A partire da questo stato, il modello fa una <strong>previsione del token successivo</strong>
utilizzando una tecnica chiamata campionamento stocastico o <strong>sampling</strong>
(spesso controllato da un parametro denominato <strong>Temperatura</strong>).</p>
<p>Il processo si ripete, ma questa volta, il nuovo input per la previsione successiva è
l’intero prompt più il token appena generato.</p>
<p>Con questo modo di procedere, un <strong>LLM</strong> non “capisce” nel senso umano.
Il suo successo deriva dalla sua capacità di:</p>
<ul class="simple">
<li><p><strong>Imitare la Sintassi e la Semantica del Testo Umano</strong>: Avendo analizzato enormi quantità di testo,
ha imparato quali sequenze di parole sono statisticamente coerenti e significative.</p></li>
<li><p><strong>Mantenere il Contesto</strong>: Grazie al meccanismo di attenzione, ogni token generato è coerente
non solo con l’ultima parola, ma con l’intero contesto del prompt e della conversazione precedente.</p></li>
</ul>
</section>
<section id="linguaggi-di-programmazione">
<span id="id39"></span><h2>Linguaggi di programmazione<a class="headerlink" href="#linguaggi-di-programmazione" title="Permalink to this heading">¶</a></h2>
<p>I linguaggi di programmazione (<strong>LdP</strong>) sono costruiti per essere l’esatto opposto dei linguaggi naturali
in termini di precisione e ambiguità.</p>
<p>Questi linguaggi ‘artificiali’ non si preoccupano di come l’essere umano percepisce il mondo esterno.
La loro <a class="reference external" href="https://it.wikipedia.org/wiki/Ontologia">ontologia</a> (gli oggetti che esistono) è definita esplicitamente dal programmatore:</p>
<ul class="simple">
<li><p>Gli oggetti sono tipi di dati (<code class="docutils literal notranslate"><span class="pre">Int,</span> <span class="pre">String,</span> <span class="pre">Person</span></code>).</p></li>
<li><p>Lo spazio e il tempo sono gestiti da astrazioni matematiche precise (indirizzi di memoria, timestamp, cicli di CPU).</p></li>
<li><p>Non c’è spazio per la “percezione” individuale dei concetti.</p></li>
</ul>
<p>Se si usa un <code class="docutils literal notranslate"><span class="pre">LdP</span></code>, l’hardware sottostante (il <em>computer</em>) esegue la logica allo stesso modo;
ciò che cambia è l’efficienza e la facilità con cui l’umano esprime quella logica nel linguaggio usato.</p>
<section id="una-frase-misteriosa">
<h3>Una frase misteriosa<a class="headerlink" href="#una-frase-misteriosa" title="Permalink to this heading">¶</a></h3>
<p>Supponiamo che un esploratore abbia trovato una incisione rupestre che si presenta come segue:</p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/FraseEnigmatica.jpg"><img alt="_images/FraseEnigmatica.jpg" class="align-center" src="_images/FraseEnigmatica.jpg" style="width: 60%;" /></a>
</div></blockquote>
<p>Cosa dovrà fare l’esploratore per comprenderne il significato? Certo dovrà occuparsi di sintassi e di semantica.</p>
</section>
<section id="sintassi-e-semantica">
<span id="id40"></span><h3>Sintassi e semantica<a class="headerlink" href="#sintassi-e-semantica" title="Permalink to this heading">¶</a></h3>
<p>Ogni frase di un <code class="docutils literal notranslate"><span class="pre">LdP</span></code> ubbidisce a una precisa sintassi, espressa da regole definite
con notazioni formali.</p>
<p>La frase di un LdP ha sempre una interpretazione univoca che permette al computer di
<strong>agire</strong> in un unico modo: questo modo di agire costituisce la <strong>semantica</strong> della frase.</p>
<ul class="simple">
<li><p><strong>Sintassi</strong>: Riguarda le regole strutturali che definiscono se una frase è legalmente formata
(es. le parentesi sono bilanciate? I punti e virgola sono al posto giusto?).
Se una frase non rispetta la sintassi, è un errore e il computer non può agire.</p></li>
<li><p><strong>Semantica</strong>: Riguarda il significato della frase sintatticamente corretta e le azioni che ne derivano.
La semantica è, in sostanza, la descrizione rigorosa e formale dell’effetto che l’esecuzione di una frase
ha sullo stato della macchina.</p></li>
</ul>
</section>
<section id="linguaggi-per-descrivere-linguaggi">
<span id="id41"></span><h3>Linguaggi per descrivere linguaggi<a class="headerlink" href="#linguaggi-per-descrivere-linguaggi" title="Permalink to this heading">¶</a></h3>
<p>C’è una connessione fondamentale tra linguaggi, macchine e la necessità di
notazioni formali per definire e studiare i linguaggi in modo non ambiguo.</p>
<p>Un <strong>computer</strong> è un sistema fisico. Ogni istruzione di un <code class="docutils literal notranslate"><span class="pre">LdP</span></code> si traduce in una serie di transizioni
di stato all’interno di circuiti e memoria.
Il <strong>linguaggio macchina</strong> di un computer è direttamente
<strong>interpretabile</strong> dalla CPU. Tutto il codice di alto livello deve essere ricondotto
a questo linguaggio di basso livello per l’esecuzione.</p>
<p>Prima che il computer possa eseguire le frasi di un <code class="docutils literal notranslate"><span class="pre">LdP</span></code>, deve <strong>riconoscere</strong> tali frasi (fare il <strong>parsing</strong>)
cioè  determinare se la frase costituisce una sequenza di simboli valida di quel linguaggio.</p>
<p>Per descrivere le forme lecite assumbili dalle frasi di un <code class="docutils literal notranslate"><span class="pre">LdP</span></code> (<strong>sintassi</strong>) si usano
notazioni (dunque ulteriori linguaggi) dette <strong>Grammatiche Formali</strong> costituite da un
sistema di regole  che delineano matematicamente un insieme (di solito infinito)
di sequenze finite di simboli (<em>stringhe</em>) appartenenti ad un <a href="#id42"><span class="problematic" id="id43">*</span></a>alfabeto- anch’esso finito.</p>
<section id="macchine-astratte-per-riconoscere-linguaggi">
<span id="id44"></span><h4>Macchine astratte per riconoscere linguaggi<a class="headerlink" href="#macchine-astratte-per-riconoscere-linguaggi" title="Permalink to this heading">¶</a></h4>
<p>La <a class="reference external" href="https://it.wikipedia.org/wiki/Gerarchia_di_Chomsky">Gerarchia di Chomsky</a> è un insieme di classi di grammatiche formali che generano linguaggi formali.
Un concetto fondamentale nell’informatica teorica
è la corrispondenza tra la <strong>Gerarchia di Chomsky</strong>   e
una <strong>Gerarchia di Macchine Astratte</strong> in grado di riconoscere i linguaggi.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In informatica, una <a class="reference external" href="https://it.wikipedia.org/wiki/Macchina_astratta">Macchina astratta</a> è un modello teorico di sistema computazionale.</p>
<p>La corrispondeza tra tipi di grammatiche e macchine astratte in grado di riconescere
i linguaggi generati può essere riassunta come segue:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 15%" />
<col style="width: 25%" />
<col style="width: 40%" />
<col style="width: 20%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Tipo di Chomsky</strong></p></td>
<td><p><strong>Nome Grammatica</strong></p></td>
<td><p><strong>Macchina Astratta</strong></p></td>
<td><p><strong>Complessità di Riconoscimento</strong></p></td>
</tr>
<tr class="row-even"><td><p><strong>Tipo0</strong></p></td>
<td><p>Unrestricted</p></td>
<td><p>Macchina di Turing</p></td>
<td><p>Indecidibile</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Tipo1</strong></p></td>
<td><p>Context-Sensitive</p></td>
<td><p>Macchina di Turing Limitata Linearmente (LBA)</p></td>
<td><p>Decidibile</p></td>
</tr>
<tr class="row-even"><td><p><strong>Tipo2</strong></p></td>
<td><p><strong>Context-Free</strong></p></td>
<td><p>Automa a Pila (Pushdown Automaton, PDA)</p></td>
<td><p>Decidibile, Tempo Polinomiale</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Tipo3</strong></p></td>
<td><p><strong>Regular</strong></p></td>
<td><p>Automa a Stati Finiti (Finite Automaton, FA)</p></td>
<td><p>Decidibile, Tempo Lineare</p></td>
</tr>
</tbody>
</table>
</div>
<p>Il riconoscimento delle frasi di un <code class="docutils literal notranslate"><span class="pre">LdP</span></code> deve avvenire rapidamente.
Quindi la sintassi di tutti gli <code class="docutils literal notranslate"><span class="pre">LdP</span></code> oggi uso è descritta grammatiche <strong>Context-Free</strong> o <strong>Regular</strong>.</p>
</section>
</section>
<section id="la-analisi-sintattica">
<h3>La analisi sintattica<a class="headerlink" href="#la-analisi-sintattica" title="Permalink to this heading">¶</a></h3>
<p>Le <strong>grammatiche formali</strong> definiscono in modo non ambiguo e matematicamente rigoroso quali sequenze di simboli
(parole chiave, identificatori, operatori, ecc.) costituiscono un programma sintatticamente corretto.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>La notazione più fondamentale è la <em>Forma di Backus-Naur</em> (<strong>BNF</strong>) e la <em>BNF Estesa</em> (<strong>EBNF</strong>).
Questa notazione definisce la sintassi attraverso un insieme di regole di produzione. Ad esempio</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">assegnazione</span><span class="o">&gt;</span> <span class="p">:</span><span class="o">:=</span> <span class="o">&lt;</span><span class="n">variabile</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">espressione</span><span class="o">&gt;</span> <span class="p">;</span>
<span class="o">&lt;</span><span class="n">espressione</span><span class="o">&gt;</span>  <span class="p">:</span><span class="o">:=</span> <span class="o">&lt;</span><span class="n">termine</span><span class="o">&gt;</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">espressione</span><span class="o">&gt;</span> <span class="o">+</span> <span class="o">&lt;</span><span class="n">termine</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Le grammatiche sono essenziali per la costruzione dei traduttori (<strong>compilatori</strong> e <strong>interpreti</strong>):</p>
<ul class="simple">
<li><p><em>Analisi Lessicale</em> (<strong>Lexing</strong>): Il testo viene scomposto in <strong>token</strong> (simboli terminali).</p></li>
<li><p><em>Analisi Sintattica</em> (<strong>Parsing</strong>): Il <em>parser</em> utilizza le regole della grammatica
per verificare se la sequenza di <em>token</em> è strutturalmente corretta.
Se le regole vengono soddisfatte, il parser costruisce un
<strong>Albero Sintattico Astratto</strong> (<strong>AST</strong>), che è la rappresentazione strutturata del codice
che verrà poi usata per definire la semantica (il significato e l’azione) del programma.</p></li>
</ul>
</div>
<p>Sono stati creati tool che generano automaticamente un <em>parser</em> partendo dalla specifica
di un linguaggio di programmazione descritta con la <strong>BNF</strong>, ad esempio <strong>Yacc</strong>
(<em>Yet Another Compiler Compiler</em>).</p>
</section>
<section id="descrivere-la-semantica">
<h3>Descrivere la semantica<a class="headerlink" href="#descrivere-la-semantica" title="Permalink to this heading">¶</a></h3>
<p>Si distinguono diversi tipi di semantica formale, ciascuno con i suoi metodi e applicazioni specifiche.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>La semantica operazionale (<strong>Operational Semantics</strong>) definisce il significato di un programma descrivendo come viene eseguito.
L’attenzione è posta sui passaggi elementari di calcolo che un’istruzione innesca.</p>
<ul class="simple">
<li><p><em>Formalismo Principale</em>: Regole di transizione.</p></li>
<li><p><em>Utilità principale</em>:  Progettazione di interpreti e macchine virtuali</p></li>
</ul>
<p>La semantica denotazionale (<strong>Denotational Semantics</strong>) definisce il significato di un programma associando (o “denotando”)
a ogni costrutto una funzione matematica pura.</p>
<ul class="simple">
<li><p><em>Formalismo Principale</em>: Teoria dei Domini e Punti Fissi (Fixed Points).</p></li>
<li><p><em>Utilità principale</em>: Dimostrazione di equivalenza tra programmi</p></li>
</ul>
<p>La semantica assiomatica (<strong>Axiomatic semantics</strong>) definisce il significato di un programma specificando le proprietà logiche che devono
essere vere prima e dopo l’esecuzione dell’istruzione.</p>
<ul class="simple">
<li><p><em>Formalismo Principale</em>: La Logica di Tony Hoare.</p></li>
<li><p><em>Utilità principale</em>: Verifica e validazione di programmi</p></li>
</ul>
</div>
<p>Il tipo di semantica più utilizzato nella pratica ingegneristica e didattica della programmazione è la
<strong>Semantica Operazionale</strong>, per i seguenti motivi:</p>
<ol class="arabic simple">
<li><p><strong>Corrispondenza Diretta con l’Implementazione</strong>: Le regole della semantica operazionale
(es. “Quando incontri un’istruzione IF, valuta prima la condizione, se è vera esegui il blocco ‘then’,
altrimenti il blocco ‘else’”) sono quasi un blueprint diretto per l’implementazione di un interprete
o di un compilatore. È la forma più vicina a come una macchina esegue i calcoli.</p></li>
<li><p><strong>Facilità di Comprensione e Debug</strong>: I programmatori sono abituati a tracciare l’esecuzione del codice passo dopo passo,
proprio come farebbe un debugger. La semantica operazionale formalizza questa tracciabilità,
rendendo intuitivo capire cosa accadrà ad ogni istruzione.</p></li>
<li><p><strong>Definizione di Standard</strong>: Molte specifiche di linguaggi di programmazione, come C, C++, e Java
(in termini di esecuzione della Java Virtual Machine o JVM), si basano implicitamente o esplicitamente
su un modello operazionale per definire il comportamento del linguaggio in vari scenari.</p></li>
</ol>
</section>
</section>
<section id="compilatori-e-interpreti">
<h2>Compilatori e interpreti<a class="headerlink" href="#compilatori-e-interpreti" title="Permalink to this heading">¶</a></h2>
<p>Un <strong>compilatore</strong> è un programma che traduce l’intero codice sorgente di un LdP ad alto livello in un
programma equivalente in linguaggio macchina (o in un formato eseguibile intermedio),
prima della sua esecuzione.</p>
<p>Un <strong>interprete</strong> è un programma che esegue direttamente il codice sorgente istruzione per istruzione,
traducendo e valutando le frasi  una dopo l’altra.</p>
<p>Molti LdP usano approcci ibridi, come:</p>
<ul class="simple">
<li><p>Java → compilazione in bytecode + interpretazione/ottimizzazione <strong>JIT</strong> (<em>Just-In-Time Compilation</em>)</p></li>
<li><p>Python → bytecode + interprete (CPython)</p></li>
<li><p>JavaScript → interprete + compilazione dinamica <strong>JIT</strong> nei browser</p></li>
</ul>
</section>
<section id="general-processing-programming-languages">
<span id="id45"></span><h2>General Processing Programming Languages<a class="headerlink" href="#general-processing-programming-languages" title="Permalink to this heading">¶</a></h2>
<p>Il numero totale di linguaggi di programmazione (inclusi linguaggi esoterici, accademici e non più in uso)
è stimato in circa <code class="docutils literal notranslate"><span class="pre">2500</span></code>.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 45%" />
<col style="width: 55%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>.</p>
<a class="reference internal image-reference" href="_images/historyHLPL.PNG"><img alt="_images/historyHLPL.PNG" class="align-center" src="_images/historyHLPL.PNG" style="width: 100%;" /></a>
</td>
<td><p>La figura  mostra una visione sintetica dello sviluppo nel tempo di questa evoluzione linguistica,
con riferimento ad alcuni dei linguaggi più noti.</p>
<p>—</p>
<p>L’avvento della programmazione ad oggetti sembra avere segnato il culmine di questo processo;
un motivo può certo essere il raggiungimento di una sufficiente maturità nella capacità espressiva
in ciascuna delle <a class="reference internal" href="#dimensioni"><span class="std std-ref">Dimensioni</span></a> citate.</p>
</td>
</tr>
</tbody>
</table>
<p>Tuttavia, il numero di Linguaggi di Programmazione Generale (<strong>GPL</strong>) attivamente utilizzati in
ambiente industriale è molto più limitato,
probabilmente tra <code class="docutils literal notranslate"><span class="pre">20</span></code> e <code class="docutils literal notranslate"><span class="pre">50</span></code>. Solo una decina di questi domina oltre l’<code class="docutils literal notranslate"><span class="pre">80%</span></code> del mercato dello sviluppo;
tra essi vi sono:</p>
<p><strong>Python, Java, Javascript, C, C++, C#, TypeScript, GO</strong></p>
<p>Questi <code class="docutils literal notranslate"><span class="pre">GPL</span></code> sono quasi sempre utilizzati
in combinazione con <strong>framework</strong> e <strong>librerie</strong> che non solo forniscono funzionalità/utlilità
ma che possono anche alzare il livello di astrazione.
Doiscutermeo questo aspetto più avanti, nella sezione <a class="reference internal" href="#l-astrazione"><span class="std std-ref">L’astrazione</span></a>.</p>
<section id="stili-paradigni-di-programmazione">
<h3>Stili (paradigni) di programmazione<a class="headerlink" href="#stili-paradigni-di-programmazione" title="Permalink to this heading">¶</a></h3>
<p>I linguaggi di programmazione possono essere raggruppati in stili o paradigmi,
che definiscono il <strong>modo concettuale</strong> in cui si struttura un programma per risolvere un problema.</p>
<section id="paradigma-imperativo">
<h4>Paradigma Imperativo<a class="headerlink" href="#paradigma-imperativo" title="Permalink to this heading">¶</a></h4>
<p>Il paradigma imperativo si concentra sul come un programma debba operare. Si basa sul concetto di <strong>stato</strong> e
su istruzioni (o comandi) che modificano sequenzialmente tale stato (variabili, memoria).
Il codice descrive una serie di <strong>azioni esplicite</strong> che il computer deve eseguire.</p>
<p>Come Linguaggio Rappresentativo possiamo citare il <strong>C</strong>.</p>
<dl class="simple">
<dt><strong>Caratteristiche:</strong></dt><dd><ul class="simple">
<li><p><strong>Stato Mutabile:</strong> Le variabili possono essere modificate.</p></li>
<li><p><strong>Flusso di Controllo:</strong> Utilizzo massiccio di costrutti come <em>if/else</em>, <em>for</em>, <em>while</em>, ….</p></li>
<li><p><strong>Procedure/Funzioni:</strong> Raggruppano istruzioni per il riutilizzo.</p></li>
</ul>
</dd>
</dl>
</section>
<section id="paradigma-orientato-agli-oggetti-oop">
<span id="id46"></span><h4>Paradigma Orientato agli Oggetti (OOP)<a class="headerlink" href="#paradigma-orientato-agli-oggetti-oop" title="Permalink to this heading">¶</a></h4>
<p>Derivato dal paradigma imperativo, l’Object Oriented Programming (<strong>OOP</strong>) organizza il software attorno a <strong>oggetti</strong>,
che combinano <strong>dati</strong> (attributi)
e le <strong>funzioni</strong> (metodi) che operano su quei dati. L’obiettivo è modellare entità del mondo reale.</p>
<p>Come Linguaggio Rappresentativo possiamo citare il <strong>C++</strong> o <strong>Java</strong>.</p>
<dl class="simple">
<dt><strong>Caratteristiche:</strong></dt><dd><ul class="simple">
<li><p><strong>Inscapsulamento</strong> (Encapsulation): Raggruppamento di dati e metodi che operano su di essi.</p></li>
<li><p><strong>Ereditarietà</strong> (Inheritance):  Le nuove classi ereditano le proprietà delle classi esistenti.</p></li>
<li><p><strong>Polimorfismo</strong> (Polymorphism):  Oggetti diversi possono rispondere allo stesso input in modi diversi.</p></li>
<li><p><strong>Astrazione</strong> (Abstraction):  Nascondere la complessità implementativa all’utente.</p></li>
</ul>
</dd>
</dl>
</section>
<section id="paradigma-funzionale-fp">
<h4>Paradigma Funzionale (FP)<a class="headerlink" href="#paradigma-funzionale-fp" title="Permalink to this heading">¶</a></h4>
<p>Il paradigma funzionale tratta il calcolo come la valutazione di <strong>funzioni matematiche</strong>
(non nel senso di procedure imperative). Si concentra sul <strong>cosa</strong> calcolare, evitando cambiamenti
di stato e dati mutabili. Promuove l’uso di <strong>funzioni pure</strong>.</p>
<p>Come Linguaggio Rappresentativo possiamo citare il <strong>Lisp/Scheme</strong> o <strong>Haskell</strong>.</p>
<dl class="simple">
<dt><strong>Caratteristiche:</strong></dt><dd><ul class="simple">
<li><p><strong>Immutabilità:</strong> I dati non cambiano una volta creati.</p></li>
<li><p><strong>Funzioni Pure:</strong> Una funzione restituisce sempre lo stesso output per lo stesso input e non produce effetti collaterali (non modifica lo stato esterno).</p></li>
<li><p><strong>Funzioni di Ordine Superiore:</strong> Funzioni che accettano altre funzioni come argomenti o le restituiscono come risultato.</p></li>
</ul>
</dd>
</dl>
</section>
<section id="paradigma-logico-dichiarativo">
<h4>Paradigma Logico (Dichiarativo)<a class="headerlink" href="#paradigma-logico-dichiarativo" title="Permalink to this heading">¶</a></h4>
<p>Questo paradigma si basa sulla <strong>logica formale</strong>. Il programmatore <strong>non</strong> specifica
<em>come</em> trovare la soluzione, ma descrive il problema in termini di <strong>fatti</strong> e <strong>regole</strong>.
Il motore di esecuzione (l’interprete <em>risolutore</em>) cerca le risposte che soddisfano queste regole.</p>
<p>Come Linguaggio Rappresentativo possiamo citare il <strong>Prolog</strong></p>
<dl class="simple">
<dt><strong>Caratteristiche:</strong></dt><dd><ul class="simple">
<li><p><strong>Asserzioni (Facts):</strong> Dichiarazioni vere sul dominio del problema.</p></li>
<li><p><strong>Regole (Rules):</strong> Definizioni di nuove verità basate su fatti esistenti.</p></li>
<li><p><strong>Query:</strong> Domande poste al sistema per dedurre nuove informazioni.</p></li>
<li><p><strong>Backtracking:</strong> Il meccanismo di ricerca automatico per trovare le soluzioni.</p></li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Molti linguaggi moderni (come <em>Python, JavaScript e Scala</em>) sono <strong>multi-paradigma</strong>,
supportando elementi di imperativo, OOP e funzionale.</p>
</div>
</section>
</section>
</section>
<section id="gli-attori-come-nuovo-paradigma">
<span id="id47"></span><h2>Gli attori come nuovo paradigma?<a class="headerlink" href="#gli-attori-come-nuovo-paradigma" title="Permalink to this heading">¶</a></h2>
<p>L’<strong>Actor Model</strong>, ideato da <em>Carl Hewitt</em> nel <code class="docutils literal notranslate"><span class="pre">1973</span></code> e reso popolare da linguaggi come <strong>Erlang</strong> e
framework come <strong>Akka</strong> (implementato in <em>Scala</em> e <em>Java</em>), offre una filosofia di calcolo
che molti vedono come un nuovo stile di programmazione per l’era del multicore e del cloud.</p>
<p>Il focus non è più su cosa fare (Funzionale) o come cambiare lo stato (Imperativo),
ma su come le entità computazionali (Attori) interagiscono
in un ambiente massivamente concorrente e potenzialmente fallibile.</p>
<p>In un modello computazionale ad attori, la priorità è la comunicazione e la gestione dei messaggi.</p>
<ul class="simple">
<li><p><strong>Inscapsulamento Forte e Isolamento</strong>
Ogni Attore è un’entità completamente
incapsulata. È “strutturalmente” un contenitore di stato e comportamento, ma il suo stato
è rigorosamente isolato. Questo significa che la struttura interna di un Attore
non è visibile o accessibile all’esterno. L’unico modo per interagire è attraverso
l’invio di messaggi asincroni.</p></li>
<li><p><strong>Il Messaggio come contratto</strong>
L’attenzione si sposta sulla definizione dei messaggi
che verranno scambiati. Questi messaggi definiscono l’interfaccia pubblica e
il contratto di <strong>interazione</strong> tra gli Attori. La logica del sistema diventa una complessa
rete di conversazioni e risposte a messaggi, piuttosto che una gerarchia di chiamate a metodi sincroni.</p></li>
<li><p><strong>Concorrenza per Composizione</strong>
Invece di preoccuparsi di <em>Lock</em> e <em>Thread</em> per gestire la concorrenza all’interno
di un singolo componente  ci si concentra su come comporre Attori indipendenti
che lavorano in parallelo e coordinano il loro lavoro tramite lo scambio di messaggi.</p></li>
</ul>
<p>Un linguaggio come <strong>Akka</strong> non solo sposta il focus sull’interazione, ma fornisce anche gli strumenti e i
modelli comportamentali intrinseci (isolamento, asincronicità, supervisione) che risolvono
le sfide più difficili della creazione di moderni  <a class="reference external" href="https://en.wikipedia.org/wiki/Microservices">Microservizi</a> resilienti e scalabili.</p>
</section>
<section id="non-determinismo">
<h2>Non determinismo<a class="headerlink" href="#non-determinismo" title="Permalink to this heading">¶</a></h2>
<p>Se una qualche frase di un <code class="docutils literal notranslate"><span class="pre">LdP</span></code> induce un computer ad agire in due o più modi
diversi, si ha una esecuzione non deterministica.</p>
<p>Esempi di forme di non determinsimo si hanno:</p>
<ul>
<li><p><a class="reference external" href="https://it.wikipedia.org/wiki/Edsger_Dijkstra">Edsger Dijkstra</a> ha definito un costrutto teorico che introduce la <strong>scelta non-deterministica</strong>
(usato per prove formali di correttezza)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">C1</span> <span class="o">-&gt;</span> <span class="n">S1</span> <span class="p">[]</span> <span class="n">C2</span> <span class="o">-&gt;</span> <span class="n">S2</span> <span class="n">fi</span><span class="o">.</span>
</pre></div>
</div>
<p>Se entrambe le condizioni (<code class="docutils literal notranslate"><span class="pre">C_1</span></code> e <code class="docutils literal notranslate"><span class="pre">C_2</span></code>) sono vere, il sistema sceglie non deterministicamente
se eseguire <code class="docutils literal notranslate"><span class="pre">S_1</span></code> o <code class="docutils literal notranslate"><span class="pre">S_2</span></code>.</p>
</li>
<li><p>in <strong>Prolog</strong>: La semantica di Prolog non specifica l’ordine in cui il motore di inferenza
deve provare le regole o i fatti per soddisfare un goal.
Il motore sceglie non deterministicamente (anche se le implementazioni reali seguono un ordine predefinito)
un percorso, e se fallisce, “torna indietro” (<strong>backtracking</strong>) e prova un’alternativa.</p></li>
<li><p>In <strong>Akka</strong>: L’ordine in cui gli attori ricevono i messaggi e l’esatto momento in cui elaborano i messaggi
è non-deterministico.</p>
<p>Ad esempio, se l’Actor <code class="docutils literal notranslate"><span class="pre">A</span></code> invia due messaggi all’Actor <code class="docutils literal notranslate"><span class="pre">B</span></code>, non c’è garanzia
che <code class="docutils literal notranslate"><span class="pre">B</span></code> elabori il Messaggio <code class="docutils literal notranslate"><span class="pre">1</span></code> prima del Messaggio <code class="docutils literal notranslate"><span class="pre">2</span></code> se c’è traffico di rete o ritardi.
Questo non-determinismo può essere visto come un forza del modello, poiché costringe gli sviluppatori a scrivere
codice resiliente a qualsiasi temporizzazione.</p>
</li>
</ul>
</section>
<section id="influenza-di-un-ldp-sul-progettista-del-software">
<h2>Influenza di un LdP sul progettista del software<a class="headerlink" href="#influenza-di-un-ldp-sul-progettista-del-software" title="Permalink to this heading">¶</a></h2>
<p>Come già evidenziato da <a class="reference internal" href="#il-motto-di-alan-kay"><span class="std std-ref">Il motto di Alan Kay</span></a>, la struttura di un <code class="docutils literal notranslate"><span class="pre">LdP</span></code> può influenzare
notevolmente il modo in cui il programmatore modella e
risolve un problema. Ad esempio:</p>
<ul class="simple">
<li><p><strong>Prolog</strong> (Logico): Incoraggia a pensare in termini di fatti e regole di deduzione, costringendo
il programmatore a definire cosa è vero.</p></li>
<li><p><strong>Java/C++</strong> (OOP): Incoraggia a modellare il mondo in termini di oggetti, classi e relazioni gerarchiche.</p></li>
<li><p><strong>Lisp/Scala/Haskell</strong> (Funzionale): Incoraggia a pensare in termini di trasformazione di dati
immutabili e composizione di funzioni, riducendo gli effetti collaterali.</p></li>
<li><p><strong>Akka</strong> (Attori): Incoraggia a pensare a un sistema come una collezione di (Micro)servizi
che interagiscono usando Messaggi ed Eventi</p></li>
</ul>
<p>La scelta del linguaggio impone un modello mentale e un modello di oggetto specifico:</p>
<ul class="simple">
<li><p><strong>OOP</strong>: induce a pensare: “Quali entità esistono nel  sistema e quali azioni possono
eseguire su sé stesse?” Questo porta a un modello in cui lo stato (la realtà modellata)
è distribuito e potenzialmente volatile.</p></li>
<li><p><strong>FP</strong>: inducea pensare: “Quali trasformazioni (funzioni) devo applicare a un insieme di dati
immutabili per ottenere il risultato desiderato?”
Questo porta a un modello più robusto per la gestione della complessità e della concorrenza.</p></li>
<li><p><strong>Actor</strong>: inducea pensare: “Quali attori esistono nel sistema e quali messaggi
si devono scambiare e in quale modo?” Questo porta a un modello di sistema a (nano/micro)servizi
come avremo modo di approfondire in seguito.</p></li>
</ul>
<p>Il linguaggio non ha creato alcun oggetto reale,
ma la sua struttura ha creato la sua rappresentazione digitale (<em>Funzione, Classe, Actor</em>)
e ha dettato la logica di sistema (mutazione di stato vs. trasformazione pura vs. scambio di messaggi)
che il software seguirà.</p>
<p>In questo senso, un <code class="docutils literal notranslate"><span class="pre">LdP</span></code> <strong>orienta la soluzione architetturale</strong> che
il progettista sceglie per mappare un problema del mondo reale nella logica computazionale.</p>
</section>
<section id="l-astrazione">
<span id="id48"></span><h2>L’astrazione<a class="headerlink" href="#l-astrazione" title="Permalink to this heading">¶</a></h2>
<p>Un LdP crea i <strong>modelli di enti</strong> con cui la logica
del sistema opera.
Questa fase definisce il <strong>concetto di astrazione in informatica</strong> e la sua relazione con la realtà,
o, meglio, con l’insieme delle rappresentazioni umane del mondo perceptio come ‘reale’.</p>
<section id="realta-vs-modello">
<h3>Realtà vs. Modello<a class="headerlink" href="#realta-vs-modello" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>“Oggetti Reali” (Il <strong>Dominio del Problema</strong>): Sono le entità, i concetti e le interazioni che esistono
al di fuori del codice. Ad esempio, una persona, un conto bancario, un evento fisico
(come un click del mouse) o una transazione finanziaria.
Questi esistono indipendentemente dalla applicazione.</p></li>
<li><p>“Modelli di Oggetti” (Il <strong>Dominio della Soluzione</strong>): Sono le rappresentazioni, o astrazioni, di
quegli oggetti reali create all’interno del linguaggio di programmazione.</p></li>
</ul>
<p>Quando si utilizza la parola “automobile” nel linguaggio naturale, si evoca un’immagine vaga e ricca
di connotazioni. Quando si definisce una <code class="docutils literal notranslate"><span class="pre">Classe</span> <span class="pre">Automobile</span></code> in C++ o Java, si crea un modello preciso
che ha solo le proprietà (velocità, colore, motore) e i comportamenti (<em>accelera</em>, <em>frena</em>)
che sono stati esplicitamente codificati nel linguaggio.</p>
<ul class="simple">
<li><p>In C, un modello potrebbe essere la <em>struct</em> (struttura).</p></li>
<li><p>In C++, un modello può essere la <em>Classe automobile</em>.</p></li>
<li><p>In Prolog, fatti e le regole logiche definiscono le relazioni che coivolgono l’automobile.</p></li>
<li><p>In Akka, un modello potrebbe essere l’<em>Actor automobile</em> che differisce da tutti i precedenti
in quanto esprime l’automobile come un ente intrinsecamente attivo.</p></li>
</ul>
<p>In conclusione: <strong>la programmazione è un esercizio di modellazione</strong>.
I linguaggi di programmazione sono strumenti formali e rigorosi che permettono di creare
rappresentazioni manipolabili di entità per poter applicare una logica e risolvere un problema,
senza cadere nell’ambiguità o nella relatività del linguaggio umano.</p>
</section>
<section id="l-abstraction-gap">
<span id="id49"></span><h3>L’Abstraction gap<a class="headerlink" href="#l-abstraction-gap" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div></div></blockquote>
<p>L’<strong>Abstraction Gap</strong> (<em>Divario di Astrazione</em>) è la distanza concettuale tra:</p>
<ul>
<li><p>Il <strong>Dominio del Problema</strong>: I concetti, le regole e le entità come sono compresi e descritti dagli
esperti del dominio (es. un economista, un biologo, un esperto fiscale) usando il Linguaggio Naturale.</p>
<p><em>Esempio</em> in <code class="docutils literal notranslate"><span class="pre">LN</span></code>: “Ogni cliente della banca deve avere al più un conto corrente in rosso”.</p>
</li>
<li><p>Il <strong>Dominio della Soluzione</strong>: Il modo in cui tali concetti devono essere mappati in strutture,
tipi e logiche eseguibili nel <em>Linguaggio di Programmazione General Purpose</em>
(<span class="xref std std-ref">GPL</span>).</p>
<p><em>Esempio</em> in <code class="docutils literal notranslate"><span class="pre">LdP</span></code> (<em>Java/C++</em>): Il concetto di “Cliente della banca” può essere modellato come un <em>Actor</em>
che possiede uno o più (riferimenti a) <em>Oggetti</em> di classe <code class="docutils literal notranslate"><span class="pre">ContoCorrente</span></code>  oppure come una riga di
una tabella “Clienti” in un database relazionale in relazione con la tabella <code class="docutils literal notranslate"><span class="pre">ContoCorrente</span></code>
o in vari altri modi.</p>
</li>
</ul>
<section id="perche-esiste-l-abstraction-gap">
<h4>Perché esiste l’Abstraction Gap<a class="headerlink" href="#perche-esiste-l-abstraction-gap" title="Permalink to this heading">¶</a></h4>
<p>Nei GPL più comuni
<strong>non esistono</strong> tipi nativi come <em>Microservizio</em>, <em>ConttoCorrent</em>, <em>ContrattoAssicurativo</em>, o <em>EquazioneTermodinamica</em>.
Il programmatore deve tradurre manualmente il linguaggio del dominio nel linguaggio GPL,
un processo che richiede tempo, è soggetto a errori di interpretazione e
spesso diluisce l’intenzione originale del dominio.</p>
</section>
</section>
<section id="modelli-e-linguaggi-di-modellazione">
<span id="id50"></span><h3>Modelli e Linguaggi di modellazione<a class="headerlink" href="#modelli-e-linguaggi-di-modellazione" title="Permalink to this heading">¶</a></h3>
<p>Un <a href="#id174"><span class="problematic" id="id175">`Linguaggio di modellazione`_</span></a> è un <a href="#id176"><span class="problematic" id="id177">`Linguaggio formale`_</span></a>
che può essere utilizzato per descrivere (modellare) un sistema di qualche natura.</p>
<p>Nel linguaggio comune, il termine <cite>modello</cite> è spesso usato per denotare un’astrazione
di qualcosa che esiste nella realtà, come ad esempio il modello che posa per un artista,
una riproduzione in miniatura, un esempio di modo di svolgere un’attività, una forma
da cui ricavare vestiti, un ideale da seguire, etc..</p>
<p>Alcuni (tra cui gli ingegneri) intendono per modello un sistema matematico o fisico che ubbidisce
a specifici vincoli e che può essere utilizzato per descrivere e comprendere un sistema
(fisico, biologico, sociale, etc.) attraverso relazioni di analogia.</p>
<p><strong>Modello=rappresentazione dell’essenza di un sistema</strong></p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_images/Modello.PNG"><img alt="_images/Modello.PNG" class="align-center" src="_images/Modello.PNG" style="width: 70%;" /></a>
</td>
<td><a class="reference internal image-reference" href="_images/ModelloNumeri.PNG"><img alt="_images/ModelloNumeri.PNG" class="align-center" src="_images/ModelloNumeri.PNG" style="width: 100%;" /></a>
</td>
</tr>
</tbody>
</table>
<p>Nel concepire un modello come visione semplificata di un sistema software si assume che il sistema
abbia già una sua esistenza concreta.
In alcune fasi di lavoro (in particolare nella fase di analisi) il sistema è il modello;
un raffinamento o una variazione del modello corrisponde in questo caso ad una variazione del sistema.</p>
<p>La produzione esplicita di modelli si rivela utile in quanto i diversi attori di un processo
di produzione di software (committenti, analisti, progettisti, utenti, etc)
operano a diversi livelli di astrazione e con fini diversi.</p>
<p>Definendo opportuni modelli del sistema da realizzare, in ogni fase del processo di produzione
l’attenzione può essere focalizzata sugli aspetti rilevanti in quella fase, utilizzando una
forma di comunicazione comprensibile ad attori diversi.
Per garantire coesione e interoperabilità, si cerca di individuare regole di corrispondenza
e di trasformazione automatica tra modelli.</p>
</section>
<section id="id51">
<span id="id52"></span><h3>UML<a class="headerlink" href="#id51" title="Permalink to this heading">¶</a></h3>
<p>UML (<em>Unified Modeling Language</em>) è un linguaggio di modellazione e di specifica
di sistemi software basato sul <a class="reference internal" href="#paradigma-orientato-agli-oggetti-oop"><span class="std std-ref">Paradigma Orientato agli Oggetti (OOP)</span></a>. Il linguaggio è definito in termini
di un <strong>linguaggio di meta-modellazione</strong> denominato <code class="docutils literal notranslate"><span class="pre">MOF</span></code> (si veda <a href="#id178"><span class="problematic" id="id179">`Meta Object Facility`_</span></a>) .</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_images/mofUml.PNG"><img alt="_images/mofUml.PNG" class="align-center" src="_images/mofUml.PNG" style="width: 100%;" /></a>
</td>
<td><p>La <a href="#id180"><span class="problematic" id="id181">`Meta Object Facility`_</span></a> di UML2 nella versione incorporata in Eclipse
(denominata <a href="#id182"><span class="problematic" id="id183">`Ecore`_</span></a>) può essere usata per definire un linguaggio che permette di esprimere sistemi software come
oggetti attivi (<strong>attori</strong>) che interagiscono tra loro a scambio di messaggi si comportano come <a href="#id184"><span class="problematic" id="id185">`MooreMachines`_</span></a>.</p></td>
</tr>
</tbody>
</table>
<p>Nel contesto dell’ingegneria del software, <code class="docutils literal notranslate"><span class="pre">UML</span></code> viene usato soprattutto per descrivere il dominio applicativo
di un sistema software e/o il comportamento e la struttura del sistema stesso.</p>
<p>Il modello è strutturato secondo un <strong>insieme di viste</strong> che rappresentano diversi aspetti della cosa modellata
(funzionamento, struttura, comportamento e così via), a scopo sia di analisi sia di progetto,
mantenendo la tracciabilità dei concetti impiegati nelle diverse viste.</p>
<p>Il linguaggio <a href="#id186"><span class="problematic" id="id187">`UML`_</span></a> permette di definire modelli al termine di ogni fase
del processo di sviluppo software:</p>
<ul class="simple">
<li><p><em>Use Case Diagrams</em>: permettono di esprimre il risultato della fase di analisi dei requisiti;</p></li>
<li><p><em>class diagrams</em>, <em>sequence diagrams</em>, <em>activity diagrams</em>, <em>statechart diagram</em> permettono
di esprimre la struttura e il comportmento il sistema al termine della analisi del problema
e del progetto:</p></li>
<li><p><em>deployment diagrams</em> permettono di esprimere le modalità di distribuzione del prodotto.</p></li>
</ul>
<p>Il linguaggio (metanodello) di <a href="#id188"><span class="problematic" id="id189">`UML`_</span></a> (<em>(Unified Modeling Language</em>) è stato definito come strumento
di modellazione di uso generale (GPL), con riferimento alla programmazione ad oggetti.</p>
<p>Tecnicamente, UML non è limitato al :ref:<a class="reference internal" href="#paradigma-orientato-agli-oggetti-oop"><span class="std std-ref">Paradigma Orientato agli Oggetti (OOP)</span></a>,
in quanto permette <strong>estensioni</strong> che lo possono rendere capace di
modellare anche sistemi basati sul <a class="reference internal" href="#gli-attori-come-nuovo-paradigma"><span class="std std-ref">Modello ad Attori</span></a>.
Inoltre esistono  <a class="reference external" href="https://en.wikipedia.org/wiki/Profile_(UML)">Profili UML</a>
definiti da comuità di sviluppattori, come è stato nel caso di Akka.</p>
<p>Un modello UML standard è una specifica, mentre un modello <strong>xUML</strong> (<em>Executable UML</em>)
o <strong>fUML</strong> (<em>Foundational UML</em>)
è una rappresentazione formale che può essere utilizzata da un tool
(come una piattaforma  <a class="reference external" href="https://en.wikipedia.org/wiki/Model-driven_engineering">MDE</a>: <em>Model-Driven Engineering</em>) per:</p>
<ul class="simple">
<li><p><strong>Interpretazione</strong>: Eseguire direttamente il modello per simulare o testare il sistema.</p></li>
<li><p><strong>Trasformazione</strong> (Generazione di Codice): Generare codice sorgente eseguibile completo
(codice della piattaforma) dal modello astratto.</p></li>
</ul>
<p>Questi aspetti sono però ua sorta di ‘add on’ al corpo principale di UML
e <a class="reference internal" href="#il-linguaggio-qak"><span class="std std-ref">Il linguaggio qak</span></a> che introdurremo più avanti
vuole fornire uno strumento più adatto (in quanto esplicitamente
orientato allo scopo) ad
abbattere i costi di produzione di un sistema distribuito.</p>
</section>
</section>
<section id="domain-specific-languages-dsl">
<h2>Domain-Specific Languages (DSL)<a class="headerlink" href="#domain-specific-languages-dsl" title="Permalink to this heading">¶</a></h2>
<p><a class="reference internal" href="#l-abstraction-gap"><span class="std std-ref">L’Abstraction gap</span></a> è un dato di fatto strutturale nell’informatica e
i <em>Domain-Specific Languages</em> (<strong>DSL</strong>) rappresentano oggi la tecnica più potente per riconciliare
il ricco e complesso linguaggio di un certo dominio applicativo con i rigidi e universali GPL.</p>
<p>I DSL sono linguaggi creati per esprimere in modo conciso e non ambiguo i concetti e le regole di un
dominio applicativo specifico. Il loro scopo primario è alzare il livello di astrazione per
colmare <a class="reference internal" href="#l-abstraction-gap"><span class="std std-ref">L’Abstraction gap</span></a> in modo più espressivo di quanto possa fare una libreria o
un framework di un GPL.</p>
<p>È un primo esempio di <strong>DSL</strong>, strettamente <strong>dichiarativo</strong>,
poiché si concentra sulla descrizione del <strong>risultato desiderato</strong> (i dati da recuperare)
piuttosto che sulla sequenza di passi per ottenerlo.</p>
<dl class="simple">
<dt><strong>Caratteristiche:</strong></dt><dd><ul class="simple">
<li><p><strong>Non Procedurale:</strong> Non si specificano i cicli o le condizioni di flusso.</p></li>
<li><p><strong>Set-Oriented:</strong> Le operazioni agiscono su insiemi di dati (tabelle).</p></li>
<li><p><strong>Focus sui Dati:</strong> La logica è incentrata su come manipolare e interrogare i dati relazionali.</p></li>
</ul>
</dd>
</dl>
<p>I DSL possono essere classificati in base alla loro implementazione:</p>
<section id="dsl-interno">
<span id="id53"></span><h3>DSL Interno<a class="headerlink" href="#dsl-interno" title="Permalink to this heading">¶</a></h3>
<p>Un DSL costruito all’interno di un GPL esistente (l’Host Language) viene anche detto
<strong>Embedded DSL</strong>.
Utilizza la sintassi e la semantica dell’LdP host per creare astrazioni di livello superiore.</p>
<ul class="simple">
<li><p><em>Vantaggio</em>: Facile integrazione, sfrutta l’infrastruttura dell’Host Language (es. compilatore, debugger).</p></li>
<li><p><em>Esempi</em>: LINQ in C#, le API Funzionali di Scala (es. le collezioni), l’uso di Builder Pattern in Java.</p></li>
</ul>
</section>
<section id="dsl-esterno">
<span id="id54"></span><h3>DSL Esterno<a class="headerlink" href="#dsl-esterno" title="Permalink to this heading">¶</a></h3>
<p>Si tratta di un linguaggio completamente nuovo, con la sua sintassi, parser e motore di esecuzione.</p>
<ul class="simple">
<li><p><em>Vantaggio</em>: Massima espressività, può essere letto e scritto direttamente dagli esperti del dominio, totale indipendenza dal GPL.</p></li>
<li><p><em>Esempi</em>: SQL (per interrogare database), Regex (per pattern matching), YAML/JSON (per la configurazione).</p></li>
</ul>
<p>Il framework <strong>Xtext</strong> si basa sull’ecosistema <strong>Eclipse</strong> e offre strumenti per ampliare
Eclipse con appositi plugin per fornsre un editor guidato dalla sintassi, e
un generazione di codice (Java, Kotlin o altro) che realizza la semantica del linguaggio.</p>
<a class="reference internal image-reference" href="_images/factory.jpg"><img alt="_images/factory.jpg" class="align-center" src="_images/factory.jpg" style="width: 100%;" /></a>
<p>I DSL traducono direttamente concetti del <code class="docutils literal notranslate"><span class="pre">LN</span></code> in costrutti formali
che sono facili da comprendere sia dagli esperti del dominio che dai programmatori.</p>
<p><strong>Esempio</strong>: Nonostante Java non abbia una parola chiave “Microservizio”,
un Framework (come <em>Akka</em> o <em>Spring Cloud</em>) può essere visto come un insieme di astrazioni che creano un
DSL interno:</p>
<ul class="simple">
<li><p>Si usano annotazioni come <code class="docutils literal notranslate"><span class="pre">&#64;Service</span></code> o si definiscono <code class="docutils literal notranslate"><span class="pre">Actor</span></code> (come in <em>Akka</em>) che mappano direttamente
il concetto di unità isolata del microservizio.</p></li>
<li><p>Questo “Linguaggio” all’interno del Framework permette agli sviluppatori di pensare e scrivere in
termini di servizi anziché solo in termini di classi e thread.</p></li>
</ul>
<p><a class="reference internal" href="#il-linguaggio-qak"><span class="std std-ref">Il linguaggio qak</span></a> che introdurremo più avanti costituisce una <a class="reference internal" href="#dsl-esterno"><span class="std std-ref">DSL Esterno</span></a> che permette di esprimere
in modo diretto concetti (attore, messaggio, etc.) particolarmente rilevanti per la costruzione di sistemi software
distribuiti a microserivizi.</p>
<p><strong>Vantaggi Principali a livello Applicativo</strong></p>
<p>L’uso di DSL per colmare <a class="reference internal" href="#l-abstraction-gap"><span class="std std-ref">L’Abstraction gap</span></a> offre vantaggi sostanziali:</p>
<ul class="simple">
<li><p><strong>Riduzione dell’Ambiguità</strong>: I concetti del dominio vengono espressi in modo formale e non ambiguo
(es. “calcolaInteressi” nel DSL fiscale è univoco, a differenza dell’LN).</p></li>
<li><p><strong>Aumento della Produttività</strong>: I programmatori lavorano con astrazioni più vicine al problema,
riducendo la quantità di “boilerplate code” (codice standardizzato e ripetitivo).</p></li>
<li><p><strong>Manutenibilità</strong>: Quando le regole del dominio cambiano (es. una nuova legge fiscale), si modificano
solo le definizioni nel DSL (che è ad alto livello), senza toccare gran parte della logica
di basso livello del GPL.</p></li>
</ul>
</section>
</section>
<section id="i-dsl-e-i-digital-twins">
<span id="id55"></span><h2>I DSL e i Digital Twins<a class="headerlink" href="#i-dsl-e-i-digital-twins" title="Permalink to this heading">¶</a></h2>
<p>I DSL consentono agli esperti di un dominio (ingegneri meccanici, fisici, chimici) di esprimere
la logica e le proprietà di un asset fisico senza dipendere da programmatori software
o da GPL.</p>
<p>Questo aspetto è particolarmente rilevante per un sistemi software che svolge il ruolo
di <a class="reference external" href="https://it.wikipedia.org/wiki/Gemello_digitale">Gemello Digitale</a>  (<strong>Digital Twin</strong> o <strong>DT</strong>) di un sistema fisico.</p>
<p>Il termine <em>Digital Twin</em> è stato introdotto nel <code class="docutils literal notranslate"><span class="pre">2003</span></code>  da <em>Michael Grieves</em>
per denotare la replica digitale di una qualsiasi Entità Fisica che
viene vista come la fonte dei dati
su cui il <strong>DT</strong> opera per realizzare alcune funzionalità chiave:</p>
<ul class="simple">
<li><p><strong>Monitoraggio in Tempo Reale</strong>: Il <code class="docutils literal notranslate"><span class="pre">DT</span></code> è alimentato da streaming data (telemetria)
che riflette costantemente lo stato operativo, la salute e le prestazioni dell’asset fisico.</p></li>
<li><p><strong>Simulazione e Previsione</strong>: Permette di eseguire scenari What-If (“Cosa succede se…”)
sul gemello virtuale senza rischiare danni all’entità fisica.</p></li>
<li><p><strong>Diagnostica e Ottimizzazione</strong>: Viene utilizzato per identificare le cause profonde
dei problemi e per testare le modifiche operative prima di implementarle nel mondo reale.</p></li>
<li><p><strong>Manutenzione Predittiva</strong>: Una delle applicazioni più potenti: il <code class="docutils literal notranslate"><span class="pre">DT</span></code> analizza
le prestazioni attuali, le confronta con i modelli di degrado e prevede
esattamente quando e dove un componente fallirà, permettendo la manutenzione prima del guasto.</p></li>
</ul>
<p>Il <code class="docutils literal notranslate"><span class="pre">DT</span></code> fornisce una rappresentazione concreta di un <a class="reference internal" href="#sistemi-complessi"><span class="std std-ref">Sistema complesso</span></a>.
Questo riduce l’<span class="xref std std-ref">Abstraction gap</span> tra l’utente finale (che lavora con l’asset fisico)
e il programmatore (che scrive il codice di controllo).</p>
<p>In questo campo, i DSL non sono solo strumenti di codifica, ma sono
strumenti indispendabili per la <strong>modellazione concettuale</strong> che rendono il
<code class="docutils literal notranslate"><span class="pre">DT</span></code> più accurato, manutenibile e interoperabile.</p>
<p>Un DSL può servire anche come linguaggio intermedio standardizzato per descrivere e
integrare i dati provenienti da fonti eterogenee di dati
generati da sistemi di controllo industriali (<em>PLC, SCADA</em>).</p>
<p>I <code class="docutils literal notranslate"><span class="pre">DT</span></code> sono intrinsecamente basati su <strong>eventi</strong>, guidati dal flusso continuo di dati
<strong>IoT</strong> (<a class="reference external" href="https://en.wikipedia.org/wiki/Internet_of_things">Internet of Things</a>).
I sistemi software che li gestiscono devono essere costruiti con architetture reattive
e asincrone (come l’Actor Model o l’architettura a microservizi) per gestire
l’alta velocità e la bassa latenza richieste.</p>
<p>Il <code class="docutils literal notranslate"><span class="pre">DT</span></code> eleva il ruolo del programmatore da semplice codificatore a <strong>modellatore di sistemi</strong>
e <strong>ingegnere di dominio</strong>. Il valore non risiede più solo nello scrivere codice, ma nel:</p>
<ul class="simple">
<li><p><strong>Creare Modelli Accurati</strong>: Sviluppare modelli matematici e fisici che replichino fedelmente
il comportamento del mondo reale.</p></li>
<li><p><strong>Ingegneria dei Dati</strong>: Progettare data pipelines efficienti e sistemi di time-series
database per gestire e pulire il volume massiccio di dati in tempo reale generato dal gemello.</p></li>
</ul>
<p>Il <em>Digital Twin</em>, quindi, è un caso emblematico di come l’obiettivo di molti moderni sistemi software
si sposta verso la proattività, la previsione e la conoscenza olistica dello stato operativo.
La transizione <span class="xref std std-ref">Dagli algoritmi ai sistemi software</span> trova qui il suo più evoluto
compimento.</p>
<span class="target" id="computare"></span></section>
</section>
<section id="sistemi-software">
<span id="id56"></span><h1>Sistemi software<a class="headerlink" href="#sistemi-software" title="Permalink to this heading">¶</a></h1>
<p>In ambito informatico, un Sistema è spesso descritto come:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Una</span> <span class="n">combinazione</span> <span class="n">strutturata</span> <span class="n">di</span> <span class="n">componenti</span> <span class="n">che</span> <span class="n">raccolgono</span><span class="p">,</span> <span class="n">elaborano</span><span class="p">,</span>
<span class="n">memorizzano</span> <span class="n">e</span> <span class="n">distribuiscono</span> <span class="n">informazioni</span> <span class="n">per</span> <span class="n">supportare</span>
<span class="n">servizi</span> <span class="n">e</span> <span class="n">processi</span> <span class="n">decisionali</span> <span class="n">e</span> <span class="n">di</span> <span class="n">controllo</span><span class="o">.</span>
</pre></div>
</div>
<p>Storicamente, il software nasce come l’insieme di <strong>istruzioni-macchina</strong> che deve essere
eseguito da un computer su un insieme di <strong>dati</strong> per realizzare un algoritmo.</p>
<p>L’evoluzione di linguaggi ad alto livello ha visto la rapida introduzione di
costrutti capaci di esprimere semplici forme di aggregazioni di istruzioni e dati (componenti sofware).</p>
<p>L’uso del termine <strong>sistema software</strong> enfatizza,
in genere, prodotti  complessi, costruiti o studiati in termini
della  organizzazione e della interazione tra i componenti che formano il prodotto.</p>
<p>Quando si ha a che fare con un sistema software, è utile distinguere <strong>due livelli</strong>:</p>
<ol class="arabic simple">
<li><p><strong>Descrizione esterna</strong> — come il sistema parla con l’esterno: API, messaggi, contratto di servizio.</p></li>
<li><p><strong>Comportamento interno</strong> — come ogni componente (oggetto, attore, microservizio) evolve nel tempo:
stato, transizioni, reazioni ai messaggi, logica interna.</p></li>
</ol>
<p>Molti strumenti coprono solo il primo livello (descrizione dell’interfaccia — es. <a class="reference external" href="https://it.wikipedia.org/wiki/Specifiche_OpenAPI">OpenAPI</a>),
altri solo il secondo (codice, FSM, logica interna).
Ma per sistemi complessi servono entrambi in modo coerente.</p>
<section id="viste-di-un-sistema-software">
<h2>Viste di un sistema software<a class="headerlink" href="#viste-di-un-sistema-software" title="Permalink to this heading">¶</a></h2>
<p>Un sistema software può essere descritto da diversi punti di vista:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>L’osservatore di un sistema software può
parlare di un sistema considerando
diversi punti di vista</p>
<ul class="simple">
<li><p><a class="reference internal" href="#vista-esterna"><span class="std std-ref">Vista esterna</span></a></p></li>
<li><p><a class="reference internal" href="#vista-interna"><span class="std std-ref">Vista interna</span></a></p></li>
<li><p><a class="reference internal" href="#vista-sommersa"><span class="std std-ref">Vista sommersa</span></a></p></li>
</ul>
</td>
<td><p>Quello che si vede e non</p>
<a class="reference internal image-reference" href="_images/Viste.PNG"><img alt="_images/Viste.PNG" class="align-center" src="_images/Viste.PNG" style="width: 80%;" /></a>
</td>
</tr>
</tbody>
</table>
<section id="vista-esterna">
<span id="id57"></span><h3>Vista esterna<a class="headerlink" href="#vista-esterna" title="Permalink to this heading">¶</a></h3>
<p>Il sistema  viene visto come una entità accessibile attraverso una  <a class="reference internal" href="#api"><span class="std std-ref">Le API</span></a>
(<strong>Application Programming Interface</strong>)
intesa come il punto di contatto che consente l’interazione tra codici in esecuzione</p>
</section>
<section id="vista-interna">
<span id="id58"></span><h3>Vista interna<a class="headerlink" href="#vista-interna" title="Permalink to this heading">¶</a></h3>
<p>Il sistema  viene visto come un insieme di enti computazionali (funzioni, oggetti, processi, etc.) che operano
interagendo tra loro e con il mondo esterno (clienti, dispositivi, etc.) usando adeguati supporti</p>
</section>
<section id="vista-sommersa">
<span id="id59"></span><h3>Vista sommersa<a class="headerlink" href="#vista-sommersa" title="Permalink to this heading">¶</a></h3>
<p>Il sistema  è l’ultimo livello (<em>ayer</em>) di uno stack i cui livelli sottostanti
(librerie, infrastrutura, etc.) forniscono il supporto alla esecuzione.</p>
<p>Nel corso degli anni sono stati proposti e usati diversi tipi di componenti software,
che hanno contribuito a formare lo <strong>spazio concettuale</strong> dei linguaggi di programmazione
di alto livello.</p>
</section>
</section>
<section id="componenti-software">
<h2>Componenti software<a class="headerlink" href="#componenti-software" title="Permalink to this heading">¶</a></h2>
<p>In generale, il concetto di <strong>componente software</strong> può essere definito come:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">una</span> <span class="n">unità</span> <span class="n">autonoma</span> <span class="n">e</span> <span class="n">riusabile</span> <span class="n">di</span> <span class="n">codice</span> <span class="n">che</span> <span class="n">svolge</span> <span class="n">una</span>
<span class="n">funzione</span> <span class="n">specifica</span> <span class="nb">all</span><span class="s1">&#39;interno di un sistema software,</span>
<span class="n">promuovendo</span> <span class="n">la</span> <span class="n">riusabilità</span><span class="p">,</span> <span class="n">la</span> <span class="n">modularità</span> <span class="n">e</span> <span class="n">la</span> <span class="n">manutenibilità</span> <span class="k">del</span> <span class="n">codice</span>
</pre></div>
</div>
<p>Questa idea di base ha subito una profonda evoluzione nel corso degli anni, tanto che
occrrerebbe un corso ad hoc per descriverla.</p>
<p>Trascurando molti rilevanti aspetti, noi cercheremo di
delinarne alcuni punti importanti sia sul piano concettuale, sia sul piano pragamatico,
relativi alle moderne pratiche di costruzione di sistemi sofwtare.</p>
<section id="componenti-software-di-base">
<h3>Componenti software di base<a class="headerlink" href="#componenti-software-di-base" title="Permalink to this heading">¶</a></h3>
<p>I linguaggi di programmazione più diffusi permettono di costruire sistemi software
composti da due principali specie di componenti-base:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>.</p>
<a class="reference internal image-reference" href="_images/funz.PNG"><img alt="_images/funz.PNG" class="align-center" src="_images/funz.PNG" style="width: 70%;" /></a>
</td>
<td><p>Una funzione rappresenta un componente che permette la definizione parametrica di
istruzioni e la loro esecuzione mediante trasferimento di controllo.</p>
<p><em>Linguaggio di riferimento</em>: <code class="docutils literal notranslate"><span class="pre">JavaScript</span></code> (<code class="docutils literal notranslate"><span class="pre">Node.js</span></code>)</p>
</td>
</tr>
<tr class="row-even"><td><p>pojo</p>
<a class="reference internal image-reference" href="_images/obj.PNG"><img alt="_images/obj.PNG" class="align-center" src="_images/obj.PNG" style="width: 80%;" /></a>
</td>
<td><p>Un oggetto incapsula uno stato e un insieme di funzioni (metodi), la cui esecuzione
avviene mediante chiamata di procedura (trasferimento di controllo).</p>
<p><em>Linguaggio di riferimento</em>: <code class="docutils literal notranslate"><span class="pre">Java</span></code>.</p>
<p>Un oggetto può essere dotato di comportamento autonomo incapsulando un <strong>Thread</strong>.</p>
</td>
</tr>
</tbody>
</table>
<section id="i-pojo">
<h4>I POJO<a class="headerlink" href="#i-pojo" title="Permalink to this heading">¶</a></h4>
<p>Nel seguito useremo il termine <strong>POJO</strong> (<em>Plain Old Java Object</em>) per denotare componenti software
‘vecchio stile’ che interagiscono mediante trasferimento del controllo (chiamate di procedera).</p>
</section>
</section>
<section id="oltre-gli-oggetti">
<h3>Oltre gli oggetti<a class="headerlink" href="#oltre-gli-oggetti" title="Permalink to this heading">¶</a></h3>
<p>Lo sviluppo delle reti informatiche e di Internet ha promosso la costruzione di <strong>sistemi software
distribuiti</strong> su più nodi di elaborazione, su ciascuno dei quali possono essere eseguiti
programmi espressi medianti linguaggi diversi.</p>
<ul class="simple">
<li><p>La costruzione di <strong>sistemi software distributi eterogenei</strong> è resa possibile dall’uso
(entro funzioni ed oggetti) di protocolli di comunicazione (come <code class="docutils literal notranslate"><span class="pre">UDP,</span> <span class="pre">TCP,</span> <span class="pre">HTTP,</span> <span class="pre">MQTT,</span> <span class="pre">CoAP</span></code>, etc.)
e richiede logicamente componenti  capaci di interagire
(spesso in modo <code class="docutils literal notranslate"><span class="pre">asincrono</span></code>) mediante <strong>scambio di messaggi</strong> e non più mediante trasferimento
di controllo con chiamate di procedura.</p></li>
<li><p>Ciò ha portato alla definizione di nuovi tipi di componenti software
quali gli <a class="reference internal" href="#gli-attori-come-nuovo-paradigma"><span class="std std-ref">Attori</span></a>, gli <span class="xref std std-ref">agenti software (intelligenti)</span>,
i <a class="reference external" href="https://en.wikipedia.org/wiki/Microservices">Microservizi</a>, le <a class="reference external" href="https://it.wikipedia.org/wiki/Function_as_a_service">Funzioni serverless</a>, etc.</p></li>
</ul>
</section>
</section>
<section id="un-viaggio-nei-sistemi-software">
<span id="id60"></span><h2>Un viaggio nei sistemi software<a class="headerlink" href="#un-viaggio-nei-sistemi-software" title="Permalink to this heading">¶</a></h2>
<p>In questa sezione cercheremo di parlare, in linguaggio naturale, di un sistema denominato <strong>S</strong>
supponendo che sia un <em>sistema hardware/software</em> con cui sia possibile interagire via rete.</p>
<a class="reference internal image-reference" href="_images/SInU.jpg"><img alt="_images/SInU.jpg" class="align-center" src="_images/SInU.jpg" style="width: 55%;" /></a>
<p>Il sistema <strong>S</strong>  è posto in un ‘universo’ (<strong>U</strong>) in cui si trova anche un
osservatore (umano o meno) <strong>Obs</strong>, che
può interagire con <code class="docutils literal notranslate"><span class="pre">S</span></code>  in molti modi diversi.</p>
<section id="punti-di-vista">
<h3>Punti di vista<a class="headerlink" href="#punti-di-vista" title="Permalink to this heading">¶</a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>.</p>
<a class="reference internal image-reference" href="_images/VisteObs.PNG"><img alt="_images/VisteObs.PNG" class="align-center" src="_images/VisteObs.PNG" style="width: 100%;" /></a>
</td>
<td><p>La figura vuole rappresentare l’idea che due osservatori di uno stesso oggetto
possono avere viste diverse di esso
e quindi pensare che l’oggetto osservato abbia proprietà diverse.</p></td>
</tr>
</tbody>
</table>
<p>Dire che <strong>S</strong> è un sistema <strong>hardware/software</strong> induce a pensare che sia
costruito usando un <strong>computer</strong> (hardware) capace di elaborare <strong>istruzioni</strong> (software) che determinano
il comportamento osservabile del sistema.</p>
<p>Il  <em>sistema globale S + Obs</em> è un sistema distribuito di cui può essere
difficile <em>parlare in modo preciso</em> senza un opportuno linguaggio capace
di <strong>esprimere gli aspetti salienti della interazione/comunicazione</strong>, lasciando sullo sfondo dettagli importanti,
ma non essenziali.</p>
<p>In assenza di ulteriori informazioni, <code class="docutils literal notranslate"><span class="pre">S</span></code> potrebbe essere visto come un <strong>servizio</strong>,
pensando che il sistema sia in grado di <strong>fornire funzionalità</strong> a
<strong>clienti</strong> (umani o programmi) che ne fanno richiesta usando
protocolli di rete standard, come <code class="docutils literal notranslate"><span class="pre">HTTP</span></code> e <code class="docutils literal notranslate"><span class="pre">WS</span></code> (<em>WebSocket</em>) o altri.</p>
<p>Queste sommarie indicazioni sono già suficienti a dare una idea
di cosa stiamo parlando comprensibile a <strong>molti</strong> esseri umani,
ed in particolare a coloro che sono abituati a usare <strong>Internet</strong>.
Osserviamo però che questo modo di ‘capire’ cosa sia <code class="docutils literal notranslate"><span class="pre">S</span></code>  era <strong>praticamente impossibile</strong>
solo pochi decenni fa, quando i <em>computer</em> e <em>Internet</em> non erano così diffusi e
facilmente accessibili.</p>
<p>Tuttavia, anche  in comunità umane in cui il termine <strong>servizio</strong> (software) è ormai di uso comune,
non è certo scontato che sia a tutti ‘chiaro’ cosa sia un <em>servizio</em>, come sia fatto e come funzioni.
Inoltre, anche i più esperti del settore potrebbero trovarsi in difficoltà di fronte a  domande del tipo:</p>
<p><strong>Domanda1</strong>: che differenza c’è’ tra un servizio e un normale <strong>programma</strong> che gira su un computer?
Certo si può presumere che un serivizio sia un programma, ma allora cosa lo rende un <strong>servizio</strong>?</p>
<p><strong>Domanda2</strong>: che differenza c’è’ tra un <em>servizio</em>  e un <strong>microservizio</strong> ?</p>
<p>In attesa di rispondere a domande di questo tipo, al momento osserviamo solo che:</p>
<ul class="simple">
<li><p><strong>tutti is sistemi software servono a qualcosa ma non tutti sono servizi</strong></p></li>
</ul>
</section>
<section id="sistemi-embedded-iot">
<span id="id61"></span><h3>Sistemi Embedded/IoT<a class="headerlink" href="#sistemi-embedded-iot" title="Permalink to this heading">¶</a></h3>
<p>I computer oggi in uso sono spesso
dotati di dispositivi di interazione con il mondo fisico (si pensi a un un <a class="reference internal" href="#raspberrypi"><span class="std std-ref">RaspberryPi</span></a>
e ai suoi  PIN <strong>GPIO</strong> (<em>General Purpose IO</em>)
e rappresentano una categoria qualitativamente diversa dai computer generici che elabora solo dati.</p>
<p>Un <strong>sistema embedded</strong> è un sistema di calcolo dedicato a svolgere una o poche funzioni specifiche,
integrato all’interno di un prodotto o dispositivo fisico.
Quando questi sistemi sono connessi in rete — spesso a Internet — e possono interagire con altri dispositivi
o servizi digitali, si parla di <strong>sistemi IoT</strong> (<a class="reference external" href="https://en.wikipedia.org/wiki/Internet_of_things">Internet of Things</a>).</p>
<section id="sistemi-cibernetici">
<span id="id62"></span><h4>Sistemi cibernetici<a class="headerlink" href="#sistemi-cibernetici" title="Permalink to this heading">¶</a></h4>
<p>Un computer interfacciato con il mondo fisico rappresenta
un <strong>sistema cibernetico</strong> la cui funzione primaria è modificare o preservare lo stato del mondo
reale. Come tale,  è un sistema — naturale, artificiale o misto — capace di
raggiungere o mantenere uno stato desiderato (un obiettivo):</p>
<ul class="simple">
<li><p>percependo l’ambiente attraverso sensori,</p></li>
<li><p>valutando l’errore rispetto all’obiettivo,</p></li>
<li><p>agendo sull’ambiente tramite attuatori,</p></li>
<li><p>chiudendo il ciclo tramite un meccanismo di feedback.</p></li>
</ul>
</section>
<section id="raspberrypi">
<span id="id63"></span><h4>RaspberryPi<a class="headerlink" href="#raspberrypi" title="Permalink to this heading">¶</a></h4>
<p>Il <a class="reference external" href="https://it.wikipedia.org/wiki/Raspberry_Pi">Raspberry Pi</a> è una piccola scheda computer, economica e a basso consumo, molto utilizzata per
realizzare sistemi embedded e IoT grazie a:</p>
<ul class="simple">
<li><p>un sistema operativo completo (generalmente Linux)</p></li>
<li><p>interfacce di comunicazione evolute (Wi-Fi, Bluetooth, Ethernet)</p></li>
<li><p>GPIO per la connessione diretta a sensori e attuatori fisici</p></li>
<li><p>una comunità e un ecosistema di librerie molto vasti</p></li>
</ul>
</section>
</section>
</section>
<section id="capire-sperimentando">
<h2>Capire sperimentando<a class="headerlink" href="#capire-sperimentando" title="Permalink to this heading">¶</a></h2>
<p>Il problema di capire/definire
cosa sia  <code class="docutils literal notranslate"><span class="pre">S</span></code> può essere affrontato seguendo un approccio analogo a quello di un ricercatore che
vuole studiare un nuovo oggetto fisico.
In questo caso, il ricercatore potrebbe iniziare a porsi alcune domande del tipo:</p>
<ol class="arabic simple">
<li><p>cosa fa questo oggetto?</p></li>
<li><p>come funziona?</p></li>
<li><p>come è fatto?</p></li>
<li><p>quali sono le sue proprietà più interessanti?</p></li>
</ol>
<p>Notiamo che le domande <code class="docutils literal notranslate"><span class="pre">1</span></code> e <code class="docutils literal notranslate"><span class="pre">2</span></code> implicano una certa <strong>osservazione</strong> dell’oggetto in azione,
mentre le domande <code class="docutils literal notranslate"><span class="pre">3</span></code> e <code class="docutils literal notranslate"><span class="pre">4</span></code> richiedono una certa <strong>analisi</strong> dell’oggetto, magari smontandolo per
vedere come è fatto dentro.</p>
<section id="capire-interagendo">
<h3>Capire interagendo<a class="headerlink" href="#capire-interagendo" title="Permalink to this heading">¶</a></h3>
<p>Sembra ragionevole pensare che, prima di ‘smontare’ un oggetto, sia  meglio intergire con
l’oggetto in una <em>fase di ‘pura osservarzione’</em>, per cercare di ricavarne informazioi utili
per il suo utilizzo
e per <strong>inferire</strong>, se possibile, alcune delle sue proprietà.</p>
<p>Siamo qui di fronte a una delle problematiche più interessanti e controverse della scienza:
come si fa a studiare un oggetto nuovo di cui non si sa nulla?
Anche una questione che sembra banale, come <em>la ‘semplice (!) osservazione</em>, è oggi un tema di ricerca
avanzata in molti campi, dopo che la <a class="reference external" href="https://it.wikipedia.org/wiki/Meccanica_quantistica">meccanica quantistica</a> ha mostrato che
l’atto stesso dell’osservazione
può influenzare  (prima ancora di ‘smontarlo’) l’oggetto osservato
o addirittura <strong>determinarne alcune proprietà</strong>.</p>
<p>Fortunatamente, per i nostri scopi, potremo trascurare queste proprietà che
sembrano caratterizzare il mondo in cui viviamo, almeno fino a quando non
dovremo occuparci di sistemi software che usano il <a class="reference internal" href="#quantum-computer"><span class="std std-ref">Quantum computer</span></a>.</p>
</section>
<section id="interagire-con-un-sistema-software">
<span id="id64"></span><h3>Interagire con un sistema software<a class="headerlink" href="#interagire-con-un-sistema-software" title="Permalink to this heading">¶</a></h3>
<p>Nel caso in cui <code class="docutils literal notranslate"><span class="pre">S</span></code> sia un sistema software, è implicito il fatto che la interazione richiede
l’uso di un computer e/o di una rete di comunicazione.</p>
<a class="reference internal image-reference" href="_images/SInUComputer.jpg"><img alt="_images/SInUComputer.jpg" class="align-center" src="_images/SInUComputer.jpg" style="width: 60%;" /></a>
</section>
<section id="capire-implica-opportuni-livelli-di-conoscenza">
<h3>Capire implica opportuni livelli di conoscenza<a class="headerlink" href="#capire-implica-opportuni-livelli-di-conoscenza" title="Permalink to this heading">¶</a></h3>
<p>L’informazione scambiata tra un sistema software <code class="docutils literal notranslate"><span class="pre">S</span></code> e <code class="docutils literal notranslate"><span class="pre">Obs</span></code> è di solito
rappresentata in forma di stringa usando caratteri
quali <a class="reference external" href="https://en.wikipedia.org/wiki/UTF-8">UTF-8</a>. Ma questo dettaglio di basso livello è piuttosto <strong>irrilevante per catturare gli aspetti
salienti</strong> della comunicazione.</p>
<p>Questo aspetto è ancora più evidente considerando che noi ‘sappiamo’
che <code class="docutils literal notranslate"><span class="pre">S</span></code> (o almeno il suo <em>hardware) è semza dubbio formato da *atomi</em> (su questo punto ci sarebbe da approfondire …) ;
tuttavia nessun essere umano penserebbe che
questo livello di conoscenza sia necessario (o meglio <strong>il livello ‘giusto’</strong>) per capire <code class="docutils literal notranslate"><span class="pre">S</span></code>.</p>
<p>In altri termini, per capire <code class="docutils literal notranslate"><span class="pre">S</span></code> non è oggi necessario (al momento almeno)
studiare discipline come la <em>fisica</em> o la <em>chimica</em>
o la <em>biologia</em> o  la <em>psicologia</em>. Pensandoci bene, non è nemmeno necessario studiare
<strong>calcolatori elettronici</strong>, perchè è implicito che quello che fa <code class="docutils literal notranslate"><span class="pre">S</span></code> è determinato dal <em>software</em>,
che ha nell’hardware del computer, la sua premessa indispensabile, il suo ‘supporto vitale’
ma non gli elementi necessari per fornire una adeguata ‘spiegazione’ di <code class="docutils literal notranslate"><span class="pre">S</span></code>.</p>
<p>Potrebbe anche non essere nemmeno necessario addentrarsi nella parte di software nota come <strong>sistema operativo</strong>:
per capire pienamente <code class="docutils literal notranslate"><span class="pre">S</span></code> sarebbe però necessario
conoscere  il <strong>linguaggio di programmazione</strong> (o i linguaggi)
con cui è stato specificato il comportamento di <code class="docutils literal notranslate"><span class="pre">S</span></code> : al più è necessario conoscere anche
il rapporto tra il linguaggio e il primo livello si software limitrofo sottostatnte.</p>
<p>Ma prima di ‘aprire il sistema’ per vedere come è fatto ‘dentro’, proviamo a capirlo seguendo l’idea
meno invasiva di <strong>comunicare</strong> con esso.</p>
<p>Tenendo conto del moderno punto di vista scientifico, non possiamo dimenticare che osservatore
e osservato sono parte dello stesoo ‘universo’ e che il funzionamento di <code class="docutils literal notranslate"><span class="pre">S</span></code> potrebbe essere legato
non solo al modo in cui l’osservatore interagisce direttamente con esso, ma anche da altri fattori,
ad esempio la temperatura e la pressione dell’ambiente, flare solari, etc.</p>
<p>Tuttavia è ragionevole pensare che, per studiare <code class="docutils literal notranslate"><span class="pre">S</span></code>, l’osservatore possa limitarsi a interagire con esso
usando un computer come unico ‘strumento di interazione’, senza preoccuparsi troppo di altri fattori esterni
(come ha proposto di fare per primo <em>Galileo</em>, al fine di distinguere ciò che è necessario
da ciò che può essere ignorato in prima istanza).</p>
</section>
<section id="conoscere-per-comunicare">
<span id="id65"></span><h3>Conoscere per comunicare<a class="headerlink" href="#conoscere-per-comunicare" title="Permalink to this heading">¶</a></h3>
<p>Per poter <strong>comunicare proficuamente</strong> con  <code class="docutils literal notranslate"><span class="pre">S</span></code>, l’osservatore <code class="docutils literal notranslate"><span class="pre">Obs</span></code> deve conoscere:</p>
<ol class="arabic simple">
<li><p>il <strong>protocollo di comunicazione (P)</strong> che permette al computer che supporta <code class="docutils literal notranslate"><span class="pre">S</span></code> di ricevere/trasmettere
informazione e quindi di iteragire con il computer usato da <code class="docutils literal notranslate"><span class="pre">Obs</span></code>;</p></li>
<li><p>il <strong>vocabolario/linguaggio</strong> che <code class="docutils literal notranslate"><span class="pre">S</span></code> usa per denotare l’informazione trasmessa/ricevuta
come <strong>messaggi</strong>  usando <code class="docutils literal notranslate"><span class="pre">P</span></code>;</p></li>
<li><p>il <strong>legame logico della interazione</strong> che si stabilisce in ogni particolare tipo di
comunicazione tra due enti.</p></li>
</ol>
<section id="la-interazione-come-vincolo">
<span id="id66"></span><h4>La interazione come vincolo<a class="headerlink" href="#la-interazione-come-vincolo" title="Permalink to this heading">¶</a></h4>
<p>La necessità di conoscere il <strong>legame logico della interazione</strong> nasce dal fatto che vi sono varie forme di
comunicazione e che queste comportano diverse forme
di interazione logica tra gli enti comunicanti. Ad esempio, il sistema <code class="docutils literal notranslate"><span class="pre">S</span></code>  potrebbe essere:</p>
<ol class="arabic">
<li><p>capace di rispondere a <strong>richieste</strong> provenienti da uno o più <code class="docutils literal notranslate"><span class="pre">Obs</span></code>, inviando
la risposta a chi ha fatto la richiesta. Se due <code class="docutils literal notranslate"><span class="pre">Obs</span></code> diversi inviano richieste a <code class="docutils literal notranslate"><span class="pre">S</span></code>,
ognuno di loro si aspetta di ricevere una risposta pertinente alla
propria richiesta, senza confusioni.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Notiamo che l’invio di una richiesta non implica che <code class="docutils literal notranslate"><span class="pre">Obs</span></code> si blocchi
in attesa delle risposta. in tal caso si avrebbe una <strong>operazione sincrona</strong> e il canale di comunicazione
rimarrebbe aperto fino alla risposta.</p>
<p><code class="docutils literal notranslate"><span class="pre">Obs</span></code> potrebbe inviare la richiesta come <strong>operazione asincrona</strong>; in tal caso il canale di comunicazione
potrebbe chiudersi subito dopo l’invio della richiesta e <code class="docutils literal notranslate"><span class="pre">S</span></code> dovrebbe trovare  modi opportuni per
inviare la risposta che  <code class="docutils literal notranslate"><span class="pre">Obs</span></code> si aspetta e che elaborerà quando
sarà ‘disposto a farlo’.</p>
</div>
</li>
<li><p><strong>emettere informazioni</strong>  (dette <strong>eventi</strong>) in modo spontaneo verso il mondo esterno, che potrebbero
essere ‘captate’ da uno o più <code class="docutils literal notranslate"><span class="pre">Obs</span></code> (si pensi ad esempio a un servizio che avvisa su allarmi,
congestione o blochhi stradali, etc.)
Questa forma di comunicazione viene detta <a class="reference external" href="https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern">Publish–subscribe</a> e viene supportata da broker come
<code class="docutils literal notranslate"><span class="pre">RAbbitMQ,</span> <span class="pre">Mosquritto,</span> <span class="pre">HiveMQ</span> <span class="pre">,</span> <span class="pre">Kafka</span></code>.</p></li>
<li><p>capace di eleborare messaggi inviati in modo
<a class="reference external" href="https://medium.com/mandiri-engineering/fire-and-forget-e59b745c9f97">fire-and-forget</a> , impegnandosi a gestirli come <strong>comandi da eseguire</strong> e/o a restituire risultati
in forma di <strong>notifiche/eventi</strong>.</p></li>
</ol>
<p>Ognuna delle forme di comunicazione citate costituisce un <strong>vincolo</strong> tra gli enti comunicanti, che devono agire
ciascuno in modo coerente con l’altro. E’ simile al tipo di vincolo che lega due danzatori.</p>
<p>Anche questo semplice e vago elenco di possibiltà mostra come possa essere
difficile <em>parlare in modo preciso</em> di un sistema software senza un opportuno linguaggio capace
di <strong>esprimere gli aspetti salienti della interazione/comunicazione</strong>, lasciando sullo sfondo dettagli importantissimi,
ma non essenziali per la definizione e la comprensione del  <em>sistema globale S + Obs</em>.</p>
</section>
</section>
</section>
<section id="sistemi-software-come-servizi-ma-non-solo">
<h2>Sistemi software come servizi (ma non solo)<a class="headerlink" href="#sistemi-software-come-servizi-ma-non-solo" title="Permalink to this heading">¶</a></h2>
<p>Il sistema software <code class="docutils literal notranslate"><span class="pre">S</span></code> risulta accessibile a <code class="docutils literal notranslate"><span class="pre">Obs</span></code> attraverso l’uso di un particolare sistema fisico
(il <strong>computer</strong>) che ha la capacità di inviare/ricevere informazioni usando reti cablate e/o wireless e opportuni
<strong>protocolli</strong> di comunicazione quali <code class="docutils literal notranslate"><span class="pre">HTTP</span></code>, <code class="docutils literal notranslate"><span class="pre">TCP</span></code>, <code class="docutils literal notranslate"><span class="pre">MQTT</span></code>, <code class="docutils literal notranslate"><span class="pre">WS</span></code> ed altri.</p>
<section id="l-infrastruttura">
<span id="infrastruttura"></span><h3>L’infrastruttura<a class="headerlink" href="#l-infrastruttura" title="Permalink to this heading">¶</a></h3>
<p>Perché il computer usato da <code class="docutils literal notranslate"><span class="pre">Obs</span></code> (<strong>Client</strong>) possa interagire con <code class="docutils literal notranslate"><span class="pre">S</span></code>
occorre disporre, allo stato attuale della tecnologia, di un ponte di comunicazione.</p>
<ul class="simple">
<li><p><strong>Networking</strong>: Entrambi i computer devono essere sulla stessa rete (LAN) o connessi tramite VPN/Internet.
Occorre conoscere l’Indirizzo IP del computer su cui gira S.</p></li>
<li><p><strong>Wrapping</strong>: Se S è un programma “chiuso” (es. uno script che gira solo da terminale),
occorre aggiungere uno strato software (un <em>Framework</em> come <strong>Flask</strong> per Python, <strong>Express</strong> per JS,
SpringBoot o  ASP.NET) che riceva le chiamate su rete e le “passi” a <code class="docutils literal notranslate"><span class="pre">S</span></code>.</p></li>
<li><p><strong>Port</strong>: occorre scleglier un “canale” numerico (es. <code class="docutils literal notranslate"><span class="pre">8080</span></code>) su cui il server rimarrà in ascolto.</p></li>
<li><p><strong>Firewall</strong>: Sul computer di S, occorre aprire la porta scelta nel firewall per permettere il traffico in entrata.</p></li>
</ul>
<section id="i-framework">
<span id="framework"></span><h4>I framework<a class="headerlink" href="#i-framework" title="Permalink to this heading">¶</a></h4>
<p>Un <strong>framework</strong> è una struttura logica di supporto su cui uno sviluppatore può costruire software.</p>
<p>A differenza di una semplice libreria, il framework fornisce un’architettura predefinita e un insieme di strumenti,
componenti e regole che guidano lo sviluppo, permettendo di non dover riscrivere codice comune da zero</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Molti framework gestiscono le comunicazioni client-server, solitamente via <code class="docutils literal notranslate"><span class="pre">HTTP/HTTPS</span></code> o <a class="reference internal" href="#websockets"><span class="std std-ref">WebSocket</span></a>; tra questi:
<code class="docutils literal notranslate"><span class="pre">Node.js</span> <span class="pre">(Express)</span></code>, <code class="docutils literal notranslate"><span class="pre">FastAPI</span> <span class="pre">(Python)</span></code>, <span class="xref std std-ref">javalin</span>, <code class="docutils literal notranslate"><span class="pre">Spring</span> <span class="pre">Boot</span> <span class="pre">(Java)</span></code>.</p>
<p>Nel campo dei Web <em>React</em> e <em>Angular</em> sono framework per <strong>Frontend</strong>, mentre Django (Python), Laravel (PHP), Spring (Java)
sono framework per <strong>Backend</strong>.</p>
</div>
<p>Le caratteristiche principali di un framework includono:</p>
<ul class="simple">
<li><p><strong>Inversione del controllo (IoC)</strong>: A differenza delle librerie, dove il programmatore chiama il codice esterno,
in un framework è la struttura stessa a chiamare il codice scritto dall’utente nei punti appropriati.</p></li>
<li><p><strong>Estendibilità</strong>: Permette di personalizzare specifiche parti del software per aggiungere funzionalità.</p></li>
<li><dl class="simple">
<dt><strong>Codice predefinito</strong>: Include soluzioni già pronte per compiti ripetitivi</dt><dd><p>(come la gestione dei database o l’autenticazione degli utenti).</p>
</dd>
</dl>
</li>
</ul>
<p>Un volta stabilita una connessione, il computer <strong>Client</strong> è analogo ai tipi di strumenti
telescopi, miscroscopi, acceleratori di particelle, etc.) usati dagli scienziati.</p>
<p>Ovviamente, la conoscenza di quale protocollo (<strong>P</strong>) usa  <code class="docutils literal notranslate"><span class="pre">S</span></code> per interagire con il mondo esterno
non è sufficiente: occorre anche conoscere la <a class="reference internal" href="#sintassi-e-semantica"><span class="std std-ref">Sintassi e semantica</span></a> delle ‘frasi’
veicolate tramire <strong>P</strong>. In altre parole, <code class="docutils literal notranslate"><span class="pre">S</span></code> definisce un <strong>proprio vocabolario</strong>, o più
in generale un  <strong>proprio linguaggio</strong> che <code class="docutils literal notranslate"><span class="pre">Obs</span></code> deve conoscere per interagire in modo
proficuo con <code class="docutils literal notranslate"><span class="pre">S</span></code>.</p>
</section>
</section>
<section id="le-api">
<span id="api"></span><h3>Le API<a class="headerlink" href="#le-api" title="Permalink to this heading">¶</a></h3>
<p>Nei sistemi software accessibili in rete, di solito si esegue un mappaing tra le capacità interne del sistema
e un’interfaccia esterna, l’<strong>API</strong> (<em>Application Programming Interface</em>) che stabilisce il “contratto”
che definisce quali informazioni il sistema può ricevere e cosa risponderà.</p>
<p>Senza <strong>API standardizzate</strong>, non ci sarebbe un accordo condiviso su come le diverse applicazioni o i servizi software comunicano.
I programmatori di due applicazioni separate dovrebbero parlare tra loro per determinare ogni volta
come sviluppare lo scambio di dati.</p>
<p>Di solito una API specifica almeno:</p>
<ul class="simple">
<li><p><strong>Input/Output</strong>: Quali argomenti accetta una specifica funzionalità di <code class="docutils literal notranslate"><span class="pre">S</span></code>? Che tipo di dati restituisce?
(Es. una stringa, un numero, un’immagine?).</p></li>
<li><p><strong>Protocollo</strong>: Il più comunenei servzi software è <strong>HTTP</strong>,
seguendo lo stile architetturale <a class="reference internal" href="#rest"><span class="std std-ref">Representational State Transfer (REST)</span></a> (<strong>Representational State Transfer</strong>).</p></li>
</ul>
<p>Aspetti importanti in relazione all’uso di un sistema sono anche:</p>
<ol class="arabic simple">
<li><p>Gestione dello Stato</p>
<ul class="simple">
<li><p><strong>Stateless</strong>: Ogni richiesta è indipendente (es. una funzione che calcola la radice quadrata).</p></li>
<li><p><strong>Stateful</strong> : <code class="docutils literal notranslate"><span class="pre">S</span></code> ricorda le azioni precedenti (es. un carrello della spesa).
In questo caso, il client deve inviare un “ID sessione” per farsi riconoscere.</p></li>
</ul>
</li>
<li><p>Concorrenza</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">S</span></code> è in grado di gestire più richieste contemporaneamente?
Se due client chiamano la stessa funzione nello stesso istante, <code class="docutils literal notranslate"><span class="pre">S</span></code> mette in coda le richieste?
Se <code class="docutils literal notranslate"><span class="pre">S</span></code> non è multi-thread, il <a class="reference internal" href="#framework"><span class="std std-ref">I framework</span></a> che funge da wrapper della
<a class="reference internal" href="#infrastruttura"><span class="std std-ref">L’infrastruttura</span></a>  dovrà realizzare e gestire la coda.</p>
</div></blockquote>
<p>Al giorno d’oggi esistono diverse soluzioni consolidate
per descrivere in modo formale (le interfacce di) servizi software,
alcune delle quali sono largamente usate.</p>
<p>Non tutte sono “formalismi puri” in senso teorico, ma piuttosto <strong>linguaggi di descrizione contrattuale</strong>
(interface description languages, IDL / API description languages).</p>
</section>
<section id="representational-state-transfer-rest">
<span id="rest"></span><h3>Representational State Transfer (REST)<a class="headerlink" href="#representational-state-transfer-rest" title="Permalink to this heading">¶</a></h3>
<p>REST è uno stile architetturale per sistemi distribuiti. L’espressione “representational state transfer”
e il suo acronimo, REST, fu introdotto nel 2000 nella tesi di dottorato di <strong>Roy Fielding</strong>.</p>
<p>REST rappresenta un sistema di trasmissione di dati su HTTP senza ulteriori livelli (quali ad esempio <a class="reference external" href="https://it.wikipedia.org/wiki/SOAP">SOAP</a>).
I sistemi REST non prevedono il concetto di sessione, ovvero sono <strong>stateless</strong>.</p>
<p>REST prevede che la scalabilità del Web e la sua crescita siano risultati di pochi principi chiave di progettazione:</p>
<ul class="simple">
<li><p>lo stato dell’applicazione e le funzionalità sono divisi in risorse web</p></li>
<li><p>ogni risorsa è unica e indirizzabile usando sintassi universale per uso nei link ipertestuali</p></li>
</ul>
<p>Il funzionamento di REST prevede una struttura degli <a class="reference external" href="https://it.wikipedia.org/wiki/Uniform_Resource_Locator">URL</a> (<em>Uniform Resource Locator</em>)
ben definita che identifica univocamente una <strong>risorsa</strong> o un insieme di risorse
e l’utilizzo dei metodi HTTP specifici per il recupero di informazioni,
per la modifica e per altri scopi (<code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code>, ecc.):</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>GET</strong>: “Dammi le informazioni” (non modifica nulla).</p></li>
<li><p><strong>POST</strong>: “Crea qualcosa di nuovo” (invia dati).</p></li>
<li><p><strong>PUT/PATCH</strong>: “Aggiorna qualcosa che esiste già”.</p></li>
<li><p><strong>DELETE</strong>: “Cancella una risorsa”.</p></li>
</ul>
</div></blockquote>
<p>REST è ideale per creare un’API pubblica per sviluppatori esterni o un servizio-web semplice.
È lo <strong>standard universale</strong> e il più facile da testare.</p>
<section id="hateoas">
<h4>HATEOAS<a class="headerlink" href="#hateoas" title="Permalink to this heading">¶</a></h4>
<p>HATEOAS è l’acronimo di <strong>Hypermedia as the Engine of Application State</strong> ed è un componente dell’architettura
e della progettazione delle API RESTful.</p>
<p>Utilizzando l’architettura HATEOAS, un client potrà accedere all’API di un’applicazione
tramite una semplice chiamata URL RESTful. Qualsiasi ulteriore azione che il client desideri
intraprendere sarà abilitata dai dati restituiti dal server nella chiamata originale.</p>
<p>I “dati”, all’interno della risposta, che consentono questo cambiamento di stato
sono semplici collegamenti ipermediali.
Ciò consentirà al client di passare da uno stato dell’applicazione al successivo semplicemente
interagendo con i dettagli contenuti nelle risposte del server.</p>
</section>
</section>
<section id="dai-servizi-ai-microservizi">
<h3>Dai servizi ai microservizi<a class="headerlink" href="#dai-servizi-ai-microservizi" title="Permalink to this heading">¶</a></h3>
<p>I sistemi software composti da microservizi rappresentano l’apice di un’evoluzione
che ha visto i sistemi informatici
trasformarsi da semplici programmi a complicate infrastrutture distribuite.</p>
<p>Le principali tappe che hanno segnato questo cambiamento possono essere visualizzate e riassunte come
riportato in <a class="reference external" href="_static/docs/msoIEEE.pdf">mshistory</a> .</p>
<a class="reference internal image-reference" href="_images/microservices.jpg"><img alt="_images/microservices.jpg" class="align-left" src="_images/microservices.jpg" style="width: 100%;" /></a>
<p>Le motivazioni che spingono le aziende verso i microservizi sono molteplici e spesso legate alla
necessità di gestire sistemi complessi e scalabili, migliorare la resilienza, accelerare l’innovazione,
e supportare la trasformazione digitale.</p>
<p>Il tema verrà approfondito nella sezione <span class="xref std std-ref">microservizi</span></p>
<p><strong>Oltre HTTP</strong></p>
<p>Considerati i limiti di HTTP, vi sono molte applicazioni in cui
è preferibile utilizzare strumenti di interazione più efficienti ed ottimizzati, come
il protocollo <a class="reference internal" href="#coap"><span class="std std-ref">CoAP</span></a> le <a class="reference internal" href="#websockets"><span class="std std-ref">WebSocket</span></a> o, più recentemente, <a class="reference internal" href="#grpc"><span class="std std-ref">gRPC</span></a>.</p>
</section>
<section id="coap">
<span id="id67"></span><h3>CoAP<a class="headerlink" href="#coap" title="Permalink to this heading">¶</a></h3>
<p>Il protocollo <em>CoAP</em> (<strong>Constrained Application Protocol</strong>) è stato progettato specificamente per portare
il paradigma RESTful (risorse, metodi, URI) in ambienti dove l’overhead di HTTP e TCP sarebbe insostenibile.</p>
<p>Mentre HTTP è il protocollo del <strong>Web delle persone</strong>, CoAP è il protocollo del <strong>Web delle cose (IoT)</strong>.</p>
<p>REST tradizionale usa HTTP su TCP. Questo comporta un “peso” notevole per dispositivi alimentati a batteria
o con poca memoria. CoAP ottimizza questa struttura agendo su tre livelli:</p>
<ol class="arabic">
<li><p><strong>Dal Testo al Binario</strong></p>
<p>HTTP è testuale (leggibile dagli umani), il che lo rende verboso.
CoAP è binario e utilizza un header fisso di soli 4 byte.</p>
<ul class="simple">
<li><p>In CoAP: Un intero messaggio può stare in meno di 10-20 byte.</p></li>
</ul>
</li>
<li><p><strong>Da TCP a UDP</strong></p>
<p>TCP richiede un “handshake” (3 passaggi) per stabilire la connessione e gestisce la
ri-trasmissione in modo complesso. CoAP gira su UDP, che è “senza connessione”.</p>
<ul class="simple">
<li><p>CoAP implementa la propria affidabilità (<a class="reference internal" href="#messaggi-confirmable"><span class="std std-ref">Messaggi Confirmable</span></a>) solo quando serve,
risparmiando energia e traffico di rete.</p></li>
</ul>
</li>
<li><p><strong>Non solo Request/Response</strong></p>
<p>In REST/HTTP, per un aggiornamento, occorre fare polling (chiedere continuamente).
CoAP introduce il <strong>meccanismo Observe</strong>:</p>
<ul class="simple">
<li><p>Il client si “iscrive” a una risorsa e il server invia un aggiornamento solo quando il valore cambia.
È un ibrido tra REST e Publish/Subscribe.</p></li>
</ul>
</li>
</ol>
<section id="messaggi-confirmable">
<span id="id68"></span><h4>Messaggi Confirmable<a class="headerlink" href="#messaggi-confirmable" title="Permalink to this heading">¶</a></h4>
<p>I messaggi Confirmable (<strong>CON</strong>) rappresentano il meccanismo principale per garantire in CoAP
l’affidabilità della comunicazione sopra il protocollo di trasporto <code class="docutils literal notranslate"><span class="pre">UDP</span></code>, che di per sé non è affidabile.</p>
<p>Un messaggio contrassegnato come Confirmable richiede una conferma esplicita dal destinatario.</p>
<ul class="simple">
<li><p>Acknowledge (ACK): Quando il server riceve un messaggio CON, deve rispondere con un pacchetto ACK.</p></li>
<li><p>Message ID: Per collegare correttamente la conferma al messaggio originale,
l’ACK deve contenere lo stesso Message ID del messaggio CON inviato.</p></li>
<li><p>Ritrasmissione: Se il mittente non riceve l’ACK entro un determinato intervallo (timeout),
il messaggio CON viene inviato nuovamente. Questo processo continua fino a quando non arriva
la conferma o viene raggiunto il numero massimo di tentativi.</p></li>
</ul>
<p>Se il server CoAP può elaborare la richiesta immediatamente, include i dati della risposta direttamente nel pacchetto ACK
(<strong>Piggybacked Response</strong>).
Altrimenti,  invia prima un ACK vuoto (per fermare le ritrasmissioni del client) e, una volta pronti i dati,
invia un nuovo messaggio CON verso il client, che a sua volta dovrà rispondere con un ACK (<strong>Separate Response</strong>).</p>
</section>
</section>
<section id="websockets">
<span id="id69"></span><h3>WebSocket<a class="headerlink" href="#websockets" title="Permalink to this heading">¶</a></h3>
<p>Il protocollo <em>WebSocket</em> (<strong>WS</strong>) è nato nato per risolvere il limite della comunicazione unidirezionale di HTTP.</p>
<p><strong>WS</strong> consente a due o più computer di comunicare tra loro in modo full-duplex
su una singola <strong>connessione TCP</strong>. È uno strato molto sottile su TCP che trasforma un flusso di byte
in un flusso di messaggi (testo o binario).</p>
<ul class="simple">
<li><p>Con REST, per sapere se ci sono novità, occorre chiedere continuamente (<strong>Polling</strong>).
In WebSockets, si apre la connessione una volta e il server emette i dati appena sono pronti.
Ciò aumenta l’efficienza.</p></li>
<li><p>Tuttavia, gestire migliaia di connessioni sempre aperte è costoso in termini di memoria del server.
REST è più efficiente per operazioni “mordi e fuggi” (es. leggere un articolo di un blog).
Dunque, <strong>WS</strong> non è un sostituto totale di REST:</p></li>
<li><p><strong>WS</strong> ha come uso ideale: Chat, notifiche live, cruscotti finanziari, giochi online.</p></li>
</ul>
<p>Nella sua forma più semplice,</p>
<p><strong>un WebSocket è solo un canale di comunicazione tra due applicazioni</strong></p>
<p>e non deve essere necessariamente coinvolto un browser.
Tuttavia l’uso più comune di WebSocket è facilitare la comunicazione tra un un’applicazione server
e un’applicazione basata su browser, avendo il vantaggio di realizzare comunicazioni asincrone bidirezionali
e in tempo reale.</p>
<p>Mentre in HTTP ogni singola richiesta porta con sé il “metodo” (<code class="docutils literal notranslate"><span class="pre">GET/POST</span></code>)
e il “path” (<code class="docutils literal notranslate"><span class="pre">/xxx</span></code>), nel protocollo WebSocket, una volta stabilita la connessione,
i messaggi sono solo <strong>sequenze di byte o testo</strong> senza alcun metadato di instradamento.</p>
<p>Sorge un problema:
una volta che aperta una <strong>WS</strong> verso un servizio, occorre sapere cosa inviare
e cosa aspettarsi. Senza uno standard, l’unico modo è leggere il codice Java o qualche documentazione scritta a mano.</p>
<p>A questo scopo è stato introdotto <span class="xref std std-ref">AsyncAPI</span>, di cui parliamo più avanti.</p>
<section id="la-fase-di-connessione-nelle-ws">
<span id="id70"></span><h4>La fase di connessione nelle WS<a class="headerlink" href="#la-fase-di-connessione-nelle-ws" title="Permalink to this heading">¶</a></h4>
<p>Ogni WebSocket inizia la sua vita come una normale richiesta <strong>HTTP GET</strong>.</p>
<ul class="simple">
<li><p>Il client invia: <cite>GET /xxx HTTP/1.1</cite> con l’intestazione <cite>Upgrade: websocket</cite>.</p></li>
</ul>
<p>Questo <strong>instradamento della connessione</strong> apre la via a diverse forme di <a class="reference internal" href="#instradamento-del-messaggio"><span class="std std-ref">Instradamento del messaggio</span></a>,
in accodo a diverse tecniche che permettono a un
<strong>server WebSocket</strong> di gestire molteplici funzionalità sulla stessa porta.</p>
</section>
<section id="instradamento-del-messaggio">
<span id="id71"></span><h4>Instradamento del messaggio<a class="headerlink" href="#instradamento-del-messaggio" title="Permalink to this heading">¶</a></h4>
<p>Volendo inviare ordini diversi (es. “fai questo”, “fai quello”)
sulla <strong>stessa</strong> connessione WebSocket, il protocollo non aiuta perché non ci sono “header” nei messaggi.
Per risolvere questo “vuoto” di informazioni, i server e gli sviluppatori usano tre strategie:</p>
<ul>
<li><ol class="upperalpha simple">
<li><p>Il modello “<strong>Un path, una funzione</strong>”</p></li>
</ol>
<p>È la soluzione più semplice. Creiamo connessioni diverse per scopi diversi.</p>
<ul class="simple">
<li><p>Connessione A -&gt; <cite>/xxx1</cite></p></li>
<li><p>Connessione B -&gt; <cite>/xxx2</cite></p></li>
</ul>
<p>Il “routing” avviene solo all’inizio. È adeguato se le funzionalità sono logicamente separate.</p>
</li>
<li><ol class="upperalpha simple" start="2">
<li><p><strong>Sotto-protocolli</strong> (Sub-protocols)</p></li>
</ol>
<p>Il protocollo WebSocket permette di definire un “sotto-protocollo” (es. <strong>STOMP</strong> o <strong>MQTT</strong>).
Questi aggiungono un piccolo header a ogni messaggio che dice: “Questo messaggio è per la coda X”.
Ciò complica il codice del client.
.. Javalin può supportarli, ma complicano il codice del client.</p>
</li>
<li><ol class="upperalpha simple" start="3">
<li><p>L’<strong>Envelope Pattern</strong> (Il “<strong>Facade</strong>” logico)</p></li>
</ol>
<p>Visto che il protocollo è “muto”, avvolgiamo il messaggio in una ‘busta’ (<em>envelope</em>) che contiene
le istruzioni di routing. È lo standard nell’industria moderna.</p>
<p><strong>Esempio di envelope JSON:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;xxx1&quot;</span><span class="p">,</span>
  <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;il mio input&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In questo caso, un server riceve il messaggio come stringa generica,
lo decodifica e usa uno <cite>switch</cite> nel codice Java per decidere cosa fare.</p>
<p><strong>Il routing non lo fa il protocollo, lo fai il codice applicativo.</strong></p>
</li>
</ul>
</section>
<section id="javalin-server">
<span id="id72"></span><h4>javalin server<a class="headerlink" href="#javalin-server" title="Permalink to this heading">¶</a></h4>
<p>Javalin è quello che in gergo viene definito un micro-framework per Java e Kotlin.
Javalin è per Java quello che <strong>Express.js</strong> è per <em>Node.js</em> o <strong>Flask</strong> è per <em>Python</em>.</p>
<p>A differenza di <a class="reference external" href="https://spring.io/projects/spring-boot">Spring Boot</a>, che è un “ecosistema” vasto e spesso pesante,
<em>Javalin</em> è progettato per essere estremamente leggero, semplice da imparare e
privo di configurazioni (niente file XML o annotazioni <code class="docutils literal notranslate"><span class="pre">&#64;</span></code>).</p>
<p>Dalla <strong>versione 6</strong>, <em>Javalin</em> è diventato molto modulare, per cui è opportuno
usare la dipendenza <strong>javalin-bundle</strong>, che include tutto
il necessario per far girare WebSockets e rendering di template.</p>
<p><strong>Come opera javalin</strong></p>
<p>Javalin sfrutta il fatto che ogni WebSocket inizia la sua vita come una normale richiesta <strong>HTTP GET</strong>.</p>
<ol class="arabic simple">
<li><p>Il client invia: <cite>GET /f1 HTTP/1.1</cite> con l’intestazione <cite>Upgrade: websocket</cite>.</p></li>
<li><p>Javalin legge il path <cite>/xxx1</cite> come se fosse una normale pagina web.</p></li>
<li><p>In quel momento, Javalin “stacca” quella specifica connessione e la associa internamente
al blocco di codice che hai scritto per <cite>/xxx1</cite>.</p></li>
</ol>
<p>Da questo punto tutti i messaggi che arrivano su quella connessione
verranno passati alla funzione <cite>xxx11</cite>.
<strong>Il protocollo non instrada i messaggi, il server ricorda a quale “binario” appartiene la connessione.</strong></p>
<p><strong>In sintesi</strong></p>
<p>Javalin “bara” usando le informazioni dell’HTTP iniziale per separare i flussi.
Una volta che la connessione è aperta, il protocollo WebSocket è effettivamente un “tubo cieco”:</p>
<ul class="simple">
<li><p>Volendo  <strong>ordine e semplicità</strong>, è opportuno usare path diversi (<cite>/xxx1</cite>, <cite>/xxx2</cite>).</p></li>
<li><p>Volendo <strong>un solo path</strong>, occorre aggiungere  le informazioni di instradamento dentro
il messaggio (solitamente JSON) come detto in <a class="reference internal" href="#instradamento-del-messaggio"><span class="std std-ref">Instradamento del messaggio</span></a>.</p></li>
</ul>
<p>Javalin:</p>
<ul class="simple">
<li><p>è <strong>Imperativo/Bloccante</strong>: segue il modello “One Thread per Request”. Quando arriva una richiesta,
viene assegnato un thread che rimane occupato finché la funzione
non ha finito. È facile da leggere e da debuggare perché il codice segue un flusso lineare.</p></li>
<li><p>è un Framework Web: È progettato quasi esclusivamente per fare HTTP e WebSocket.
È un “guscio” attorno al <a class="reference internal" href="#server-jetty"><span class="std std-ref">Jetty</span></a>.</p></li>
<li><p>è ideale per trasformare una funzione semplice in un servizio accessibile</p></li>
</ul>
</section>
<section id="server-jetty">
<span id="id73"></span><h4>Jetty<a class="headerlink" href="#server-jetty" title="Permalink to this heading">¶</a></h4>
<p><a class="reference external" href="https://it.wikipedia.org/wiki/Jetty">Jetty</a> è un server web e un container di servlet Java, leggero, gratuito e open source,
gestito dalla Eclipse Foundation</p>
<p>A differenza di server più “monolitici” come Apache Tomcat, Jetty è nato per essere incorporato direttamente
nel codice di un’applicazione.</p>
<blockquote>
<div><p>È ottimizzato per gestire un numero elevatissimo di connessioni simultanee con un basso consumo di memoria,
rendendolo ideale per applicazioni ad alta concorrenza.</p>
</div></blockquote>
</section>
<section id="server-vert-x">
<span id="id74"></span><h4>Vert.x<a class="headerlink" href="#server-vert-x" title="Permalink to this heading">¶</a></h4>
<p>Un server javalin non è ideale se un sistema</p>
<ul class="simple">
<li><p>deve gestire decine di migliaia di connessioni WebSocket aperte contemporaneamente
(es. una chat massiva o un sistema di notifiche push)</p></li>
<li><p>ha bisogno di resilienza: se un componente fallisce, gli altri devono continuare a girare isolati</p></li>
<li><p>vuole usare più linguaggi di programmazione</p></li>
</ul>
<p>Una alternativa è impostare il server usando <a class="reference external" href="https://www.baeldung.com/vertx">Vert.x</a>:</p>
<ul class="simple">
<li><p>è <strong>Reattivo/Non-bloccante</strong>: i basa sul modello Event Loop (simile a Node.js).
Un solo thread (o pochissimi) gestisce migliaia di connessioni contemporaneamente.
Se la funzione richiesta deve attendere un dato, il thread non si blocca, ma passa subito a servire un’altra richiesta.</p></li>
<li><p>è un <strong>Toolkit per sistemi distribuiti</strong>: Non serve solo per il Web. Può essere usarlo per gestire protocolli
TCP, UDP, DNS, database, o persino per far comunicare diversi parti di software tramite un <strong>Event Bus</strong> interno.</p></li>
<li><p>non è solo un server, ma un insieme di <strong>Verticles</strong> (piccoli componenti isolati) che si scambiano messaggi.</p></li>
</ul>
</section>
</section>
<section id="openapi-specification">
<span id="id75"></span><h3>OpenAPI Specification<a class="headerlink" href="#openapi-specification" title="Permalink to this heading">¶</a></h3>
<p><a class="reference external" href="https://it.wikipedia.org/wiki/Specifiche_OpenAPI">OpenAPI</a> (precedentemente noto come <strong>Swagger</strong>) è oggi lo standard de facto per descrivere
API HTTP/REST.</p>
<p>Un <em>documento OpenAPI</em> rappresenta una descrizione formale di un’API,
(endpoint, metodi (GET, POST, …), parametri, tipi di dato, schemi di richiesta/risposta,
sicurezza, metadati, ecc) che può essere utilizzata da diversi
strumenti per generare codice, documentazione, test case e altro ancora.
Il documento:</p>
<ul class="simple">
<li><p>può essere serializzato in JSON o YAML ed essere letto da tool che <strong>generano</strong>
<em>client</em>, <em>server-stub</em>, <em>documentazione interattiva</em>, <em>test automatici</em>, ecc.</p></li>
<li><p><strong>REST API</strong>
rappresenta il contratto formale che definisce <strong>cosa offre il servizio</strong>, senza esporre l’implementazione.
Questo facilita interoperabilità, evoluzione indipendente dei servizi.</p></li>
<li><p>non è un formalismo “semantico” come quelli della teoria del calcolo.
Serve a descrivere <em>API</em>, <strong>non</strong> a definire <em>comportamenti dinamici, proprietà concorrenti, tipologie di stato,
invarianti, transazioni, sincronizzazione</em></p></li>
</ul>
<p>Una specifica come la <strong>OAS</strong> (<a class="reference internal" href="#openapi-specification"><span class="std std-ref">OpenAPI Specification</span></a>) può servire come <strong>contratto di superficie</strong>
(quello che un sistema-servizio “dichiara di offrire”, come <strong>endpoint</strong> e - nelle versioni più recenti -
anche <strong>eventi</strong>, <strong>webhooks</strong>),
ma <strong>non</strong> come modello completo per la dinamica del servizio.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>webhooks sono una funzionalità introdotta nativamente con la versione 3.1,
per descrivere comunicazioni “out-of-band” o asincrone iniziate dal server.</p>
<p>A differenza delle API tradizionali (<strong>PULL</strong>), dove il client interroga il server,
i <em>webhooks</em> seguono un modello <strong>PUSH</strong>: il server invia proattivamente dati al client
quando si verifica un evento specifico.</p>
</div>
<p>Il livello descrittivo <strong>OAS</strong> rimane un’astrazione relativamente semplice,
vicina al modello ‘REST + callback HTTP’.</p>
<p>Poichè <strong>non tutti i sistemi software sono servizi</strong>,
per sistemi complessi, distribuiti, dinamici, event-driven — la documentazione API non basta:
serve un formalismo di <strong>comportamento e coordinazione</strong>, non soltanto di interfaccia.</p>
<section id="asyncapi">
<h4>AsyncAPI<a class="headerlink" href="#asyncapi" title="Permalink to this heading">¶</a></h4>
<p>Mentre per un’API HTTP è il Client a decidere quando chiamare il sistema,
con gli <em>eventi</em> è il sistema che decide quando informare il mondo esterno.
Per le forme di interazione ad eventi uno standard usato è <strong>AsyncAPI</strong>
che (in un file <em>asyncapi.yaml</em>) elenca i <strong>Channels</strong> e le operazioni di <em>Publish</em> (quello che il sistema emette)
e <em>Subscribe</em> (quello che il sistema riceve).</p>
<p><em>AsyncAPI</em> non è una tecnologia di comunicazione, ma uno standard di documentazione.
È nato per affiancare OpenAPI per coprire ciò che OpenAPI non poteva fare: il mondo asincrono.
Permette di documentare cosa succede quando un servizio lancia un messaggio (es. su <code class="docutils literal notranslate"><span class="pre">RabbitMQ</span></code> o <code class="docutils literal notranslate"><span class="pre">Kafka</span></code>)
per avvisare tutti gli altri di un allarme o di un fatto applicativo.</p>
<ul class="simple">
<li><dl class="simple">
<dt><em>OpenAPI</em>: Descrive una conversazione <em>Domanda -&gt; Risposta immediata</em> (<strong>Sincrona</strong>) con possibile</dt><dd><p>semplici notifiche con webhooks</p>
</dd>
</dl>
</li>
<li><p><em>AsyncAPI</em>: Descrive un <em>flusso di messaggi</em> dove chiunque può inviare qualcosa in qualsiasi momento (<strong>Asincrona</strong>).
È perfetto per le WebSocket perché gestisce sia chi “Invia” (<em>Publish</em>) sia chi “Ascolta” (<em>Subscribe</em>).</p></li>
</ul>
<p><em>AsyncAPI</em> ricalca la struttura di OpenAPI ma la adatta ai sistemi di messaggistica asincrona
e permette di definire il “contratto” di un’interfaccia <a class="reference internal" href="#websockets"><span class="std std-ref">WebSocket</span></a> in modo
che sia leggibile dalle macchine.</p>
<p><em>AsyncAPI</em> usa un file (<code class="docutils literal notranslate"><span class="pre">YAML</span></code> o <code class="docutils literal notranslate"><span class="pre">JSON</span></code>) per descrivere formalmente:</p>
<ul class="simple">
<li><p><strong>Servers</strong>: L’indirizzo del server (es. <code class="docutils literal notranslate"><span class="pre">ws://localhost:8080</span></code>).</p></li>
<li><p><strong>Channels</strong> (I percorsi): Specifica che esiste un canale <code class="docutils literal notranslate"><span class="pre">/xxx</span></code>.</p></li>
<li><p><strong>Messages</strong> (Il contenuto): Descrive la forma dei dati.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">asyncapi</span><span class="p">:</span> <span class="mf">2.6.0</span>
<span class="n">info</span><span class="p">:</span>
  <span class="n">title</span><span class="p">:</span> <span class="n">Sistema</span> <span class="n">S</span> <span class="n">API</span>
  <span class="n">version</span><span class="p">:</span> <span class="mf">1.0.0</span>
<span class="n">channels</span><span class="p">:</span>
  <span class="o">/</span><span class="n">f1</span><span class="p">:</span>
    <span class="n">subscribe</span><span class="p">:</span> <span class="c1"># Messaggi che il CLIENT riceve dal server</span>
      <span class="n">message</span><span class="p">:</span>
        <span class="n">payload</span><span class="p">:</span>
          <span class="nb">type</span><span class="p">:</span> <span class="n">string</span>
          <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;Il risultato dell&#39;elaborazione di f1&quot;</span>
    <span class="n">publish</span><span class="p">:</span> <span class="c1"># Messaggi che il CLIENT può inviare al server</span>
      <span class="n">message</span><span class="p">:</span>
        <span class="n">payload</span><span class="p">:</span>
          <span class="nb">type</span><span class="p">:</span> <span class="nb">object</span>
          <span class="n">properties</span><span class="p">:</span>
            <span class="n">inputString</span><span class="p">:</span>
              <span class="nb">type</span><span class="p">:</span> <span class="n">string</span>
</pre></div>
</div>
<p>A partire da questo documento, è possibile:</p>
<ul class="simple">
<li><p><strong>Documentazione Automatica</strong>: Esistono tool che leggono il file AsyncAPI e generano una pagina web
(simile a Swagger UI) dove chiunque può vedere come interagire con il  sistema .</p></li>
<li><p><strong>Generazione del Codice</strong>: Dal file è possibile generare automaticamente le classi Java o i client JavaScript.
Invece di scrivere manualmente frasi del tipo <code class="docutils literal notranslate"><span class="pre">socket.send(...)</span></code>, le funzioni generate impediscono di
commettere errori.</p></li>
<li><p><strong>Validazione</strong>: Si può inserire nel server un “validatore” che controlla se i messaggi in arrivo
rispettano il contratto. Se un client invia un numero invece di una stringa, il sistema lo rifiuta automaticamente.</p></li>
</ul>
<p>Ad esempio, una volta scritto il contratto in <a class="reference external" href="https://studio.asyncapi.com/">AsyncAPI Studio</a> (editor visuale online), si potrebbe usare:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://modelina.org/">Modelina</a> per generare le classi Java dei messaggi.</p></li>
<li><p><a class="reference external" href="https://www.asyncapi.com/tools/generator">AsyncAPI Generator</a> per creare lo scheletro del client che i tuoi colleghi useranno.</p></li>
<li><p><a class="reference external" href="https://microcks.io/">Microcks</a> per simulare il server mentre si scrive la logica reale in Javalin o Vert.x.</p></li>
</ul>
</section>
</section>
<section id="grpc">
<span id="id76"></span><h3>gRPC<a class="headerlink" href="#grpc" title="Permalink to this heading">¶</a></h3>
<p><strong>gRPC</strong> sta per <a class="reference external" href="https://it.wikipedia.org/wiki/gRPC">gRPC Remote Procedure Call</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>la <strong>“g”</strong> non ha un significato fisso. Sebbene il framework sia stato creato originariamente da Google,
il significato della lettera cambia per ogni versione rilasciata.
Ad esempio, nella versione 1.1 significava “gentle”, nella 1.10 “glowing”, e così via.</p>
</div>
<p>gRPC è un’architettura e un sistema API open source governati dalla <em>Cloud Native Computing Foundation</em>.
È è un’implementazione specifica basata sul modello <strong>RPC</strong> (<em>Remote Procedure Call</em>).</p>
<p>Mentre in <em>REST</em> un client richiede o aggiorna i dati sul sistema-servizio,
in <em>gRPC</em>, il client chiama o invoca funzioni specifiche del server, visto come un altro componente software.</p>
<p>gRPC è stato progettato da Google specificamente per essere più efficiente di REST nella comunicazione
tra <span class="xref std std-ref">microservizi</span>.</p>
<ul class="simple">
<li><p>gRPC è progettato per far sì che un client possa invocare un metodo su un server remoto
come se fosse una chiamata a una funzione locale, scoendo un ‘contratto’ definito nel file <code class="docutils literal notranslate"><span class="pre">.proto</span></code>.</p></li>
<li><p>un server gRPC è solitamente stateless</p></li>
<li><p>REST usa JSON (testuale, pesante da leggere per le macchine).
gRPC usa <em>Protocol Buffers</em> (binario, molto più piccolo e veloce da processare).</p></li>
<li><p>gRPC usa <strong>HTTP/2</strong>, che permette di inviare più richieste contemporaneamente
sulla stessa connessione (multiplexing).</p></li>
<li><p>gRPC non è un sostituto totale di REST: È <strong>difficile da usare direttamente dal browser</strong> (richiede dei proxy).
Inoltre, essendo binario, non puoi “leggere” i messaggi semplicemente guardando
il traffico di rete senza strumenti appositi.</p></li>
<li><p>in architetture a m <span class="xref std std-ref">microservizi&lt;Microservices&gt;`icroservizi, se due servizi risiedono nello stesso processo,
la specifica può indicare un trasporto locale **In-Process**. Questo elimina l’overhead della rete e
della serializzazione, pur mantenendo l’interfaccia definita nel file di configurazione (`</span>.proto``).</p></li>
<li><p>gRPC ha come uso ideale: Comunicazione interna tra <span class="xref std std-ref">microservizi</span> (<strong>Backend-to-Backend</strong>).</p></li>
</ul>
<p>gRPC è estremamente efficiente per lo sviluppatore perché genera automaticamente il codice per il client
e per il server. Non occorre scrivere a mano  chiamate o gestire gli errori di parsing JSON:
il codice generato si comporta come se si stesse chiamando una funzione locale sul client.</p>
</section>
<section id="grpc-vs-oas">
<h3>gRPC vs. OAS<a class="headerlink" href="#grpc-vs-oas" title="Permalink to this heading">¶</a></h3>
<p>Il rapporto tra gRPC e OAS è un tema centrale nell’architettura moderna, poiché rappresenta l’incontro tra due mondi:
quello della comunicazione binaria ad alte prestazioni e quello della documentazione testuale standardizzata.</p>
<section id="code-first-vs-contract-first">
<h4>Code-First” vs “Contract-First<a class="headerlink" href="#code-first-vs-contract-first" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p><strong>OAS (REST)</strong>: Nasce per descrivere interfacce HTTP esistenti o per progettarne di nuove basate su verbi (GET, POST)
e risorse. È molto flessibile e orientato all’essere umano.
Molte implementazioni REST fatte con Spring Boot o ASP.NET Web API partono (<strong>Code-First</strong>)
da una classe in C# o Java, in cui si aggiungono dei metadati (es. &#64;Annotation);
un software scansiona il codice per produrre un file descrittivo (come <em>swagger.json</em>).</p></li>
<li><p><strong>gRPC (Protobuf)</strong>: Il contratto <code class="docutils literal notranslate"><span class="pre">.proto</span></code> non è solo una documentazione, ma è il codice stesso.
Dal file <em>.proto</em> si generano le classi e le funzioni da usere nel software.
È un approccio “Schema-First” o  <strong>Contract-First</strong> ((Il contratto prima di tutto)) per definizione.</p></li>
</ul>
<p>In generale si può dire che:</p>
<ul class="simple">
<li><p>il rapporto OAS/gRPC evideniza un punto fondamentale dell’ingegneria del software:
la distinzione tra interfaccia di superficie (contratto ‘passivo’ su cosa si può chiamare - endpoint, verbi, parametri) e
contratto funzionale (contratto “Vincolante”: Tipizzazione Forte, Gestione degli errori, …).</p></li>
<li><p>gRPC sposta il contratto dalla documentazione alla compilazione e
il contratto include aspetti inerenti alla <strong>logica della comunicazione</strong>
Client e Server usano lo stesso identico codice generato dal file <code class="docutils literal notranslate"><span class="pre">.proto</span></code>.
Se il contratto cambia, entrambi devono essere ricompilati.
È impossibile avere un client che “pensa” che l’API sia fatta in un modo mentre il server la implementa in un altro.
Dunque gRPC fa meglio se l’obiettivo è la correttezza del sistema: evita ambiguità, elimina gli errori di parsing
e garantisce che la dinamica tra i servizi sia coerente.</p></li>
<li><p>OAS fa meglio se l’obiettivo è l’accessibilità: chiunque, con un semplice browser o un comando <strong>curl</strong>,
deve poter interagire con la superficie del servizio senza dover scaricare compilatori o file di schema.
OAS rimane superiore anche per la scoperta (<strong>Discoverability</strong>) dei servizi</p></li>
</ul>
<p>Nelle architetture a <span class="xref std std-ref">microservizi</span>, <code class="docutils literal notranslate"><span class="pre">gRPC</span></code> e <code class="docutils literal notranslate"><span class="pre">OAS</span></code> convivono spesso secondo questo schema:</p>
<ul class="simple">
<li><p><strong>Front-End - Back-End</strong> (<code class="docutils literal notranslate"><span class="pre">OAS/REST</span></code>): Per la comunicazione verso il mondo esterno (browser, app mobile, partner esterni),
si usa OAS. È universale, facile da testare con un browser e attraversa facilmente i firewall.</p></li>
<li><p><strong>Back-End - Back-End</strong> (<code class="docutils literal notranslate"><span class="pre">gRPC</span></code>): Per la comunicazione interna tra i microservizi, si usa gRPC.
È molto più veloce, riduce il carico della CPU e garantisce che se un servizio cambia il suo “contratto”
(il file <code class="docutils literal notranslate"><span class="pre">.proto</span></code>), gli altri se ne accorgano in fase di compilazione.</p></li>
</ul>
<p>La comunità ha creato strumenti per trasformare l’uno nell’altro. Il più famoso è il <strong>gRPC-Gateway</strong>.
Si tratta di un plugin che i file .proto e genera automaticamente:</p>
<ul class="simple">
<li><p>Un server Reverse Proxy che accetta chiamate REST/JSON e le traduce in gRPC.</p></li>
<li><p>Un file OpenAPI che documenta quegli stessi endpoint.</p></li>
</ul>
<p>In questo modo, si può scrivere il  servizio  in gRPC e fornire agli utenti
una documentazione OAS standard per usare il servvio via HTTP.</p>
</section>
</section>
</section>
<section id="sistemi-visti-dall-interno">
<h2>Sistemi visti dall’interno<a class="headerlink" href="#sistemi-visti-dall-interno" title="Permalink to this heading">¶</a></h2>
<p>Guardare un sistema software ‘dal di dentro’ significa poter capire meglio come è fatto e quali altre proprietà
abbia, oltre a quelle esposte nelle API.</p>
<p>Ovviamente l’interno di un sistema software è costituito da  un insieme di <em>istruzioni</em> (codice) scritte in qualche
linguaggio di programmazione e non è raro che, per molti sistemi, la lettura del codice risulti intricata
e <a class="reference internal" href="#sistemi-complicati"><span class="std std-ref">complicata</span></a> da capire.</p>
<p>Ma se un sistema software è ‘fatto bene’ il codice rivela subito una precisa <strong>architettura</strong> che ne rende
la comprensione più semplice.</p>
<section id="dimensioni">
<span id="id77"></span><h3>Dimensioni<a class="headerlink" href="#dimensioni" title="Permalink to this heading">¶</a></h3>
<p>La descrizione di un sistema software ‘dall’interno’ può avvenire
focalizzando l’attenzione su almeno tre diversi punti di vista:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_static/img/Architectures/Dimensioni.PNG"><img alt="_static/img/Architectures/Dimensioni.PNG" class="align-center" src="_static/img/Architectures/Dimensioni.PNG" style="width: 100%;" /></a>
</td>
<td><ul class="simple">
<li><p>l’organizzazione del sistema in parti (<strong>struttura</strong>);</p></li>
<li><p>il modo in cui le diverse parti scambiano informazione implicita o esplicita tra loro (<strong>interazione</strong>);</p></li>
<li><p>il funzionamento del tutto e di ogni singola parte (<strong>comportamento</strong>).</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</section>
<section id="design-patterns">
<h3>Design patterns<a class="headerlink" href="#design-patterns" title="Permalink to this heading">¶</a></h3>
<p>I Design Pattern sono l’equivalente dei “modelli predefiniti” o delle “best practice”
consolidate nel mondo dell’ingegneria del software. Invece di reinventare ogni volta la ruota
per risolvere un problema ricorrente, si utilizza una <strong>soluzione architetturale</strong> che è già stata testata,
analizzata e raffinata da migliaia di sviluppatori.</p>
<p>Un pattern non è codice da copiare e incollare.
È piuttosto un <strong>progetto concettuale</strong> che descrive come risolvere un problema in una
determinata situazione.</p>
<p>Se l’architettura è la “strategia” (come dividiamo il sistema in grandi blocchi?),
i design pattern sono la “tattica” (come facciamo comunicare questi blocchi in modo opportuno?).</p>
<p>I pattern vengono solitamente divisi in famiglie principali.
Ricordiamo qui le tre categorie classiche, la cui conoscenza diamo per scontata.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 40%" />
<col style="width: 60%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Agli anni 90 del secolo scorso risale l’idea di <cite>pattern</cite>, culminata nella pubblicazione
nel <code class="docutils literal notranslate"><span class="pre">1995</span></code> dell’ormai famoso testo sui <a class="reference external" href="https://it.wikipedia.org/wiki/Design_pattern">Design Pattern</a>  della così detta <em>Gang-of-Four</em>
(<strong>GoF</strong>): <em>Erich Gamma, Richard Helm, Ralph Johnson e John Vlissides</em>).</p></td>
<td><a class="reference internal image-reference" href="_images/DesignPatternGof.PNG"><img alt="_images/DesignPatternGof.PNG" class="align-center" src="_images/DesignPatternGof.PNG" style="width: 100%;" /></a>
</td>
</tr>
</tbody>
</table>
<p>Un errore comune è cercare di “forzare” i pattern ovunque.
Questo porta alla cosiddetta <strong>Over-engineering</strong>: il codice diventa inutilmente complicato.
Un bravo architetto software usa i pattern solo quando la semplicità non è più sufficiente.</p>
<p>Dopo la introduzione dei pattern <strong>GoF</strong>, si sono susseguiti molte altre
proposte sui design pattern.
I riferimenti più noti sono i cinque testi <code class="docutils literal notranslate"><span class="pre">POSA</span></code>
sulle <em>Pattern oriented Software Architectures</em>
e i convegni <code class="docutils literal notranslate"><span class="pre">PLoP</span></code> (<em>Pattern Languages of Programming</em>).</p>
<section id="pattern-posa">
<h4>Pattern POSA<a class="headerlink" href="#pattern-posa" title="Permalink to this heading">¶</a></h4>
<p>Si riportano qui i pattern POSA (<em>Pattern oriented Software Architectures</em>) principali,
che intendono introdurre strutture nei
sistemi software, per superare il così detto <a class="reference internal" href="#big-ball-of-mud"><span class="std std-ref">Big Ball of Mud</span></a>.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 2%" />
<col style="width: 98%" />
</colgroup>
<tbody>
<tr class="row-odd"><td></td>
<td><a class="reference internal image-reference" href="_images/Posa.PNG"><img alt="_images/Posa.PNG" class="align-center" src="_images/Posa.PNG" style="width: 100%;" /></a>
</td>
</tr>
</tbody>
</table>
<p>Anche se non approfondiremo in modo sistematico questi pattern, ritroveremo
molte delle problematiche che motivano i vari pattern nei casi di studio
di sistemi distributi che affronteremo, poenendo particolare attenzione
sui <a class="reference internal" href="#sistemi-a-microservizi"><span class="std std-ref">Sistemi a Microservizi</span></a>.</p>
</section>
</section>
<section id="architettura-di-un-sistema">
<h3>Architettura di un sistema<a class="headerlink" href="#architettura-di-un-sistema" title="Permalink to this heading">¶</a></h3>
<p>Definire l’architettura software è sempre stato complicato perché il termine oscilla tra la struttura
tecnica e il processo decisionale. Oggi, la comunità scientifica e professionale converge
principalmente su due definizioni che si completano a vicenda.</p>
<section id="definizione-strutturale">
<h4>Definizione Strutturale<a class="headerlink" href="#definizione-strutturale" title="Permalink to this heading">¶</a></h4>
<p>Lo Standard ISO/IEC/IEEE 42010 recita:</p>
<ul class="simple">
<li><p>L’architettura software è l’organizzazione fondamentale di un sistema, definita dai suoi componenti,
dalle relazioni tra di essi e con l’ambiente, e dai principi che ne guidano il progetto e l’evoluzione.</p></li>
</ul>
</section>
<section id="definizione-pragmatica">
<h4>Definizione Pragmatica<a class="headerlink" href="#definizione-pragmatica" title="Permalink to this heading">¶</a></h4>
<p>Nel mondo dello sviluppo Agile e dei Microservizi, si sposta l’attenzione dal “disegno” alle scelte strategiche:</p>
<ul class="simple">
<li><p>L’architettura è l’insieme delle decisioni significative su come è costruito un sistema software;
sono le decisioni <strong>difficili da cambiare</strong> in un secondo momento</p></li>
</ul>
<p>Ad esempio: usare un database relazionale o NoSQL è una scelta architettonica (difficile da invertire).</p>
<p>Un’altra frase celebre nel settore dice:</p>
<ul class="simple">
<li><p>L’architettura è ciò che resta del sistema quando si rimuovono tutti i dettagli implementativi.</p></li>
</ul>
<p>Ovvero, è lo <strong>scheletro concettuale</strong> che permette di ragionare sul comportamento del software.</p>
<p><strong>Evoluzione delle architetture</strong></p>
<p>L’evoluzione delle architetture software è una storia di <em>astrazione crescente</em> e di <em>decentramento</em>.
Ogni fase è nata per risolvere un limite della precedente, passando da blocchi di codice indivisibili
a ecosistemi di funzioni atomiche che “vivono” nel cloud.</p>
<p>Un sintetico quadro di questa evoiluzione può essere tracciato come segue:</p>
<ol class="arabic">
<li><p>Il <strong>Monolite (Anni ‘60 - ‘80)</strong></p>
<p>Tutto il software risiede in un unico blocco logico.
Interfaccia utente, logica di business e accesso ai dati sono strettamente intrecciati.
Il software gira su un unico server (Mainframe)</p>
</li>
<li><p><strong>Client-Server (Anni ‘90)</strong></p>
<p>Con l’arrivo dei PC e delle reti locali, l’architettura si spacca in due (<strong>2-Tier</strong>).
Il Client (PC dell’utente) contiene l’interfaccia e la logica, mentre il Server gestisce solo il Database.</p>
</li>
<li><p><strong>Architettura N-Tier / Layered (Anni 2000)</strong></p>
<p>L’esplosione del Web induce a dividere il monolite in “strati” (<strong>layer</strong>) logici.
Si aggiunge uno strato intermedio (<strong>3-Tier</strong>):</p>
<p><code class="docutils literal notranslate"><span class="pre">Presentation</span> <span class="pre">(Browser)</span> <span class="pre">→</span> <span class="pre">Logic</span> <span class="pre">(Server</span> <span class="pre">Applicativo)</span> <span class="pre">→</span> <span class="pre">Data</span> <span class="pre">(Database)</span></code></p>
<p>Questo modello ha dominato l’era di Java EE e .NET, portando alla definizione di pattern come
il <em>Model-View-Controller</em> (<strong>MVC</strong>).</p>
</li>
<li><p><strong>SOA - Service Oriented Architecture (Metà anni 2000)</strong></p>
<p>Il sistema è un insieme di “servizi” che comunicano tramite un bus centrale (<strong>ESB</strong> - <em>Enterprise Service Bus</em>)
I servizi sono grandi e pesanti, spesso legati a protocolli complicati come SOAP e XML.</p>
</li>
<li><p><strong>Microservizi e Cloud-Native (2010 - Oggi)</strong></p>
<p>Il sistema è diviso in decine o centinaia di servizi minuscoli e autonomi.
Ogni servizio ha il suo DB, viene “impacchettato” in <strong>Docker</strong> e orchestrato da <strong>Kubernetes</strong>.
La comunicazione è leggera (REST, gRPC, WebSocket).</p>
</li>
<li><p><strong>Serverless ed Event-Driven (Il Presente)</strong></p></li>
</ol>
<blockquote>
<div><p>L’architettura non è più fatta di server sempre accesi, ma di singole funzioni che si attivano solo in risposta a un evento
(<strong>FaaS</strong> <em>Function as a Service</em>) gestito da un <em>Cloud Provider</em>.</p>
</div></blockquote>
</section>
</section>
<section id="big-ball-of-mud">
<span id="id78"></span><h3>Big Ball of Mud<a class="headerlink" href="#big-ball-of-mud" title="Permalink to this heading">¶</a></h3>
<p>Il concetto di <strong>Big Ball of Mud</strong> (<em>Grande Palla di Fango</em>) è stato evocatoo per la prima volta
in un saggio di <em>Brian Foote</em> e <em>Joseph Yoder</em> nel 1997.
Tuttavia, come problema sistematico, si è manifestato in momenti diversi dell’evoluzione architettonica,
diventando particolarmente critico durante la transizione tra gli anni ‘80 e ‘90.</p>
<p>Nel 1997, quando Foote e Yoder pubblicarono il loro saggio,
nonostante i nuovi Design Pattern, la maggior parte del software reale non era affatto “pulito”.</p>
<p>La fretta, i requisiti che cambiano continuamente e il turnover degli sviluppatori portavano
naturalmente il codice verso la “Palla di Fango”, cioè
verso uno stato di entropia massima del software: un sistema che cresce senza un’architettura definita,
dove ogni parte dipende da ogni altro parte.</p>
<p>Nella storia del software, il “Big Ball of Mud” si manifesta ogni volta che la velocità
di sviluppo prevale sulla disciplina architettonica.
È la “<strong>default architecture</strong>”: senza uno sforzo cosciente per applicare principi organizzivi
(come i <a class="reference internal" href="#principi-solid"><span class="std std-ref">Principi SOLID</span></a> o
le <a class="reference internal" href="#clean-architectures"><span class="std std-ref">Clean Architecture</span></a>, il sistema, inevitabilmente, si presenta internamente  una palla di fango.</p>
<p><strong>L’architettura è costosa, ma la mancanza di architettura costa molto di più.</strong></p>
</section>
<section id="principi-solid">
<span id="id79"></span><h3>Principi SOLID<a class="headerlink" href="#principi-solid" title="Permalink to this heading">¶</a></h3>
<p>I principi SOLID sono nati nel contesto della <em>Programmazione Orientata agli Oggetti</em> (OOP),
ma oggi sono considerati principi universali di progettazione software, applicabili a livello di architettura,
microservizi e persino organizzazione dei dati.</p>
<section id="srp-single-responsibility">
<span id="single-responsibility"></span><h4>SRP-Single responsibility<a class="headerlink" href="#srp-single-responsibility" title="Permalink to this heading">¶</a></h4>
<p><strong>Single responsibility principle</strong>:  in OOP, una classe dovrebbe avere una, e una sola, ragione per cambiare.</p>
<ul class="simple">
<li><p>Concetto Universale: <strong>Coesione</strong>. Ogni componente del sistema deve fare (bene) una cosa sola.</p></li>
<li><p>In Architettura: Un microservizio (o un modulo del Monolite Modulare) deve gestire una sola funzionalità
di business. Se il servizio “Ordini” gestisce anche la “Generazione PDF delle fatture” e il “Tracking GPS”,
si sta violando l’SRP a livello macroscopico.</p></li>
</ul>
</section>
<section id="ocp-open-closed">
<span id="open-closed"></span><h4>OCP-Open/closed<a class="headerlink" href="#ocp-open-closed" title="Permalink to this heading">¶</a></h4>
<p><strong>Open-closed principle</strong>:  in OOP, una classe dovrebbe essere aperta per l’estensione ma chiusa per la modifica.</p>
<ul class="simple">
<li><p>Concetto Universale: <strong>Estensibilità</strong>. Usare interfacce o “hook” per permettere l’evoluzione del sistema
senza toccare il codice sorgente originale.</p></li>
<li><p>In Architettura: Un sistema deve permettere l’aggiunta di nuove funzionalità senza riscrivere il nucleo esistente.
Si pensa ai Plugin o alle Estensioni dei browser.</p></li>
</ul>
</section>
<section id="lsp-liskov-substitution">
<span id="liskov-substitution"></span><h4>LSP-Liskov substitution<a class="headerlink" href="#lsp-liskov-substitution" title="Permalink to this heading">¶</a></h4>
<p><strong>Liskov’s substitution principle</strong>: in OOP, gli oggetti in un programma dovrebbero essere sostituibili
con istanze dei loro sottotipi senza alterare la correttezza di quel programma.</p>
<ul class="simple">
<li><p>Concetto Universale: <strong>Intercambiabilità</strong>. Il rispetto del “contratto” garantisce che il sistema
non collassi sostituendo un componente.</p></li>
<li><p>In Architettura: Questo è il principio cardine delle Interfacce API e dei Contratti (come AsyncAPI).
Se si sostituisce il servizio xxx1 versione A con la versione B, il client non deve accorgersi della differenza.</p></li>
</ul>
</section>
<section id="isp-interface-segregation">
<span id="interface-segregation"></span><h4>ISP-Interface segregation<a class="headerlink" href="#isp-interface-segregation" title="Permalink to this heading">¶</a></h4>
<p><strong>Interface segregation principle</strong>: in OOP, molte interfacce specifiche del client sono migliori di un’interfaccia generica.</p>
<ul class="simple">
<li><p>Concetto Universale: <strong>Minimo Privilegio Informativo</strong>. Fornire solo ciò che serve per quel compito specifico
(molto rilevante nella sicurezza e nelle performance).</p></li>
<li><p>In Architettura: Evitare i “Modelli Dati Giganti”. Se un client ha bisogno solo dell’indirizzo di un utente,
non inviargli l’intero oggetto JSON con password, storico acquisti e preferenze.</p></li>
</ul>
</section>
<section id="dip-dependency-inversion">
<span id="dependency-inversion"></span><h4>DIP-Dependency inversion<a class="headerlink" href="#dip-dependency-inversion" title="Permalink to this heading">¶</a></h4>
<p><strong>Dependency inversion principle</strong>: si dovrebbe dipendere dalle astrazioni, non dalle implementazioni.</p>
<ul class="simple">
<li><p>Concetto Universale: <strong>Disaccoppiamento</strong>. L’astrazione protegge la logica di business dalle tecnologie volatili.</p></li>
<li><p>In Architettura: È il fondamento della <a class="reference internal" href="#architettura-port-adapter"><span class="std std-ref">Architettura Port/Adapter</span></a>.
Il “cuore” logico della applicazione non deve dipendere dal database specifico (MySQL o MongoDB)
o dal protocollo (WebSocket o CoAP). Sono il database e il protocollo che devono “adattarsi” alle porte del sistema.</p></li>
</ul>
<p>Se il codice sorgetne di un componente di alto livello dipende da quello di un componente di basso livello,
i cambiamenti nei componenti di basso livello si diffonderanno al componente di alto livello.
Pertanto, poniamo un confine tra i due, usando il polimorfismo per invertire il flusso logico.</p>
</section>
</section>
<section id="clean-architectures">
<span id="id80"></span><h3>Clean Architecture<a class="headerlink" href="#clean-architectures" title="Permalink to this heading">¶</a></h3>
<p>E’ un’architettura che segue i principi SOLID.
L’idea chiave è quella di utilizzare il <a class="reference internal" href="#dependency-inversion"><span class="std std-ref">principio di inversione delle dipendenze</span></a> per tracciare
confini tra componenti di alto livello e componenti di basso livello.
Questo crea un’architettura “plug-in” che mantiene il sistema flessibile e manutenibile.</p>
<p>Vediamo un esempio, preso da :ref:Clean Architecture:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Le regole aziendali dipendono dall’interfaccia anziché dalla classe di database concreta.</p>
<p>Il database diventa un plug-in delle regole aziendali: un componente di basso livello
che può essere modificato senza influenzare le regole aziendali (componente di alto livello).</p>
</td>
<td><p>.</p>
<a class="reference internal image-reference" href="_images/EsempioInversioneDip.PNG"><img alt="_images/EsempioInversioneDip.PNG" class="align-center" src="_images/EsempioInversioneDip.PNG" style="width: 100%;" /></a>
</td>
</tr>
</tbody>
</table>
<section id="architettura-port-adapter">
<span id="id81"></span><h4>Architettura Port/Adapter<a class="headerlink" href="#architettura-port-adapter" title="Permalink to this heading">¶</a></h4>
<p>L’architettura <strong>esagonale</strong> (anche nota come <em>Port-Adapter</em>) è, tra le tante Architetture di sistemi software
oggi in uso, quella cui noi faremo particolare attenzione.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Si identificano quattro layer principali</p>
<ul class="simple">
<li><p>Entities: oggetti che contengono la logica aziendale critica.</p></li>
<li><p>Use-cases: regole aziendali specifiche dell’applicazione</p></li>
<li><p>Interface adapters: gateway, presentatori e controller.
Ad esempio, questo livello contiene l’architettura MVC della GUI e anche oggetti che trasformano
i dati tra il formato del database e i casi d’uso.</p></li>
<li><p>Frameworks and drivers: framework web, database, la vista di MVC</p></li>
</ul>
</td>
<td><p>.</p>
<a class="reference internal image-reference" href="_images/portAdapterArch.PNG"><img alt="_images/portAdapterArch.PNG" class="align-center" src="_images/portAdapterArch.PNG" style="width: 100%;" /></a>
</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="bounded-context-e-clean-architecture">
<span id="bounded-context"></span><h3>Bounded Context e Clean Architecture<a class="headerlink" href="#bounded-context-e-clean-architecture" title="Permalink to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Bounded Context: Il confine “Politico/Linguistico”</p></li>
</ol>
<blockquote>
<div><p>Immagina il tuo sistema S. Se cresce, potresti avere una parte che si occupa di Vendite e una di Spedizioni.
Nel Bounded Context “Vendite”, la parola Prodotto significa “prezzo e descrizione”.
Nel Bounded Context “Spedizioni”, Prodotto significa “peso e dimensioni”.</p>
<p>Il Bounded Context impedisce che i due concetti si confondano.</p>
<p>Divide il sistema in moduli indipendenti (la base per i Microservizi o i Monoliti Modulari).</p>
</div></blockquote>
<ol class="arabic simple">
<li><p>Clean Architecture: Il confine “Tecnico”</p></li>
</ol>
<blockquote>
<div><p>Una volta stabilito che siamo dentro il contesto “Vendite”, come organizziamo il codice? Qui entra in gioco la Clean Architecture (o Architettura Esagonale).</p>
<p>Mette la Business Logic (le tue funzioni f1 e f2) al centro.</p>
<p>Mette il Database, le WebSocket (Javalin/Vert.x) e le interfacce esterne in periferia.</p>
<p>La regola d’oro è: il centro non sa nulla della periferia.</p>
</div></blockquote>
<p>In sintesi:</p>
<ul class="simple">
<li><p>Il Bounded Context (dal Domain-Driven Design) definisce i confini orizzontali (tra diverse aree di business).</p></li>
<li><p>La Clean Architecture definisce i confini verticali (all’interno di ogni singola area, tra logica e tecnologia).</p></li>
</ul>
<p>Un microservizio ben progettato è:</p>
<p>Un’unità di deploy che racchiude un singolo Bounded Context, organizzata internamente secondo la Clean Architecture.</p>
</section>
</section>
</section>
<section id="costruire-sistemi-software">
<h1>Costruire sistemi software<a class="headerlink" href="#costruire-sistemi-software" title="Permalink to this heading">¶</a></h1>
<p>Processo di produzione SCRUM</p>
<section id="installare-su-pc">
<h2>Installare su PC<a class="headerlink" href="#installare-su-pc" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Installare <cite>Java JDK 17</cite> <em>Windows-&gt;Preferences-&gt;Java-&gt;InstalledJRE</em></p></li>
<li><p>Installare <cite>GIT</cite> e un Git repository <cite>PERSONALE PRIVATO</cite> e <strong>dare accesso al docente</strong></p></li>
<li><p>Installare <cite>Gradle</cite>  (8.4, 8.6)
(per accedere a <em>System Properties Advanced</em> su Windows: <code class="docutils literal notranslate"><span class="pre">sysdm.cpl</span></code>)</p></li>
<li><p>Installare  <cite>Eclipse IDE</cite>: <a class="reference external" href="https://www.eclipse.org/downloads/packages/">Eclipse IDE for Java and DSL Developers</a> (2024 12)</p></li>
<li><p>Installare <cite>Docker</cite> e provarne l’uso</p></li>
</ol>
<p>In un secondo momento:</p>
<ol class="arabic simple">
<li><p>Installare <cite>Python (3.9.13)</cite> (usando Anaconda)</p></li>
<li><p>Installare <cite>IntelliJ</cite></p></li>
<li><p>Installare <cite>Node.js</cite></p></li>
</ol>
</section>
<section id="il-ruolo-di-gradle">
<h2>Il ruolo di Gradle<a class="headerlink" href="#il-ruolo-di-gradle" title="Permalink to this heading">¶</a></h2>
<p>La costruzione di un sistema software non può oggi prescindere dall’uso di un <strong>IDE</strong> e di
strumenti di come <a class="reference external" href="https://gradle.org/">Gradle</a>, uno strumento open source per automatizzare la costruzione (build)
del software.</p>
<p>Gradle è ormai uno standard di fatto in questo settore ed è interessante non solo in quanto
strumento, ma anche perchè applica i principi del <a class="reference external" href="https://it.wikipedia.org/wiki/Domain-driven_design">Domain Driven Design</a> (<strong>DDD</strong>)
per modellare il suo proprio  domain-building software.</p>
<p>Ne consegue che non poco tempo deve essere dedicato allo studio di questi tools e
alla preparazione del file <code class="docutils literal notranslate"><span class="pre">build.gradle</span></code> che governa lo sviluppo e il deployment
del sistema software.</p>
<p>Le rete offfre numerosi tutorial su Gradle, come ad esempio:
<a class="reference external" href="https://tomgregory.com/gradle/gradle-tutorial-for-complete-beginners/">https://tomgregory.com/gradle/gradle-tutorial-for-complete-beginners/</a>
(anche in <a class="reference external" href="_static/GradleTutorialForCompleteBeginners.pdf">gradle-tutorial</a> e in <span class="xref std std-ref">GradleIntro25</span>)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Per usare Eclipse insieme a Gradle, potrebbe essere necessario eseguire i seguenti passi
(Grazie a <em>Stefano Arasi</em>):</p>
<ol class="arabic simple">
<li><p>Help-&gt;Eclipse MarketPlace</p></li>
<li><p>Search “Gradle”</p></li>
<li><p>Go to “BuildShop Gradle Integration 3.0” (the elephant) which is indicated as installed and</p></li>
</ol>
<blockquote>
<div><p>clic on the grayed installed button.</p>
</div></blockquote>
<ol class="arabic simple">
<li><p>Either click on update or uninstall and reinstall it, this will restart eclipse.</p></li>
</ol>
</div>
</section>
<section id="processi-agili-e-incrementali">
<h2>Processi agili e incrementali<a class="headerlink" href="#processi-agili-e-incrementali" title="Permalink to this heading">¶</a></h2>
<p>Oggi si ritiene che un approccio <cite>INCREMENTALE</cite> sia  indispensabile per aggredire la complessità del problema e per
mettere in luce in primis gli aspetti
PIU’ IMPORTANTI e PIU’ CRITICHE senza perdersi in dettagli che possono distogliere
l’attenzione per formare un quadro generale di riferimento.</p>
<p>L’approccio <cite>AGILE</cite> descritto in <a class="reference external" href="https://scrumguides.org/">SCRUM Guide</a> è oggi un punto di riferimento.</p>
<a class="reference internal image-reference" href="_images/AgileDevelop.PNG"><img alt="_images/AgileDevelop.PNG" class="align-center" src="_images/AgileDevelop.PNG" style="width: 90%;" /></a>
<p>I vari SPRINT dovrebbero effettuare uno ZOOMING entro MACRO-COMPONENTI
innescando un processo ITERATIVO di analisi, progetto , sviluppo e testing di
quel componente o del SOTTOSISTEMA  che lo SPRINT vuole costruire.</p>
</section>
<section id="il-testing">
<h2>Il testing<a class="headerlink" href="#il-testing" title="Permalink to this heading">¶</a></h2>
<p>L’obiettivo della fase di testing è quello di trovare il maggior numero di situazioni che conducono ad errori
con il minimo numero di casi di prova.</p>
<p>La fase di testing del software è  attività imprescindibile per garantirne la qualità ed è anche
indispensabile per garantire all’utente una <em>user experience</em> soddisfacente.</p>
<p>In <a class="reference external" href="https://www.ibm.com/it-it/topics/software-testing">Software testing IBM</a>  leggiamo che:</p>
<ul>
<li><p>Negli anni ‘90 c’è stata una transizione dai test a un processo più completo denominato
<cite>controllo di qualità</cite>, che copre l’intero ciclo di sviluppo del software e riguarda
i processi di pianificazione, progettazione, creazione ed esecuzione di casi di test.</p></li>
<li><p>I test del software sono stati tradizionalmente separati dal resto dello sviluppo, ma
molti team di sviluppo  usano ora una metodologia nota come <cite>test continuo</cite>.</p>
<p>Un  <em>piano di testing</em> (<strong>TestPlan</strong>)  ha di solito lo scopo di stabilire la gerarchia con cui i test vanno eseguiti,</p>
</li>
</ul>
<p>i metodi di esecuzione, i criteri di accettazione e prevede diverse tipologie di test, tra cui:</p>
<ul>
<li><p><strong>Unit test</strong> (Test di unità o di modulo)
Ha l’obiettivo di individuare gli errori nel singolo modulo software.</p></li>
<li><p><strong>Integration Test</strong> (Test di integrazione)
Ha l’obiettivo di individuare gli errori nel software quando tutti i moduli che compongono un sottosistema
o l’intero sistema vengono fatti lavorare assieme.</p></li>
<li><p><strong>System Test</strong> (Test di sistema)
Ha l’obiettivo di garantire che il prodotto software nel suo complesso soddisfi completamente
i requisiti iniziali. E’ un collaudo interno.</p></li>
<li><p><strong>Functional Test</strong> (Test legato ai requisit)
verifica che il sistema implementi correttamente le funzionalità specificate, producendo gli output attesi
a fronte di input noti, indipendentemente da come il sistema è implementato internamente.
In altre parole, verifica <strong>cosa fa</strong> il sistema, <strong>non come</strong> lo fa.</p></li>
<li><p><strong>User Acceptance Test</strong> (Test di accettazione)
Ha l’obiettivo di valutare la rispondenza dell’applicazione software rispetto ai requisiti
espressi inizialmente nel contratto e di ottenere l’accettazione formale del cliente di quanto realizzato.
Il test viene effettuato dal cliente nel suo ambiente di test, e da un gruppo di utenti.</p></li>
<li><p><strong>Alpha test e Beta test</strong>
Un <cite>alpha test</cite> è un test preliminare di un’applicazione software anche non ancora completa,
eseguito da alcuni potenziali utenti rappresentati da un team.</p>
<p>Un <cite>beta test</cite> ha l’obiettivo di far valutare al cliente, prima della distribuzione ufficiale del sistema,
la reale funzionalità, completezza ed operatività dell’applicazione.</p>
</li>
<li><p><strong>Regression Test</strong> (test di non regressione)
Ha l’obiettivo di verificare a valle di una manutenzione, dopo che un bug è stato individuato e corretto
e sono stati eseguiti esattamente gli stessi test che erano stati effettuati quando era stato individuato il problema.</p></li>
<li><p><strong>Stress test</strong> (test di carico)
Ha l’obiettivo di determinare il punto di rottura di un sistema software,
oltre il quale si verificano instabilità del sistema, perdita dei dati o interruzione del servizio.</p></li>
</ul>
<p>Sul problema del testing si trova moltissimo materiale in rete. Riportiamo qui alcuni riferimenti utili sul ‘piano pragmatico’:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Software_testing">Software testing</a> (wikipedia)</p></li>
<li><p><a class="reference external" href="http://sqa.fyicenter.com/FAQ/Automated-Testing-Plan/">Automated-Testing-Plan FAQ</a></p></li>
</ul>
<section id="dal-testing-a-devops">
<h3>Dal testing a DevOps<a class="headerlink" href="#dal-testing-a-devops" title="Permalink to this heading">¶</a></h3>
<p>Il <em>test continuo</em> è parte dell’approccio <a class="reference external" href="https://it.wikipedia.org/wiki/DevOps">DevOps</a>, in cui sviluppo e operazioni collaborano
per l’intero ciclo di vita del prodotto. L’obiettivo è quello di accelerare la fornitura del software,
bilanciando al tempo stesso i costi, la qualità e i rischi.</p>
<p>L’obiettivo di definire fin dalle fasi di analisi un  <strong>TestPlan</strong> con test automatizzabili
di un sistema applicativo, introduce di fatto, per il progettisto del sistema, un <strong>nuovo requisito</strong>:
<cite>rendere  l’applicazione osservabile</cite>, o meglio:</p>
<p><strong>rendere verificabili, da parte di una macchina, gli effetti di un sistema software</strong></p>
</section>
</section>
<section id="il-metodo-di-lavoro">
<h2>Il metodo di lavoro<a class="headerlink" href="#il-metodo-di-lavoro" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Partiamo dall’insieme di requisiti <strong>forniti dal committente</strong> ed espressi in linguaggio naturale</p></li>
<li><p>Impostiamo lo <code class="docutils literal notranslate"><span class="pre">SPRINT0</span></code> come una <strong>analisi dei requisiti</strong> che mira a esprimerli in modo comprensibile anche alla macchina introducendo:</p>
<ul class="simple">
<li><p>un modello (eseguibile) dell’architattura del sistema desunta dai requisiti</p></li>
<li><p>un (primo) <em>TestPlan</em> di <strong>Functional Tests</strong></p></li>
</ul>
</li>
<li><p>Impostiamo una <strong>analisi del problema</strong> che mira a definire:</p>
<ul class="simple">
<li><p>una architettura logica del sistema come risultato dall’analisi</p></li>
<li><p>un piano di lavoro</p></li>
<li><p>una possibile estensione ai piani di testing funzionali</p></li>
<li><p>la definizione del primo SPRINT relizzativo</p></li>
</ul>
</li>
<li><p>Impostiamo ogni SPRINT come un <strong>sottoprogetto</strong> con sua propria spiegazione e testing.</p>
<ul class="simple">
<li><p>Lo SPRINT <span class="math notranslate nohighlight">\(n+1\)</span> parte dai risultati dello sprint <span class="math notranslate nohighlight">\(n\)</span> e costruisce un sottosistema (funzionante)
che sarà l’input dello SPRINT <span class="math notranslate nohighlight">\(n+2\)</span>.</p></li>
</ul>
</li>
<li><p>Facciamo seguire ad ogni SPRINT una fase di <a class="reference external" href="https://www.agileway.it/sprint-review-meeting/">Sprint review</a>&gt; i cui meeting saranno</p>
<ul class="simple">
<li><p><strong>un nuovo modo di concepire le ore di ricevimento-studenti</strong></p></li>
</ul>
</li>
<li><p>Per ogni  SPRINT, compiliamo un documento (si veda <span class="xref std std-ref">La documentazione del lavoro</span>)
per <strong>rendere esplcite</strong> le conoscenze,
le decisioni, i modelli, etc. introdotti nello SPRINT,
fornendo indicazioni all’utente finale su come eseguire lo SPRINT.</p></li>
</ol>
<section id="il-diario-di-bordo">
<h3>Il diario di bordo<a class="headerlink" href="#il-diario-di-bordo" title="Permalink to this heading">¶</a></h3>
<p>Ogni porgetto da noi impostato, deve avere un <cite>diario di bordo</cite>,
organizzato secondo un preciso <a class="reference external" href="_static/templateToFill.html">template</a>. Questo diario deve essere compilato
<strong>in itinere</strong>
con indicazioni <strong>sintetiche ed essenziali</strong>, man mano si svolge
il processo di produzione e <cite>non dopo</cite> avere sviluppato il codice.</p>
<section id="il-template-del-diario">
<h4>Il template del diario<a class="headerlink" href="#il-template-del-diario" title="Permalink to this heading">¶</a></h4>
<ul>
<li><p>Introduction</p></li>
<li><p>Requirements</p>
<blockquote>
<div><p>Copy here the EXACT text given by the customer.</p>
</div></blockquote>
</li>
<li><p>Requirement analysis</p></li>
<li><p>Problem analysis</p></li>
<li><p>Test plans</p></li>
<li><p>Project</p></li>
<li><p>Testing</p></li>
<li><p>Deployment</p></li>
<li><p>Maintenance</p></li>
<li><p>About the team (massimo 3 worker)</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>CognomeNomeMatricola del worker1</p></li>
<li><p>…</p></li>
</ol>
</div></blockquote>
</li>
</ul>
</section>
</section>
</section>
</section>
<section id="game-of-life-di-conway">
<h1>Game of Life di Conway<a class="headerlink" href="#game-of-life-di-conway" title="Permalink to this heading">¶</a></h1>
<p>Affrontiamo la
costruzione di un sistema software ispirato al famoso automa cellulare di
<strong>John Horton Conway</strong>: il <strong>Game of Life</strong> (<em>GofLife</em>).</p>
<p>Il mondo di <em>GofLife</em> è una griglia infinita di celle quadrate. Ogni cella può trovarsi in soli due stati:
VIVA (accesa) o MORTA (spenta)2.</p>
<p>GofLife è un “zero-player game”: la sua evoluzione è determinata interamente dallo stato iniziale della griglia.
Ad ogni “tick” di un clock (<strong>generazione</strong> o <strong>Epoch</strong>), si applicano quattro <strong>regole</strong>
basate sui  vicini di ogni cella:</p>
<blockquote>
<div><ul class="simple">
<li><p>Una cella viva con meno di due celle vive adiacenti muore (per isolamento).</p></li>
<li><p>Una cella viva con due o tre celle vive adiacenti sopravvive alla generazione successiva.</p></li>
<li><p>Una cella viva con più di tre celle vive adiacenti muore (per sovrappopolazione).</p></li>
<li><p>Una cella morta con esattamente tre celle vive adiacenti diventa una cella viva (per riproduzione).</p></li>
</ul>
</div></blockquote>
<p>Nel caso di grigla infinita, ogni cella ha esattamente 8 vicini (orizzontali, verticali e diagonali).
Ovviamente, in una implementazione software, la griglia sarà finita e le celle potranno avere <strong>3,5,o 8</strong> vicini.</p>
<p>Nonostante le regole parlino solo di “celle e vicini”, <strong>osservando una vista del sistema</strong>
emergono strutture che sembrano avere una propria identità, come:</p>
<ul class="simple">
<li><p>Still Lifes: Forme statiche che non cambiano (come rocce).</p></li>
<li><p>Oscillatori: Forme che mutano ciclicamente (come un battito cardiaco).</p></li>
<li><p>Spaceships (Astronavi): Aggregati che “espellono” delle strutture che viaggiano all’infinito lontano dal centro della griglia. Il più famoso è il <strong>Glider</strong> (Aliante).</p></li>
</ul>
<p>E’ importante sottolinare che le strutture <em>Still Lifes</em> <strong>sembrano</strong> rimanere immutabili.
Infatti esse sono <strong>continuamente rigenerate</strong> dal ‘motore’ del gico, sempre uguali a sè stesse.
Si veda: <a class="reference internal" href="#evoluzione-di-goflife"><span class="std std-ref">Il processo di evoluzione del gioco</span></a>.</p>
<section id="il-gioco-in-javascript">
<h2>Il gioco in  JavaScript<a class="headerlink" href="#il-gioco-in-javascript" title="Permalink to this heading">¶</a></h2>
<p>Collegandosi al sito <a class="reference external" href="https://playgameoflife.com/">https://playgameoflife.com/</a> si può sperimmetare il gioco. Riportiamo qui
alcune configurazioni iniziali interessanti:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>oscilla</p>
<a class="reference internal image-reference" href="_images/demobase.png"><img alt="_images/demobase.png" class="align-center" src="_images/demobase.png" style="width: 100%;" /></a>
</td>
<td><p>stabilizza</p>
<a class="reference internal image-reference" href="_images/stabile.png"><img alt="_images/stabile.png" class="align-center" src="_images/stabile.png" style="width: 100%;" /></a>
</td>
<td><p>penatamini</p>
<a class="reference internal image-reference" href="_images/pentamini.png"><img alt="_images/pentamini.png" class="align-center" src="_images/pentamini.png" style="width: 100%;" /></a>
</td>
<td><p>glider</p>
<a class="reference internal image-reference" href="_images/glider.png"><img alt="_images/glider.png" class="align-center" src="_images/glider.png" style="width: 100%;" /></a>
</td>
<td><p>pentaminoR</p>
<a class="reference internal image-reference" href="_images/pentaminoR.png"><img alt="_images/pentaminoR.png" class="align-center" src="_images/pentaminoR.png" style="width: 100%;" /></a>
</td>
</tr>
</tbody>
</table>
<p>I 12 <strong>pentamini</strong> esistenti si stabilizzano nei tre modi citati: Still Lifes, Oscillatori e Astronavi (Glider).</p>
<p>Il <strong>Pentamino-R</strong> è importante perché ha dimostrato che non era possibile prevedere a occhio nudo
se una forma sarebbe cresciuta all’infinito o meno. È il riflesso visivo del Problema della <em>Fermata di Turing</em>:
non si può sapere se un programma si fermerà (si stabilizzerà) senza farlo girare.
Viene definito un <em>Matusalemme</em>, perché esplode in un caos ribollente che dura per
ben <code class="docutils literal notranslate"><span class="pre">1103</span></code> generazioni prima di stabilizzarsi.</p>
</section>
<section id="il-gioco-produce-complessita">
<h2>Il gioco produce complessità<a class="headerlink" href="#il-gioco-produce-complessita" title="Permalink to this heading">¶</a></h2>
<p>Nonostante la semplità delle regole di base,
la previsione del comportamento a lungo termine del Gioco della Vita è un problema
che ha affascinato matematici e informatici per decenni e, nonostante numerosi studi,
non esiste ancora una soluzione definitiva e generale, per alcuni motivi:</p>
<ul class="simple">
<li><p><strong>Complessità esponenziale</strong>: Il numero di possibili configurazioni di una griglia di celle aumenta in modo
esponenziale con la dimensione della griglia stessa. Questo rende impraticabile un’analisi esaustiva
di tutte le possibili evoluzioni.</p></li>
<li><p><strong>Comportamento caotico</strong>: Piccole variazioni nella configurazione iniziale possono portare a risultati
completamente diversi nel lungo periodo, rendendo difficile stabilire delle leggi generali che governino
l’evoluzione del sistema.</p></li>
<li><p><strong>Emergenza</strong>: Dal semplice insieme di regole del gioco emergono comportamenti complessi e imprevedibili,
come la formazione di strutture stabili, oscillanti o in continua evoluzione.</p></li>
</ul>
<p>Anche con una griglia finita, prevedere il comportamento a lungo termine di una configurazione iniziale
rimane un <a class="reference internal" href="#sistemi-complessi"><span class="std std-ref">problema complesso</span></a>.
Il numero di possibili configurazioni, anche se finito, può essere enorme,
rendendo impraticabile un’analisi esaustiva.</p>
<p>Inoltre, a differenza di molti altri sistemi fisici, il Gioco della Vita <strong>non è sempre reversibile</strong>.
Ciò significa che, data una configurazione finale, non è sempre possibile risalire univocamente alla configurazione iniziale
che l’ha generata. Molte configurazioni finali possono avere più configurazioni iniziali che portano allo stesso risultato.</p>
<p>Dunque, determinare la configurazione iniziale che porta a una data configurazione finale nel
Gioco della Vita
è un <a class="reference internal" href="#sistemi-complessi"><span class="std std-ref">problema complesso</span></a> e, in generale, non esiste una soluzione
algoritmica efficiente.</p>
<p>Il gioco è un esempio di sviluppo e <strong>auto-organizzazione</strong>. È interessante per scienziati, matematici e economisti
osservare il modo in cui schemi complessi possono emergere dall’implementazione di regole assai semplici.</p>
<section id="il-gioco-e-turing-completo">
<h3>Il gioco è Turing-completo<a class="headerlink" href="#il-gioco-e-turing-completo" title="Permalink to this heading">¶</a></h3>
<p>È stato dimostrato che nel <em>Game of Life</em> si possono costruire circuiti logici (porte <code class="docutils literal notranslate"><span class="pre">AND,</span> <span class="pre">OR,</span> <span class="pre">NOT</span></code>)
ed è quindi <a class="reference internal" href="#computazionalmente-completo"><span class="std std-ref">Computazionalmente completo</span></a>.
Ciò significa che, con una griglia abbastanza grande e la giusta configurazione iniziale,
si pottrebbe costruire un computer capace di eseguire qualsiasi algoritmo che un PC attuale può eseguire.</p>
</section>
</section>
<section id="il-problema-della-vista-del-gioco">
<span id="id82"></span><h2>Il problema della vista del gioco<a class="headerlink" href="#il-problema-della-vista-del-gioco" title="Permalink to this heading">¶</a></h2>
<p>Se visualizziamo l’evoluzione dello stato delle celle con una sequenza di messaggi su una console,
come ad esempio:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cell</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">:</span><span class="n">false</span>
<span class="n">cell</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">false</span>
<span class="n">cell</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">:</span><span class="n">false</span>
<span class="o">...</span>
</pre></div>
</div>
<p>possiamo capire che <a class="reference internal" href="#lifecontroller"><span class="std std-ref">LifeController</span></a> sta girando, ma non avremo certo alcuna
immediata percezione delle configurazioni ‘interessanti’.</p>
<p>il “senso” delle configurazioni non risiede solo nei dati, ma anche nella struttura dello spazio
in cui questi dati vengono proiettati.
Se la proiezione non rispetta la geometria delle regole del gioco,
l’emergenza (la nascita delle forme) svanisce per l’osservatore.</p>
<p>Per fare in modo che lo spazio della rappresentazione
sia “sintonizzato” sulla metrica delle leggi del gioco
occorre una matrice 2D.</p>
<p>La matrice non è solo un modo “comodo” per vedere il gioco;
è la chiave di <strong>decrittazione</strong> che permette alla logica di Conway di manifestarsi come “forma”.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Il filosofo <strong>Daniel Dennet</strong> utilizza il Game of Life come metafora centrale nel suo saggio del <code class="docutils literal notranslate"><span class="pre">1991</span></code>,
<em>Real Patterns</em>, per illustrare come entità complesse possano essere considerate “reali”
senza dover essere riducibili a oggetti fisici fondamentali.</p>
<p>La descrizione dello stato delle celle come sequenza di stringhe è esaustiva ma priva di sintesi;
non permette di “vedere” il comportamento globale del sistema in modo efficiente.</p>
<p>Per Dennett, il <strong>glider</strong> che si muove su una rappresentazione a matrice
è un “pattern reale” perché riconoscerlo permette una <strong>compressione predittiva</strong>:
fornisce un vantaggio informativo enorme rispetto alla descrizione atomica delle celle.</p>
<p>I glider dunque “esistono”? La risposta di Dennet è che sono reali tanto quanto i nostri desideri
o le nostre credenze. Non sono entità fisiche separate, ma sono configurazioni oggettive
della materia che diventano visibili (e reali) solo quando adottiamo
un certo livello di astrazione necessario per navigare la complessità del mondo.</p>
<p>Dennet sostiene che noi identifichiamo modelli adottando diverse posizioni nei confronti di un sistema:</p>
<ul class="simple">
<li><p><strong>Posizione fisica</strong>: previsione basata su leggi fisiche e microdettagli.</p></li>
<li><p><strong>Posizione di progettazione</strong>: previsione basata sull’organizzazione funzionale
(ad esempio, “questa parte serve per il raffreddamento”).</p></li>
<li><p><strong>Posizione intenzionale</strong>: prevedere il comportamento attribuendo credenze, desideri e razionalità.</p></li>
</ul>
<p>Il collegamento tra i “Real Patterns” di Dennett e la <strong>Teoria algoritmica dell’informazione</strong>
è diventato un pilastro della filosofia della scienza contemporanea, con importanti sviluppi
nel 2025 e 2026 che formalizzano questa intuizione.</p>
<p>Per un approfondimento, si veda  la <a class="reference internal" href="#teoria-algoritmica-dell-informazione"><span class="std std-ref">Teoria Algoritmica dell’Informazione</span></a> come
l’apparato matematico che formalizza le idee di Dennet.</p>
</div>
</section>
<section id="il-gioco-come-caso-di-studio">
<h2>Il gioco come caso di studio<a class="headerlink" href="#il-gioco-come-caso-di-studio" title="Permalink to this heading">¶</a></h2>
<p>Nei capitoli seguenti faremo riferimento al gioco <em>Game of Life</em> (<strong>GofLife</strong>) come
caso di studio di sistemi software, dapprima concentrati e poi distribuiti.
Riportimo qui l’elenco delle varie versionei:</p>
<ol class="arabic simple">
<li><dl class="simple">
<dt><a class="reference internal" href="#progetto-conway26java"><span class="std std-ref">Costruiamo il Game of Life in Java</span></a>:</dt><dd><p>impostiamo il sistema come una collezione
di oggetti Java. L’obiettivo è anche mettere a punto gli strumenti
(Eclipse, Gradle, Docker, etc.) che usermo per la cstruzione del software</p>
</dd>
</dl>
</li>
<li><p><a class="reference internal" href="#una-gui-html-per-game-of-life"><span class="std std-ref">Una GUI HTML per Game of Life</span></a>: estendiamo il sistema Java iniziale
dotando il gioco di una GUI HTML in cui visualizzare l’evoluzione della griglia.</p></li>
<li><p><a class="reference internal" href="#game-of-life-con-protoattori"><span class="std std-ref">Game of Life con protoattori</span></a>: impostiamo il controllore del gioco come un
<a class="reference internal" href="#protoattori"><span class="std std-ref">Protoattore</span></a>, un nuovo tipo di componente software da noi introdotto.</p></li>
<li><p><span class="xref std std-ref">Game of Life con QActor</span>:</p></li>
</ol>
<section id="progetto-conway26java">
<span id="id83"></span><h3>Progetto conway26Java<a class="headerlink" href="#progetto-conway26java" title="Permalink to this heading">¶</a></h3>
<p><strong>Impostiamo il progetto in Eclipse</strong></p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_images/conway25JavaProjectEclipse.PNG"><img alt="_images/conway25JavaProjectEclipse.PNG" class="align-center" src="_images/conway25JavaProjectEclipse.PNG" style="width: 100%;" /></a>
</td>
<td><p>Inizializzazione</p>
<ul class="simple">
<li><p>nella directory <strong>conway26Java</strong> eseguire: <code class="docutils literal notranslate"><span class="pre">gradle</span> <span class="pre">init</span> <span class="pre">1</span> <span class="pre">2</span> <span class="pre">-</span> <span class="pre">-</span></code></p></li>
<li><p>aggiunta <em>Java nature</em></p></li>
<li><p>definito il <span class="xref std std-ref">build.gradle</span></p></li>
<li><p>aggiunta (se non esiste) come <cite>sourcefolder</cite>: <strong>src/main/java</strong>  e le altre directory
specificate in <span class="xref std std-ref">build.gradle</span></p></li>
<li><p>eseguito  <code class="docutils literal notranslate"><span class="pre">gradlew</span> <span class="pre">eclipse</span></code> per generare i file per Eclipse</p></li>
</ul>
<p>Parte applicativa</p>
<ul class="simple">
<li><p>aggiunto <code class="docutils literal notranslate"><span class="pre">package</span> <span class="pre">conway</span></code> con i file <code class="docutils literal notranslate"><span class="pre">java</span></code> dell’applicazione,
incluso <span class="xref std std-ref">Main di conway26Java</span></p></li>
<li><p>aggiunto <code class="docutils literal notranslate"><span class="pre">package</span> <span class="pre">conway.devices</span></code> con i file <code class="docutils literal notranslate"><span class="pre">java</span></code> dei dispositivi di I/O</p></li>
<li><p>aggiunto <code class="docutils literal notranslate"><span class="pre">folder</span> <span class="pre">userDocs</span></code> e al suo interno:</p>
<ul>
<li><p>il file di nome <code class="docutils literal notranslate"><span class="pre">conway25Java_v0.html</span></code> ricavato da <a class="reference external" href="_static/templateToFill.html">template</a>  che ha il ruolo di un <cite>diario di bordo</cite>
(con varie versioni)</p></li>
<li><p>la subdirectory <code class="docutils literal notranslate"><span class="pre">userDocs/css</span></code> per gli stili usati dal diario</p></li>
<li><p>la subdirectory <code class="docutils literal notranslate"><span class="pre">userDocs/img</span></code> per le immagini usate dal diario</p></li>
</ul>
</li>
</ul>
<p>Settaggio filtri per redere visibili <strong>resources</strong> e <strong>Gradle build folder</strong></p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/eclipseProjectFilers.png"><img alt="_images/eclipseProjectFilers.png" class="align-center" src="_images/eclipseProjectFilers.png" style="width: 40%;" /></a>
</div></blockquote>
</td>
</tr>
<tr class="row-even"><td><p>Esecuzione del prodotto</p></td>
<td><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gradlew</span> <span class="pre">run</span></code>  o da Eclipse</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</section>
<section id="build-gradle-e-main-di-conway26java">
<h3>build.gradle e Main di conway26Java<a class="headerlink" href="#build-gradle-e-main-di-conway26java" title="Permalink to this heading">¶</a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><cite>build.gradle</cite></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugins</span> <span class="p">{</span>
    <span class="nb">id</span> <span class="s1">&#39;java&#39;</span>
    <span class="nb">id</span> <span class="s1">&#39;eclipse&#39;</span>
<span class="p">}</span>
<span class="n">version</span> <span class="s1">&#39;1.0&#39;</span>
<span class="n">java</span> <span class="p">{</span>
  <span class="n">toolchain</span><span class="o">.</span><span class="n">languageVersion</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
        <span class="n">JavaLanguageVersion</span><span class="o">.</span><span class="n">of</span><span class="p">(</span><span class="mi">17</span><span class="p">))</span>
<span class="p">}</span>
<span class="n">repositories</span> <span class="p">{</span>
    <span class="n">mavenCentral</span><span class="p">()</span>
    <span class="n">flatDir</span> <span class="p">{</span>   <span class="n">dirs</span> <span class="s1">&#39;../unibolibs&#39;</span>    <span class="p">}</span>
<span class="p">}</span>
<span class="n">sourceSets</span> <span class="p">{</span>
      <span class="n">main</span> <span class="p">{</span>
          <span class="n">java</span> <span class="p">{</span>
              <span class="n">srcDirs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;src/main/java&#39;</span><span class="p">]</span>
          <span class="p">}</span>
          <span class="n">resources</span> <span class="p">{</span>
              <span class="n">srcDirs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;src/main/resources&#39;</span><span class="p">]</span>
          <span class="p">}</span>
      <span class="p">}</span>
      <span class="n">test</span> <span class="p">{</span>
          <span class="n">java</span> <span class="p">{</span>
              <span class="n">srcDirs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;src/test/java&#39;</span><span class="p">]</span>
          <span class="p">}</span>
          <span class="n">resources</span> <span class="p">{</span>
              <span class="n">srcDirs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;src/test/resources&#39;</span><span class="p">]</span>
          <span class="p">}</span>
      <span class="p">}</span>
<span class="p">}</span>
<span class="n">dependencies</span> <span class="p">{</span>
    <span class="n">testImplementation</span> <span class="s1">&#39;junit:junit:4.13.2&#39;</span>
<span class="p">}</span>

<span class="n">task</span> <span class="n">run</span><span class="p">(</span><span class="nb">type</span><span class="p">:</span> <span class="n">JavaExec</span><span class="p">){</span>
    <span class="n">classpath</span> <span class="o">=</span> <span class="n">sourceSets</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">runtimeClasspath</span>
    <span class="n">mainClass</span> <span class="o">=</span> <span class="s2">&quot;conway.MainConway&quot;</span>
<span class="p">}</span>

<span class="n">jar</span> <span class="p">{</span>
  <span class="n">println</span><span class="p">(</span><span class="s2">&quot;building jar&quot;</span><span class="p">)</span>
  <span class="kn">from</span> <span class="nn">sourceSets.main.allSource</span>
  <span class="n">manifest</span> <span class="p">{</span>
    <span class="n">attributes</span> <span class="s1">&#39;Main-Class&#39;</span><span class="p">:</span><span class="s1">&#39;src/main/java/conway.MainConway&#39;</span>
  <span class="p">}</span>
</pre></div>
</div>
<p>}</p>
</td>
<td><p>Si veda <span class="xref std std-ref">Creazione progetto con Gradle</span></p>
<p>In questa versione <cite>vi sono dipendenze</cite> solo relative alla libreria JUnit per il <span class="xref std std-ref">Testing</span></p>
<p><a href="#id190"><span class="problematic" id="id191">`MainConway.java`_</span></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">MainConway</span>  <span class="p">{</span>

    <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>

      <span class="o">//</span><span class="n">configureTheSystem</span>
        <span class="n">Life</span> <span class="n">life</span>           <span class="o">=</span>
                <span class="n">new</span> <span class="n">Life</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span><span class="mi">3</span> <span class="p">);</span>
        <span class="n">LifeController</span> <span class="n">cc</span>   <span class="o">=</span>
                <span class="n">new</span> <span class="n">LifeController</span><span class="p">(</span><span class="n">life</span><span class="p">);</span>
        <span class="n">ConwayInputMock</span> <span class="n">cim</span> <span class="o">=</span>
                <span class="n">new</span> <span class="n">ConwayInputMock</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="n">life</span><span class="p">);</span>

      <span class="o">//</span><span class="n">start</span> <span class="n">the</span> <span class="n">system</span>
        <span class="n">cim</span><span class="o">.</span><span class="n">simulateUserControl</span><span class="p">();</span>

    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
<section id="conway26java-testing">
<h3>conway26Java testing<a class="headerlink" href="#conway26java-testing" title="Permalink to this heading">¶</a></h3>
<p>Per il <span class="xref std std-ref">Testing</span>, eseguire:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gradlew</span> <span class="pre">test</span></code> e aprire il file <code class="docutils literal notranslate"><span class="pre">build\reports\tests\test\index.html</span></code> per vedere il risultato del test</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gradlew</span> <span class="pre">run</span></code> per vedere il risultato dell’esecuzione del programma</p></li>
</ul>
<ol class="arabic simple">
<li><p>Seguendo quanto detto in <span class="xref std std-ref">Il metodo di lavoro</span>, considerimao questo progetto come il primo Sprint
per la costruzione incrementale ed evolutiva di un prodotto software</p></li>
<li><p>Definiamo nel modo più preciso possibile i <strong>requisiti del sistema GofLife</strong>:</p>
<ul class="simple">
<li><p>il sistema deve consentire ad un singolo utente di inizializzare lo stato della griglia
e di attivare/fermare il gioco</p></li>
</ul>
</li>
</ol>
<section id="analsi-del-problema-goflife">
<h4>Analsi del problema GofLife<a class="headerlink" href="#analsi-del-problema-goflife" title="Permalink to this heading">¶</a></h4>
<p>Tratandosi di un gioco zero-player con controllo esterno, il sistema</p>
<ul class="simple">
<li><p>deve essere <strong>proattivo</strong>, in quanto deve realizzare il gioco come un comportamento autonomo</p></li>
<li><p>deve essere <strong>anche reattivo</strong>, in quanto deve percepire e gstire i comandi di configurazione
e di start/stop che l’utente inviarà  mediante un dispositivo di input</p></li>
<li><p>deve fornire una rappresentazione tenendo conto di quanto detto in
<a class="reference internal" href="#il-problema-della-vista-del-gioco"><span class="std std-ref">Il problema della vista del gioco</span></a></p></li>
</ul>
</section>
<section id="progetto-del-sistema-goflife">
<h4>Progetto del sistema GofLife<a class="headerlink" href="#progetto-del-sistema-goflife" title="Permalink to this heading">¶</a></h4>
<p>In accordo al principi di <a class="reference internal" href="#separazione-delle-responsabilita"><span class="std std-ref">Separazione delle Responsabilità</span></a> e <a class="reference internal" href="#single-responsibility"><span class="std std-ref">SRP-Single responsibility</span></a>
proponiamo una architettura software basata sui seguenti componenti software:</p>
<ol class="arabic simple">
<li><p>Modelliamo il dominio cone le classi Java <code class="docutils literal notranslate"><span class="pre">Cell,</span> <span class="pre">Grid,</span> <span class="pre">Life</span></code></p></li>
<li><p>Definiamo un componente attivo <code class="docutils literal notranslate"><span class="pre">LifeController</span></code> che ha la responsabilità di far evolvere il gioco</p></li>
<li><p>Definiamo <a class="reference internal" href="#la-interfaccia-ioutdev"><span class="std std-ref">La interfaccia IOutDev</span></a>  per la visualizzazione dello stato di una <code class="docutils literal notranslate"><span class="pre">Cell</span></code>
e/o di tutta la <code class="docutils literal notranslate"><span class="pre">Grid</span></code></p></li>
<li><p>Definiamo <a class="reference internal" href="#la-interfaccia-gamecontroller"><span class="std std-ref">La interfaccia GameController</span></a>  per la interazione dei dispostivi di input cone  <code class="docutils literal notranslate"><span class="pre">LifeController</span></code></p></li>
<li><p>Definiamo i componenti di output che implementano <code class="docutils literal notranslate"><span class="pre">IOutDev</span></code> e quelli di input che si relazionano con <code class="docutils literal notranslate"><span class="pre">LifeController</span></code>
mediante l’interfaccia <code class="docutils literal notranslate"><span class="pre">GameController</span></code>.</p></li>
</ol>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 55%" />
<col style="width: 45%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>.</p>
<a class="reference internal image-reference" href="_images/LifeGameJava+.jpg"><img alt="_images/LifeGameJava+.jpg" class="align-center" src="_images/LifeGameJava+.jpg" style="width: 100%;" /></a>
</td>
<td><ul class="simple">
<li><p><strong>Cell</strong>: elemento fondamentale del gioco</p></li>
<li><p><strong>Grid</strong>: aggregato di <code class="docutils literal notranslate"><span class="pre">Cell</span></code></p></li>
<li><p><strong>Life</strong>: regole del gioco</p></li>
<li><p><strong>IOutDev</strong>: contratto per la visualizzazione dello stato di una <code class="docutils literal notranslate"><span class="pre">Cell</span></code></p></li>
<li><p><strong>LifeController</strong>: controllo del gioco e visualizzazione della <code class="docutils literal notranslate"><span class="pre">Grid</span></code></p></li>
<li><p><strong>Gamecontroller</strong>: contratto che <code class="docutils literal notranslate"><span class="pre">LifeController</span></code> impone ai dispositivi in input</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="lifecontroller">
<span id="id84"></span><h3>LifeController<a class="headerlink" href="#lifecontroller" title="Permalink to this heading">¶</a></h3>
<p>Osserviamo che <code class="docutils literal notranslate"><span class="pre">LifeController</span></code> è un componente</p>
<ul class="simple">
<li><p><strong>proattivo</strong>, in quanto fa evolvere il “zero-player game”</p></li>
<li><p><strong>reattivo</strong>, in quanto dovrebbe essere capace di:</p>
<ul>
<li><p>percepire comandi per definire la configurazione iniziale della  <code class="docutils literal notranslate"><span class="pre">Grid</span></code></p></li>
<li><p>percepire comandi di <code class="docutils literal notranslate"><span class="pre">start/stop/clear</span></code> del gioco  emssi da un utente (umano) mediante un dispositivo di input.
A questo fine, <code class="docutils literal notranslate"><span class="pre">LifeController</span></code> implementa  <a class="reference internal" href="#la-interfaccia-gamecontroller"><span class="std std-ref">La interfaccia GameController</span></a></p></li>
</ul>
</li>
</ul>
<p>Osserviamo anche che i dispostivi di output e di input possono essere di tipi diversi. In particolare,
esamineremo le seguenti possibilità:</p>
<ol class="arabic simple">
<li><p>Dispositivo di output basato su console (<code class="docutils literal notranslate"><span class="pre">System.out</span></code>); lasciato come esercizio al lettore</p></li>
<li><p>Dispositivo di output (e input) basato su GUI swing: si veda <a class="reference internal" href="#una-gui-con-swing"><span class="std std-ref">Una GUI con Swing</span></a></p></li>
<li><p>Dispositivo di output (e input) basato su GUI HTML/JS:</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>con rapprresentazione granulare della <code class="docutils literal notranslate"><span class="pre">Grid</span></code>; si veda <a class="reference internal" href="#una-griglia-granulare"><span class="std std-ref">Una griglia granulare</span></a></p></li>
<li><p>con rappresentazione sintetica della <code class="docutils literal notranslate"><span class="pre">Grid`</span></code> mediante canvas; si veda <a class="reference internal" href="#una-griglia-globale"><span class="std std-ref">Una griglia globale</span></a></p></li>
</ul>
</div></blockquote>
<p>Il punto importante consiste nel fare in modo che <code class="docutils literal notranslate"><span class="pre">LifeController</span></code>
<strong>non dipenda</strong> da una specifica implementazione di <code class="docutils literal notranslate"><span class="pre">IOutDev</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LifeController</span> <span class="kd">implements</span> <span class="n">GameController</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="nf">LifeController</span><span class="p">(</span> <span class="n">Life</span> <span class="n">game</span><span class="p">,</span> <span class="n">IOutDev</span> <span class="n">outdev</span> <span class="p">){</span>
  <span class="p">...</span>
  <span class="p">}</span>

  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">play</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">new</span> <span class="n">Thread</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">//Evoluzione del gioco in epoche successive</span>
        <span class="k">while</span><span class="p">(</span> <span class="n">running</span> <span class="p">)</span> <span class="p">{</span>
          <span class="p">...</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}.</span><span class="na">start</span><span class="p">();</span>
   <span class="p">}</span><span class="c1">//play</span>
</pre></div>
</div>
<section id="il-processo-di-evoluzione-del-gioco">
<span id="evoluzione-di-goflife"></span><h4>Il processo di evoluzione del gioco<a class="headerlink" href="#il-processo-di-evoluzione-del-gioco" title="Permalink to this heading">¶</a></h4>
<p>Il task <strong>play</strong> fa evolvere il gioco dalla configurazione iniziale in epoche successive.
Nella nostra implementazione attuale, il task rimane <strong>running</strong>  fino a quando:</p>
<ul class="simple">
<li><p>la configurazione corrente diventa stabile</p></li>
<li><p>non ci sono più celle vive</p></li>
<li><p>l’utente invia un comando <code class="docutils literal notranslate"><span class="pre">stop</span></code> per fermare l’evoluzione del sistema</p></li>
</ul>
<p>Tuttavia si potrebbe pensare di non fermare <em>play</em> nei primi due casi, in quanto:</p>
<ul class="simple">
<li><p>l’utente che controlla il gioco potrebbe introdurre nuove celle ‘vive’ tra una epoca e l’altra</p></li>
<li><p>il task <em>play</em> stesso potrebbe generare nuove celle ‘vive’ in modo casuale,
simulando un meccanisimo che nella teoria dei campi della fisica moderna
è collegato all’idea di ‘vuoto fisico’ della toria dei campi come entità dinamica,
che, come asserito dai mistici orientali,
è la ‘realtà prima’ che dà origine a tutte le forme del mondo fenomenico.</p></li>
</ul>
</section>
</section>
<section id="la-interfaccia-ioutdev">
<span id="id85"></span><h3>La interfaccia IOutDev<a class="headerlink" href="#la-interfaccia-ioutdev" title="Permalink to this heading">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">main.java.conway.domain</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IOutDev</span> <span class="p">{</span>
  <span class="kt">void</span> <span class="nf">display</span><span class="p">(</span><span class="n">String</span> <span class="n">msg</span><span class="p">);</span>      <span class="c1">//For HMI</span>
  <span class="kt">void</span> <span class="nf">displayCell</span><span class="p">(</span><span class="n">Cell</span> <span class="n">cell</span><span class="p">,</span> <span class="n">Grid</span> <span class="n">grid</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">displayGrid</span><span class="p">(</span><span class="n">Grid</span> <span class="n">grid</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">close</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Il metodo <code class="docutils literal notranslate"><span class="pre">display(String</span> <span class="pre">msg)</span></code> consente di visualizzare messaggi di testo (per una migliore <strong>HMI</strong>
<em>HumanMachineInterface</em>)</p></li>
<li><p>Il metodo <code class="docutils literal notranslate"><span class="pre">displayCell(Cell</span> <span class="pre">cell,</span> <span class="pre">Grid</span> <span class="pre">grid)</span></code> consente di visualizzare lo stato di una singola cella
(all’interno della griglia)</p></li>
<li><p>Il metodo <code class="docutils literal notranslate"><span class="pre">displayGrid(Grid</span> <span class="pre">grid)</span></code> consente di visualizzare lo stato di tutta la griglia</p></li>
</ul>
</section>
<section id="la-interfaccia-gamecontroller">
<span id="id86"></span><h3>La interfaccia GameController<a class="headerlink" href="#la-interfaccia-gamecontroller" title="Permalink to this heading">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">main.java.conway.domain</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">GameController</span> <span class="p">{</span>
    <span class="kt">void</span> <span class="nf">onStart</span><span class="p">();</span>
    <span class="kt">void</span> <span class="nf">onStop</span><span class="p">();</span>
    <span class="kt">void</span> <span class="nf">onClear</span><span class="p">();</span>
    <span class="kt">void</span> <span class="nf">switchCellState</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">);</span>
    <span class="kt">void</span> <span class="nf">setOutDev</span><span class="p">(</span><span class="n">IOutDev</span> <span class="n">outdev</span><span class="p">);</span> <span class="c1">//injection</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>I metodi <code class="docutils literal notranslate"><span class="pre">onStart</span></code>, <code class="docutils literal notranslate"><span class="pre">onStop</span></code> e <code class="docutils literal notranslate"><span class="pre">onClear</span></code> consentono di avviare, fermare e azzerare il gioco.</p></li>
<li><p>Il metodo <code class="docutils literal notranslate"><span class="pre">switchCellState</span></code> consente di commutare lo stato di una cella (viva/morta). Usato in particolare nella
fase di inizializzazione.</p></li>
<li><p>Il metodo <code class="docutils literal notranslate"><span class="pre">setOutDev</span></code> consente di ‘iniettare’ una specifica implementazione di <code class="docutils literal notranslate"><span class="pre">IOutDev</span></code> nel <code class="docutils literal notranslate"><span class="pre">LifeController</span></code>.</p></li>
</ul>
<p>I diversi approcci per la realizzazione di dispostivi di output e input vengono sperimentati con il programma
<strong>MainConwayLifeJava.java</strong> nel package <code class="docutils literal notranslate"><span class="pre">main.java.conway.domain</span></code> attraverso diverse procedure di configurazione
del sistema:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#configurazione-di-goflife-con-swing"><span class="std std-ref">Configurazione di GofLife con Swing</span></a></p></li>
<li><p><a class="reference internal" href="#configurazione-di-goflife-con-html"><span class="std std-ref">Configurazione di GofLife con HTML</span></a></p></li>
</ul>
</section>
<section id="una-gui-con-swing">
<span id="id87"></span><h3>Una GUI con Swing<a class="headerlink" href="#una-gui-con-swing" title="Permalink to this heading">¶</a></h3>
<p>Un primo modo per superare il limite dell’uso della console come dispositivo di output,
è introdurre una visualizzazione di tipo grafico,
realizzando una GUI in Java con Swing.
Un dispostivo di questo tipo è definito nella classe <code class="docutils literal notranslate"><span class="pre">main/java/conway/io/ConwayLifeGridClaude.java</span></code>
il cui codice è stato proposto da <strong>Claude AI</strong>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Il prompt dato a Claude (<strong>requisiti</strong>): Vorrei una classe Java che realizza la rappresentazione grafica di
una griglia quadrata di <code class="docutils literal notranslate"><span class="pre">20x20</span></code> celle usando Swiing.
La griglia è relativa al gioco ConwayLife e quindi le celle possono assumere solo due colori (white - cella morta e red - cella viva).
La classe deve fornire metodi invocabili dall’esterno per visualizzare tutta la griglia e per commutare il colore di una cella
(da white a red e viceversa). Nella rappresentazione grafica devono comparire anche due pulsanti START e STOP,
facendo click sui quali la classe invia un comando a un componente esterno (un controllore del gioco)</p>
</div>
<section id="configurazione-di-goflife-con-swing">
<span id="id88"></span><h4>Configurazione di GofLife con Swing<a class="headerlink" href="#configurazione-di-goflife-con-swing" title="Permalink to this heading">¶</a></h4>
<p>Rispetto al codice proposto da Claude, abbiamo aggiunto i metodi per implementare l’interfaccia <code class="docutils literal notranslate"><span class="pre">IOutDev</span></code>
e la ‘iniezione’ alla costruzione  dell’istanza di <code class="docutils literal notranslate"><span class="pre">LifeController</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureTheSystemWithSwing</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Life</span> <span class="n">life</span>            <span class="o">=</span> <span class="k">new</span> <span class="n">Life</span><span class="p">(</span> <span class="mi">20</span><span class="p">,</span><span class="mi">20</span> <span class="p">);</span>
  <span class="n">IOutDev</span> <span class="n">swinggui</span>     <span class="o">=</span> <span class="k">new</span> <span class="n">ConwayLifeGridClaude</span><span class="p">(</span> <span class="p">);</span>   <span class="c1">//dispositivo di output (e anche di input)</span>
  <span class="n">GameController</span>  <span class="n">cc</span>   <span class="o">=</span> <span class="k">new</span> <span class="n">LifeController</span><span class="p">(</span><span class="n">life</span><span class="p">,</span> <span class="n">swinggui</span><span class="p">)</span> <span class="p">;</span>   <span class="c1">//un GameController che deve usare un IOutDev</span>
  <span class="p">((</span><span class="n">ConwayLifeGridClaude</span><span class="p">)</span> <span class="n">swinggui</span><span class="p">).</span><span class="na">setController</span><span class="p">(</span><span class="n">cc</span><span class="p">);</span>          <span class="c1">//iniezione del controller nella GUI</span>
  <span class="c1">//Il sistema termina quando si chiude la swinggui</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Problemi di deplyment</strong></p>
<p>Questa implementazione funziona bene in locale, ma non è adatta a essere eseguito in un container Docker.</p>
<p>Infatti, Java Swing tenta di disegnare la GUI, interroga il sistema operativo per trovare un Display Server
(come <em>X11</em> su Linux o <em>Window Manager</em> su Windows).
Non trovandolo, Java solleverà l’eccezione <strong>java.awt.HeadlessException</strong>.</p>
<p>Mettere una GUI Swing in Docker va contro la filosofia “Cloud Native”, se non altro
perchè l’immagine Docker diventa enorme, dovendo includere tutte le librerie grafiche.</p>
<p>Meglio quindi realizzare la GUI come una pagina Web (HTML/JS).</p>
</section>
</section>
</section>
</section>
<section id="da-una-funzione-a-un-servizio">
<h1>Da una funzione a un servizio<a class="headerlink" href="#da-una-funzione-a-un-servizio" title="Permalink to this heading">¶</a></h1>
<p>Vogliamo realizzare un semplicissimo servizio in Java che calcola i valori di una data espressione matematica:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 40%" />
<col style="width: 60%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\sin(x) + \cos(\sqrt{3}*x)\)</span></p></td>
<td><p>.</p>
<a class="reference internal image-reference" href="_images/eval.jpg"><img alt="_images/eval.jpg" class="align-center" src="_images/eval.jpg" style="width: 100%;" /></a>
</td>
</tr>
</tbody>
</table>
<p>Per raggiungere l’obiettivo useremo  il <a class="reference internal" href="#javalin-server"><span class="std std-ref">javalin server</span></a>
che abilita la ricezione di mesaggi via WebSocket, ma anche via HTTP/1 e HTTP2</p>
<section id="framework-javalin-ali-e-catene">
<h2>framework javalin: ali e catene<a class="headerlink" href="#framework-javalin-ali-e-catene" title="Permalink to this heading">¶</a></h2>
<p>In modo analogo a <a class="reference internal" href="#il-motto-di-alan-kay"><span class="std std-ref">Il motto di Alan Kay</span></a>
per i linguaggi di programmazione, possiamo dire che i framework sono, in generale, <strong>sia ali sia catene</strong>.</p>
<p>Infatti, un framework propone un proprio modello organizzativo di sistema.
Gli esempi documentali tendono a favorire la brevità a scapito della manutenibilità
e, senza opportune avvertenze progettuali, la struttura del codice
del sistema, ricalcando la struttura degli esempi, potrebbe creare confusione e accoppiamenti pericolosi.</p>
<p>In particolare, <strong>javalin</strong> è un framework <strong>non-opinionated</strong> (si veda <a class="reference external" href="https://dev.to/muhammadmedhat/opinionated-vs-non-opinionated-frameworks-understanding-the-difference-2379">Opinionated vs. Non-Opinionated Frameworks</a>)
che pottrerbbe indurre a scrivere tutta la logica dentro i gestori dei messaggi,
creando un ammasso disordinato di codice. Vediamo un esempio.</p>
<section id="imitiamo-gli-esempi-documentali">
<h3>Imitiamo gli esempi documentali<a class="headerlink" href="#imitiamo-gli-esempi-documentali" title="Permalink to this heading">¶</a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">main</span><span class="o">.</span><span class="n">java</span><span class="o">.</span><span class="n">javalin</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">io.javalin.Javalin</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">unibo.basicomm23.utils.CommUtils</span><span class="p">;</span>
<span class="n">public</span> <span class="k">class</span> <span class="nc">SistemaSJavalin</span> <span class="p">{</span>
<span class="n">public</span> <span class="n">void</span> <span class="n">doJob</span><span class="p">()</span> <span class="p">{</span>  <span class="o">....</span>  <span class="p">}</span>
<span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">new</span> <span class="n">SistemaSJavalin</span><span class="p">()</span><span class="o">.</span><span class="n">doJob</span><span class="p">();</span>
<span class="p">}</span>
<span class="p">}</span><span class="o">//</span><span class="n">SistemaSJavalin</span>
</pre></div>
</div>
</td>
<td><p>Il metodo <em>doJob()</em> deve:</p>
<ol class="arabic simple">
<li><p>acquisire da un client il valore dell’argonento <code class="docutils literal notranslate"><span class="pre">x</span></code> via rete</p></li>
<li><p>calcolare <span class="math notranslate nohighlight">\(\sin(x) + \cos(\sqrt{3}*x)\)</span></p></li>
<li><p>inviare al client il risultato</p></li>
</ol>
</td>
</tr>
</tbody>
</table>
<p>Il codice di <strong>doJob</strong>,  impostato secondo lo ‘stile’ della documentazione di javalin si presenta come segue:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span><span class="mi">1</span><span class="o">*/</span> <span class="o">...</span>
<span class="n">public</span> <span class="n">void</span> <span class="n">doJob</span><span class="p">()</span> <span class="p">{</span>
<span class="o">/*</span><span class="mi">2</span><span class="o">*/</span>  <span class="n">Javalin</span> <span class="n">app</span> <span class="o">=</span>
          <span class="n">Javalin</span><span class="o">.</span><span class="n">create</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span>
<span class="o">//</span><span class="n">PARTE</span> <span class="n">WS</span> <span class="o">------------------------------------</span>
<span class="o">/*</span><span class="mi">3</span><span class="o">*/</span> <span class="n">app</span><span class="o">.</span><span class="n">ws</span><span class="p">(</span><span class="s2">&quot;/eval&quot;</span><span class="p">,</span>
<span class="o">/*</span><span class="mi">4</span><span class="o">*/</span>  <span class="n">ws</span> <span class="o">-&gt;</span> <span class="p">{</span>
<span class="o">/*</span><span class="mi">5</span><span class="o">*/</span>   <span class="n">ws</span><span class="o">.</span><span class="n">onConnect</span><span class="p">(</span>
            <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;welcome&quot;</span><span class="p">);</span> <span class="p">});</span>
<span class="o">/*</span><span class="mi">6</span><span class="o">*/</span>   <span class="n">ws</span><span class="o">.</span><span class="n">onMessage</span><span class="p">(</span><span class="n">ctx</span> <span class="o">-&gt;</span> <span class="p">{</span>
        <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">message</span><span class="p">();</span>
        <span class="k">try</span> <span class="p">{</span>
<span class="o">/*</span><span class="mi">7</span><span class="o">*/</span>     <span class="n">double</span> <span class="n">x</span> <span class="o">=</span> <span class="n">Double</span><span class="o">.</span><span class="n">parseDouble</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
<span class="o">/*</span><span class="mi">8</span><span class="o">*/</span>     <span class="n">double</span> <span class="n">r</span> <span class="o">=</span>
            <span class="n">Math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">Math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">);</span>
<span class="o">/*</span><span class="mi">9</span><span class="o">*/</span>     <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span> <span class="n">result</span> <span class="p">);</span>
        <span class="p">}</span><span class="n">catch</span> <span class="p">(</span><span class="n">NumberFormatException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
<span class="o">/*</span><span class="mi">9</span><span class="o">*/</span>       <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;Errore: num non valido&quot;</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span>
<span class="o">/*</span><span class="mi">10</span><span class="o">*/</span><span class="n">ws</span><span class="o">.</span><span class="n">onClose</span><span class="p">(</span>
         <span class="n">ctx</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;sbye&quot;</span><span class="p">);}</span>
      <span class="p">);</span>
     <span class="p">});</span><span class="o">//</span><span class="n">ws</span>
  <span class="o">...</span>
<span class="p">}</span><span class="o">////</span><span class="n">doJob</span>
<span class="o">...</span>
</pre></div>
</div>
</td>
<td><ol class="arabic simple">
<li><p>codice precedente</p></li>
<li><p>crea il framework, che fa partire il <a class="reference internal" href="#server-jetty">Server Jetty</a> con una configurazione di default</p></li>
<li><p>chiama il metodo di Javalin per registrare un endpoint WebSocket specificando come path <code class="docutils literal notranslate"><span class="pre">/eval</span></code>
e come secondo argomento una <strong>lambda expression</strong> <code class="docutils literal notranslate"><span class="pre">ws</span> <span class="pre">-&gt;</span> <span class="pre">{...}</span></code></p></li>
<li><p>il parametro <strong>ws</strong> è un oggetto di tipo <code class="docutils literal notranslate"><span class="pre">io.javalin.websocket.WsConfig</span></code>.
L’oggetto <strong>ctx</strong> è di tipo <a class="reference external" href="https://javalin.io/documentation#wscontext:~:text=Copy-,WsMessageContext,-message()&amp;text=Copy-,WsMessageContext,-message()">WsMessageContext</a></p></li>
<li><p>specifica il comportamento alla connessione</p></li>
<li><p>specifica il comportamento alla ricezione di un messaggio di tipo String su WS
(ad es. <code class="docutils literal notranslate"><span class="pre">&quot;-4.0&quot;</span></code>)</p></li>
<li><p>estrae dal messggio il valore di input</p></li>
<li><p>calcola l’espressione ‘core’</p></li>
<li><p>invia la risposta al client su WS</p></li>
<li><p>gestisce la chiusura della connessione da parte del client</p></li>
</ol>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Il messaggio “welcome” su WS al punto 5 potrebbe non arrivare al client.</p>
<p>L’evento <strong>onConnect</strong> in Javalin scatta non appena il server decide che la connessione è valida,
ma non garantisce che il client abbia già “finito di inizializzare”
i suoi software. È l’essenza dei sistemi asincroni: essere connessi non significa essere pronti a ricevere.</p>
</div>
</section>
<section id="come-opera-javalin">
<span id="id89"></span><h3>Come opera javalin<a class="headerlink" href="#come-opera-javalin" title="Permalink to this heading">¶</a></h3>
<p>Javalin gira sopra Jetty (un server web estremamente performante).
Ogni volta che arriva un messaggio, Jetty assegna il compito di eseguire il codice dentro <strong>onMessage</strong> a un thread preso dal suo <em>Thread Pool</em>.</p>
<p>In particolare:</p>
<ul class="simple">
<li><p>Quando si esegue <code class="docutils literal notranslate"><span class="pre">Javalin.create().start(8080)</span></code>, viene inizializzato un pool di thread (solitamente chiamato <em>QueuedThreadPool</em>).</p></li>
<li><p>Se arrivano due messaggi quasi simultaneamente da due client diversi (o anche dallo stesso client),
Jetty preleva due thread distinti (<strong>TX</strong>) dal pool.</p>
<ul>
<li><p>Il primo thread TX esegue la logica di onMessage per il Messaggio A.</p></li>
<li><p>Il secondo thread TX esegue la logica di onMessage per il Messaggio B.</p></li>
</ul>
</li>
</ul>
<p>Questi due processi avvengono contemporaneamente (in parallelo) sui core della CPU.
Questa esecuzione parallela è ottima per le prestazioni, ma introduce molti problemi se il server non è <strong>stateless</strong>:</p>
<ul class="simple">
<li><p>Corse critiche (ad es. incremento di un contatore errato)</p></li>
<li><p>In Java, ogni core della CPU ha la sua cache. Se il Thread TX-1 aggiorna una variabile nella sua cache,
il Thread TX-2 (che gira su un altro core) potrebbe continuare a vedere il valore vecchio per diversi cicli di clock.
Questo costringe a usare <strong>volatile</strong> o <strong>synchronized</strong>, appesantendo il codice.</p></li>
<li><p>Inversione dell’Ordine. Le WebSocket garantiscono che i messaggi arrivino al server nell’ordine corretto,
ma Javalin non garantisce che i thread TX finiscano nell’ordine corretto. Ad esempio,
se un Client invia un messaggio “Accendi” e poi il messaggio “Spegni”, il thread TX che gestosce “Spegni”
potrebbe termninare per primo e il sistema rimane acceso.</p></li>
</ul>
<p>Per questo motivo un server scritto in Node.js esegue il codice JavaScript su un <em>unico thread</em> (chiamato <strong>Event Loop</strong>)  .</p>
<p>Notiamo che in un sistema distribuito due server potrebbero interagire con un altro servizio, ad esempio uno stesso database.
In questo caso, i problemi di concorrenza si ripresentano a livello di rete.</p>
</section>
<section id="tempo-di-vita-di-una-connessione-ws-in-jetty">
<span id="id90"></span><h3>Tempo di vita di una connessione WS in Jetty<a class="headerlink" href="#tempo-di-vita-di-una-connessione-ws-in-jetty" title="Permalink to this heading">¶</a></h3>
<p>Jetty chiude automaticamente le connessioni WebSocket se non rileva traffico dopo un certo intervallo di tempo.</p>
<p>Per prolungare la vita di una connessione WebSocket in Javalin (che si appoggia a Jetty),
si può agire su un parametro del server chiamato <em>Idle Timeout</em>.</p>
<p>Tuttavia,  anche se si imposta un timeout molto lungo sul server, i router o i proxy lungo il percorso
potrebbero comunque chiudere la connessione se non vedono passare dati.</p>
<p>In taluni casi è quindi opportuno inviare periodicamente dei messaggi (PING) di “heartbeat” (battito cardiaco)</p>
<p>Un esempio è fornito più avanti, nella sezione <span class="xref std std-ref">Teniamo in vita la connessione WS</span>.</p>
</section>
<section id="l-oggetto-ctx-di-javalin">
<h3>L’oggetto ctx di javalin<a class="headerlink" href="#l-oggetto-ctx-di-javalin" title="Permalink to this heading">¶</a></h3>
<p><strong>ctx</strong> che compare all’interno di onMessage è un’istanza della classe <em>io.javalin.websocket.WsMessageContex</em>.</p>
<p>Il <a class="reference external" href="https://javalin.io/documentation#wscontext:~:text=Copy-,WsMessageContext,-message()&amp;text=Copy-,WsMessageContext,-message()">WsMessageContext</a> agisce come un wrapper. Javalin lo crea nell’istante in cui il messaggio arriva
e lo “distrugge” (lo rende disponibile per il Garbage Collector) non appena la lambda finisce di girare.</p>
<p>Tuttavia, all’interno di questo wrapper c’è un riferimento alla Sessione WebSocket reale,
che invece è persistente e rimane la stessa finché il client non chiude il browser o cade la connessione.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Il <a class="reference external" href="https://javalin.io/documentation#wscontext:~:text=Copy-,WsMessageContext,-message()&amp;text=Copy-,WsMessageContext,-message()">WsMessageContext</a>  mette a disposizione strumenti ottimizzati per la lettura del messaggio:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 35%" />
<col style="width: 65%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>ctx.message()</p></td>
<td><p>Restituisce il messaggio ricevuto come semplice String.</p></td>
</tr>
<tr class="row-even"><td><p>ctx.messageAsClass(Class&lt;T&gt;)</p></td>
<td><p>Converte il messaggio direttamente in un <a class="reference external" href="https://www.baeldung.com/java-16-new-features#records-jep-395">Java record</a> o POJO.</p></td>
</tr>
<tr class="row-odd"><td><p>ctx.send(Object)</p></td>
<td><p>Invia una risposta al client (un oggetto, che Javalin  trasforma in JSON).</p></td>
</tr>
<tr class="row-even"><td><p>ctx.session()</p></td>
<td><p>Dà accesso all’oggetto Session di Jetty (per operazioni di basso livello)</p></td>
</tr>
<tr class="row-odd"><td><p>ctx.queryString()</p></td>
<td><p>pPrmette di leggere i parametri dell’URL usati al momento della connessione.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="javalin-gestisce-anche-http">
<h3>javalin gestisce anche HTTP<a class="headerlink" href="#javalin-gestisce-anche-http" title="Permalink to this heading">¶</a></h3>
<p>Negli esempi, a questo codice si affianca spesso una parte che gestisce <code class="docutils literal notranslate"><span class="pre">HTTP</span></code>, che di solito richiede l’uso di <strong>JSON</strong>:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">public</span> <span class="n">void</span> <span class="n">doJob</span><span class="p">()</span> <span class="p">{</span>
<span class="o">/*</span><span class="mi">1</span><span class="o">*/</span><span class="n">var</span> <span class="n">app</span><span class="o">=</span><span class="n">Javalin</span><span class="o">.</span><span class="n">create</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span>

<span class="o">//</span><span class="n">PARTE</span> <span class="n">WS</span> <span class="o">---------------------------</span>
  <span class="o">....</span>
<span class="o">//</span><span class="n">PARTE</span> <span class="n">HTTP</span> <span class="o">-------------------------</span>
   <span class="o">...</span>
<span class="p">}</span><span class="o">//</span><span class="n">doJob</span>
</pre></div>
</div>
</td>
<td><ol class="arabic simple">
<li><p>parte precedente, che crea il framework.</p></li>
</ol>
<blockquote>
<div><p>La frase <strong>var app</strong> sfrutta
la funzionalità chiamata <strong>LVDT</strong> (<em>Local Variable Type Inference</em>)
introdotta da <code class="docutils literal notranslate"><span class="pre">Java10</span></code>, disponibile solo per le <strong>variabili locali con inizializzatore</strong>.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 55%" />
<col style="width: 45%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span><span class="mi">1</span><span class="o">*/</span> <span class="o">....</span>
<span class="o">//</span><span class="n">PARTE</span> <span class="n">HTTP</span> <span class="o">-------------------------------</span>
<span class="o">/*</span><span class="mi">2</span><span class="o">*/</span><span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span>
        <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">ctx</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="s2">&quot;Hello HTTP/1.1&quot;</span><span class="p">));</span>
<span class="o">/*</span><span class="mi">3</span><span class="o">*/</span><span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/eval&quot;</span><span class="p">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="p">{</span>
      <span class="n">double</span> <span class="n">x</span> <span class="o">=</span> <span class="n">Double</span><span class="o">.</span><span class="n">parseDouble</span><span class="p">(</span>
              <span class="n">ctx</span><span class="o">.</span><span class="n">queryParam</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">));</span>
<span class="o">/*</span><span class="mi">4</span><span class="o">*/</span> <span class="n">double</span> <span class="n">r</span> <span class="o">=</span>
        <span class="n">Math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">Math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">);</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">Map</span><span class="o">.</span><span class="n">of</span><span class="p">(</span>
        <span class="s2">&quot;fullUrl&quot;</span><span class="p">,</span> <span class="n">ctx</span><span class="o">.</span><span class="n">fullUrl</span><span class="p">(),</span>
        <span class="s2">&quot;result&quot;</span><span class="p">,</span> <span class="n">r</span><span class="p">));</span>
        <span class="p">});</span>

<span class="o">/*</span><span class="mi">5</span><span class="o">*/</span><span class="n">app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/evaluate&quot;</span><span class="p">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="o">//</span><span class="n">CORS</span>
      <span class="n">org</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">simple</span><span class="o">.</span><span class="n">JSONObject</span> <span class="n">m</span> <span class="o">=</span>
<span class="o">/*</span><span class="mi">6</span><span class="o">*/</span> <span class="n">CommUtils</span><span class="o">.</span><span class="n">parseForJson</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">body</span><span class="p">());</span>
<span class="o">/*</span><span class="mi">7</span><span class="o">*/</span> <span class="n">String</span> <span class="n">xs</span><span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">+</span><span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">);</span>
      <span class="k">try</span> <span class="p">{</span>
<span class="o">/*</span><span class="mi">8</span><span class="o">*/</span>   <span class="n">double</span> <span class="n">x</span> <span class="o">=</span> <span class="n">Double</span><span class="o">.</span><span class="n">parseDouble</span><span class="p">(</span><span class="n">xs</span><span class="p">);</span>
<span class="o">/*</span><span class="mi">9</span><span class="o">*/</span>   <span class="n">double</span> <span class="n">r</span> <span class="o">=</span>
          <span class="n">Math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">Math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">);</span>
         <span class="o">//</span> <span class="n">Invia</span> <span class="n">risposta</span> <span class="ow">in</span> <span class="n">JSON</span>
<span class="o">/*</span><span class="mi">10</span><span class="o">*/</span>  <span class="n">ctx</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">Map</span><span class="o">.</span><span class="n">of</span><span class="p">(</span>
          <span class="s2">&quot;fullUrl&quot;</span><span class="p">,</span> <span class="n">ctx</span><span class="o">.</span><span class="n">fullUrl</span><span class="p">(),</span>
           <span class="n">body</span><span class="s2">&quot;, ctx.body(), &quot;</span><span class="n">result</span><span class="s2">&quot;, r));</span>
      <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">NumberFormatException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
<span class="o">/*</span><span class="mi">10</span><span class="o">*/</span>   <span class="n">ctx</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">Map</span><span class="o">.</span><span class="n">of</span><span class="p">(</span>
          <span class="s2">&quot;fullUrl&quot;</span><span class="p">,</span> <span class="n">ctx</span><span class="o">.</span><span class="n">fullUrl</span><span class="p">(),</span>
          <span class="s2">&quot;body&quot;</span><span class="p">,</span> <span class="n">ctx</span><span class="o">.</span><span class="n">body</span><span class="p">(),</span>
          <span class="s2">&quot;result&quot;</span><span class="p">,</span> <span class="s2">&quot;Errore:num non valido&quot;</span><span class="p">));</span>
      <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span><span class="o">//</span><span class="n">doJob</span>
</pre></div>
</div>
</td>
<td><ol class="arabic">
<li><p>parte precedente</p></li>
<li><p>comportamento GET alla connessione <code class="docutils literal notranslate"><span class="pre">localhost:/8080</span></code>.
L’oggetto <strong>ctx</strong> è di tipo <a class="reference external" href="https://javalin.io/documentation#context">io.javalin.http.Context</a></p>
<p>—</p>
</li>
<li><p>comportamento GET quando l’URL di una connessione specifica un parametro
(ad esempio:</p>
<p><code class="docutils literal notranslate"><span class="pre">http://localhost:8080/eval?x=-4</span></code>)</p>
</li>
<li><p>calcola l’espressione ‘core’</p>
<p>—</p>
</li>
<li><p>comportamento POST quando i dati (parametro <code class="docutils literal notranslate"><span class="pre">x</span></code>)  viaggiano nel
corpo (body) della richiesta, in formato JSON</p></li>
<li><p>estrazione del body in JSON</p></li>
<li><p>estrazione del valore del parametro</p></li>
<li><p>calcolo del valore del parametro <code class="docutils literal notranslate"><span class="pre">x</span></code></p></li>
<li><p>calcola l’espressione ‘core’</p></li>
<li><p>invia la risposta HTTP in JSON</p></li>
</ol>
</td>
</tr>
</tbody>
</table>
<p><strong>ctx.json(Map.of(…))</strong></p>
<p>La operazione <code class="docutils literal notranslate"><span class="pre">ctx.json(Map.of(...))</span></code>  fa le seguenti azioni:</p>
<ul class="simple">
<li><p><strong>Serializzazione</strong>: Prende la Map Java e la trasforma in una stringa in formato JSON.
Javalin usa solitamente una libreria  <em>Jackson</em> per farlo.</p></li>
<li><p><strong>Impostazione degli Header</strong>: Comunica al destinatario cosa starà ricevendo impostando l’header HTTP <code class="docutils literal notranslate"><span class="pre">Content-Type</span> <span class="pre">a</span> <span class="pre">application/json;</span> <span class="pre">charset=utf-8</span></code>.
Senza questo, il client potrebbe pensare che sia semplice testo (<em>text/plain</em>).</p></li>
<li><p><strong>Scrittura della Risposta</strong>: Invia la stringa JSON nel corpo della risposta HTTP e chiude la transazione per quel thread.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>CORS (<em>Cross-Origin Resource Sharing</em>) è un meccanismo di sicurezza nei browser che permette
a una pagina web di richiedere risorse (come dati, font, immagini) da un dominio diverso
dal proprio, cosa normalmente vietata dalla <em>Same-Origin Policy</em> (<strong>SOP</strong>).</p>
<p>Se il codice viene eseguito da un browser verso un IP
diverso da quello della pagina web corrente, il server del servizio
deve essere configurato per accettare richieste <strong>Cross-Origin</strong>,
altrimenti il browser bloccherà la risposta per sicurezza.</p>
<p>Funziona tramite intestazioni HTTP, dove il server di destinazione comunica al browser
quali origini (siti) sono autorizzate ad accedere alle sue risorse,
gestendo così in modo sicuro le interazioni tra applicazioni web e servizi esterni, come le API.
In javalin, si può abilitare CORS alla creazione del server, con una opportuna configurazione:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">app</span> <span class="o">=</span> <span class="n">Javalin</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">config</span> <span class="o">-&gt;</span> <span class="p">{</span>
             <span class="n">config</span><span class="o">.</span><span class="n">bundledPlugins</span><span class="o">.</span><span class="n">enableCors</span><span class="p">(</span><span class="n">cors</span> <span class="o">-&gt;</span> <span class="p">{</span>
             <span class="n">cors</span><span class="o">.</span><span class="n">addRule</span><span class="p">(</span><span class="n">it</span> <span class="o">-&gt;</span> <span class="n">it</span><span class="o">.</span><span class="n">anyHost</span><span class="p">());</span>
         <span class="p">});</span>
     <span class="p">})</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span>
</pre></div>
</div>
</div>
</section>
<section id="http-e-ws-sono-diversi">
<h3>HTTP e WS sono diversi<a class="headerlink" href="#http-e-ws-sono-diversi" title="Permalink to this heading">¶</a></h3>
<p>L’esempio vuole mostrare che javalin permette di gestire sia connessioni su WebSocket
sia interazioni via HTTP con un impianto di codice molto simile.</p>
<p>Ma le due funzionalità sono profondamente diverse:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">app.ws</span></code> stabilisce una <strong>relazione</strong> tra client e server che rimane attiva fino a quando il client
chiude la connessione.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">app.post</span></code> stabilisce una <strong>transazione</strong> che termina quando il server invia il risultato.</p></li>
</ul>
<p>Si evidenzia un punto critico di molti framework moderni:
la tensione tra “facilità d’uso” e “correttezza architettonica”.</p>
<p>Javalin è progettato per essere fluente e minimale e propone un’interfaccia che fa sembrare tutto simile.
Ma questa uniformità estetica nasconde differenze strutturali profonde tra i protocolli,
creando quello che in gergo si chiama un “modello mentale sfocato”.
Si viola il <a class="reference external" href="https://en.wikipedia.org/wiki/Principle_of_least_astonishment">Principle of least astonishment</a> <strong>(POLA)</strong> (Minima Sorpresa):
un sistema si deve comportare in modo da non stupire o sorprendere gli utenti.</p>
</section>
</section>
<section id="progettiamo-il-sistema">
<h2>Progettiamo il sistema<a class="headerlink" href="#progettiamo-il-sistema" title="Permalink to this heading">¶</a></h2>
<p>L’esempio ci induce a riflettere sulla differenza tra <em>imparare uno strumento</em> (il framework)
e seguire metodi opportuni di ingegneria del software nell’uso dello strumento.</p>
<p>La progettazione (a livello umano) è sempre legata all’uso, consapevole o meno,
di ‘abitudini mentali’ implicitamente assunte come pragmaticamente utili e opportune.
E’ però indispensabule rendere espliciti i <strong>‘principi’</strong> su cui un progettista basa le sue
proposte, con particolare riferimento alla <strong>impostazione della architettura</strong> del sistema.</p>
<section id="separazione-delle-responsabilita">
<span id="id91"></span><h3>Separazione delle Responsabilità<a class="headerlink" href="#separazione-delle-responsabilita" title="Permalink to this heading">¶</a></h3>
<p>I progettisti di Javalin hanno operato, all’interno del framwork, una scelta architettonica precisa,
che rispetta il principio della <strong>Separazione delle Responsabilità</strong> (<em>Separation of Concerns</em> - <strong>SoC</strong>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>SoC</strong> è un principio  architettonico generale che opera a ‘livello  macro’.</p>
<p>Si affianca al
<a class="reference internal" href="#single-responsibility"><span class="std std-ref">SRP-Single responsibility</span></a>
che invece si applica a ‘livello  micro’, cioè di singoli componenti.</p>
</div>
<p>Infatti Javalin introdice due diverse classi come supporto alle funzionalità relative
alle <em>WebSocket</em> e a <em>HTTP</em>:</p>
<ul class="simple">
<li><p><strong>io.javalin.websocket.WebMessageContext</strong> (sottoclasse di <em>WebContext</em>) per la gestione di messaggi inviati su <strong>WS</strong>;</p></li>
<li><p><strong>io.javalin.http.Context</strong> per le rotte <strong>HTTP</strong>
(come <code class="docutils literal notranslate"><span class="pre">app.get</span></code> o <code class="docutils literal notranslate"><span class="pre">app.post</span></code>).</p></li>
</ul>
<p>Sebbene abbiano nomi simili, queste due classi servono a gestire protocolli diversi e appartengono a
gerarchie ompletamente separate.</p>
<p>Tuttavia, negli esempi che ‘spiegano’ il funzionamento di javalin questi due contestii
non sono chiaramente separati.
Lo ‘stile dichiarativo’ che il framework propone a livello applicativo,
intende enfatizzare concetti comuni a due parti diverse ‘sommerse’
e il comprtamento del framweork può apparire misterioso.</p>
<p>Il rischio è che il framework, in quanto parte sommersa del sistema, venga
percepito come un’entità magica, mentre la sua reale comprensione risiede
nel capire come esso orchestra le risorse (thread, socket, memoria) ‘dietro le quinte’
degli esempi.</p>
<p>Nel nostro refactoring del sistema, la <em>Separation of Concerns</em> verrà chiaramente evidenziata
(in qualche modo ‘ricostruita’) a livello applicativo.</p>
</section>
<section id="influenza-della-clean-architecture">
<h3>Influenza della Clean Architecture<a class="headerlink" href="#influenza-della-clean-architecture" title="Permalink to this heading">¶</a></h3>
<p>Ricordando i principi delle <a class="reference internal" href="#clean-architectures"><span class="std std-ref">Clean Architecture</span></a>,</p>
<ol class="arabic simple">
<li><p>il framework <a class="reference internal" href="#javalin-server"><span class="std std-ref">javalin</span></a>, verrà conceptito come un sotto-sistema che svolge il ruolo
di un <strong>Inbound Adapter</strong> .</p></li>
<li><p>L’espressione matematica da calcolare sarà
contenuta in un componete sofware isolato dal framework.
Al momento, introduciamo una  <strong>funzione</strong> (<code class="docutils literal notranslate"><span class="pre">eval</span></code>) attorno alla quale,
javalin funge <strong>solo da guscio</strong> infrastrutturale,
evitando che le logiche di trasporto inquinino la purezza del dominio applicativo.</p></li>
</ol>
<p>Si  evitarà in questo modo il danno di una <strong>Leaky Abstraction</strong>, cioè che
i dettagli tecnici del framework vadano a contaminare la logica di business.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_images/evalInJavalin.png"><img alt="_images/evalInJavalin.png" class="align-center" src="_images/evalInJavalin.png" style="width: 100%;" /></a>
</td>
<td><a class="reference internal image-reference" href="_images/LayersSistemaS.png"><img alt="_images/LayersSistemaS.png" class="align-center" src="_images/LayersSistemaS.png" style="width: 100%;" /></a>
</td>
</tr>
</tbody>
</table>
<p>Queste scelte progettuali modificano
la struttura del codice del sistema in una  <strong>architettura a Layer</strong> :</p>
<ol class="arabic">
<li><p><strong>Livello di Dominio</strong>. La funzione <code class="docutils literal notranslate"><span class="pre">eval</span></code> è il layer che definisce la ‘business logic’ del sistema:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">protected</span> <span class="n">double</span> <span class="nb">eval</span><span class="p">(</span><span class="n">double</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">4.0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">CommUtils</span><span class="o">.</span><span class="n">outmagenta</span><span class="p">(</span> <span class="s2">&quot;eval  | Simulo ritardo per x=&quot;</span> <span class="o">+</span> <span class="n">x</span><span class="p">);</span>
      <span class="n">CommUtils</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">10000</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">Math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">Math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Questa funzione non sa nulla di  Javalin o di protcolli.
In seguito, potrrebbe essere sostituita da un <strong>POJO</strong>.</p>
<p>SI noti che, per simulare computazioni con tempi lunghi, introduiciamo un ritardo per i valori <code class="docutils literal notranslate"><span class="pre">(x</span> <span class="pre">&gt;</span> <span class="pre">4.0</span></code>.</p>
</li>
<li><p><strong>Livello Infrastruttura</strong>. Qui opera Javalin, con l’obiettivo di gestire i protocolli e
di prelevare dai messaggi le informazioni rilevanti per il <strong>domain-layer</strong>.
E’ opportuno separare bene i vari aspetti con altrettante funzioni:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">Parte</span> <span class="n">di</span> <span class="n">supporto</span> <span class="n">alle</span> <span class="n">WebSocket</span> <span class="o">-----------------------</span>
<span class="n">protected</span> <span class="n">String</span> <span class="n">handlerWS</span><span class="p">(</span><span class="n">WsMessageContext</span> <span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">//</span><span class="n">Elabora</span> <span class="n">i</span> <span class="n">messaggi</span> <span class="n">ricevuti</span> <span class="n">su</span> <span class="n">WS</span><span class="p">,</span>
  <span class="k">try</span> <span class="p">{</span>
          <span class="n">String</span> <span class="n">m</span>       <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">message</span><span class="p">();</span>
          <span class="n">double</span> <span class="n">x</span>       <span class="o">=</span> <span class="n">readInputWS</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
    <span class="n">double</span> <span class="n">result</span>  <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="k">return</span> <span class="s2">&quot;risultato WS=&quot;</span><span class="o">+</span><span class="n">result</span> <span class="o">+</span> <span class="s2">&quot; per x=&quot;</span><span class="o">+</span><span class="n">x</span><span class="p">;</span>
  <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">NumberFormatException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">return</span> <span class="s2">&quot;Errore WS: numero non valido&quot;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="o">//</span><span class="n">Parte</span> <span class="n">di</span> <span class="n">supporto</span> <span class="n">ad</span> <span class="n">HTTP</span>        <span class="o">-----------------------</span>
<span class="n">protected</span> <span class="n">String</span> <span class="n">handlerHTTP</span><span class="p">(</span><span class="n">Context</span> <span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">//</span><span class="n">Elabora</span> <span class="n">i</span> <span class="n">messaggi</span> <span class="n">ricevuti</span> <span class="n">su</span> <span class="n">HTTP</span><span class="p">,</span>
   <span class="k">try</span> <span class="p">{</span>
          <span class="n">JSONObject</span> <span class="n">m</span>  <span class="o">=</span> <span class="n">CommUtils</span><span class="o">.</span><span class="n">parseForJson</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">body</span><span class="p">());</span>
          <span class="n">double</span> <span class="n">x</span>      <span class="o">=</span> <span class="n">readInputHTTP</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
    <span class="n">double</span> <span class="n">result</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="k">return</span> <span class="s2">&quot;risultato HTTP=&quot;</span><span class="o">+</span><span class="n">result</span><span class="p">;</span>
  <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">NumberFormatException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">return</span> <span class="s2">&quot;Errore HTTP: numero non valido&quot;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p><strong>Livello di Adattamento</strong>: livello intermedio che trasforma i dati di basso livello
forniti dalla infrastruttura nei dati richiesti dalla applicazione.
Anche qui  è opportuno introdurre   funzioni di utilità:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">protected</span> <span class="n">double</span> <span class="n">readInputWS</span><span class="p">(</span><span class="n">String</span> <span class="n">message</span><span class="p">)</span> <span class="n">throws</span> <span class="n">NumberFormatException</span><span class="p">{</span>
  <span class="o">//</span><span class="n">Elabora</span> <span class="n">i</span> <span class="n">dati</span> <span class="n">ricevuti</span> <span class="n">su</span> <span class="n">WS</span>
  <span class="n">double</span> <span class="n">x</span> <span class="o">=</span> <span class="n">Double</span><span class="o">.</span><span class="n">parseDouble</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">protected</span> <span class="n">double</span> <span class="n">readInputHTTP</span><span class="p">(</span><span class="n">JSONObject</span> <span class="n">b</span><span class="p">)</span> <span class="n">throws</span> <span class="n">NumberFormatException</span><span class="p">{</span>
  <span class="o">//</span><span class="n">Elabora</span> <span class="n">i</span> <span class="n">messaggi</span> <span class="n">ricevuti</span> <span class="n">su</span> <span class="n">HTTP</span><span class="p">,</span>
  <span class="n">String</span> <span class="n">xs</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">+</span><span class="n">b</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">);</span>
  <span class="n">double</span> <span class="n">x</span>  <span class="o">=</span> <span class="n">Double</span><span class="o">.</span><span class="n">parseDouble</span><span class="p">(</span><span class="n">xs</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
<p>In <em>javalin</em> (come in ogni framework) è il framework che chiama il codice scritto dall’utente
secondo il meccanismo della <a class="reference internal" href="#dependency-inversion"><span class="std std-ref">Inversione di Controllo</span></a>.</p>
</section>
<section id="sistemasjavalinbetter-soc">
<span id="sistemasjavalinbetter"></span><h3>SistemaSJavalinBetter: SOC<a class="headerlink" href="#sistemasjavalinbetter-soc" title="Permalink to this heading">¶</a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">main</span><span class="o">.</span><span class="n">java</span><span class="o">.</span><span class="n">javalin</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">io.javalin.Javalin</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">unibo.basicomm23.utils.CommUtils</span><span class="p">;</span>

<span class="n">public</span> <span class="k">class</span> <span class="nc">SistemaSJavalinBetter</span> <span class="p">{</span>
<span class="o">/*</span><span class="mi">1</span><span class="o">*/</span> <span class="n">private</span> <span class="n">Javalin</span> <span class="n">app</span> <span class="o">=</span> <span class="n">null</span><span class="p">;</span>

<span class="o">/*</span><span class="mi">2</span><span class="o">*/</span> <span class="n">protected</span> <span class="n">double</span> <span class="nb">eval</span><span class="p">(</span><span class="n">double</span> <span class="nb">input</span><span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>

<span class="o">/*</span><span class="mi">3</span><span class="o">*/</span><span class="n">public</span> <span class="n">void</span> <span class="n">configureTheSystem</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">setWorkHTTP</span><span class="p">();</span>
      <span class="n">setWorkWS</span><span class="p">(</span> <span class="p">);</span>
    <span class="p">}</span>

<span class="o">/*</span><span class="mi">4</span><span class="o">*/</span><span class="n">protected</span> <span class="n">void</span> <span class="n">setWorkWS</span><span class="p">(</span><span class="n">Javalin</span> <span class="n">app</span><span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="o">/*</span><span class="mi">5</span><span class="o">*/</span><span class="n">protected</span> <span class="n">void</span> <span class="n">setWorkHTTP</span><span class="p">(</span><span class="n">Javalin</span> <span class="n">app</span><span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>

  <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">new</span> <span class="n">SistemaSJavalinBetter</span><span class="p">()</span><span class="o">.</span><span class="n">configureTheSystem</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span><span class="o">//</span><span class="n">SistemaSJavalinBetter</span>
</pre></div>
</div>
</td>
<td><ol class="arabic simple">
<li><p>dichiarazione dell’oggetto che rappresenta l’infrastruttura</p></li>
<li><p>la funzione <code class="docutils literal notranslate"><span class="pre">eval</span></code> che deve essere resa eseguibile via rete</p></li>
<li><p>metodo per configurare il sistema in modo che gestisca sia WS sia HTTP</p></li>
<li><p>configurazione del server per comunicazioni tramite WebSocket</p></li>
<li><p>configurazione del server per comunicazioni tramite HTTP</p></li>
</ol>
</td>
</tr>
</tbody>
</table>
<p>La struttura del codice rende immediatamente percepible il ‘core business’ applicativo
e le due diverse responsabilità
della infrastruttura: gestione delle WebSocket  e gestione HTTP.</p>
<section id="sistemasjavalinbetter-setupserver">
<h4>SistemaSJavalinBetter: setUpServer<a class="headerlink" href="#sistemasjavalinbetter-setupserver" title="Permalink to this heading">¶</a></h4>
<p>Introduciamo un metodo che crea il framework javalin per WS e/o per HTTP in modo
che consenta la corretta configurazione del server in entrambi i casi,
indipendentemente da chi venga attivato per primo.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 90%" />
<col style="width: 10%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">protected</span> <span class="n">void</span> <span class="n">setUpServer</span><span class="p">(</span> <span class="n">boolean</span> <span class="n">forWS</span> <span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">forWS</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">app</span> <span class="o">==</span> <span class="n">null</span> <span class="p">)</span> <span class="n">app</span> <span class="o">=</span> <span class="n">Javalin</span><span class="o">.</span><span class="n">create</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span>
  <span class="p">}</span><span class="k">else</span> <span class="p">{</span> <span class="o">//</span><span class="n">forHTTP</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">app</span> <span class="o">==</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">app</span> <span class="o">=</span> <span class="n">Javalin</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">config</span> <span class="o">-&gt;</span> <span class="p">{</span>
        <span class="n">config</span><span class="o">.</span><span class="n">bundledPlugins</span><span class="o">.</span><span class="n">enableCors</span><span class="p">(</span><span class="n">cors</span> <span class="o">-&gt;</span> <span class="p">{</span>
          <span class="n">cors</span><span class="o">.</span><span class="n">addRule</span><span class="p">(</span><span class="n">it</span> <span class="o">-&gt;</span> <span class="n">it</span><span class="o">.</span><span class="n">anyHost</span><span class="p">());</span>
        <span class="p">});</span>
      <span class="p">})</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
      <span class="o">//</span><span class="s2">&quot;Server già avviato. Configuro per CORS&quot;</span>
      <span class="n">app</span><span class="o">.</span><span class="n">before</span><span class="p">(</span><span class="n">ctx</span> <span class="o">-&gt;</span> <span class="p">{</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">header</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Origin&quot;</span><span class="p">,</span><span class="s2">&quot;*&quot;</span><span class="p">);</span> <span class="o">//</span><span class="n">Permette</span> <span class="n">a</span> <span class="n">TUTTI</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">header</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Methods&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;GET, POST, PUT, DELETE, OPTIONS&quot;</span><span class="p">);</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">header</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Headers&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Content-Type, Authorization&quot;</span><span class="p">);</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">header</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Credentials&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="o">//</span> <span class="n">Gestisce</span> <span class="n">le</span> <span class="n">richieste</span> <span class="n">OPTIONS</span> <span class="p">(</span><span class="n">Preflight</span><span class="p">)</span>
      <span class="n">app</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="s2">&quot;/*&quot;</span><span class="p">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="p">{</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="mi">204</span><span class="p">);</span> <span class="o">//</span> <span class="n">No</span> <span class="n">Content</span> <span class="o">-</span> <span class="n">il</span> <span class="n">server</span> <span class="n">accetta</span> <span class="n">la</span> <span class="n">chiamata</span>
        <span class="p">});</span>
    <span class="p">}</span><span class="o">//</span><span class="n">app</span> <span class="o">!=</span> <span class="n">null</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
<td></td>
</tr>
</tbody>
</table>
<p>Scopo del metodo è inizializzare la variabile <strong>app</strong> che rappresenta la infrastruttura.
Se si vuole creare il supporto per HTTP
con abilitazione di CORS
dopo che <em>app</em> è gia stata inizializzata.
occorre fare riferimeo a <strong>app.before</strong> e <strong>app.option</strong>, al fine di:</p>
<ul class="simple">
<li><p>Aggiungere gli header a ogni risposta.</p></li>
<li><p>Rispondere alle <em>richieste Preflight</em> (il metodo <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> che il browser
invia prima della richiesta reale).</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Quando il browser deve fare una chiamata “pericolosa” (come un POST con JSON o una richiesta con header personalizzati)
a un dominio diverso, esegue prima una chiamata di prova con il metodo <strong>OPTIONS</strong>.</p>
<p>Se il server non risponde positivamente (200 o 204) a questa chiamata,
il browser blocca la richiesta vera e propria per sicurezza.</p>
<p>Usando <code class="docutils literal notranslate"><span class="pre">app.options(&quot;/*&quot;,</span> <span class="pre">...)</span></code> il sistema risponderà positivamente a qualunque “test”
di connessione su qualsiasi percorso.</p>
</div>
</section>
<section id="sistemasjavalinbetter-setworkws">
<h4>SistemaSJavalinBetter: setWorkWS<a class="headerlink" href="#sistemasjavalinbetter-setworkws" title="Permalink to this heading">¶</a></h4>
<p>Questa funzione ha la <strong>responsabilità</strong> di preparare le funzionalità del server
rleative alla gestione delle connessioni su WebSocket.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 80%" />
<col style="width: 20%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/*1*/ ...
protected void setWorkWS( ) {
/*2*/setUpServer( true ); //per WS
/*3*/ app.ws(&quot;/eval&quot;,
/*4*/  ws -&gt; {
        //w:io.javalin.websocket.WsConfig
/*5*/   ws.onConnect( ctx -&gt; {
          //ctx:io.javalin.websocket.WsConnectContext
          //Thread.sleep(1000); //SOLO PER TEST!
          ctx.send(&quot;welcome&quot;); }
        );
/*6*/   ws.onMessage(ctx -&gt; {
          //ctx:io.javalin.websocket.WsMessageContext
          String message = ctx.message();
          String answer  = handlerWS( ctx );
          // Invia la risposta al client
/*7*/    ctx.send( answer );
      });
/*8*/ ws.onClose(ctx -&gt; {
          //ctx:io.javalin.websocket.WsCloseContext
          System.out.println(&quot;server: conn closed&quot;);
            });
    });
 }//setWorkWS
</pre></div>
</div>
</td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="sistemasjavalinbetter-setworkhttp">
<h4>SistemaSJavalinBetter: setWorkHTTP<a class="headerlink" href="#sistemasjavalinbetter-setworkhttp" title="Permalink to this heading">¶</a></h4>
<p>Questa funzione ha la <strong>responsabilità</strong> di preparare le funzionalità del server
rleative alla gestione delle connessioni HTTP.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 80%" />
<col style="width: 20%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">setUpServer</span><span class="p">(</span> <span class="n">false</span> <span class="p">);</span> <span class="o">//</span><span class="n">per</span> <span class="n">HTTP</span>
<span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="n">result</span><span class="p">(</span>
        <span class="s2">&quot;Hello World via HTTP/1.1&quot;</span><span class="p">));</span>

<span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/eval&quot;</span><span class="p">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="p">{</span>
  <span class="n">double</span> <span class="n">x</span> <span class="o">=</span> <span class="n">Double</span><span class="o">.</span><span class="n">parseDouble</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">queryParam</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">));</span>
  <span class="n">double</span> <span class="n">r</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span> <span class="n">x</span> <span class="p">);</span>
  <span class="o">//</span><span class="n">Invia</span> <span class="n">risposta</span> <span class="ow">in</span> <span class="n">JSON</span>
  <span class="n">ctx</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">Map</span><span class="o">.</span><span class="n">of</span><span class="p">(</span><span class="s2">&quot;fullUrl&quot;</span><span class="p">,</span> <span class="n">ctx</span><span class="o">.</span><span class="n">fullUrl</span><span class="p">(),</span> <span class="s2">&quot;result&quot;</span><span class="p">,</span> <span class="n">r</span><span class="p">));</span>
<span class="p">});</span>

<span class="n">app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/evaluate&quot;</span><span class="p">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="p">{</span>  <span class="o">//</span><span class="ne">Warning</span><span class="p">:</span> <span class="n">check</span> <span class="n">CORS</span>
      <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">handlerHTTP</span><span class="p">(</span> <span class="n">ctx</span> <span class="p">);</span>
          <span class="o">//</span><span class="n">Invia</span> <span class="n">risposta</span> <span class="ow">in</span> <span class="n">JSON</span>
          <span class="n">ctx</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">Map</span><span class="o">.</span><span class="n">of</span><span class="p">(</span>
            <span class="s2">&quot;fullUrl&quot;</span><span class="p">,</span> <span class="n">ctx</span><span class="o">.</span><span class="n">fullUrl</span><span class="p">(),</span>
            <span class="s2">&quot;body&quot;</span><span class="p">,</span> <span class="n">ctx</span><span class="o">.</span><span class="n">body</span><span class="p">(),</span>
            <span class="s2">&quot;result&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>
</div>
</td>
<td></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="uso-del-sistema-in-js">
<span id="id92"></span><h2>Uso del sistema in JS<a class="headerlink" href="#uso-del-sistema-in-js" title="Permalink to this heading">¶</a></h2>
<p>Per utilizzare il sistema possiamo impostare client WS o HTTP in un qualche linguaqggio di programmazione
(Java, Pythin, etc.) o fare uso di strumenti come Postam o curl.</p>
<p>Un modo semplice è impostare un file html con codice Javascript. Aprendo il file con un browser
e attivando gli <strong>Strumenti per sviluppatori</strong> (tasto <strong>F12</strong>) si vedranno i messaggi inviati sulla console.</p>
<section id="prova-ws-in-javascript">
<h3>Prova WS in Javascript<a class="headerlink" href="#prova-ws-in-javascript" title="Permalink to this heading">¶</a></h3>
<p>Impostaimo un file <strong>CallerBasic.html</strong></p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span>
<span class="n">function</span>  <span class="n">callWS</span><span class="p">(</span><span class="n">msgtosend</span><span class="p">){</span>
<span class="o">/*</span><span class="mi">1</span><span class="o">*/</span><span class="n">const</span> <span class="n">socketWS</span> <span class="o">=</span>
  <span class="n">new</span> <span class="n">WebSocket</span><span class="p">(</span><span class="s2">&quot;ws://localhost:8080/eval&quot;</span><span class="p">);</span>

<span class="o">/*</span><span class="mi">2</span><span class="o">*/</span><span class="n">socketWS</span><span class="o">.</span><span class="n">onopen</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;callWS | Connesso a eval&quot;</span><span class="p">);</span>
    <span class="n">socketWS</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msgtosend</span><span class="p">);</span>
  <span class="p">}</span>

<span class="o">/*</span><span class="mi">3</span><span class="o">*/</span><span class="n">socketWS</span><span class="o">.</span><span class="n">onmessage</span> <span class="o">=</span> <span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;callWS | Risposta:&quot;</span><span class="p">,</span><span class="n">event</span><span class="o">.</span><span class="n">data</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span><span class="o">//</span><span class="n">callWS</span>

<span class="n">callWS</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)</span>  <span class="o">//</span><span class="n">lazy</span>
<span class="n">callWS</span><span class="p">(</span><span class="mf">4.0</span><span class="p">)</span>  <span class="o">//</span><span class="n">fast</span>
<span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</pre></div>
</div>
</td>
<td><ol class="arabic simple">
<li><p>Crea una WS con path <code class="docutils literal notranslate"><span class="pre">eval</span></code></p></li>
<li><p>Invia un valore quando la connessione è stabilita</p></li>
<li><p>Ascolta i messaggi dal server</p></li>
</ol>
</td>
</tr>
</tbody>
</table>
<p>La console del browser mosterà ‘eventi’ emessi dal server e due risposte:</p>
<a class="reference internal image-reference" href="_images/CallWS.png"><img alt="_images/CallWS.png" class="align-center" src="_images/CallWS.png" style="width: 80%;" /></a>
</section>
<section id="prova-http-in-javascript">
<h3>Prova HTTP in Javascript<a class="headerlink" href="#prova-http-in-javascript" title="Permalink to this heading">¶</a></h3>
<p>In JavaScript moderno, il modo più semplice ed elegante per interagire con un’API è utilizzare
l’API <strong>fetch()</strong>. È integrata in tutti i browser recenti e nelle versioni attuali di <em>Node.js</em>.</p>
<section id="esempio-di-richiesta-get">
<h4>Esempio di Richiesta GET<a class="headerlink" href="#esempio-di-richiesta-get" title="Permalink to this heading">¶</a></h4>
<p>Questa richiesta serve per “chiedere” informazioni al servizio.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>async function testHTTPGet() {
  try {
    const url = &#39;http://localhost:8080/evaluate?x=-4&#39;;
    const response = await fetch(url);
    // Controlla se il server ha risposto con un errore (es. 404 o 500)
    if (!response.ok) {
      throw new Error(`Errore del server: ${response.status}`);
    }
    const data=await response.json(); //Converte la risposta da JSON a oggetto JS
    console.log(&#39;Dati ricevuti con successo:&#39;, data);
  } catch (error) {
    console.error(&#39;Errore:&#39;, error);
  }
}
</pre></div>
</div>
<p><strong>fetch</strong> restituisce una <strong>Promise</strong>. Usiamo <strong>async</strong> e <strong>await</strong> per rendere il codice leggibile,
<em>come se fosse sincrono</em>, evitando che il programma si blocchi mentre aspetta la risposta della rete.</p>
<p>La console del browser mosterà:</p>
<a class="reference internal image-reference" href="_images/CallHTTPget.png"><img alt="_images/CallHTTPget.png" class="align-center" src="_images/CallHTTPget.png" style="width: 80%;" /></a>
</section>
<section id="esempio-di-richiesta-post">
<h4>Esempio di Richiesta POST<a class="headerlink" href="#esempio-di-richiesta-post" title="Permalink to this heading">¶</a></h4>
<p>Per inviare delle informazioni al servizio,
occorre specificare il metodo, gli headers e il body (il corpo del messaggio).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="n">function</span> <span class="n">testHTTPPost</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="n">const</span> <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://localhost:8080/evaluate&#39;</span><span class="p">;</span>
        <span class="n">const</span> <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">method</span><span class="p">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="o">//</span> <span class="n">Specifica</span> <span class="n">il</span> <span class="n">metodo</span>
            <span class="n">headers</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span>
                <span class="o">//</span><span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s1">&#39;Bearer IL_TUO_TOKEN&#39;</span> <span class="o">//</span><span class="n">Se</span> <span class="n">serve</span> <span class="n">autenticazione</span>
            <span class="p">},</span>
            <span class="n">body</span><span class="p">:</span> <span class="n">JSON</span><span class="o">.</span><span class="n">stringify</span><span class="p">({</span> <span class="n">x</span><span class="p">:</span> <span class="mf">4.0</span> <span class="p">})</span> <span class="o">//</span> <span class="n">Converte</span> <span class="n">oggetto</span> <span class="n">JS</span> <span class="ow">in</span> <span class="n">stringa</span> <span class="n">JSON</span>
        <span class="p">});</span>
        <span class="n">const</span> <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">();</span>
        <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Risposta del server:&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Errore durante il caricamento:&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>JSON.stringify()</strong>: È fondamentale quando invii dati (POST/PUT). Il server non capisce gli oggetti JavaScript,
capisce solo stringhe di testo formattate come JSON.</p>
<p>La console del browser mosterà:</p>
<a class="reference internal image-reference" href="_images/CallHTTPpost.png"><img alt="_images/CallHTTPpost.png" class="align-center" src="_images/CallHTTPpost.png" style="width: 80%;" /></a>
</section>
</section>
</section>
<section id="dal-bottum-up-al-top-down">
<h2>Dal bottum-up al top-down<a class="headerlink" href="#dal-bottum-up-al-top-down" title="Permalink to this heading">¶</a></h2>
<p>Abbiamo visto che in <em>javalin</em> è il framework che chiama il codice scritto dall’utente
secondo il meccanismo della <a class="reference internal" href="#dependency-inversion"><span class="std std-ref">Inversione di Controllo</span></a>.</p>
<p>Le applicazioni costruite attorno a questo framework, anche se ben organizzate,
appaiono intrinsecamente <strong>reattive</strong> e
potrebbe essere difficile impostare il progetto di applicazioni che siano anche proattive.</p>
<p>Si supponga, ad esempio, che la funzione <code class="docutils literal notranslate"><span class="pre">eval</span></code>  debba essere calcolata ogni 5 secondi
con i dati forniti da un sensore, e se il risultato è critico,
il server deve “avvisare” tutti i client collegati su WebSocket (senza che loro abbiano chiesto nulla)
o anche altri componenti del sistema.</p>
<p>Avendo però introdotto il ruolo del framework come <strong>inbound adapter</strong>,
il livello applicativo potrebbe essere attivato anche da un timer o uno scheduler interno.</p>
<p>Si prospetta quindi un nuovo modo di vedere le cose:</p>
<p><strong>non è il sistema che “aspetta” Javalin, è Javalin che “serve” il sistema</strong></p>
<p>Siamo alle soglie della possibile trasformazione del sistema <code class="docutils literal notranslate"><span class="pre">S</span></code> in un ‘organismo’
che ha i suoi propri obiettivi e  comportamenti (<em>proattivi</em>) e le sue
capacità di ‘interazioni sociali’ (<em>reattive</em>).</p>
<p>Nei prossimi capitoli cercheremo di affrontare il progetto di sistemi di questo tipo.</p>
<p>Prima però, faremo un ulteriore passo nella direzione
per cui <em>javalin</em> sia <strong>solo un supporto</strong> alle esigenze applicative e non il vincolo
che stabilsce come è organizzata l’architettura del sistema.</p>
<p>Questo significa partire dai <strong>requsiti applicativi</strong> e selezionare (non adottare a priori)
le tecnologie ritenuti più adeguate per raggiungere gli obiettivi voluti.</p>
</section>
</section>
<section id="interaction">
<h1>Interaction<a class="headerlink" href="#interaction" title="Permalink to this heading">¶</a></h1>
<p>Nel capitolo precedente, abbiamo visto come utilizzare il framweork <em>javalin</em> pre costruire un sistema
che rende disponibile via rete un servizio di calcolo rappresentato da una funzione (<em>eval</em>).</p>
<p>Abbiamo fatto esempi di <a class="reference internal" href="#uso-del-sistema-in-js"><span class="std std-ref">Uso del sistema in JS</span></a> in cui i messaggi applicativi di richiesta
da inviare su WS o su HTTP erano, nel caso di WS, semplici stringhe
o, nel caso HTTP, dati espressi in json.</p>
<p>Ancora una volta a dettare le ‘regole del gioco’ della comunicazione è il framework.
Al termine del capitolo, abbiamo prospettato l’idea che un framwework per le comunicazioni di rete
sia <strong>solo un supporto</strong> alle esigenze applicative e non il vincolo
che stabilsce come è organizzata l’architettura del sistema.</p>
<p>Un <strong>primo passo</strong> in questa direszione consiste nel pensare a un protocollo di comunicazione
(<code class="docutils literal notranslate"><span class="pre">TCP,</span> <span class="pre">HTTP,</span> <span class="pre">UDP,</span> <span class="pre">CoAP,</span> <span class="pre">WS,</span> <span class="pre">BTH</span></code>, etc.) come puro trasportatore di informazioni, la cui struttura
è fissata dal livello applicativo.</p>
<p>L’idea è di vedere un messaggio come una sorta di “carico standardizzato” , come un <em>container</em>
nel trasporto merci, che può viaggiare su nave, treno, camion, etc..
Questo messaggio-container ha sempre la stessa forma e le stesso proprietà, indipendemente dal mezzo di trasporto.
Nel massaggio inseriamo informazioni, come il nome del mittente e del destinatario,
che corrispondono a una sorta di ‘metadati’ capaci di rendere il messaggio <strong>autoconsistente</strong>.</p>
<p>Notiamo che nei messaggi usati negli esempi <em>javalin</em> non ci sono indicazioni esplicite del mittente e del destinatario,
essendo queste conoscenze legate agli ‘endpoint’ delle connessioni punto-a-punto stabilite dai protocolli.
Protocolli punto-a-punto come TCP, HTTP, CoAP, etc. sono in grado di stabilire una connessione stabile sulla quale inviare
e ricevere messaggi.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Il protocollo UDP non stabilisce una connessione,
ma può comunque essere usato per inviare messaggi e ricevere risposte.</p>
</div>
<p>Un <strong>secondo passo</strong> verso il ribaltamento da bottom-up a top-down consiste nell’introdurre a livello applicatovo
l’idea di ‘connessione’ di comunicazione come una astrazione, che, in informatica, viene spesso
denominata “Link” o “Channel”. Noi chiameremo questa astrazione <a class="reference internal" href="#interconnessione"><span class="std std-ref">Interconnessione</span></a>.</p>
<p>L’idea è che la <strong>logica applicativa</strong> non dovrebbe sapere se ci sono bit che stanno viaggiando
su un cavo seriale, un pacchetto CoAP o un frame WebSocket.
Essa dovrebbe solo sapere che esiste una <em>Interconnessione</em> capace di fornire azioni logiche   fondamentali
per l’invio e la ricezione delle informazioni espresse come messaggi-container.</p>
<section id="unibo-basicomm23-1-0">
<span id="id93"></span><h2>unibo.basicomm23-1.0<a class="headerlink" href="#unibo-basicomm23-1-0" title="Permalink to this heading">¶</a></h2>
<p>Introduciamo subito una formalizzazione di queste idee mediante interfacce e classi Java, incluse, tra molte altre,
nella libreria  <strong>unibo.basicomm23-1.0</strong>. Ecco una sintesi:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 55%" />
<col style="width: 45%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Interfaccia standard dei messaggi</p></td>
<td><p><a class="reference internal" href="#iapplmessage"><span class="std std-ref">unibo.basicomm23.interfaces.IApplMessage</span></a></p></td>
</tr>
<tr class="row-even"><td><p>Classe di implementazione dei messaggi</p></td>
<td><p><a class="reference internal" href="#applmessage"><span class="std std-ref">unibo.interaction.msg.ApplMessage</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>Interfaccia per la interazione</p></td>
<td><p><a class="reference internal" href="#interface-interaction"><span class="std std-ref">unibo.basicomm23.interfaces.Interaction</span></a></p></td>
</tr>
<tr class="row-even"><td><p>Classe astratta per la implementazione di <a class="reference internal" href="#interface-interaction"><span class="std std-ref">Interaction</span></a></p></td>
<td><p><a class="reference internal" href="#connection"><span class="std std-ref">unibo.basicomm23.utils.Connection</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>Factory per la creazione di connessioni <span class="xref std std-ref">Interaction</span></p></td>
<td><p><a class="reference internal" href="#connectionfactory"><span class="std std-ref">unibo.basicomm23.utils.ConnectionFactory</span></a></p></td>
</tr>
</tbody>
</table>
</section>
<section id="tipi-di-messaggi">
<span id="id94"></span><h2>Tipi di messaggi<a class="headerlink" href="#tipi-di-messaggi" title="Permalink to this heading">¶</a></h2>
<p>I messaggi applicativi hanno una forma comune, ma possono riferirsi a diversi tipologie,
a ciascuno dei quali
corrisponde una precisa forma di ‘legame’ tra chi lo emette e chi lo riceve, ricordando
quanto detto in  <a class="reference internal" href="#la-interazione-come-vincolo"><span class="std std-ref">La interazione come vincolo</span></a>.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 75%" />
<col style="width: 25%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>enum ApplMessageType{
  event, dispatch, request, reply, invitation}``
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p><strong>dispatch</strong>: un messaggio inviato a un preciso destinatario senza attesa di una risposta
(il modo detto <strong>fire-and-forget</strong> in <a class="reference internal" href="#la-interazione-come-vincolo"><span class="std std-ref">La interazione come vincolo</span></a>);</p></li>
<li><p><strong>invitation</strong>: un messaggio inviato a un preciso destinatario aspettandosi un ‘ack’
da parte di questi;</p></li>
<li><p><strong>request</strong>: un messaggio inviato a un preciso destinatario aspettandosi da parte di questi una <strong>reply</strong>
logicamente correlata alla richiesta;</p></li>
<li><p><strong>event</strong>: un messaggio inviato a chiunque sia in grado di elaborarlo.</p></li>
</ul>
</td>
<td><p>.</p>
<a class="reference internal image-reference" href="_images/legendMessages.png"><img alt="_images/legendMessages.png" class="align-center" src="_images/legendMessages.png" style="width: 80%;" /></a>
</td>
</tr>
</tbody>
</table>
<section id="iapplmessage">
<span id="id95"></span><h3>IApplMessage<a class="headerlink" href="#iapplmessage" title="Permalink to this heading">¶</a></h3>
<p><em>IApplMessage</em> la interface Java che ogni  messaggio applicativo deve implementare .</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">interface</span> <span class="n">IApplMessage</span> <span class="p">{</span>
<span class="o">//</span><span class="n">selettori</span>
    <span class="n">public</span> <span class="n">String</span> <span class="n">msgId</span><span class="p">();</span>
    <span class="n">public</span> <span class="n">String</span> <span class="n">msgType</span><span class="p">();</span>
    <span class="n">public</span> <span class="n">String</span> <span class="n">msgSender</span><span class="p">();</span>
    <span class="n">public</span> <span class="n">String</span> <span class="n">msgReceiver</span><span class="p">();</span>
    <span class="n">public</span> <span class="n">String</span> <span class="n">msgContent</span><span class="p">();</span>
    <span class="n">public</span> <span class="n">String</span> <span class="n">msgNum</span><span class="p">();</span>
<span class="o">//</span><span class="n">predicati</span>
    <span class="n">public</span> <span class="n">boolean</span> <span class="n">isDispatch</span><span class="p">();</span>
    <span class="n">public</span> <span class="n">boolean</span> <span class="n">isRequest</span><span class="p">();</span>
    <span class="n">public</span> <span class="n">boolean</span> <span class="n">isReply</span><span class="p">();</span>
    <span class="n">public</span> <span class="n">boolean</span> <span class="n">isEvent</span><span class="p">();</span>

    <span class="n">public</span> <span class="n">String</span> <span class="n">toJsonString</span><span class="p">();</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">setConn</span><span class="p">(</span> <span class="n">Interaction</span> <span class="n">conn</span> <span class="p">);</span>
    <span class="n">public</span> <span class="n">Interaction</span> <span class="n">getConn</span><span class="p">(</span>   <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="applmessage">
<span id="id96"></span><h3>ApplMessage<a class="headerlink" href="#applmessage" title="Permalink to this heading">¶</a></h3>
<p>ApplMessage è la classe che implementa i messaggi applicativi. Ne riportiamo qui i costruttori:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">ApplMessage</span> <span class="n">implements</span> <span class="n">IApplMessage</span> <span class="p">{</span>
<span class="o">//</span><span class="n">Costruttori</span>
<span class="n">public</span> <span class="n">ApplMessage</span><span class="p">(</span>
       <span class="n">String</span> <span class="n">MSGID</span><span class="p">,</span> <span class="n">String</span> <span class="n">MSGTYPE</span><span class="p">,</span> <span class="n">String</span> <span class="n">SENDER</span><span class="p">,</span> <span class="n">String</span> <span class="n">RECEIVER</span><span class="p">,</span>
       <span class="n">String</span> <span class="n">CONTENT</span><span class="p">,</span> <span class="n">String</span> <span class="n">SEQNUM</span><span class="p">,</span> <span class="n">Interaction</span> <span class="n">conn</span> <span class="p">){</span><span class="o">...</span><span class="p">}</span>
<span class="n">public</span> <span class="n">ApplMessage</span><span class="p">(</span> <span class="n">String</span> <span class="n">m</span> <span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
   <span class="o">//</span><span class="n">m</span><span class="p">:</span> <span class="n">msg</span><span class="p">(</span> <span class="n">MSGID</span><span class="p">,</span> <span class="n">MSGTYPE</span><span class="p">,</span> <span class="n">SENDER</span><span class="p">,</span> <span class="n">RECEIVER</span><span class="p">,</span> <span class="n">CONTENT</span><span class="p">,</span> <span class="n">SEQNUM</span> <span class="p">)</span>
   <span class="o">//</span><span class="n">oppure</span><span class="p">:</span> <span class="n">Rappresentazione</span> <span class="n">dei</span> <span class="n">messaggi</span> <span class="ow">in</span> <span class="n">JSON</span>
   <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Se le astrazioni di messaggio-container  <a class="reference internal" href="#iapplmessage"><span class="std std-ref">IApplMessage</span></a> e di <a class="reference internal" href="#interconnessione"><span class="std std-ref">Interconnessione</span></a> sono
utili e anche ‘potenti’, perché <em>Javalin</em> o altri framework non la introducono?</p>
<p>Ci sono due ragioni fondamentali:</p>
<ol class="arabic simple">
<li><p><strong>Overhead</strong>: Creare oggetti <em>IApplMessage</em> consuma più memoria rispetto a una stringa grezza.</p></li>
<li><p><strong>Capacità specifiche</strong>: Alcuni protocolli hanno funzioni uniche (es. il Multicast di CoAP o gli Header di HTTP)
che vengono “nascoste” e perse nella parte sommersa di un’astrazione generica.</p></li>
</ol>
<p>Tuttavia, per sistemi dove la chiarezza e la proattività sono prioritari rispetto alla performance estrema,
questa impostazione può rivelarsi una scelta corretta per rendere il livello applicativo <strong>tecchnology-independent</strong>
e per privilegiare le fasi di analisi dei problemi e di progettazione del software.</p>
</div>
</section>
<section id="rappresentazione-dei-messaggi-come-string">
<span id="msgsasstring"></span><h3>Rappresentazione dei messaggi come String<a class="headerlink" href="#rappresentazione-dei-messaggi-come-string" title="Permalink to this heading">¶</a></h3>
<p>Come ogni classe Java, <em>ApplMessage</em> definisce anche un metodo <strong>toString</strong> che restituisce una rappresentazione dei
messaggi in forma di semplice stringa:</p>
<p><code class="docutils literal notranslate"><span class="pre">msg(</span> <span class="pre">MSGID,</span> <span class="pre">MSGTYPE,</span> <span class="pre">SENDER,</span> <span class="pre">RECEIVER,</span> <span class="pre">CONTENT,</span> <span class="pre">SEQNUM</span> <span class="pre">)</span></code></p>
<p>ove:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 45%" />
<col style="width: 55%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><ul class="simple">
<li><p>MSGID:    identificativo del messaggio</p></li>
<li><p>MSGTYPE:  tipo del msg</p></li>
<li><p>SENDER:   nome del componente che invia</p></li>
<li><p>CONTENT:  contenuto applicativo (payload)</p></li>
<li><p>RECEIVER: nome del componente chi riceve</p></li>
<li><p>SEQNUM:   numero di sequenza</p></li>
</ul>
</td>
<td><p>La rappresentazione in forma di String dei messaggi segue (per motivi che approfondiremo)
le regole della <strong>sintassi Prolog</strong>. In particolare:</p>
<ul class="simple">
<li><p>gli identificatori MSGID,SENDER,RECEIVER sono espressi da atomi Prolog formati da lettere minuscole;</p></li>
<li><p>MSGTYPE è un atomo prefissato: <strong>dispatch, request, reply, event</strong> (non è implementato <strong>invitation</strong>);</p></li>
<li><p>CONTENT è un termine Prolog;</p></li>
<li><p>SEQNUM è una stringa che rappresenta un intero.</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>A cosa serve SEQNUM</strong></p>
<p>In un sistema proattivo, il livello applicativo potrebbe inviare molti messaggi in rapida successione.</p>
<p>Senza un SEQNUM:</p>
<ul class="simple">
<li><p>Il client non saprebbe se ha perso la “Notifica #4” mentre leggeva la “Notifica #5”.</p></li>
<li><p>Non si potrebbero implementare logiche di Acknowledge (ACK),
dove il destinatario conferma: “Ho ricevuto correttamente fino al messaggio 102”.</p></li>
</ul>
</div>
</section>
<section id="rappresentazione-dei-messaggi-in-json">
<span id="id97"></span><h3>Rappresentazione dei messaggi in JSON<a class="headerlink" href="#rappresentazione-dei-messaggi-in-json" title="Permalink to this heading">¶</a></h3>
<p>Il metodo  <strong>toJsonString</strong> di ApplMessage restituisce la rappresentazione di un <a class="reference internal" href="#iapplmessage"><span class="std std-ref">IApplMessage</span></a> in formato JSON.
Ad esempio:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">msgtosend</span> <span class="o">=</span>
<span class="s1">&#39;{&quot;msgId&quot;:&quot;eval&quot;, &quot;msgType&quot;:&quot;request&quot;,&quot;msgSender&quot;:&quot;client&quot;,</span>
  <span class="s2">&quot;msgReceiver&quot;</span><span class="p">:</span><span class="s2">&quot;server&quot;</span><span class="p">,</span> <span class="s2">&quot;msgContent&quot;</span><span class="p">:</span><span class="s2">&quot;4.0&quot;</span><span class="p">,</span> <span class="s2">&quot;msgNum&quot;</span><span class="p">:</span><span class="s2">&quot;0&quot;</span><span class="p">}</span><span class="s1">&#39;</span>
</pre></div>
</div>
</section>
<section id="esempi-di-uso-in-js">
<h3>Esempi di uso in JS<a class="headerlink" href="#esempi-di-uso-in-js" title="Permalink to this heading">¶</a></h3>
<p>Package <strong>main.java.javalin</strong>:</p>
<p>Introduciamo una versione del sistema che gestisce solo messaggi
ricevuti in forma di <a class="reference internal" href="#rappresentazione-dei-messaggi-in-json"><span class="std std-ref">Rappresentazione dei messaggi in JSON</span></a>:
<strong>SistemaSJavalinBetterApplMsgs.java</strong>.</p>
<p>Esempi di caller Javascript:</p>
<ul class="simple">
<li><p><strong>CallerBasicApplMsgLazy.html</strong>: invia su WS e HTTP messaggi
di richiesta a esecuzione ‘lazy’ espressi in JSON.</p></li>
<li><p><strong>CallerBasicApplMsgFast.html</strong>: invia su WS e HTTP messaggi
di richiesta a esecuzione ‘fast’ espressi in JSON.</p></li>
</ul>
</section>
<section id="esempio-di-uso-in-java">
<h3>Esempio di uso in Java<a class="headerlink" href="#esempio-di-uso-in-java" title="Permalink to this heading">¶</a></h3>
<p>Riportiamo anche un client scritto in Java (package <strong>main.java.javalin</strong>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>La libreria <strong>org.java_websocket</strong> è bloccante/sincrona nella gestione della connessione (usa i thread classici).</p></li>
<li><p>La libreria <strong>java.net.http.WebSocket</strong>, inglobata nel JDK da <em>Java11</em> è asincrona (usa i <a class="reference external" href="https://www.baeldung.com/java-completablefuture">CompletableFuture Java</a>)</p></li>
</ul>
</div>
<section id="callerwsapplmsgs-l-organizzazione">
<h4>CallerWsApplMsgs: l’organizzazione<a class="headerlink" href="#callerwsapplmsgs-l-organizzazione" title="Permalink to this heading">¶</a></h4>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 70%" />
<col style="width: 30%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>import java.util.concurrent.CountDownLatch;
import org.java_websocket.client.WebSocketClient;
import org.java_websocket.handshake.ServerHandshake;
...

/*1*/public class CallerWsApplMsgs {
/*2*/private IApplMessage msg=
  CommUtils.buildRequest(&quot;client&quot;,&quot;eval&quot;,&quot;4.0&quot;,&quot;server&quot;);
/*3*/private WebSocketClient client;
/*4*/private CountDownLatch latch=new CountDownLatch(1);

  public CallerWsApplMsgs(URI serverUri) {
/*5*/client = new WebSocketClient(serverUri){
  //Event handlers
  }
  ...
  doJob();
}

/*6*/public void doJob() {
      try {
/*7*/  client.connect();
/*8*/  while ! client.isOpen()){CommUtils.delay(100);}

/*9*/  client.send(reqmsg.toJsonString());
/*10*/ latch.await();
/*11*/ client.close();
      } catch (Exception e) { ... }
    }//doJob
</pre></div>
</div>
</td>
<td><ol class="arabic simple">
<li><p>Classe che include un client di tipo WebSocketClient</p></li>
<li><p>Definizione del messaggi di richiesta</p></li>
<li><p>Dischiarazione di un client WS</p></li>
<li><p><strong>Latch</strong> (con valore <strong>1</strong>) per evitare che il programma termini prima di ricevere la unica risposta.</p></li>
<li><p>Creazione del client con specifica dei metodi <strong>Event Handlers</strong> (o <strong>Lifecycle Hooks</strong>)</p></li>
<li><p>Metodo che realizza il comportamento del client applicativo</p></li>
<li><p>Creazione della connessione con il server</p></li>
<li><p>Attesa che la connessione sia completata</p></li>
<li><p>Invio del messaggio di richiesta</p></li>
<li><p>Attesa della risposta</p></li>
<li><p>Chiusura della connessione</p></li>
</ol>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Internamente, un <a class="reference external" href="https://www.baeldung.com/java-countdown-latch">CountDownLatch</a> usa un componente chiamato <strong>AQS</strong> (<em>AbstractQueuedSynchronizer</em>)
che funziona come segue:</p>
<ul class="simple">
<li><p>Al suo interno c’è un numero intero (quello che passi nel costruttore).</p></li>
<li><p>Quando si chiama <strong>await()</strong>, il latch controlla: “Il contatore è zero?”</p>
<ul>
<li><p>Se NO, mette il thread in una coda di attesa e lo “addormenta”.</p></li>
<li><p>Se SÌ, lascia passare il thread come se fosse un semaforo verde.</p></li>
</ul>
</li>
<li><dl class="simple">
<dt>Quando un altro thread (quello del WebSocket) chiama <strong>countDown()</strong>, il numero scende.</dt><dd><p>Se arriva a zero, il latch invia un segnale di “sveglia” a tutti i thread che erano fermi sull’<em>await()</em>.</p>
</dd>
</dl>
</li>
</ul>
<p>Nel caso si dimentichi <strong>countDown()</strong>, il programma rimane bloccato per senpre.  Per evitare questo,
meglio usare una verdsione con timeout:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>boolean successo = latch.await(10, TimeUnit.SECONDS);
if (!successo) {
    System.out.println(&quot;Timeout: il server non ha risposto in tempo.&quot;);
}
</pre></div>
</div>
</div>
</section>
<section id="callerwsapplmsgs-la-parte-client">
<h4>CallerWsApplMsgs: la parte client<a class="headerlink" href="#callerwsapplmsgs-la-parte-client" title="Permalink to this heading">¶</a></h4>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 65%" />
<col style="width: 35%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">client</span> <span class="o">=</span> <span class="n">new</span> <span class="n">WebSocketClient</span><span class="p">(</span><span class="n">serverUri</span><span class="p">){</span>

 <span class="o">//</span><span class="n">Event</span> <span class="n">handlers</span>
 <span class="nd">@Override</span>
 <span class="o">/*</span><span class="mi">1</span><span class="o">*/</span><span class="n">public</span> <span class="n">void</span> <span class="n">onOpen</span><span class="p">(</span><span class="n">ServerHandshake</span> <span class="n">data</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;Connessione aperta!&quot;</span><span class="p">);</span>
 <span class="p">}</span>
 <span class="nd">@Override</span>
 <span class="o">/*</span><span class="mi">2</span><span class="o">*/</span><span class="n">public</span> <span class="n">void</span> <span class="n">onMessage</span><span class="p">(</span><span class="n">String</span> <span class="n">message</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">try</span> <span class="p">{</span>
     <span class="n">IApplMessage</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ApplMessage</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
     <span class="n">CommUtils</span><span class="o">.</span><span class="n">outmagenta</span><span class="p">(</span><span class="n">reply</span> <span class="n">ricevuto</span><span class="p">:</span><span class="s2">&quot; + msg);</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">isReply</span><span class="p">())</span> <span class="n">latch</span><span class="o">.</span><span class="n">countDown</span><span class="p">();</span>
   <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="ne">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">CommUtils</span><span class="o">.</span><span class="n">outgreen</span><span class="p">(</span><span class="s2">&quot;onMessage: &quot;</span> <span class="o">+</span> <span class="n">message</span><span class="p">);</span>
   <span class="p">}</span>
 <span class="p">}</span>
 <span class="nd">@Override</span>
 <span class="n">public</span> <span class="n">void</span> <span class="n">onMessage</span><span class="p">(</span><span class="n">ByteBuffer</span> <span class="n">message</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot; ByteBuffer ricevuto! &quot;</span><span class="p">);</span>
 <span class="p">}</span>
 <span class="nd">@Override</span>
 <span class="o">/*</span><span class="mi">3</span><span class="o">*/</span><span class="n">public</span> <span class="n">void</span> <span class="n">onClose</span><span class="p">(</span>
         <span class="nb">int</span> <span class="n">code</span><span class="p">,</span> <span class="n">String</span> <span class="n">reason</span><span class="p">,</span> <span class="n">boolean</span> <span class="n">remote</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;Connessione chiusa: &quot;</span> <span class="o">+</span> <span class="n">reason</span><span class="p">);</span>
 <span class="p">}</span>
 <span class="nd">@Override</span>
 <span class="n">public</span> <span class="n">void</span> <span class="n">onError</span><span class="p">(</span><span class="ne">Exception</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">System</span><span class="o">.</span><span class="n">err</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;Errore:&quot;</span><span class="o">+</span><span class="n">ex</span><span class="o">.</span><span class="n">getMessage</span><span class="p">());</span>
 <span class="p">}</span>
 <span class="p">};</span>
</pre></div>
</div>
</td>
<td><p>Gli <strong>Event handlers</strong> sono metodi di callback, invocati dalla libreira <em>org.java_websocket</em>:</p>
<ol class="arabic simple">
<li><p>alla apertua della connessione</p></li>
<li><p>alla ricezione di un messaggio inviato dal server sulla WS</p></li>
<li><p>alla chiusra della connessione</p></li>
</ol>
</td>
</tr>
</tbody>
</table>
<p>La logica applicativa del client è inclusa nella callback <strong>onMessage</strong>. Poichè questa callback viene invocata
ad ogni messaggio inviato dal server, essa mostra il messaggio così come arriva nel caso
non sia possibile convertirlo in un <a class="reference internal" href="#applmessage"><span class="std std-ref">ApplMessage</span></a>.
Se si tratta di un <a class="reference internal" href="#applmessage"><span class="std std-ref">ApplMessage</span></a>, allora, nel caso sia la <strong>reply</strong> attesa, si decrementa di 1 il <strong>latch</strong>,
permettendo la terminazione del client appplicativo.</p>
<p><strong>Ancora troppe dipendenze tecnologiche</strong></p>
<p>La complicazione dell’impianto di codice che sempre accompagna le interazioni asincrone e il fatto
che queste forme complicate variano da libreria a libreria e da protocollo a protcollo,
ci induce a intraprendere il <strong>secondo passo</strong> di cui abbiamo parlato:</p>
<ul class="simple">
<li><p>un componente software che intende
comunicare con un altro componente, dovrebbe farlo senza doversi preoccupare dei dettagli
del trasporto e delle sue forme peculiari (sincrono, asincrono, con callback ttadizionali,
etc.)
focalizzando l’attenzione solo sulla <a class="reference internal" href="#la-interazione-come-vincolo"><span class="std std-ref">logica della comunicazione</span></a>.</p></li>
</ul>
<p>Introduciamo quindi un nuovo concetto: quello di <a class="reference internal" href="#interconnessione"><span class="std std-ref">Interconnessione</span></a>.</p>
</section>
</section>
</section>
<section id="interconnessione">
<span id="id98"></span><h2>Interconnessione<a class="headerlink" href="#interconnessione" title="Permalink to this heading">¶</a></h2>
<p>Usiamo il termine <em>Interconnessione</em> per denotare l’idea astratta di un canale logico di comunicazione (bidirezionale) tra due
o più componenti software (end-points).</p>
<section id="connection">
<span id="id99"></span><h3>Connection<a class="headerlink" href="#connection" title="Permalink to this heading">¶</a></h3>
<p>Formalizziamo in Java il concetto di <em>Interconnessione</em> introducendo una classe astratta che cattura aspetti generali
implementabili con ciascuono dei <a class="reference internal" href="#protocolli"><span class="std std-ref">Protocolli</span></a> citati.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">abstract</span> <span class="k">class</span> <span class="nc">Connection</span> <span class="n">implements</span> <span class="n">Interaction</span><span class="p">{</span>
  <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="interface-interaction">
<span id="id100"></span><h2>Interface Interaction<a class="headerlink" href="#interface-interaction" title="Permalink to this heading">¶</a></h2>
<p>Le operazioni di invio-ricezione di messaggi relative all’astrazione <a class="reference internal" href="#interconnessione"><span class="std std-ref">Interconnessione</span></a>
sono divise in due insiemi, ciascuno dei quali include
funzioni con lo stesso nome ma con signature diversa, legata ai tipi di messaggi scambiati:
String non meglio specifiate (<strong>Interaction2021</strong>) o <a class="reference internal" href="#iapplmessage"><span class="std std-ref">IApplMessage</span></a> (<strong>Interaction2023</strong>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">interface</span> <span class="n">Interaction</span> <span class="n">extends</span> <span class="n">Interaction2021</span><span class="p">,</span> <span class="n">Interaction2023</span><span class="p">{</span>
<span class="p">}</span>

<span class="n">public</span> <span class="n">interface</span> <span class="n">Interaction2021</span>  <span class="p">{</span>
  <span class="n">public</span> <span class="n">void</span> <span class="n">forward</span><span class="p">(</span>  <span class="n">String</span> <span class="n">msg</span> <span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>
  <span class="n">public</span> <span class="n">String</span> <span class="n">request</span><span class="p">(</span>  <span class="n">String</span> <span class="n">msg</span> <span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>
  <span class="n">public</span> <span class="n">void</span> <span class="n">reply</span><span class="p">(</span>  <span class="n">String</span> <span class="n">reqid</span> <span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>
  <span class="n">public</span> <span class="n">String</span> <span class="n">receiveMsg</span><span class="p">(</span>  <span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span> <span class="p">;</span>
  <span class="n">public</span> <span class="n">void</span> <span class="n">close</span><span class="p">(</span> <span class="p">)</span>  <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">public</span> <span class="n">interface</span> <span class="n">InteractionBasic</span> <span class="p">{</span>
  <span class="n">public</span> <span class="n">void</span> <span class="n">forward</span><span class="p">(</span>  <span class="n">IApplMessage</span> <span class="n">msg</span> <span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>
  <span class="n">public</span> <span class="n">IApplMessage</span> <span class="n">request</span><span class="p">(</span> <span class="n">IApplMessage</span> <span class="n">msg</span> <span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">public</span> <span class="n">interface</span> <span class="n">Interaction2023</span> <span class="n">extends</span> <span class="n">InteractionBasic</span><span class="p">{</span>
  <span class="n">public</span> <span class="n">IApplMessage</span> <span class="n">request</span><span class="p">(</span>  <span class="n">IApplMessage</span> <span class="n">msg</span><span class="p">,</span> <span class="nb">int</span> <span class="n">tout</span> <span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>
  <span class="n">public</span> <span class="n">void</span> <span class="n">reply</span><span class="p">(</span>  <span class="n">IApplMessage</span> <span class="n">msg</span> <span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>
  <span class="n">public</span> <span class="n">IApplMessage</span> <span class="n">receive</span><span class="p">(</span>  <span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span> <span class="p">;</span>
  <span class="n">public</span> <span class="n">void</span> <span class="n">close</span><span class="p">(</span> <span class="p">)</span>  <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="interactionbasic">
<span id="id101"></span><h3>InteractionBasic<a class="headerlink" href="#interactionbasic" title="Permalink to this heading">¶</a></h3>
<p>L’interfaccia <strong>InteractionBasic</strong> esprime le operazioni fondamentali che usermo in alcuni esempi
che seguono.</p>
<ul class="simple">
<li><p>Il metodo <strong>request</strong> esprime una intereazione che blocca il chiamante in attesa della risposta.</p></li>
<li><p>Il metodo <strong>forward</strong> è di tipo <span class="xref std std-ref">fire-and-forget</span>;
tuttavia, se il messaggio inviato è di tipo <em>request</em>,
allora il chiamante si aspetta di ricevere (in futuro, sulla connessione usate per la request) una <strong>reply</strong>
alla sua richiesta.</p></li>
</ul>
<p>La liobreria <a class="reference internal" href="#unibo-basicomm23-1-0"><span class="std std-ref">unibo.basicomm23-1.0</span></a>  definisce diverse classi che specializzano
la classe astratta <em>Connection</em>, ciascuna in relazione ad uno specifico protocollo.</p>
</section>
<section id="protocolli">
<span id="id102"></span><h3>Protocolli<a class="headerlink" href="#protocolli" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">enum</span> <span class="n">ProtocolType</span> <span class="p">{</span>  <span class="n">http</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">tcp</span><span class="p">,</span> <span class="n">udp</span><span class="p">,</span> <span class="n">coap</span><span class="p">,</span> <span class="n">mqtt</span><span class="p">,</span> <span class="n">bluetooth</span><span class="p">,</span> <span class="n">serial</span> <span class="p">}</span>
</pre></div>
</div>
<p>Le classi spcecializzate che usermo più di frequente sono:</p>
<ul class="simple">
<li><p>HttpConnection: per http</p></li>
<li><p>WsConnection: per ws</p></li>
<li><p>TcpConnection: per tcp</p></li>
<li><p>CoapConnection: per coap</p></li>
<li><p>MqttInteraction: per mqtt</p></li>
</ul>
</section>
<section id="connectionfactory">
<span id="id103"></span><h3>ConnectionFactory<a class="headerlink" href="#connectionfactory" title="Permalink to this heading">¶</a></h3>
<p>La classe  <strong>ConnectionFactory</strong> è una factory relativa alle costruzione delle diverse classi concerete.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 45%" />
<col style="width: 55%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">ConnectionFactory</span><span class="p">{</span>
  <span class="o">...</span>
<span class="n">public</span> <span class="n">static</span> <span class="n">Interaction</span>
  <span class="n">createClientSupport</span><span class="p">(</span>
    <span class="n">ProtocolType</span> <span class="n">protocol</span><span class="p">,</span>
    <span class="n">String</span> <span class="n">host</span><span class="p">,</span><span class="n">String</span> <span class="n">entry</span> <span class="p">){</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">switch</span><span class="p">(</span> <span class="n">protocol</span> <span class="p">){</span>
      <span class="k">case</span> <span class="n">http</span>  <span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
      <span class="k">case</span> <span class="n">ws</span>    <span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
      <span class="k">case</span> <span class="n">tcp</span>   <span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
      <span class="k">case</span> <span class="n">udp</span>   <span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
      <span class="k">case</span> <span class="n">coap</span>  <span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
      <span class="k">case</span> <span class="n">mqtt</span>  <span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
      <span class="k">case</span> <span class="n">serial</span> <span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
      <span class="k">case</span> <span class="n">bluetooth</span> <span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
  <span class="p">}</span>
  <span class="o">...</span>
<span class="p">}</span><span class="o">//</span><span class="n">ConnectionFactory</span>
</pre></div>
</div>
</td>
<td><p>La coppia di argomenti <code class="docutils literal notranslate"><span class="pre">String</span> <span class="pre">host,</span> <span class="pre">String</span> <span class="pre">entry</span></code> è specifica per goni protocollo</p>
<ul class="simple">
<li><p><strong>http</strong>:host=”localhost:8080” entry=-</p></li>
<li><p><strong>ws</strong>:  host=”localhost:8080” entry=”eval”</p></li>
<li><p><strong>tcp</strong>: host=”localhost” entry=”8080”</p></li>
<li><p><strong>udp</strong>: host=”localhost” entry=”8080”</p></li>
<li><p><strong>coap</strong>:host=”localhost” entry=”8080”</p></li>
<li><p><strong>mqtt</strong>:: host”brokerip” entry=”In-Out”</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="nuove-impostazioni-progettuali">
<h2>Nuove impostazioni progettuali<a class="headerlink" href="#nuove-impostazioni-progettuali" title="Permalink to this heading">¶</a></h2>
<p>La libreria <a class="reference internal" href="#unibo-basicomm23-1-0"><span class="std std-ref">unibo.basicomm23-1.0</span></a> fornisce classi che supportano le <em>nuove astrazioni</em>
introdotte in questa sezione:</p>
<ul class="simple">
<li><p>il concetto di messaggio applicativo autocomtenuto (classi <a class="reference internal" href="#iapplmessage"><span class="std std-ref">IApplMessage</span></a> e <a class="reference internal" href="#applmessage"><span class="std std-ref">ApplMessage</span></a>)</p></li>
<li><p>il concetto di Interconnessione implemnetabile su diversi <a class="reference internal" href="#protocolli"><span class="std std-ref">Protocolli</span></a></p></li>
</ul>
<p>La disponibilià di queste astrazioni pemette di ‘penasare ai problemi’ e alla loro soluzione in modo più vicino
alle esigenze logiche dell’applicazione.</p>
<p>Riprendendo, ad esempio, quanto detto in <a class="reference internal" href="#la-interazione-come-vincolo"><span class="std std-ref">La interazione come vincolo</span></a>, ridefiniamo il <em>sistemaS</em> in modo che operi</p>
<ul class="simple">
<li><p>sia come <strong>gestore di richieste</strong></p></li>
<li><p>sia come <strong>emettitore di eventi</strong>, che siano perceibili e gestibili da <strong>tutti i client</strong> collegati al sistema.</p></li>
</ul>
<p>Naturalmente occcorre anche fare in modo che la <strong>reply</strong> a una <strong>request</strong> venga inviata solo
al client che ha fatto la richiesta.</p>
<p>Il <code class="docutils literal notranslate"><span class="pre">sistemaS</span></code> si presenta dunque agli occhi dei suoi osservaori <code class="docutils literal notranslate"><span class="pre">Obs</span></code> sia reattivo (in quanto risponde a un richiesta)
sia proattivo (in quanto può inviare informazioni ai client senza alcuna richiesta da parte loro).</p>
</section>
<section id="refactoring-del-sistemas">
<span id="id104"></span><h2>Refactoring del sistemaS<a class="headerlink" href="#refactoring-del-sistemas" title="Permalink to this heading">¶</a></h2>
<p>Facciamo ora una più chiara separazione tra <em>javalin</em> inteso come <em>Inbound Adapter</em> e
il livello applicativo, associando alla  <em>logica applicativa</em>
<strong>un processo autonomo</strong> che reagisce alle richieste in input ed emette risposte e/o eventi.</p>
<p>La <strong>nuova architettura logica</strong> del sistena è rappresentata nella figura che segue:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 55%" />
<col style="width: 45%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>.</p>
<a class="reference internal image-reference" href="_images/JavalinAndWorker.png"><img alt="_images/JavalinAndWorker.png" class="align-center" src="_images/JavalinAndWorker.png" style="width: 100%;" /></a>
</td>
<td><p>Il processo <strong>ApplLogicWorker</strong> è dotato di una coda di input <strong>applMsgQueue</strong></p>
<ul class="simple">
<li><p>su cui <em>javalin</em> deposita i messaggi applocativi
ricevuti via rete, <strong>senza elaborarli</strong> in alcun modo</p></li>
<li><p>da cui preleva i messaggi in sequenza man mano arrivano,
elaborando ciascuno di essi e, nel caso di request, inviando
la risposta al client richiedente</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Con questa nuova architettura (<code class="docutils literal notranslate"><span class="pre">Molti</span> <span class="pre">thread</span> <span class="pre">TX</span> <span class="pre">Javalin</span> <span class="pre">-&gt;</span> <span class="pre">Una</span> <span class="pre">Coda</span> <span class="pre">-&gt;</span>&#160; <span class="pre">Un</span> <span class="pre">thread</span> <span class="pre">applicativo</span> <span class="pre">TA</span></code>),
stiamo fondamentalmente replicando il modello
di <strong>Node.js</strong> in Java, con la possibilità di attivare, se ritenuto il caso, più worker applicativi.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Notiamo che con i <strong>Virtual Threads</strong> di <em>Java21</em>, si possono avere moltissimi thread TX che aspettano messaggi WebSocket
consumando pochissima memoria. Questi thread ‘leggerissimi’ convogliano i messaggi verso il thread <em>ApplLogicWorker</em>
garantendo (si veda quanto detto in <a class="reference internal" href="#come-opera-javalin"><span class="std std-ref">Come opera javalin</span></a>):</p>
<ul class="simple">
<li><p>assenza di synchronized</p></li>
<li><p>assenza di corse critiche</p></li>
<li><p>ordine di elaborazione garantito</p></li>
</ul>
</div>
<section id="dalla-logica-al-progetto">
<h3>Dalla logica al progetto<a class="headerlink" href="#dalla-logica-al-progetto" title="Permalink to this heading">¶</a></h3>
<p>L’idea di convogliare i messaggi che giungono al sistemaS ad un unico processo di elaborazione applicativo
si può concretizzare in diverso modi.
A ciascuno di questi modi corrisponde uno   <strong>specifico progetto</strong> di costruzione del sistema che conduce
a un diversa struttura del codice e a diversi modi di trasferire comportamenti nel ‘livello sommerso’
del sistema.</p>
<p>Noi esamineremo due diverse modalità di passaggio dal livello logico al livello realizzativo:</p>
<ul class="simple">
<li><p>un modo <strong>esplicito</strong>, in cui  <em>applMsgQueue</em> e <em>ApplLogicWorker</em> sono introdotti ‘in chiaro’ nel codice</p></li>
<li><p>un modo <strong>implicito</strong>, in cui la coda e il worker sono realizzati (senza che si vedano) mediante i
<a class="reference internal" href="#java-executors"><span class="std std-ref">Java Executors</span></a>,
che costituiscono il supporto più adguato per ridurre l’abstraction gap
tra ciò che vogliamo realizzare e la tecnologia.</p></li>
</ul>
<p>In questa sezione  procedermo con il <strong>modo esplicito</strong>, mentre una soluzione basata sui Java Executors
verrà introdotta per realizzare, nella sezione successiva, il microframework
<a class="reference internal" href="#abstractprotoactor"><span class="std std-ref">AbstractProtoactor</span></a> , un primo prototipo di supporto per gli
<a class="reference internal" href="#gli-attori-come-nuovo-paradigma"><span class="std std-ref">attori</span></a>.</p>
<section id="analisi-di-come-gestire-i-messaggi-request">
<h4>Analisi di come gestire i messaggi request<a class="headerlink" href="#analisi-di-come-gestire-i-messaggi-request" title="Permalink to this heading">¶</a></h4>
<p>Prima di procedere occorre però un approfondimento della <strong>analisi del problema</strong> in relazione ai diversi
tipi di messggio da eleborare.</p>
<ul class="simple">
<li><p>messaggi di tipo <strong>dispatch</strong> ed <strong>event</strong> devono essere solo ‘consegnati’ al processo applicativo <em>ApplLogicWorker</em>
perchè siano gestiti;</p></li>
<li><p>messaggi di tipo <strong>request</strong> implicano che, dopo la loro gestione da parte di <em>ApplLogicWorker</em> (TA), venga inviata
una <strong>reply</strong> al componente richiedente, sulla stessa connessione usata per la richiesta.</p></li>
</ul>
<p>Il problema è dare al processo applicativo <em>ApplLogicWorker</em> informazione
relativa alla connessione su cui è giunta la richiesta, in modo che,
terminata la elaborazione del messaggio, il processo applicativo possa inviare la
<strong>reply</strong> sulla connessione giusta.</p>
<p>Come analisti, sappiamo che Java propone un meccanismo utile allo scopo legato alla interfaccia <a class="reference external" href="https://www.baeldung.com/java-completablefuture">CompletableFuture Java</a>.
Diamo qui alcune indicazioni utili per il progettista.</p>
</section>
</section>
<section id="completablefuture">
<span id="id105"></span><h3>CompletableFuture<a class="headerlink" href="#completablefuture" title="Permalink to this heading">¶</a></h3>
<p>Java8 introduce la classe <em>CompletableFuture</em> che implementa l’ interfaccia <em>Future</em> in modo che si possa utilizzarla
come implementazione <em>Future</em> ma con logica di completamento aggiuntiva.</p>
<ul class="simple">
<li><p>Una istanza di questa classe, con costruttore senza argomenti rappresenta
un risultato futuro.</p></li>
<li><p>Distribuiamo l’istanza al processo di elaborazione, che la completarà in un momento futuro
utilizzando il metodo <strong>complete</strong>.</p></li>
<li><p>Il metodo <strong>thenAccept</strong> può essere usato per eseguire una azione quando
verrà fornito questo risultato.</p></li>
</ul>
<p>Il thread (TX) attivato da Javalin alla ricezione di un messaggio, può operare come segue:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span><span class="o">.</span><span class="n">onMessage</span><span class="p">(</span><span class="n">ctx</span> <span class="o">-&gt;</span> <span class="p">{</span>
  <span class="n">IApplMessage</span> <span class="n">am</span> <span class="o">=</span> <span class="n">readInputWS</span><span class="p">(</span> <span class="n">ctx</span><span class="o">.</span><span class="n">message</span><span class="p">()</span> <span class="p">);</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">am</span><span class="o">.</span><span class="n">isRequest</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
<span class="o">/*</span><span class="mi">1</span><span class="o">*/</span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">IApplMessage</span><span class="o">&gt;</span> <span class="n">responseFuture</span> <span class="o">=</span> <span class="n">new</span> <span class="n">CompletableFuture</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="o">/*</span><span class="mi">2</span><span class="o">*/</span><span class="n">responseFuture</span><span class="o">.</span><span class="n">thenAccept</span><span class="p">(</span><span class="n">res</span> <span class="o">-&gt;</span> <span class="p">{</span>
      <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;server invia risposta:&quot;</span> <span class="o">+</span> <span class="n">res</span> <span class="p">);</span>
      <span class="n">String</span> <span class="n">ss</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">toJsonString</span><span class="p">();</span>
      <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">ss</span><span class="p">);</span> <span class="o">//</span> <span class="n">Viene</span> <span class="n">eseguito</span> <span class="n">quando</span> <span class="n">TA</span> <span class="n">completa</span> <span class="n">la</span> <span class="n">promise</span>
    <span class="p">})</span><span class="o">.</span><span class="n">exceptionally</span><span class="p">(</span><span class="n">ex</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;Errore!&quot;</span><span class="p">);</span> <span class="k">return</span> <span class="n">null</span><span class="p">;</span> <span class="p">});</span>
    <span class="o">//</span><span class="n">Ci</span> <span class="n">potrebbe</span> <span class="n">essere</span> <span class="n">anche</span> <span class="n">un</span> <span class="n">timeout</span> <span class="o">...</span>
<span class="o">/*</span><span class="mi">3</span><span class="o">*/</span><span class="n">WorkTask</span> <span class="n">wt</span> <span class="o">=</span> <span class="n">new</span> <span class="n">WorkTask</span><span class="p">(</span> <span class="n">am</span><span class="p">,</span> <span class="n">responseFuture</span> <span class="p">);</span>
<span class="o">/*</span><span class="mi">4</span><span class="o">*/</span><span class="n">applMsgQueue</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">wt</span> <span class="p">);</span>
  <span class="p">}</span><span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">am</span><span class="o">.</span><span class="n">isDispatch</span><span class="p">()</span> <span class="o">||</span> <span class="n">am</span><span class="o">.</span><span class="n">isEvent</span><span class="p">())</span> <span class="p">{</span>
<span class="o">/*</span><span class="mi">5</span><span class="o">*/</span><span class="n">WorkTask</span> <span class="n">wt</span> <span class="o">=</span> <span class="n">new</span> <span class="n">WorkTask</span><span class="p">(</span> <span class="n">am</span><span class="p">,</span> <span class="n">null</span> <span class="p">);</span>
    <span class="n">applMsgQueue</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">wt</span> <span class="p">);</span>
  <span class="p">}</span>
</pre></div>
</div>
<section id="nel-caso-di-request">
<h4>Nel caso di <strong>request</strong><a class="headerlink" href="#nel-caso-di-request" title="Permalink to this heading">¶</a></h4>
<ol class="arabic">
<li><p>Creazione di un <strong>CompletableFuture</strong></p></li>
<li><p>Definizione delle azioni da eseguire quando il risultato sarà disponibile.</p>
<p>La <strong>lambda</strong> <code class="docutils literal notranslate"><span class="pre">res</span> <span class="pre">-&gt;</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">ctx.send(...)}</span></code> “cattura” l’oggetto <em>ctx</em>. Anche se il thread TX finisce
il suo lavoro e torna nel pool di Jetty,
la lambda rimane “viva” dentro l’oggetto <code class="docutils literal notranslate"><span class="pre">responseFuture</span></code>, portando con sé il riferimento
alla connessione corretta.</p>
</li>
<li><p>Creazione di una struttura dati (record <a class="reference internal" href="#worktask"><span class="std std-ref">Il record WorkTask</span></a>) che associa il messaggio alla connessione</p></li>
<li><p>Inserzione di WorkTask nella coda di  <em>ApplLogicWorker</em> (TA)</p></li>
</ol>
<p>Quando il thread applicativo (TA) chiama <strong>complete</strong> sulla future
(dopo avere gestito un WorkTask: si veda più avanti <span class="xref std std-ref">doelabaRequest</span>):</p>
<ul class="simple">
<li><p>La future passa dallo stato “In attesa” allo stato “Completato”.</p></li>
<li><p>Il sistema vede che c’era una funzione registrata con <strong>thenAccept</strong>.</p></li>
<li><p>Viene eseguita immediatamente il corpo della <strong>lambda</strong>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>E’ lo stesso thread TA ad eseguire anche il codice dentro <em>thenAccept</em>.
<code class="docutils literal notranslate"><span class="pre">ctx.send(..)</span></code> in Javalin è un’operazione molto veloce e thread-safe,
e non rallenta il thread applicativo, garantendo
che la risposta parta istantaneamente.</p></li>
<li><p>Possiamo usare <code class="docutils literal notranslate"><span class="pre">completeExceptionally(ex)</span></code> per inviare un messaggio di errore al client
invece del risultato.</p></li>
<li><p>E’ anche possibile specificare azioni allo scadere di un timeout.</p></li>
</ul>
</div>
</section>
<section id="nel-caso-di-dispath-o-event">
<h4>Nel caso di <strong>dispath</strong> o <strong>event</strong><a class="headerlink" href="#nel-caso-di-dispath-o-event" title="Permalink to this heading">¶</a></h4>
<ol class="arabic simple" start="5">
<li><p>Il <a class="reference internal" href="#worktask"><span class="std std-ref">Il record WorkTask</span></a> non porta con sè alcuna <em>CompletableFuture</em>.</p></li>
</ol>
</section>
<section id="il-record-worktask">
<span id="worktask"></span><h4>Il record WorkTask<a class="headerlink" href="#il-record-worktask" title="Permalink to this heading">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">private</span> <span class="n">record</span> <span class="n">WorkTask</span><span class="p">(</span>
    <span class="n">IApplMessage</span> <span class="n">message</span><span class="p">,</span>
    <span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">IApplMessage</span><span class="o">&gt;</span> <span class="n">future</span>
<span class="p">)</span> <span class="p">{}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>I <a class="reference external" href="https://www.baeldung.com/java-16-new-features#records-jep-395">Java record</a>  sono una funzionalità introdotta con <code class="docutils literal notranslate"><span class="pre">Java16</span></code>.
Rappresentano una forma ristretta di classe, progettata specificamente per fungere da “contenitore di dati”
(<strong>Data Carrier</strong>) immutabile, eliminando quasi tutto il codice ripetitivo (<strong>boilerplate</strong>) tipico dei POJO.</p>
</div>
</section>
</section>
</section>
<section id="un-progetto-esplicito">
<span id="id106"></span><h2>Un progetto esplicito<a class="headerlink" href="#un-progetto-esplicito" title="Permalink to this heading">¶</a></h2>
<p>Tenendo conto di quanto detto in fase di analisi,
la coda <strong>applMsgQueue</strong> può essere definita come segue:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lockingQueue</span><span class="o">&lt;</span><span class="n">WorkTask</span><span class="o">&gt;</span> <span class="n">applMsgQueue</span> <span class="o">=</span> <span class="n">new</span> <span class="n">LinkedBlockingDeque</span><span class="o">&lt;</span><span class="n">WorkTask</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="o">//</span><span class="n">il</span> <span class="n">dimensionamento</span> <span class="n">della</span> <span class="n">coda</span> <span class="n">a</span> <span class="mi">50</span> <span class="n">andrebbe</span> <span class="n">discusso</span> <span class="o">...</span>
</pre></div>
</div>
<section id="sistemasjavalapplmsgsqueued">
<span id="id107"></span><h3>SistemaSJavalApplMsgsQueued<a class="headerlink" href="#sistemasjavalapplmsgsqueued" title="Permalink to this heading">¶</a></h3>
<p>La classe che definisce la nuova versione del sistema implementa <a class="reference internal" href="#interactionbasic"><span class="std std-ref">InteractionBasic</span></a> per consentire
inserzione diretta nella coda <em>applMsgQueue</em>, nel caso si voglia
interagire con il componente senza l’uso della rete. Si veda <a class="reference internal" href="#interazioni-locali"><span class="std std-ref">Interazioni locali</span></a>.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">SistemaSJavalApplMsgsQueued</span>
                  <span class="n">implements</span> <span class="n">InteractionBasic</span><span class="p">{</span>
<span class="o">/*</span><span class="mi">1</span><span class="o">*/</span><span class="n">protected</span>  <span class="n">static</span> <span class="n">Vector</span><span class="o">&lt;</span><span class="n">WsConnectContext</span><span class="o">&gt;</span>
      <span class="n">allConns</span><span class="o">=</span><span class="n">new</span> <span class="n">Vector</span><span class="o">&lt;</span><span class="n">WsConnectContext</span><span class="o">&gt;</span><span class="p">();</span>
<span class="o">/*</span><span class="mi">2</span><span class="o">*/</span><span class="n">protected</span> <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">WorkTask</span><span class="o">&gt;</span>
      <span class="n">applMsgQueue</span><span class="o">=</span>
          <span class="n">new</span> <span class="n">LinkedBlockingDeque</span><span class="o">&lt;</span><span class="n">WorkTask</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
  <span class="o">...</span>
<span class="o">/*</span><span class="mi">3</span><span class="o">*/</span> <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
<td><ol class="arabic simple">
<li><p>Lista di tutte le connessioni attive (si veda <a class="reference internal" href="#ws-onconnect"><span class="std std-ref">SistemaSJavalApplMsgsQueued ws.onConnect</span></a>)</p></li>
<li><p>Coda di input per la logica applicativa (si veda <a class="reference internal" href="#worker-thread"><span class="std std-ref">Worker thread message-driven</span></a>)</p></li>
<li><p>Codice strutturato come in <a class="reference internal" href="#sistemasjavalinbetter"><span class="std std-ref">SistemaSJavalinBetter: SOC</span></a></p></li>
</ol>
</td>
</tr>
</tbody>
</table>
</section>
<section id="sistemasjavalapplmsgsqueued-ws-onconnect">
<span id="ws-onconnect"></span><h3>SistemaSJavalApplMsgsQueued ws.onConnect<a class="headerlink" href="#sistemasjavalapplmsgsqueued-ws-onconnect" title="Permalink to this heading">¶</a></h3>
<p>La gestione di una nuova connessione consiste nell’aggiungere la conessione alla lista
<strong>allConns</strong>, che viene usata da <strong>emitInfo</strong> per inviare informazioni a tutti i client collegati.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 65%" />
<col style="width: 35%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span><span class="mi">1</span><span class="o">*/</span><span class="n">protected</span>  <span class="n">static</span> <span class="n">Vector</span><span class="o">&lt;</span><span class="n">WsConnectContext</span><span class="o">&gt;</span> <span class="n">allConns</span> <span class="o">=</span>
        <span class="n">new</span> <span class="n">Vector</span><span class="o">&lt;</span><span class="n">WsConnectContext</span><span class="o">&gt;</span><span class="p">();</span>
 <span class="o">...</span>
<span class="o">/*</span><span class="mi">2</span><span class="o">*/</span><span class="n">ws</span><span class="o">.</span><span class="n">onConnect</span><span class="p">(</span><span class="n">ctx</span> <span class="o">-&gt;</span> <span class="p">{</span>
<span class="o">/*</span><span class="mi">3</span><span class="o">*/</span> <span class="n">allConns</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>
<span class="o">/*</span><span class="mi">4</span><span class="o">*/</span> <span class="n">emitEvent</span><span class="p">(</span><span class="s2">&quot;welcome&quot;</span><span class="p">,</span><span class="n">ctx</span><span class="p">);</span>
<span class="o">/*</span><span class="mi">4</span><span class="o">*/</span> <span class="n">emitInfo</span><span class="p">(</span><span class="s2">&quot;new connection established&quot;</span><span class="p">);</span>
     <span class="p">});</span>
<span class="p">});</span><span class="o">//</span><span class="n">onConnect</span>
</pre></div>
</div>
</td>
<td><ol class="arabic simple">
<li><p>Lista di tutte le connessioni attive</p></li>
<li><p>Handler di gestione di una nuova connessione</p></li>
<li><p>Aggiunta della connessione alla lsita
(la rimozione viene fatta in <strong>ws.onClose</strong>)</p></li>
<li><p>Invio di un evento al client: <a class="reference internal" href="#emitevent"><span class="std std-ref">emitEvent</span></a></p></li>
<li><p>Invio di un evento a tutti i client attivi: <a class="reference internal" href="#emitinfo"><span class="std std-ref">emitInfo</span></a></p></li>
</ol>
</td>
</tr>
</tbody>
</table>
</section>
<section id="sistemasjavalapplmsgsqueued-ws-onmessage">
<span id="id108"></span><h3>SistemaSJavalApplMsgsQueued ws.onMessage<a class="headerlink" href="#sistemasjavalapplmsgsqueued-ws-onmessage" title="Permalink to this heading">¶</a></h3>
<p>La gestione dei messaggi in input si limita ora ad aggiungere un <strong>WorkTask</strong> alla coda
di ingresso del Thread applicativo, come indicato in fase di analisi.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 70%" />
<col style="width: 30%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">SistemaSJavalApplMsgsQueued</span><span class="p">{</span>
<span class="n">protected</span> <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">WorkTask</span><span class="o">&gt;</span> <span class="n">applMsgQueue</span> <span class="o">=</span>
        <span class="n">new</span> <span class="n">LinkedBlockingDeque</span><span class="o">&lt;</span><span class="n">WorkTask</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
  <span class="o">...</span>

<span class="o">/*</span><span class="mi">1</span><span class="o">*/</span> <span class="n">protected</span> <span class="n">double</span> <span class="nb">eval</span><span class="p">(</span><span class="n">double</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">4.0</span><span class="p">)</span> <span class="p">{</span> <span class="o">//</span><span class="n">Simulazione</span> <span class="n">elab</span> <span class="n">lazy</span>
        <span class="n">CommUtils</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">10000</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">Math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">Math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">);</span>
  <span class="p">}</span>

<span class="o">/*</span><span class="mi">2</span><span class="o">*/</span><span class="n">ws</span><span class="o">.</span><span class="n">onMessage</span><span class="p">(</span><span class="n">ctx</span> <span class="o">-&gt;</span> <span class="p">{</span>
<span class="o">/*</span><span class="mi">3</span><span class="o">*/</span><span class="n">emitEvent</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span> <span class="o">//</span><span class="n">just</span> <span class="n">to</span> <span class="n">test</span>

     <span class="n">IApplMessage</span> <span class="n">am</span> <span class="o">=</span> <span class="n">readInputWS</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">message</span><span class="p">());</span>
<span class="o">/*</span><span class="mi">3</span><span class="o">*/</span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">IApplMessage</span><span class="o">&gt;</span> <span class="n">responseFuture</span><span class="o">=</span>
              <span class="n">new</span> <span class="n">CompletableFuture</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="o">/*</span><span class="mi">4</span><span class="o">*/</span><span class="n">responseFuture</span><span class="o">.</span><span class="n">thenAccept</span><span class="p">(</span><span class="n">res</span> <span class="o">-&gt;</span> <span class="p">{</span>
<span class="o">/*</span><span class="mi">5</span><span class="o">*/</span>   <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">toJsonString</span><span class="p">());</span>
     <span class="p">});</span>
<span class="o">/*</span><span class="mi">6</span><span class="o">*/</span><span class="n">WorkTask</span> <span class="n">wt</span> <span class="o">=</span> <span class="n">new</span> <span class="n">WorkTask</span><span class="p">(</span><span class="n">am</span><span class="p">,</span><span class="n">responseFuture</span><span class="p">);</span>
<span class="o">/*</span><span class="mi">7</span><span class="o">*/</span><span class="n">applMsgQueue</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">wt</span> <span class="p">);</span>
<span class="p">});</span><span class="o">//</span><span class="n">onMessage</span>
</pre></div>
</div>
</td>
<td><ol class="arabic simple">
<li><p>Funzione di calcolo che <em>simula calcoli lunghi</em> in ceri casi</p></li>
<li><p>Handler di gestione di un nuovo messaggio</p></li>
<li><p>Emissione di un evento (per una demo)</p></li>
<li><p>Creazione di una <a class="reference external" href="https://www.baeldung.com/java-completablefuture">CompletableFuture Java</a></p></li>
<li><p>Pianifiicazione dell’azione da compiere quando il <a class="reference internal" href="#worker-thread"><span class="std std-ref">Worker thread message-driven</span></a> ha elaborato la risposta</p></li>
<li><p>Invio della risposta al client</p></li>
<li><p>Creazione del record da inserire nella <em>applMsgQueue</em></p></li>
<li><p>Aggiunta del record <em>WorkTask</em> nella <em>applMsgQueue</em></p></li>
</ol>
</td>
</tr>
</tbody>
</table>
<p><strong>Il nuovo readInputWS</strong></p>
<p>I messaggi si suppongono ricevuti come stringhe Json.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">protected</span> <span class="n">IApplMessage</span> <span class="n">readInputWS</span><span class="p">(</span><span class="n">String</span> <span class="n">message</span><span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">{</span>
  <span class="k">return</span> <span class="n">ApplMessage</span><span class="o">.</span><span class="n">cvtJson</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="emitevent">
<span id="id109"></span><h4>emitEvent<a class="headerlink" href="#emitevent" title="Permalink to this heading">¶</a></h4>
<p>Emmete informazione sulla connessione corrente su cui ha ricevuto il messaggio.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">protected</span> <span class="n">void</span> <span class="n">emitEvent</span><span class="p">(</span><span class="n">String</span> <span class="n">s</span><span class="p">,</span> <span class="n">WsConnectContext</span> <span class="n">ctx</span><span class="p">){</span>
  <span class="n">String</span> <span class="n">event</span> <span class="o">=</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">msg</span><span class="se">\&quot;</span><span class="s2"> : </span><span class="se">\&quot;</span><span class="s2">EV</span><span class="se">\&quot;</span><span class="s2"> }&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;EV&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">);</span>
  <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span> <span class="n">event</span>  <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="emitinfo">
<span id="id110"></span><h4>emitInfo<a class="headerlink" href="#emitinfo" title="Permalink to this heading">¶</a></h4>
<p>Emmete informazione sul tutte le connessioni attive.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">protected</span> <span class="n">void</span> <span class="n">emitInfo</span><span class="p">(</span><span class="n">String</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">allConns</span><span class="o">.</span><span class="n">forEach</span><span class="p">(</span> <span class="p">(</span><span class="n">conn</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">conn</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="worker-thread-message-driven">
<span id="worker-thread"></span><h3>Worker thread message-driven<a class="headerlink" href="#worker-thread-message-driven" title="Permalink to this heading">¶</a></h3>
<p>Tutta la logica applicativa può essere ora espressa da un thread che opera in modo
<strong>message-driven</strong>, ignorando tutti i dettagli relativi alle comunicazioni di rete.</p>
<p>Il thread opera secondo il classico schema <strong>read-evel-print</strong>, e quindi è puramente
‘guidato’ dal fluire dei messaggi in input. Tuttavia può inivare informazioni non richieste (eventi)
sulle connessioni attive.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 55%" />
<col style="width: 45%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">protected</span> <span class="n">void</span> <span class="n">setApplLogicWorker</span><span class="p">()</span> <span class="p">{</span>
<span class="o">/*</span><span class="mi">1</span><span class="o">*/</span><span class="n">new</span> <span class="n">Thread</span><span class="p">(()</span> <span class="o">-&gt;</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
<span class="o">/*</span><span class="mi">2</span><span class="o">*/</span> <span class="n">WorkTask</span> <span class="n">wt</span> <span class="o">=</span> <span class="n">applMsgQueue</span><span class="o">.</span><span class="n">take</span><span class="p">();</span>
<span class="o">/*</span><span class="mi">3</span><span class="o">*/</span><span class="n">IApplMessage</span> <span class="n">inputMsg</span> <span class="o">=</span> <span class="n">wt</span><span class="o">.</span><span class="n">message</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">inputMsg</span><span class="o">.</span><span class="n">isRequest</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
<span class="o">/*</span><span class="mi">4</span><span class="o">*/</span>    <span class="n">doelabRequest</span><span class="p">(</span><span class="n">inputMsg</span><span class="p">,</span><span class="n">wt</span> <span class="p">);</span>
      <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">inputMsg</span><span class="o">.</span><span class="n">isDispatch</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
<span class="o">/*</span><span class="mi">5</span><span class="o">*/</span>   <span class="n">elabDispatch</span><span class="p">(</span><span class="n">inputMsg</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="ne">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
  <span class="p">}</span>
<span class="p">})</span><span class="o">.</span><span class="n">start</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
<td><ol class="arabic simple">
<li><p>Thread che esegue la logica applicativa</p></li>
<li><p>Preleva un elemento dalla <strong>applMsgQueue</strong>, bloccandosi se non esiste</p></li>
<li><p>Seleziona il messaggio ricevuto</p></li>
<li><p>Invoca il meotodo dedicato alla gestione di una <a class="reference internal" href="#tipi-di-messaggi"><span class="std std-ref">request</span></a></p></li>
<li><p>Invoca il meotodo dedicato alla gestione di un <a class="reference internal" href="#tipi-di-messaggi"><span class="std std-ref">dispathc</span></a></p></li>
</ol>
</td>
</tr>
</tbody>
</table>
<section id="doelabrequest">
<span id="id111"></span><h4>doelabRequest<a class="headerlink" href="#doelabrequest" title="Permalink to this heading">¶</a></h4>
<p>La elaborazione di una richiesta viene delagata al metodo <em>elabRequest</em>, che restituisce una <a class="reference internal" href="#tipi-di-messaggi"><span class="std std-ref">reply</span></a>
che viene inviata al client sulla connessione WS ad esso relativa</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">protected</span> <span class="n">void</span> <span class="n">doelabRequest</span><span class="p">(</span><span class="n">IApplMessage</span> <span class="n">req</span><span class="p">,</span> <span class="n">WorkTask</span> <span class="n">wt</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">IApplMessage</span> <span class="n">replyMsg</span> <span class="o">=</span> <span class="n">elabRequest</span><span class="p">(</span><span class="n">req</span><span class="p">);</span>
    <span class="n">wt</span><span class="o">.</span><span class="n">future</span><span class="o">.</span><span class="n">complete</span><span class="p">(</span><span class="n">replyMsg</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>elabRequest</strong></p>
<p>Questo metodo definisce la logica applicativa di gestione di una richiesta,
costruendo una <strong>reply</strong>
senza sapere nulla di come e a chi inviare la risposta.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">protected</span> <span class="n">IApplMessage</span> <span class="n">elabRequest</span><span class="p">(</span><span class="n">IApplMessage</span> <span class="n">req</span>  <span class="p">)</span> <span class="p">{</span>
  <span class="n">double</span> <span class="n">x</span>      <span class="o">=</span> <span class="n">Double</span><span class="o">.</span><span class="n">parseDouble</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">msgContent</span><span class="p">());</span>
  <span class="n">double</span> <span class="n">result</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
  <span class="n">IApplMessage</span> <span class="n">replyMsg</span> <span class="o">=</span>
      <span class="n">CommUtils</span><span class="o">.</span><span class="n">buildReply</span><span class="p">(</span><span class="s2">&quot;server&quot;</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">msgId</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="n">result</span><span class="p">,</span><span class="n">req</span><span class="o">.</span><span class="n">msgSender</span><span class="p">());</span>
    <span class="k">return</span> <span class="n">replyMsg</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>elabDispatch</strong></p>
<p>Questo metodo definisce la logica applicativa di gestione di un <em>dispatch</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">protected</span> <span class="n">void</span> <span class="n">elabDispatch</span><span class="p">(</span><span class="n">IApplMessage</span> <span class="n">m</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">CommUtils</span><span class="o">.</span><span class="n">outblue</span><span class="p">(</span><span class="s2">&quot;ApplLogicThread elabDispatch:&quot;</span> <span class="o">+</span> <span class="n">m</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Utilizzando dispatch e eventi, il sistema può esseere capace
di realizzare una chat tra più client.</p>
</div>
</section>
</section>
<section id="refactoring-dei-client">
<h3>Refactoring dei client<a class="headerlink" href="#refactoring-dei-client" title="Permalink to this heading">¶</a></h3>
<p>Nel package <strong>main.java.javalin</strong>:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 38%" />
<col style="width: 62%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CallerJavaApplMsgReqsynch.java</span></code></p></td>
<td><p>Componente che usa <a class="reference internal" href="#connectionfactory"><span class="std std-ref">ConnectionFactory</span></a> per creare una WsConnection
su cui invia una request in modo sincrono.
Non ha capacità di ricevere informazioni dal server diverse dalla <strong>reply</strong> alla sua richiesta.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CallerJavaApplMsgObserver.java</span></code></p></td>
<td><p>Componente che usa una  WsConnection  su cui invia una request in modo sincrono.
Estende <strong>unibo.basicomm23.utils.ApplAbstractObserver</strong> per operare
come observer dei messaggi non-reply (eventi) emessi dal server</p></td>
</tr>
</tbody>
</table>
<p>Ricordiamo anche i seguenti clienti HTML che usano messaggi definiti come strnghe JSono:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">msgfast</span> <span class="o">=</span> <span class="s1">&#39;{&quot;msgId&quot;:&quot;eval&quot;,&quot;msgType&quot;:&quot;request&quot;,&quot;msgSender&quot;:&quot;client&quot;,</span>
                <span class="s2">&quot;msgReceiver&quot;</span><span class="p">:</span> <span class="s2">&quot;server&quot;</span><span class="p">,</span><span class="s2">&quot;msgContent&quot;</span><span class="p">:</span><span class="s2">&quot;3.0&quot;</span><span class="p">,</span><span class="s2">&quot;msgNum&quot;</span><span class="p">:</span><span class="s2">&quot;0&quot;</span><span class="p">}</span><span class="s1">&#39;</span>

<span class="n">var</span> <span class="n">msglazy</span> <span class="o">=</span> <span class="s1">&#39;{&quot;msgId&quot;:&quot;eval&quot;,&quot;msgType&quot;:&quot;request&quot;,&quot;msgSender&quot;:&quot;client&quot;,</span>
                <span class="s2">&quot;msgReceiver&quot;</span><span class="p">:</span> <span class="s2">&quot;server&quot;</span><span class="p">,</span><span class="s2">&quot;msgContent&quot;</span><span class="p">:</span><span class="s2">&quot;5.0&quot;</span><span class="p">,</span><span class="s2">&quot;msgNum&quot;</span><span class="p">:</span><span class="s2">&quot;0&quot;</span><span class="p">}</span><span class="s1">&#39;</span>
</pre></div>
</div>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 38%" />
<col style="width: 62%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CallerBasicApplMsgsFast.html</span></code></p></td>
<td><p>Codice JS che invia una stringa strutturata come un <a class="reference internal" href="#applmessage"><span class="std std-ref">ApplMessage</span></a> per il calcolo di
un valore che il servizio effettua velocemente (<em>msgfast</em>)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CallerBasicApplMsgsLazy.html</span></code></p></td>
<td><p>Codice JS che invia una stringa strutturata come un <a class="reference internal" href="#applmessage"><span class="std std-ref">ApplMessage</span></a> e per il calcolo di
un valore che il servizio effettua lentamente</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="interazioni-locali">
<span id="id112"></span><h2>Interazioni locali<a class="headerlink" href="#interazioni-locali" title="Permalink to this heading">¶</a></h2>
<p>La classe dichiara di implementare la interfaccia <a class="reference internal" href="#interactionbasic"><span class="std std-ref">InteractionBasic</span></a>.
Essa deve quindi defiire metodi che permettono anche a un componente locale
(che gira nella stessa JVM) di inviare messaggi</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">SistemaSJavalApplMsgsQueued</span> <span class="n">implements</span> <span class="n">InteractionBasic</span><span class="p">{</span>
  <span class="n">protected</span> <span class="n">IApplMessage</span> <span class="n">reply</span><span class="o">=</span><span class="n">null</span><span class="p">;</span>
  <span class="o">...</span>
  <span class="nd">@Override</span>
  <span class="n">public</span> <span class="n">void</span> <span class="n">forward</span><span class="p">(</span><span class="n">IApplMessage</span> <span class="n">msg</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">WorkTask</span> <span class="n">wt</span> <span class="o">=</span> <span class="n">new</span> <span class="n">WorkTask</span><span class="p">(</span> <span class="n">msg</span><span class="p">,</span> <span class="n">null</span> <span class="p">);</span>
              <span class="n">applMsgQueue</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">wt</span> <span class="p">);</span>
  <span class="p">}</span>

  <span class="nd">@Override</span>
  <span class="n">public</span> <span class="n">IApplMessage</span> <span class="n">request</span><span class="p">(</span> <span class="n">IApplMessage</span> <span class="n">msg</span> <span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">msg</span><span class="o">.</span><span class="n">isRequest</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span> <span class="o">//</span><span class="n">defensive</span>
      <span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">IApplMessage</span><span class="o">&gt;</span> <span class="n">responseFuture</span> <span class="o">=</span> <span class="n">new</span> <span class="n">CompletableFuture</span><span class="o">&lt;&gt;</span><span class="p">();</span>
      <span class="n">WorkTask</span> <span class="n">wt</span> <span class="o">=</span> <span class="n">new</span> <span class="n">WorkTask</span><span class="p">(</span> <span class="n">msg</span><span class="p">,</span> <span class="n">responseFuture</span> <span class="p">);</span>
      <span class="n">applMsgQueue</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">wt</span> <span class="p">);</span>
      <span class="k">return</span> <span class="n">responseFuture</span><span class="o">.</span><span class="n">get</span><span class="p">();</span>
    <span class="p">}</span><span class="k">else</span> <span class="n">throw</span> <span class="n">new</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Msg not a request&quot;</span><span class="p">);</span>
  <span class="p">};</span>

   <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In questo modo è possibile inviare messaggi usando la memoria, senza dover fare ricorso alla rete.
Ad esempio (package <strong>main.java.javalin</strong>):</p>
<section id="calleronmemory">
<span id="id113"></span><h3>CallerOnMemory<a class="headerlink" href="#calleronmemory" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">CallerOnMemory</span>  <span class="p">{</span>
    <span class="n">private</span> <span class="n">SistemaSJavalApplMsgsQueued</span> <span class="n">server</span><span class="p">;</span>

    <span class="n">public</span> <span class="n">CallerOnMemory</span><span class="p">(</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">server</span> <span class="o">=</span> <span class="n">new</span> <span class="n">SistemaSJavalApplMsgsQueued</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">doJob</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">CommUtils</span><span class="o">.</span><span class="n">outblue</span><span class="p">(</span><span class="s2">&quot;doJob  ...&quot;</span><span class="p">);</span>
      <span class="n">String</span> <span class="n">startMsg</span> <span class="o">=</span> <span class="s2">&quot;msg(cmd,dispatch,callerinmem,server,start,0)&quot;</span><span class="p">;</span>
<span class="o">/*</span><span class="mi">1</span><span class="o">*/</span> <span class="n">server</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">new</span> <span class="n">ApplMessage</span><span class="p">(</span><span class="n">startMsg</span><span class="p">));</span>

<span class="o">/*</span><span class="mi">2</span><span class="o">*/</span> <span class="n">new</span> <span class="n">Thread</span><span class="p">()</span> <span class="p">{</span>
       <span class="n">public</span> <span class="n">void</span> <span class="n">run</span><span class="p">()</span> <span class="p">{</span>
               <span class="k">try</span> <span class="p">{</span>
                       <span class="n">String</span> <span class="n">reqMsg</span> <span class="o">=</span> <span class="s2">&quot;msg(eval,request,callerinmem,server,5.0,0)&quot;</span><span class="p">;</span>
                       <span class="n">IApplMessage</span> <span class="n">answer</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">new</span> <span class="n">ApplMessage</span><span class="p">(</span><span class="n">reqMsg</span><span class="p">));</span>
                       <span class="n">CommUtils</span><span class="o">.</span><span class="n">outblue</span><span class="p">(</span><span class="s2">&quot;answer=&quot;</span> <span class="o">+</span> <span class="n">answer</span><span class="p">);</span>
               <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="ne">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span> <span class="n">e</span><span class="o">.</span><span class="n">printStackTrace</span><span class="p">();</span> <span class="p">}</span>
       <span class="p">}</span>
   <span class="p">}</span><span class="o">.</span><span class="n">start</span><span class="p">();</span>

<span class="o">/*</span><span class="mi">3</span><span class="o">*/</span> <span class="n">new</span> <span class="n">Thread</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">public</span> <span class="n">void</span> <span class="n">run</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">try</span> <span class="p">{</span>
            <span class="n">String</span> <span class="n">reqMsg</span> <span class="o">=</span> <span class="s2">&quot;msg(eval,request,callerinmem,server,4.0,0)&quot;</span><span class="p">;</span>
            <span class="n">IApplMessage</span> <span class="n">answer</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">new</span> <span class="n">ApplMessage</span><span class="p">(</span><span class="n">reqMsg</span><span class="p">));</span>
            <span class="n">CommUtils</span><span class="o">.</span><span class="n">outgreen</span><span class="p">(</span><span class="s2">&quot;answer=&quot;</span> <span class="o">+</span> <span class="n">answer</span><span class="p">);</span>
          <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="ne">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span> <span class="n">e</span><span class="o">.</span><span class="n">printStackTrace</span><span class="p">();</span> <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span><span class="o">.</span><span class="n">start</span><span class="p">();</span>

    <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;Java.version=&quot;</span><span class="o">+</span> <span class="n">System</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s2">&quot;java.version&quot;</span><span class="p">));</span>
      <span class="n">new</span> <span class="n">CallerOnMemory</span><span class="p">(</span> <span class="p">)</span><span class="o">.</span><span class="n">doJob</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Il caller :</p>
<ol class="arabic simple">
<li><p>lancia un thread per la richiesta di un valore che richiede un tempo lungo di elaborazione</p></li>
<li><p>lancia un thread per la richiesta di un valore che richiede un tempo breve di elaborazione</p></li>
</ol>
<p>Come risposte, si vede per prima quella relativa alla elaborazione con tempo breve:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">server</span> <span class="o">|</span> <span class="n">invia</span> <span class="n">risposta</span> <span class="n">a</span> <span class="n">eval4</span><span class="mf">.0</span><span class="o">=</span><span class="n">msg</span><span class="p">(</span><span class="nb">eval</span><span class="p">,</span><span class="n">reply</span><span class="p">,</span><span class="n">server</span><span class="p">,</span><span class="n">callerinmem</span><span class="p">,</span><span class="mf">0.042286496169391286</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">answer</span><span class="o">=</span><span class="n">msg</span><span class="p">(</span><span class="nb">eval</span><span class="p">,</span><span class="n">reply</span><span class="p">,</span><span class="n">server</span><span class="p">,</span><span class="n">callerinmem</span><span class="p">,</span><span class="mf">0.042286496169391286</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">server</span> <span class="o">|</span> <span class="n">invia</span> <span class="n">risposta</span> <span class="n">a</span> <span class="n">eval5</span><span class="mf">.0</span><span class="o">=</span><span class="n">msg</span><span class="p">(</span><span class="nb">eval</span><span class="p">,</span><span class="n">reply</span><span class="p">,</span><span class="n">server</span><span class="p">,</span><span class="n">callerinmem</span><span class="p">,</span><span class="o">-</span><span class="mf">1.6806362513254687</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">answer</span><span class="o">=</span><span class="n">msg</span><span class="p">(</span><span class="nb">eval</span><span class="p">,</span><span class="n">reply</span><span class="p">,</span><span class="n">server</span><span class="p">,</span><span class="n">callerinmem</span><span class="p">,</span><span class="o">-</span><span class="mf">1.6806362513254687</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="un-servizio-per-comunicazioni-pub-sub">
<h2>Un servizio per comunicazioni pub/sub<a class="headerlink" href="#un-servizio-per-comunicazioni-pub-sub" title="Permalink to this heading">¶</a></h2>
<p>Fino ad ora abbiamo assunto che l’unico modo di comunicare con il sistemaS sia l’uso di un protcollo punto-a-punto
(WS o HTTP).</p>
<p>Ma la tecnologia rende disponibili anche forme di interconnessione di tipo publish-subsribe basate su protcolli
come MQTT e su servizi detti <strong>MQTT-broker</strong>. Qui si disnguono due livelli di comunicazione:</p>
<ul class="simple">
<li><p><strong>Livello di Trasporto</strong> (<em>Punto-a-Punto</em>): Si stabilisce una connessione tramite TCP o WebSocket) on il Broker.</p></li>
<li><p><strong>Livello Applicativo</strong> (<em>Publish-Subscribe</em>): Una volta connessi , si ‘parla’ <strong>attraverso il Broker</strong> usando i <strong>Topic</strong>.</p></li>
</ul>
<p>Una <strong>Topic</strong> è una sorta di ‘etichetta’ (ad es.``sensori/temperatura``) su cui chi è interessato a trasmettere
informazioni fa una <strong>pubblish</strong> e chi è interessato a ricevere fa una <strong>subscribe</strong>.</p>
<p>Per effettuare operazioni publish/subscribe usando un Broker MQTT, usiamo la liberia <strong>org.eclipse.paho.client.mqttv3</strong>
che contiene la classe <strong>MqttClient</strong>. Ad esempio:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Connessione</span> <span class="n">Punto</span><span class="o">-</span><span class="n">a</span><span class="o">-</span><span class="n">Punto</span> <span class="n">al</span> <span class="n">Broker</span>
<span class="n">MqttClient</span> <span class="n">client</span> <span class="o">=</span> <span class="n">new</span> <span class="n">MqttClient</span><span class="p">(</span><span class="s2">&quot;tcp://broker.hivemq.com:1883&quot;</span><span class="p">,</span> <span class="s2">&quot;ClientID&quot;</span><span class="p">);</span>
<span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">();</span>

<span class="o">//</span> <span class="n">Comunicazione</span> <span class="n">Pub</span><span class="o">/</span><span class="n">Sub</span>
<span class="n">client</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s2">&quot;sistemaS/risposte&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">{</span>
    <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;Ricevuto in modo asincrono: &quot;</span> <span class="o">+</span> <span class="n">new</span> <span class="n">String</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">getPayload</span><span class="p">()));</span>
<span class="p">});</span>

<span class="n">client</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="s2">&quot;sistemaS/richieste&quot;</span><span class="p">,</span> <span class="n">new</span> <span class="n">MqttMessage</span><span class="p">(</span><span class="s2">&quot;4.0&quot;</span><span class="o">.</span><span class="n">getBytes</span><span class="p">()));</span>
</pre></div>
</div>
<p>MQTT è un sistema asincrono - publisher e subscriber sono indipendenti</p>
<ul>
<li><p>Il Publisher può pubblicare anche se nessuno è in ascolto (nessun errore)</p></li>
<li><p>Il Subscriber riceverà solo i messaggi pubblicati dopo la sua sottoscrizione</p>
<p>ECCEZIONE: se i messaggi sono pubblicati con opzione <strong>retained=true</strong>,
il Subscriber riceverà l’ultimo messaggio retained anche se pubblicato prima</p>
</li>
</ul>
<section id="mqttconnectoptions">
<h3>MqttConnectOptions<a class="headerlink" href="#mqttconnectoptions" title="Permalink to this heading">¶</a></h3>
<p>Questa classe permette di configurare parametri del servizio inerenti la sicurezza e
la logica di sopravvivenza della connessione.</p>
<ul class="simple">
<li><p>Clean Session</p>
<ul>
<li><p><strong>options.setCleanSession(true)</strong>: Ogni collegamento è un nuovo inizio. Il Broker elimina eventuali messaggi non consegnati e le vecchie sottoscrizioni.</p></li>
<li><p><strong>options.setCleanSession(false)</strong>: Il Broker mantiene la sessione. Se questa cade e poi torna online, si ritrovano tutti i messaggi
che sono arrivati sui topic (se inviati con <a class="reference internal" href="#qos-di-mqtt"><span class="std std-ref">QoS</span></a> <strong>1</strong> o <strong>2</strong>) mentre si era offline .</p></li>
</ul>
</li>
<li><p>Last Will and Testament (<strong>LWT</strong> - Il Testamento)</p>
<ul>
<li><p><strong>options.setWill(lastWillTopic, payload, 1, true)</strong>: // QoS 1, Retained
Un client A dice al broker:Se muoio improvvisamente (crash, perdita di segnale), pubblica questo messaggio per me.
In questo modo, gli  altri componenti del sistema sapranno subito che A non è più disponibile.</p></li>
</ul>
</li>
<li><p>Keep Alive (Il battito cardiaco)</p>
<ul>
<li><p><strong>options.setKeepAliveInterval(30)</strong>: Definisce l’intervallo di tempo (in secondi) entro il quale il client deve inviare
un segnale al Broker per confermare di essere ancora vivo.</p></li>
</ul>
</li>
<li><p>Connection Timeout</p>
<ul>
<li><p><strong>options.setConnectionTimeout(10)</strong>: Indica quanto tempo il client deve aspettare che il Broker risponda alla richiesta di
connessione prima di arrendersi e lanciare un’eccezione.</p></li>
</ul>
</li>
</ul>
<p><strong>Esempio</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.eclipse.paho.client.mqttv3.</span><span class="o">*</span><span class="p">;</span>
<span class="n">MqttConnectOptions</span> <span class="n">options</span> <span class="o">=</span> <span class="n">new</span> <span class="n">MqttConnectOptions</span><span class="p">();</span>

<span class="o">//</span> <span class="n">Sicurezza</span>
<span class="n">options</span><span class="o">.</span><span class="n">setUserName</span><span class="p">(</span><span class="s2">&quot;il_tuo_utente&quot;</span><span class="p">);</span>
<span class="n">options</span><span class="o">.</span><span class="n">setPassword</span><span class="p">(</span><span class="s2">&quot;la_tua_password&quot;</span><span class="o">.</span><span class="n">toCharArray</span><span class="p">());</span>

<span class="o">//</span> <span class="n">Logica</span> <span class="n">di</span> <span class="n">sessione</span>
<span class="n">options</span><span class="o">.</span><span class="n">setCleanSession</span><span class="p">(</span><span class="n">false</span><span class="p">);</span> <span class="o">//</span> <span class="n">Mantieni</span> <span class="n">i</span> <span class="n">messaggi</span> <span class="n">se</span> <span class="n">cado</span>
<span class="n">options</span><span class="o">.</span><span class="n">setKeepAliveInterval</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span> <span class="o">//</span> <span class="n">Controllo</span> <span class="n">ogni</span> <span class="mi">30</span> <span class="n">secondi</span>
<span class="n">options</span><span class="o">.</span><span class="n">setConnectionTimeout</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

<span class="o">//</span> <span class="n">Proattività</span><span class="p">:</span> <span class="n">Il</span> <span class="n">Testamento</span>
<span class="n">String</span> <span class="n">lastWillTopic</span> <span class="o">=</span> <span class="s2">&quot;status/componenteA&quot;</span><span class="p">;</span>
<span class="n">byte</span><span class="p">[]</span> <span class="n">payload</span> <span class="o">=</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">alive</span><span class="se">\&quot;</span><span class="s2">: false}&quot;</span><span class="o">.</span><span class="n">getBytes</span><span class="p">();</span>
<span class="n">options</span><span class="o">.</span><span class="n">setWill</span><span class="p">(</span><span class="n">lastWillTopic</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">true</span><span class="p">);</span> <span class="o">//</span><span class="n">QoS</span> <span class="mi">1</span><span class="p">:</span><span class="n">Retained</span>

<span class="o">//</span> <span class="n">Ora</span> <span class="n">connetti</span>
<span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">options</span><span class="p">);</span>


<span class="n">OPZIONI</span> <span class="n">DI</span> <span class="n">CONNESSIONE</span><span class="p">:</span>
<span class="n">options</span><span class="o">.</span><span class="n">setCleanSession</span><span class="p">(</span><span class="n">true</span><span class="p">);</span>              <span class="o">//</span> <span class="n">true</span> <span class="o">=</span> <span class="n">non</span> <span class="n">mantiene</span> <span class="n">sessione</span>
<span class="n">options</span><span class="o">.</span><span class="n">setAutomaticReconnect</span><span class="p">(</span><span class="n">true</span><span class="p">);</span>        <span class="o">//</span> <span class="n">riconnessione</span> <span class="n">automatica</span>
<span class="n">options</span><span class="o">.</span><span class="n">setConnectionTimeout</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>           <span class="o">//</span> <span class="n">timeout</span> <span class="ow">in</span> <span class="n">secondi</span>
<span class="n">options</span><span class="o">.</span><span class="n">setKeepAliveInterval</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>           <span class="o">//</span> <span class="n">keep</span><span class="o">-</span><span class="n">alive</span> <span class="ow">in</span> <span class="n">secondi</span>
<span class="n">options</span><span class="o">.</span><span class="n">setUserName</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">);</span>            <span class="o">//</span> <span class="n">autenticazione</span>
<span class="n">options</span><span class="o">.</span><span class="n">setPassword</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="o">.</span><span class="n">toCharArray</span><span class="p">());</span>
<span class="n">options</span><span class="o">.</span><span class="n">setWill</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">qos</span><span class="p">,</span> <span class="n">retained</span><span class="p">);</span> <span class="o">//</span> <span class="n">Last</span> <span class="n">Will</span> <span class="n">Testament</span>
</pre></div>
</div>
</section>
<section id="qos-di-mqtt">
<span id="id114"></span><h3>QoS di MQTT<a class="headerlink" href="#qos-di-mqtt" title="Permalink to this heading">¶</a></h3>
<p>MQTT definisce tre livelli di <em>Qualità del Servizio` (**QoS*</em>), che influenzano la garanzia
di consegna dei messaggi:</p>
<ol class="arabic">
<li><p><strong>QoS 0</strong> (<em>At most once</em>):</p>
<blockquote>
<div><ul class="simple">
<li><p>Questo è il livello “fire-and-forget”.</p></li>
<li><p>Il messaggio viene inviato una volta, senza alcuna conferma di ricezione.</p></li>
<li><p>Non c’è garanzia che il messaggio raggiunga il destinatario.</p></li>
<li><p>È il livello più veloce e leggero, ma anche il meno affidabile.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>QoS 1</strong> (<em>At least once</em>):</p>
<blockquote>
<div><ul class="simple">
<li><p>Il messaggio viene inviato almeno una volta.</p></li>
<li><p>Il mittente conserva una copia del messaggio fino a quando non riceve una conferma (PUBACK) dal destinatario.</p></li>
<li><p>Se la conferma non arriva, il messaggio viene reinviato.</p></li>
<li><p>Garantisce che il messaggio venga consegnato, ma possono verificarsi duplicati.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>QoS 2</strong> (<em>Exactly once</em>):</p>
<blockquote>
<div><ul class="simple">
<li><p>Il messaggio viene consegnato esattamente una volta.</p></li>
<li><p>Utilizza un protocollo di handshake a quattro vie per garantire che il messaggio venga consegnato senza duplicati.</p></li>
<li><p>È il livello più affidabile, ma anche il più lento e complesso.</p></li>
</ul>
</div></blockquote>
</li>
</ol>
<p><strong>Esempi proposti da Claude</strong></p>
<ul class="simple">
<li><p>main.java.mqtt.claude.MqttSubscriber.java</p></li>
<li><p>main.java.mqtt.claude.MqttPublisher.java</p></li>
</ul>
</section>
<section id="mqttsender">
<h3>MqttSender<a class="headerlink" href="#mqttsender" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">main</span><span class="o">.</span><span class="n">java</span><span class="o">.</span><span class="n">mqtt</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.eclipse.paho.client.mqttv3.MqttClient</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.eclipse.paho.client.mqttv3.MqttConnectOptions</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.eclipse.paho.client.mqttv3.MqttException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.eclipse.paho.client.mqttv3.MqttMessage</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">unibo.basicomm23.interfaces.IApplMessage</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">unibo.basicomm23.utils.CommUtils</span><span class="p">;</span>

<span class="n">public</span> <span class="k">class</span> <span class="nc">MqttSender</span> <span class="p">{</span>


  <span class="n">public</span> <span class="n">void</span> <span class="n">doJob</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">String</span> <span class="n">broker</span> <span class="o">=</span> <span class="s2">&quot;tcp://broker.hivemq.com&quot;</span><span class="p">;</span>
  <span class="n">String</span> <span class="n">clientId</span> <span class="o">=</span> <span class="s2">&quot;sender&quot;</span><span class="p">;</span>
  <span class="n">IApplMessage</span> <span class="n">msgEvent</span> <span class="o">=</span> <span class="n">CommUtils</span><span class="o">.</span><span class="n">buildEvent</span><span class="p">(</span><span class="n">clientId</span><span class="p">,</span> <span class="s2">&quot;alarm&quot;</span><span class="p">,</span> <span class="s2">&quot;alarm(fire)&quot;</span> <span class="p">);</span>
  <span class="k">try</span> <span class="p">{</span>
      <span class="n">MqttClient</span> <span class="n">client</span> <span class="o">=</span> <span class="n">new</span> <span class="n">MqttClient</span><span class="p">(</span><span class="n">broker</span><span class="p">,</span> <span class="n">clientId</span><span class="p">);</span>
      <span class="n">MqttConnectOptions</span> <span class="n">connOpts</span> <span class="o">=</span> <span class="n">new</span> <span class="n">MqttConnectOptions</span><span class="p">();</span>
      <span class="n">connOpts</span><span class="o">.</span><span class="n">setCleanSession</span><span class="p">(</span><span class="n">true</span><span class="p">);</span>

      <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">connOpts</span><span class="p">);</span>

      <span class="o">//</span> <span class="n">Pubblica</span> <span class="n">messaggio</span>
      <span class="n">String</span> <span class="n">topic</span>   <span class="o">=</span> <span class="s2">&quot;unibo/receiver/topic&quot;</span><span class="p">;</span>
      <span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">msgEvent</span><span class="o">.</span><span class="n">toString</span><span class="p">();</span>
      <span class="nb">int</span> <span class="n">qos</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
      <span class="n">MqttMessage</span> <span class="n">message</span> <span class="o">=</span> <span class="n">new</span> <span class="n">MqttMessage</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">getBytes</span><span class="p">());</span>
      <span class="n">message</span><span class="o">.</span><span class="n">setQos</span><span class="p">(</span><span class="n">qos</span><span class="p">);</span>
      <span class="n">client</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span>

        <span class="o">//</span> <span class="n">Disconnetti</span>
        <span class="n">client</span><span class="o">.</span><span class="n">disconnect</span><span class="p">();</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">MqttException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">CommUtils</span><span class="o">.</span><span class="n">outred</span><span class="p">(</span><span class="s2">&quot;Error: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="n">getMessage</span><span class="p">());</span>
    <span class="p">}</span>

  <span class="p">}</span>

  <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">new</span> <span class="n">MqttSender</span><span class="p">()</span><span class="o">.</span><span class="n">doJob</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="mqttreceiver">
<h3>MqttReceiver<a class="headerlink" href="#mqttreceiver" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">main</span><span class="o">.</span><span class="n">java</span><span class="o">.</span><span class="n">mqtt</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.CountDownLatch</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.eclipse.paho.client.mqttv3.MqttClient</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.eclipse.paho.client.mqttv3.MqttConnectOptions</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">unibo.basicomm23.utils.CommUtils</span><span class="p">;</span>

<span class="n">public</span> <span class="k">class</span> <span class="nc">MqttReceiver</span> <span class="p">{</span>
    <span class="n">private</span> <span class="n">CountDownLatch</span> <span class="n">latch</span> <span class="o">=</span> <span class="n">new</span> <span class="n">CountDownLatch</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>


  <span class="n">public</span> <span class="n">void</span> <span class="n">doJob</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">String</span> <span class="n">broker</span> <span class="o">=</span> <span class="s2">&quot;tcp://broker.hivemq.com&quot;</span><span class="p">;</span>
  <span class="n">String</span> <span class="n">clientId</span> <span class="o">=</span> <span class="s2">&quot;receiver&quot;</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
      <span class="n">MqttClient</span> <span class="n">client</span> <span class="o">=</span> <span class="n">new</span> <span class="n">MqttClient</span><span class="p">(</span><span class="n">broker</span><span class="p">,</span> <span class="n">clientId</span><span class="p">);</span>
      <span class="n">MqttConnectOptions</span> <span class="n">connOpts</span> <span class="o">=</span> <span class="n">new</span> <span class="n">MqttConnectOptions</span><span class="p">();</span>
      <span class="n">connOpts</span><span class="o">.</span><span class="n">setCleanSession</span><span class="p">(</span><span class="n">true</span><span class="p">);</span>
      <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">connOpts</span><span class="p">);</span>

      <span class="o">//</span> <span class="n">Subscribe</span>
      <span class="n">String</span> <span class="n">topic</span> <span class="o">=</span> <span class="s2">&quot;unibo/receiver/topic&quot;</span><span class="p">;</span>
      <span class="n">client</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">{</span>
        <span class="n">CommUtils</span><span class="o">.</span><span class="n">outmagenta</span><span class="p">(</span><span class="s2">&quot;Ricevuto su topic:&quot;</span> <span class="o">+</span> <span class="n">t</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="n">new</span> <span class="n">String</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">getPayload</span><span class="p">()));</span>
        <span class="n">latch</span><span class="o">.</span><span class="n">countDown</span><span class="p">();</span>
      <span class="p">});</span>
      <span class="n">latch</span><span class="o">.</span><span class="k">await</span><span class="p">();</span> <span class="o">//</span> <span class="n">Aspetta</span> <span class="n">di</span> <span class="n">ricevere</span> <span class="n">il</span> <span class="n">messaggio</span>
      <span class="o">//</span> <span class="n">Disconnetti</span>
      <span class="n">client</span><span class="o">.</span><span class="n">disconnect</span><span class="p">();</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span> <span class="ne">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">CommUtils</span><span class="o">.</span><span class="n">outred</span><span class="p">(</span><span class="s2">&quot;Error: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="n">getMessage</span><span class="p">());</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">new</span> <span class="n">MqttReceiver</span><span class="p">()</span><span class="o">.</span><span class="n">doJob</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="mqttsupport">
<span id="id115"></span><h3>MqttSupport<a class="headerlink" href="#mqttsupport" title="Permalink to this heading">¶</a></h3>
<p>Lo scopo della classe  <strong>MqttSupport</strong> delle libreria <a class="reference internal" href="#unibo-basicomm23-1-0"><span class="std std-ref">unibo.basicomm23-1.0</span></a> è <strong>nasconder</strong>  i dettagli relativi
all’uso di <strong>MqttClient</strong> di Paho,
realizzanso operazioni più vicine al livello di astrazione applicativo:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 2%" />
<col style="width: 98%" />
</colgroup>
<tbody>
<tr class="row-odd"><td></td>
<td><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kt">boolean</span> <span class="nf">connectToBroker</span><span class="p">(</span><span class="n">String</span> <span class="n">clientid</span><span class="p">,</span>  <span class="n">String</span> <span class="n">brokerAddr</span><span class="p">)</span>
<span class="kt">void</span> <span class="nf">disconnect</span><span class="p">()</span>
<span class="kt">void</span> <span class="nf">cleartopic</span><span class="p">(</span><span class="n">String</span> <span class="n">topic</span><span class="p">)</span>
<span class="kt">void</span> <span class="nf">subscribe</span> <span class="p">(</span> <span class="n">String</span> <span class="n">topic</span><span class="p">,</span> <span class="n">MqttCallback</span> <span class="n">handler</span><span class="p">)</span>
<span class="kt">void</span> <span class="nf">unsubscribe</span><span class="p">(</span> <span class="n">String</span> <span class="n">topic</span> <span class="p">)</span>
<span class="kt">void</span> <span class="nf">publish</span><span class="p">(</span><span class="n">String</span> <span class="n">topic</span><span class="p">,</span> <span class="n">String</span> <span class="n">msg</span> <span class="p">)</span>
<span class="kt">void</span> <span class="nf">publish</span><span class="p">(</span><span class="n">String</span> <span class="n">topic</span><span class="p">,</span> <span class="n">String</span> <span class="n">msg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">qos</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">retain</span><span class="p">)</span>
<span class="kt">void</span> <span class="nf">publish</span><span class="p">(</span> <span class="n">String</span> <span class="n">topic</span><span class="p">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">payload</span><span class="p">,</span> <span class="kt">int</span> <span class="n">qos</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">retain</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
<section id="non-solo-eventi">
<h3>Non solo eventi<a class="headerlink" href="#non-solo-eventi" title="Permalink to this heading">¶</a></h3>
<p>Il protocollo MQTT nasce con l’idea che le informazioni emesse (<em>published</em>) su una topic
da un componente software sono (nella nostra  <a class="reference internal" href="#tipi-di-messaggi"><span class="std std-ref">terminologia</span></a>) <strong>eventi</strong>
che qualche altro componente (i <em>subscribers</em>) può percepire ed elaborare.</p>
<p>Ma nelle nostre applicazioni può essere utile usare MQTT anche per inviare <strong>dispatch</strong> e <strong>request</strong>.
In questi casi, il sender si aspetta che:</p>
<p>Nel caso di <strong>request</strong> il sender si aspetta che:</p>
<ul>
<li><p>il messaggio venga percepito da un solo componente: quello il cui nome è specificato come
destinatario del messaggio. A questo fine si può supporre che ogni componente software (diciamo <strong>A</strong>)
operi come unico subscriber di una specifica topic (diciamo <strong>topic_A</strong>)</p></li>
<li><p>nel caso di <strong>request</strong>, il <em>publisher</em> si aspetta che il destinaraio gli invii una <strong>reply</strong> e che
questa non venga percpeita da altri componenti.</p>
<p>A questo fine, si potrebbe introdurre il nome di una topic di risposta nel messaggio
di richiesta. Ma noi non vogliamo modificare i messaggi di request per questa esigenza;
faremo invece ricorso a un approccio ‘implicito’ specifico per la comunicazioni via MQTT:
il concetto di <span class="xref std std-ref">replyTopic</span>.</p>
</li>
</ul>
<section id="replytopic">
<h4>replyTopic<a class="headerlink" href="#replytopic" title="Permalink to this heading">¶</a></h4>
<p>Un componente che riceve un <em>message</em> di tipo <strong>request</strong> da un componente di nome
<strong>X</strong>, invia la <em>reply</em>
su una topic il cui nome è strutturato come segue:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">replyTopic</span> <span class="o">=</span> <span class="s2">&quot;answ_&quot;</span> <span class="o">+</span> <span class="n">message</span><span class="o">.</span><span class="n">msgId</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span> <span class="n">message</span><span class="o">.</span><span class="n">msgSender</span><span class="p">()</span> <span class="p">;</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>La struttura <code class="docutils literal notranslate"><span class="pre">answ_&quot;</span> <span class="pre">+</span> <span class="pre">reqid</span> <span class="pre">+</span> <span class="pre">&quot;_&quot;</span> <span class="pre">+</span> <span class="pre">X</span></code> ha tre grandi vantaggi:</p>
<ul class="simple">
<li><p><em>Isolamento</em>: Il componente <strong>X</strong> riceve su quel topic solo ed esclusivamente la risposta
a quella specifica richiesta. Non deve scorrere una lista di messaggi per trovare quello giusto.</p></li>
<li><p><em>Identità</em>: Includendo <strong>X</strong> nel nome del topic, si semplifica il debug. Guardando il broker,
si capisce immediatamente chi sta aspettando cosa.</p></li>
<li><p><em>Sicurezza</em>: Usando  le ACL (Access Control Lists) del broker,
si può fare in modo che solo A possa leggere da quel topic, proteggendo il dato.</p></li>
</ul>
</li>
<li><p>Il problema del “Topic Churn” e del “Leak” delle sottoscrizioni
C’è una sfida tecnica importante: se si inviano 1000 richieste, si creano 1000 topic di reply
e il publisher dovrà ricordarsi si fare <strong>UNSUBSCRIBE</strong> su ciascuna di esse.</p></li>
</ol>
<blockquote>
<div><p>Se si dimentica la <em>unsubscribe</em>, si può verificare un <strong>Subscription Leak</strong>:
il Broker continua a tenere in memoria numerose
sottoscrizioni vuote, rallentando le prestazioni.</p>
</div></blockquote>
</section>
</section>
<section id="response-topic">
<h3>Response Topic<a class="headerlink" href="#response-topic" title="Permalink to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Dal 2019 (con MQTT 5), il protocollo ha introdotto la logica di “Response Topic” nativamente nei
Properties del pacchetto,
senza dover “sporcare” il contenuto del messaggio (il payload).</p>
<ul class="simple">
<li><p>Invece di scrivere l’indirizzo di risposta nel JSON, lo si mette nell’header del protocollo:</p></li>
<li><p>Il componente che riceve, quando riceve il messaggio, non deve nemmeno guardare il JSON
per sapere dove rispondere: prende il valore dall’header Response Topic e pubblica lì.</p></li>
</ul>
</div>
</section>
</section>
<section id="mqttinteraction">
<h2>MqttInteraction<a class="headerlink" href="#mqttinteraction" title="Permalink to this heading">¶</a></h2>
<p>L’uso diretto della libreria Paho o di <a class="reference internal" href="#mqttsupport"><span class="std std-ref">MqttSupport</span></a>
fornisce operazioni di tipo publish/subscribe su una topic, senza imporre vincoli.
Ad esempio, un client può pubblicare messaggi su una topic, e anche registrarsi come subscriber sulla stessa topic,
con la conseguenza che il messaggio pubblicato viene ricevuto anche dal mittente.
Ciò può costituire una opportunità, ma anche fonte di complicazione nel codice che voglia evitare
la gestione dei messaggi inviati dalla sorgente.</p>
<p>Può essere quindi utile introdurre classi che forniscano un’interfaccia più semplice
e coerente per la comunicazione tra due agenti,
in cui uno fa da sender e l’altro da receiver.</p>
<a class="reference internal image-reference" href="_images/mqttinteractionSenderReceiiver.png"><img alt="_images/mqttinteractionSenderReceiiver.png" class="align-center" src="_images/mqttinteractionSenderReceiiver.png" style="width: 80%;" /></a>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">Il</span> <span class="n">sender</span>  <span class="n">dichieara</span><span class="p">:</span>
<span class="n">MqttInteraction</span> <span class="n">mqttConn</span> <span class="o">=</span>
  <span class="n">new</span> <span class="n">MqttInteraction</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>  <span class="n">MqttBroker</span><span class="p">,</span> <span class="s2">&quot;senderIn&quot;</span><span class="p">,</span> <span class="s2">&quot;receiverIn&quot;</span><span class="p">);</span>

<span class="o">//</span><span class="n">Il</span> <span class="n">receiver</span> <span class="n">dichieara</span><span class="p">:</span>
<span class="n">MqttInteraction</span> <span class="n">mqttConn</span> <span class="o">=</span>
  <span class="n">new</span> <span class="n">MqttInteraction</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>  <span class="n">MqttBroker</span><span class="p">,</span> <span class="s2">&quot;receiverIn&quot;</span><span class="p">,</span> <span class="s2">&quot;senderIn&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Esempio con MqttInteraction</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">main.java.mqttInteraction.MqttAgents</span></code></p></li>
</ul>
</section>
</section>
<section id="una-gui-html-per-game-of-life">
<span id="id116"></span><h1>Una GUI HTML per Game of Life<a class="headerlink" href="#una-gui-html-per-game-of-life" title="Permalink to this heading">¶</a></h1>
<section id="conwaygui-analisi-del-problema">
<h2>conwaygui: analisi del problema<a class="headerlink" href="#conwaygui-analisi-del-problema" title="Permalink to this heading">¶</a></h2>
<p>Per affrontare l’analisi del problema, introduciamo opportune domande. Ad esempio:</p>
<p>La GUI deve essere una pagina <code class="docutils literal notranslate"><span class="pre">HTML</span></code> che dovrebbe essere fornita da un
Web-server e che quindi potrebbe essere aperta  da <strong>più utenti contemporaneamente</strong>.</p>
<ol class="arabic simple">
<li><p><cite>chi comanda?</cite>. Nel caso di più utenti,
questi potranno vedere la stessa griglia o ognuno vedrà la sua griglia?</p>
<ul class="simple">
<li><p>il committente precisa che <strong>tutti gli utenti potranno vedere la evoluzione della stessa griglia</strong>,
ma solo uno potrà
inviare comandi di gestione del gioco. Questo utente privilegiato (detto <cite>owner</cite>) sarà
<cite>l’utente che ha aperto per primo la pagina HTML</cite>.</p></li>
</ul>
</li>
<li><p><cite>chi crea la GUI?</cite> Si modifica
<span class="xref std std-ref">ConwayLife25 in Java</span> o è  meglio lasciare il più possibile inalterato
questo software già testato?</p>
<ul class="simple">
<li><p>meglio <cite>modificare meno possibile</cite> ciò che già funziona.
<span class="xref std std-ref">ConwayLife25 in Java</span> è stato impostato in modo da  essere
estendibile senza dover modificare la logica del gioco. In particolare, la parte di <strong>output</strong> della
GUI potrebbe essere aggiornata introducendo una nuova classe che implementa la
<span class="xref std std-ref">IOutDev interface</span> in modo da visualizzare lo stato delle celle nella pagina <code class="docutils literal notranslate"><span class="pre">HTML</span></code>.</p></li>
<li><p>vi sono <cite>framework</cite> che permettono di realizzare pagine HTML che interagiscono con un server
senza dover modificare il software già realizzato in Java. Uno di questi è  <a class="reference external" href="https://spring.io/projects/spring-boot">SpringBoot</a>.</p></li>
</ul>
</li>
<li><p><cite>come si aggiorna?</cite> La pagina HTML deve essere aggiornata in modo automatico
o l’utente deve premere un pulsante per vedere lo stato delle celle?</p>
<ul class="simple">
<li><p>la pagina HTML deve essere <cite>aggiornata in modo automatico</cite> (per tutti gli utenti
connessi) durante la evoluzione del gioco, senza che un utente debba fare nulla.
Questo richiede l’uso di  <a class="reference external" href="https://it.wikipedia.org/wiki/WebSocket">WebSocket</a> che permettono di inviare messaggi dal server alla pagina HTML.</p></li>
</ul>
</li>
<li><p><cite>e se si ferma?</cite> La pagina HTML potrebbe diventare vuota o rimanere stabile.
Come evitare che il gico continui senza che l’utente se ne accorga?</p></li>
<li><p><cite>come si riduce il traffico di rete?</cite></p>
<ul class="simple">
<li><p>il traffico di rete può essere ridotto inviando solo le informazioni necessarie per aggiornare la pagina HTML.
Ad esempio, inviare <cite>solo le celle che cambiano stato</cite> e non tutta la griglia.</p></li>
<li><p>tuttavia, un utente che si collega mentre il gioco è in corso dovrebbe vedere lo stato attuale
della griglia in modo corretto. Questo richiede che il server invii al nuovo utente tutta la griglia attuale.</p></li>
</ul>
</li>
</ol>
<p>Qui ci sono alcuni problemi da affrontare:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#come-rappresentare-la-griglia-in-html-js"><span class="std std-ref">Come rappresentare la griglia in HTML/JS</span></a></p></li>
<li><p><a class="reference internal" href="#comunicazioni-server-to-pagina"><span class="std std-ref">Comunicazioni server to pagina</span></a></p></li>
<li><p><a class="reference internal" href="#comunicazioni-pagina-to-server"><span class="std std-ref">Comunicazioni pagina to server</span></a></p></li>
<li><p><a class="reference internal" href="#come-rendere-disponibile-la-pagina-html"><span class="std std-ref">Come rendere disponibile la pagina HTML</span></a>  al browser dell’utente</p></li>
</ol>
<p>La configurazione del sistema è simile alle <a class="reference internal" href="#configurazione-di-goflife-con-swing"><span class="std std-ref">Configurazione di GofLife con Swing</span></a>; quello che cambia
è la implementazione dell’oggetto (qui <a class="reference internal" href="#outinws"><span class="std std-ref">OutInWs</span></a>) che implementa <a class="reference internal" href="#la-interfaccia-ioutdev"><span class="std std-ref">La interfaccia IOutDev</span></a>
(funngendo anche da dispositivo di input).</p>
</section>
<section id="configurazione-di-goflife-con-html">
<span id="id117"></span><h2>Configurazione di GofLife con HTML<a class="headerlink" href="#configurazione-di-goflife-con-html" title="Permalink to this heading">¶</a></h2>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureTheSystemWithHtmlWs</span><span class="p">()</span> <span class="p">{</span>
   <span class="n">Life</span> <span class="n">life</span>            <span class="o">=</span> <span class="k">new</span> <span class="n">Life</span><span class="p">(</span> <span class="mi">20</span><span class="p">,</span><span class="mi">20</span> <span class="p">);</span>
   <span class="n">IOutDev</span> <span class="n">outinws</span>      <span class="o">=</span> <span class="k">new</span> <span class="n">OutInWs</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
   <span class="n">GameController</span>  <span class="n">cc</span>   <span class="o">=</span> <span class="k">new</span> <span class="n">LifeController</span><span class="p">(</span><span class="n">life</span><span class="p">,</span> <span class="n">outinws</span><span class="p">)</span> <span class="p">;</span>
   <span class="p">((</span><span class="n">OutInWs</span><span class="p">)</span> <span class="n">outinws</span><span class="p">).</span><span class="na">setController</span><span class="p">(</span><span class="n">cc</span><span class="p">);</span>    <span class="c1">//iniezione del controller nella GUI</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 55%" />
<col style="width: 45%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>.</p>
<a class="reference internal image-reference" href="_images/LifeGameJavaWithHTML.jpg"><img alt="_images/LifeGameJavaWithHTML.jpg" class="align-center" src="_images/LifeGameJavaWithHTML.jpg" style="width: 100%;" /></a>
</td>
<td><p>La pagina HTML funge da:</p>
<ul class="simple">
<li><p><strong>dispositvo di output</strong> per visualizzare lo stato della <code class="docutils literal notranslate"><span class="pre">Grid</span></code></p></li>
<li><p><strong>dispositivo di input</strong> per inviare comandi a <a class="reference internal" href="#outinws"><span class="std std-ref">OutInWs</span></a>.</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</section>
<section id="iojavalin">
<span id="id118"></span><h2>IoJavalin<a class="headerlink" href="#iojavalin" title="Permalink to this heading">¶</a></h2>
</section>
<section id="outinws">
<span id="id119"></span><h2>OutInWs<a class="headerlink" href="#outinws" title="Permalink to this heading">¶</a></h2>
<p><strong>OutInWs</strong>: dispositivo di input/output che attiva (usando <a class="reference internal" href="#come-opera-javalin"><span class="std std-ref">javalin</span></a>) una pagina HTML/JS
per visualizzare lo stato della griglia e per inviare al <code class="docutils literal notranslate"><span class="pre">LifeController</span></code>
le informazioni provenienti dalla pagina.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>public class OutInWs implements IOutDev{
      public OutInWs( boolean pageexternal ) {
  javalin = new IoJavalin();
  if( ! pageexternal ) {
    setUpPageGranular();
    //setUpPageGlobal();
    //pageAloneUsingCHrome();
  }
}

protected void setUpPageGranular() {
try {
  Desktop.getDesktop().browse(
    new URI(&quot;file:///C:/.../conway/io/ConwayInOutPage.html&quot;) );
}catch (Exception e) { ... }
}
protected void setUpPageGlobal() {
try {
 Desktop.getDesktop().browse(
  new URI(&quot;file:///C:/.../conway/io/LifeIInOutCanvas.html&quot;) );
}catch (Exception e) { ... }
}
protected void pageAloneUsingCHrome() {
try{
  String cmd =  &quot;\&quot;C:/Program Files/Google/Chrome/Application/chrome.exe\&quot;&quot; +
              + &quot; --app=file:///C:/.../ConwayInOutPage.html&quot; ;
  Runtime.getRuntime().exec( cmd );
}catch (IOException e) { ... }
}

/* Metodi di IOutDev */
    ...
}
</pre></div>
</div>
<p>I metodi <strong>setUpPagexxx</strong> aprono uno specifico tipo di pagina evitando la necessità
di una apertura manuale della pagina <a class="reference internal" href="#conwayinoutpage-html"><span class="std std-ref">ConwayInOutPage.html</span></a> o  <a class="reference internal" href="#conwayinoutpage-html"><span class="std std-ref">ConwayInOutPage.html</span></a>
(che un end-user potrebbe non sapere dove si trova).</p>
<ul class="simple">
<li><p>Si tratta di una <strong>richiesta al sistema operativo</strong>; la pagina appare come una normale scheda
(tab) all’interno di una finestra del browser già aperta, con barra degli indirizzi, segnalibri
e tasti avanti/indietro.</p></li>
</ul>
<p>Il metodo <strong>pageAloneUsingCHrome</strong> è una <strong>Chiamata diretta a Chrome</strong>:</p>
<ul class="simple">
<li><p>Forza l’apertura di <em>Chrome</em> in una modalità speciale (chiamata <strong>Application Mode</strong>,
disponibile su tutti i browser basati su Chromium (Chrome, Edge)
progettata per far sembrare un sito web un’applicazione desktop nativa.</p></li>
<li><p>La pagina ha la sua icona nella barra delle applicazioni e sembrerà un programma a sé stante.</p></li>
<li><p>Funziona solo se Chrome è installato e se il percorso dell’eseguibile è corretto (molto fragile su sistemi diversi).</p></li>
</ul>
<p>Notiamo che nessuna dei due modi di attivazione  funzionerà dentro un container Docker.
Nel caso di distribuzione del prodotto in Docker, il dispositivo dovrà essere inizializzato con
<strong>pageexternal=true</strong> e la pagina aperta con <code class="docutils literal notranslate"><span class="pre">localhost:8080/conway</span></code>, come descritto al punto 3 di
<a class="reference internal" href="#come-rendere-disponibile-la-pagina-html"><span class="std std-ref">Come rendere disponibile la pagina HTML</span></a>.</p>
</section>
<section id="come-rappresentare-la-griglia-in-html-js">
<span id="id120"></span><h2>Come rappresentare la griglia in HTML/JS<a class="headerlink" href="#come-rappresentare-la-griglia-in-html-js" title="Permalink to this heading">¶</a></h2>
<p>La pagina HTML realizza un  dispostivo di I/O che interagisce con l’applicazione da
un lato e con l’utente umano dall’altro.</p>
<p>All’interno della pagina, la griglia può essere rappresentata in modi diversi:
esaminiamone due.</p>
<section id="una-griglia-granulare">
<span id="id121"></span><h3>Una griglia granulare<a class="headerlink" href="#una-griglia-granulare" title="Permalink to this heading">¶</a></h3>
<p>Definiamo la  griglia in <em>Retained Mode</em>, cioè
come una serie di celle quadrate, ciascuna con ID  <strong>cell-i-j</strong> incapsulata in un  tag <code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code>.</p>
<ul class="simple">
<li><p>Identità: Ogni cella ha un “indirizzo” fisico nel documento HTML (es. l’ID).</p></li>
<li><p>Stato: Lo stato (viva/morta) è “appeso” direttamente all’elemento, spesso tramite una classe CSS
(<code class="docutils literal notranslate"><span class="pre">.live</span> <span class="pre">{</span> <span class="pre">background:</span> <span class="pre">#28a745;</span> <span class="pre">}</span></code>) come fatto nel file <code class="docutils literal notranslate"><span class="pre">mapstyle.css</span></code>.</p></li>
</ul>
<p>Questa tecnica è adottata nel file <strong>iomap.js</strong> usato dalla pagina realizzata nel file
<code class="docutils literal notranslate"><span class="pre">main/java/conway/io/ConwayInOutPage.html</span></code></p>
<section id="conwayinoutpage-html">
<span id="id122"></span><h4>ConwayInOutPage.html<a class="headerlink" href="#conwayinoutpage-html" title="Permalink to this heading">¶</a></h4>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>ConwayInOutPage<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;mapstyle.css&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>ConwayInOutPage<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">hr</span><span class="p">/&gt;</span>
<span class="cm">&lt;!--  INPUT AREA   --&gt;</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="s">&quot;sendCmdToServer(&#39;start&#39;); return false&quot;</span><span class="p">&gt;</span>START<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="s">&quot;sendCmdToServer(&#39;stop&#39;);  return false&quot;</span><span class="p">&gt;</span>STOP<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="s">&quot;sendCmdToServer(&#39;clear&#39;); return false&quot;</span><span class="p">&gt;</span>CLEAR<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="s">&quot;sendCmdToServer(&#39;exit&#39;);  return false&quot;</span><span class="p">&gt;</span>EXIT<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- MAP AREA --&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h3</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center&quot;</span><span class="p">&gt;</span>Life Grid Map - starts in (1,1)<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;grid&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="cm">&lt;!--  OUTPUT AREA --&gt;</span>
    <span class="p">&lt;</span><span class="nt">ol</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;msgslist&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">ol</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">onclick</span><span class="o">=</span><span class="s">clearOutArea()</span><span class="p">&gt;</span>Remove Messages<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;iomap.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;outArea.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;wscontrol.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Nel package <em>src/main/java/conway/io</em>:</p>
<ul class="simple">
<li><p><strong>iomap.js</strong>: mappa di nome <strong>map</strong> con le celle e funzione di commutazione del colore di una cella
(<code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">updateCellColor(X,Y,color)</span></code>)</p></li>
<li><p><strong>outArea.js</strong>: area di nome <strong>msgslist</strong> dei messaggi di informazioni inviati dal server alla pagine
e metodi per il suo aggiornamneto</p></li>
<li><p><strong>wscontrol.js</strong>: gestisce la comunicazioni via socket tra server e pagina (<code class="docutils literal notranslate"><span class="pre">sendCmdToServer</span></code>)
e la gestione di messaggi emessi dal serer .</p></li>
</ul>
</section>
<section id="wscontrol-js">
<span id="id123"></span><h4>wscontrol.js<a class="headerlink" href="#wscontrol-js" title="Permalink to this heading">¶</a></h4>
<p>Crea la socket di connessione tra pagina e il server e definisce codice per la gestione dei messaggi
ricevuti dal server e per la trasmissione di messaggi al server.</p>
<ul>
<li><p>apre la socket verso il server: <code class="docutils literal notranslate"><span class="pre">socketToGui</span> <span class="pre">=</span> <span class="pre">new</span> <span class="pre">WebSocket(&quot;ws://localhost:8080/eval&quot;)</span></code></p></li>
<li><p>definisce una funzione per l’inivo di messaggi in forma <a class="reference internal" href="#iapplmessage"><span class="std std-ref">IApplMessage</span></a> al server di cui
conosce il nome:</p>
<div class="highlight-Javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">cmdMsgTemplate</span> <span class="o">=</span> <span class="s2">&quot;msg( eval, dispatch, SENDER, lifectrl, CMD, 0 )&quot;</span>
<span class="kd">var</span> <span class="nx">pageId</span>         <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>

<span class="kd">function</span> <span class="nx">sendCmdToServer</span><span class="p">(</span><span class="nx">cmd</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">msg</span> <span class="o">=</span> <span class="nx">cmdMsgTemplate</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;CMD&quot;</span><span class="p">,</span> <span class="nx">cmd</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;SENDER&quot;</span><span class="p">,</span><span class="nx">pageId</span><span class="p">)</span>
  <span class="k">if</span><span class="p">(</span> <span class="nx">opened</span> <span class="p">)</span> <span class="nx">socketToGui</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">socketToGui.onopen</span></code>: esegue <em>sendCmdToServer(“ready”)</em> per segnalare di essere attiva e granulare</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">socketToGui.onmessage</span></code>: gestisce messaggi (eventi) inviati dal server come discusso
in <a class="reference internal" href="#comunicazioni-server-to-pagina"><span class="std std-ref">Comunicazioni server to pagina</span></a>.</p></li>
</ul>
</section>
</section>
<section id="una-griglia-globale">
<span id="id124"></span><h3>Una griglia globale<a class="headerlink" href="#una-griglia-globale" title="Permalink to this heading">¶</a></h3>
<p>Evitiamo la creazione di molti tag <code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code>,
definendo la  griglia in <em>Immediate Mode</em>
usando l’elemento <a class="reference external" href="https://www.w3schools.com/html/html5_canvas.asp">canvas</a> di HTML5:
un’area di disegno programmabile via JavaScript che si comporta quasi esattamente
come il <em>Graphics2D</em> di Java.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Questa tecnica è infinitamente più veloce per griglie grandi.
Disegnare 10.000 pixel su un canvas è un’operazione banale; gestire 10.000 &lt;div&gt; può mandare
in crash il browser di uno smartphone.</p>
</div>
<p>Adottiamo questa tecnica nel file <code class="docutils literal notranslate"><span class="pre">main/java/conway/io/LifeIInOutCanvas.html</span></code>, suggerito da <strong>Gemini AI</strong>.</p>
<section id="lifeiinoutcanvas-html">
<span id="lifeiinoutcanvas"></span><h4>LifeIInOutCanvas.html<a class="headerlink" href="#lifeiinoutcanvas-html" title="Permalink to this heading">¶</a></h4>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;it&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>LifeGuiCanvas<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">body</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="mh">#1a1a1a</span><span class="p">;</span><span class="w"> </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="mh">#00ff00</span><span class="p">;</span><span class="w"> </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Courier New&#39;</span><span class="p">,</span><span class="w"> </span><span class="kc">monospace</span><span class="p">;</span><span class="w"> </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">flex</span><span class="p">;</span><span class="w"> </span><span class="k">flex-direction</span><span class="p">:</span><span class="w"> </span><span class="kc">column</span><span class="p">;</span><span class="w"> </span><span class="k">align-items</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="nt">canvas</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="mh">#333</span><span class="p">;</span><span class="w"> </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="mh">#000</span><span class="p">;</span><span class="w"> </span><span class="k">cursor</span><span class="p">:</span><span class="w"> </span><span class="kc">crosshair</span><span class="p">;</span><span class="w"> </span><span class="k">box-shadow</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="w"> </span><span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="nc">controls</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="mh">#00ff00</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">#</span><span class="nn">status</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mf">0.8</span><span class="kt">em</span><span class="p">;</span><span class="w"> </span><span class="k">margin-bottom</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>CONWAY GAME OF LIFE<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;status&quot;</span><span class="p">&gt;</span>STATO: DISCONNESSO<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">canvas</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;gridCanvas&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">canvas</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;controls&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;sendCmdToServer(&#39;start&#39;)&quot;</span><span class="p">&gt;</span>START<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;sendCmdToServer(&#39;stop&#39;)&quot;</span><span class="p">&gt;</span>STOP<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;sendCmdToServer(&#39;clear&#39;)&quot;</span><span class="p">&gt;</span>CLEAR<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;wscanvascontrol.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
</section>
<section id="wscanvascontrol-js">
<h4>wscanvascontrol.js<a class="headerlink" href="#wscanvascontrol-js" title="Permalink to this heading">¶</a></h4>
<p>Simile a <a class="reference internal" href="#wscontrol-js"><span class="std std-ref">wscontrol.js</span></a> con funzioni specializzate per la gestione della griglia come canvas.</p>
<p>Riportiamo in particolare la funzione di gestione dei messaggi ricevuti dal server
(si veda <a class="reference internal" href="#comunicazioni-server-to-pagina"><span class="std std-ref">Comunicazioni server to pagina</span></a>):</p>
<div class="highlight-Javascript notranslate"><div class="highlight"><pre><span></span>  <span class="nx">socketToGui</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s2">&quot;ID:&quot;</span><span class="p">)){</span>
    <span class="nx">pageId</span><span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mf">1</span><span class="p">];</span> <span class="c1">//definisce il nome della pagina</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">&quot;[[&quot;</span><span class="p">))</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">grid</span> <span class="o">=</span> <span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
    <span class="nx">requestAnimationFrame</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nx">draw</span><span class="p">(</span><span class="nx">grid</span><span class="p">));</span> <span class="c1">//disegna la grid nel canvas</span>
  <span class="p">}</span>
  <span class="k">else</span>  <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;pageglobal |  &quot;</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span> <span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Al momento, la pagina non defisce alcuna <em>outArea</em>; i messaggi informativi inviati dal server
sono visualizzati sulla console del browser.</p>
<p><strong>Comunicazioni server-pagina</strong></p>
<p>La comunicazione
server/pagina è un elemento fondamentale per la integrazione tra due componenti
sviluppati cone tecnologue informatiche diverse e che operano su due macchine diverse.</p>
<p>Approfondimao dunque l’analisi del problema relativo a questa integrazione.</p>
</section>
</section>
<section id="comunicazioni-server-to-pagina">
<span id="id125"></span><h3>Comunicazioni server to pagina<a class="headerlink" href="#comunicazioni-server-to-pagina" title="Permalink to this heading">¶</a></h3>
<p>Il server invia alla pagina comandi espressi da semplici stringhe</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ID</span><span class="p">:</span><span class="n">name</span>                <span class="o">//</span><span class="n">par</span> <span class="n">dare</span> <span class="n">il</span> <span class="n">valore</span> <span class="n">name</span> <span class="n">al</span> <span class="n">nome</span> <span class="n">della</span> <span class="n">pagina</span>
<span class="n">cell</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span>              <span class="o">//</span><span class="n">per</span> <span class="n">commutare</span> <span class="n">lo</span> <span class="n">stato</span> <span class="n">di</span> <span class="n">una</span> <span class="n">cella</span> <span class="p">(</span><span class="n">griglia</span> <span class="n">granulare</span><span class="p">)</span>
<span class="p">[[</span><span class="n">false</span><span class="p">,</span><span class="n">false</span><span class="p">,</span> <span class="o">...</span> <span class="p">]]</span>  <span class="o">//</span><span class="n">per</span> <span class="n">specificare</span> <span class="n">lo</span> <span class="n">stato</span> <span class="n">di</span> <span class="n">una</span> <span class="n">grglia</span> <span class="n">globale</span>
</pre></div>
</div>
<p>L’invio dei comandi realativi allo stato della griglia è discusso in <a class="reference internal" href="#come-inviare-lo-stato-della-griglia"><span class="std std-ref">Come inviare lo stato della griglia</span></a>.</p>
<p>Il primo comando indica che è il <strong>server che attribuisce un nome</strong> alle pagine che si connettono.
Questo per fare in modo che ci sia una <strong>unica pagina</strong> abilitata al <em>controllo</em> del gioco:
la <strong>prima pagina</strong> che si è conessa.</p>
<p>Nel server (ad esempio nella classe <a class="reference internal" href="#iojavalin"><span class="std std-ref">IoJavalin</span></a> o in
<a class="reference internal" href="#abstractprotoactor"><span class="std std-ref">AbstractProtoactor</span></a>) avremo codice come quello che segue:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">protected</span> <span class="n">AtomicInteger</span> <span class="n">pageCounter</span>         <span class="o">=</span> <span class="n">new</span> <span class="n">AtomicInteger</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
 <span class="n">protected</span> <span class="n">Vector</span><span class="o">&lt;</span><span class="n">WsConnectContext</span><span class="o">&gt;</span> <span class="n">allConns</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Vector</span><span class="o">&lt;</span><span class="n">WsConnectContext</span><span class="o">&gt;</span><span class="p">();</span>
 <span class="n">protected</span> <span class="n">String</span> <span class="n">firstCaller</span>                <span class="o">=</span> <span class="n">null</span><span class="p">;</span>
 <span class="n">protected</span> <span class="n">WsConnectContext</span> <span class="n">firstctx</span>         <span class="o">=</span> <span class="n">null</span><span class="p">;</span>

 <span class="n">ws</span><span class="o">.</span><span class="n">onConnect</span><span class="p">(</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="p">{</span>
    <span class="nb">int</span> <span class="n">idAssegnato</span> <span class="o">=</span> <span class="n">pageCounter</span><span class="o">.</span><span class="n">incrementAndGet</span><span class="p">();</span>
    <span class="n">String</span> <span class="n">callerNAme</span> <span class="o">=</span> <span class="s2">&quot;caller&quot;</span><span class="o">+</span><span class="n">idAssegnato</span><span class="p">;</span>
    <span class="n">sendsafe</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="s2">&quot;ID:&quot;</span> <span class="o">+</span> <span class="n">callerNAme</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">firstCaller</span> <span class="o">==</span> <span class="n">null</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="n">firstCaller</span> <span class="o">=</span> <span class="n">callerNAme</span><span class="p">;</span>
                    <span class="n">firstctx</span>    <span class="o">=</span> <span class="n">ctx</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">allConns</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span> <span class="o">//</span><span class="n">per</span> <span class="n">permettere</span> <span class="n">broadcast</span> <span class="n">delle</span> <span class="n">info</span>
    <span class="n">sendsafe</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">callerNAme</span> <span class="o">+</span><span class="s2">&quot;_conn_N_&quot;</span> <span class="o">+</span> <span class="n">allConns</span><span class="o">.</span><span class="n">size</span><span class="p">());</span>
    <span class="n">heartbeatTask</span> <span class="o">=</span> <span class="o">...</span>
<span class="p">});</span><span class="o">//</span><span class="n">ws</span><span class="o">.</span><span class="n">onConnect</span>
</pre></div>
</div>
</div></blockquote>
<section id="sendsafe">
<h4>sendsafe<a class="headerlink" href="#sendsafe" title="Permalink to this heading">¶</a></h4>
<p>Può capitare che due thread applicativi cerchino di scrivere sullo stessa connessione nello stesso istante.
Questo ‘conflitto’ potrebbe accadere tra il thread proattivo che elabora la logica applicativa
e  l’Heartbeat (PING).</p>
<p>Jetty non è thread-safe per gli invii WebSocket. Se due frame si sovrappongono,
Jetty chiude la connessione per evitare di corrompere il protocollo.</p>
<p>Per evitare questi conflitti si introduce la operazion <em>sendsafe</em>:</p>
</section>
</section>
<section id="comunicazioni-pagina-to-server">
<span id="id126"></span><h3>Comunicazioni pagina to server<a class="headerlink" href="#comunicazioni-pagina-to-server" title="Permalink to this heading">¶</a></h3>
<p>La pagina HTML deve inviare al server:</p>
<ul class="simple">
<li><p>comandi di commutazione di stato di una cella, quando l’utente vuole definire lo stato iniziale della griglia</p></li>
<li><p>comandi di gestione del gioco <code class="docutils literal notranslate"><span class="pre">start/stop/clear</span></code></p></li>
<li><p>informazione sul tipo di rappresentazione della griglia adottato dalla pagina (granulare o globale),
per permettere al server di inviare i giusti messaggi di aggiornamento</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ready</span>        <span class="o">//</span><span class="n">per</span> <span class="n">dire</span> <span class="n">che</span> <span class="n">una</span> <span class="n">pagina</span> <span class="n">granulare</span> <span class="n">è</span> <span class="n">attiva</span>
<span class="n">canvas</span><span class="o">-</span><span class="n">ready</span> <span class="o">//</span><span class="n">per</span> <span class="n">dire</span> <span class="n">che</span> <span class="n">una</span> <span class="n">pagina</span> <span class="n">globale</span> <span class="n">è</span> <span class="n">attiva</span>
<span class="n">start</span>        <span class="o">//</span><span class="n">per</span> <span class="n">attivare</span> <span class="n">il</span> <span class="n">gioco</span>
<span class="n">stop</span>         <span class="o">//</span><span class="n">per</span> <span class="n">porre</span> <span class="n">il</span> <span class="n">gioco</span> <span class="ow">in</span> <span class="n">pausa</span>
<span class="n">clear</span>        <span class="o">//</span><span class="n">per</span> <span class="n">resettare</span> <span class="n">la</span> <span class="n">griglia</span>
<span class="n">exit</span>         <span class="o">//</span><span class="n">per</span> <span class="n">terminare</span> <span class="n">la</span> <span class="n">applicazione</span>
</pre></div>
</div>
<p>Queste stringhe sono il payload di messaggi di tipo IApplMessage
che vengono inviati al server come discusso nella sezione
<a class="reference internal" href="#come-la-pagina-invia-dati"><span class="std std-ref">Come la pagina invia dati</span></a>.</p>
</section>
<section id="come-inviare-lo-stato-della-griglia">
<span id="id127"></span><h3>Come inviare lo stato della griglia<a class="headerlink" href="#come-inviare-lo-stato-della-griglia" title="Permalink to this heading">¶</a></h3>
<ol class="arabic">
<li><p>Se si rappresenta la griglia in modo granulare,
si può inviare un messaggio di aggiornamento <strong>cella per cella</strong>.</p></li>
<li><p>Se si rappresenta la grida con l’elemento <a class="reference external" href="https://www.w3schools.com/html/html5_canvas.asp">canvas</a>,
basta un messaggio con lo stato di <strong>tutta la griglia</strong></p>
<p>Per una griglia di <code class="docutils literal notranslate"><span class="pre">20x20</span></code>, il costo di inviare tutta la griglia è trascurabile:</p>
</li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>Una matrice di <code class="docutils literal notranslate"><span class="pre">400</span></code> boolean occupa circa <code class="docutils literal notranslate"><span class="pre">400-500</span></code> byte in formato JSON.</p></li>
<li><p>Un singolo pacchetto di rete (<strong>MTU</strong> <em>Maximum Transmission Unit</em>) è di circa <code class="docutils literal notranslate"><span class="pre">1500</span></code> byte.</p></li>
</ul>
<blockquote>
<div><p>Dunque, inviare tutta la griglia o inviare una singola cella consuma esattamente la stessa quantità di risorse di rete
(perché il pacchetto deve comunque partire).</p>
</div></blockquote>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<blockquote>
<div><ul class="simple">
<li><p>A volte, l’interfaccia di rete di Docker ha un <strong>MTU</strong> leggermente più piccolo (es. <code class="docutils literal notranslate"><span class="pre">1450</span></code> byte)</p></li>
<li><p>rispetto a quella del PC fisico (1500 byte).</p>
<ol class="arabic simple">
<li><p>Il pacchetto esce dal  programma Java.</p></li>
<li><p>Arriva al “confine” del container Docker.</p></li>
<li><p>Docker si accorge che il pacchetto è troppo grande per il suo tunnel virtuale.</p></li>
<li><p>Il problema: Se la frammentazione non è gestita bene, il pacchetto viene scartato.
Questo è uno dei motivi tecnici “oscuri” dietro l’<strong>errore 1006</strong> o le disconnessioni improvvise.</p></li>
</ol>
</li>
</ul>
</div></blockquote>
</div>
</section>
<section id="come-la-pagina-invia-dati">
<span id="id128"></span><h3>Come la pagina invia dati<a class="headerlink" href="#come-la-pagina-invia-dati" title="Permalink to this heading">¶</a></h3>
<p>I dati introdotti in <a class="reference internal" href="#comunicazioni-pagina-to-server"><span class="std std-ref">Comunicazioni pagina to server</span></a>
potrebbero essere inviati al server direttamente, in forma di stringa.</p>
<p>Concettualmente però, ogni dato rappresenta il paylooad di un messaggio di tipo <a class="reference internal" href="#iapplmessage"><span class="std std-ref">IApplMessage</span></a>
tra il componente-pagina e il compoente-server:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">msg</span><span class="p">(</span> <span class="nb">eval</span><span class="p">,</span> <span class="n">dispatch</span><span class="p">,</span> <span class="n">PAGENAME</span><span class="p">,</span> <span class="n">SERVENAME</span><span class="p">,</span> <span class="n">DATOPAGINA</span><span class="p">,</span> <span class="n">MSGNUM</span> <span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>La pagina potrebbe avere nome <code class="docutils literal notranslate"><span class="pre">PAGENAME=caller1</span></code>  ed essere configurata in modo da conoscere
‘a-priori’ il nome del server (ad. es <code class="docutils literal notranslate"><span class="pre">SERVENAME=lifectrl</span></code>) o ricevere il nome
dal server stesso alla prima connessione.</p>
<p>Ci si può chiedere che senso abbia custruire e inviare una struttura così ridondante,
quando la comunicazione deve avvenire tramite la WebSocket di connessione tra la pagina e il server.
Ocoorre però ricordare che <code class="docutils literal notranslate"><span class="pre">N&gt;1</span></code> utenti umani possono aprire <code class="docutils literal notranslate"><span class="pre">N</span></code> pagine, ciascuna delle quali potrebbe
essere usata per inviare dati.</p>
<p>La struttura ridondante del messaggio fornisce ulteriori informazioni per la gestione dello
scambio di informazioni tra un server e <code class="docutils literal notranslate"><span class="pre">N&gt;1</span></code> pagine:</p>
<ul class="simple">
<li><p>nel caso di <strong>dispatch</strong> l’intento è che il comando deve essere recapitato e gestito dal solo
destinatario di nome <code class="docutils literal notranslate"><span class="pre">SERVENAME</span></code>. Nel caso di <strong>event</strong> l’intento è inviare il payload
come notifica a tutte le pagine connesse al server</p></li>
<li><p>la indicazione di <code class="docutils literal notranslate"><span class="pre">PAGENAME</span></code> vincola
il server a gestire un comando di gestione del gioco <strong>solo se proviene</strong> dalla <em>unica</em> pagina
abilitata al <em>controllo</em> del gioco.</p></li>
</ul>
<p>Per ottenere un <strong>unica pagina di controllo del gioco</strong>, possiamo procedere come indicato
in <a class="reference internal" href="#comunicazioni-server-to-pagina"><span class="std std-ref">Comunicazioni server to pagina</span></a> e con le sehuenti regole:</p>
<ul class="simple">
<li><p>il server considera la <strong>prima pagina</strong> che si è conessa come l’unica abilitata al <em>controllo</em> del gioco</p></li>
<li><p>il server elabora solo messaggi che abbiano come RECEIVER il <em>serverName</em> corretto</p></li>
<li><p>il server ignora eventuali comandi spediti da altre pagine, controllando il <code class="docutils literal notranslate"><span class="pre">PAGENAME</span></code>
del messaggio ricevuto</p></li>
<li><p>tutte la pagine connesse possono ricevere informazioni emesse dal server come <strong>event</strong></p></li>
</ul>
</section>
<section id="come-rendere-disponibile-la-pagina-html">
<span id="id129"></span><h3>Come rendere disponibile la pagina HTML<a class="headerlink" href="#come-rendere-disponibile-la-pagina-html" title="Permalink to this heading">¶</a></h3>
<ol class="arabic">
<li><p>Aprendo ‘manualmente’ la pagina in un browser. Si tratta del
modo <em>Standalone Client-Side App</em> o <em>Decoupled Frontend</em>:
il browser opera come un motore di rendering per un’interfaccia locale.</p></li>
<li><p>Come fatto in <a class="reference internal" href="#outinws"><span class="std std-ref">OutInWs</span></a> con <em>pageexternal=false</em>, facendo in modo che la pagina sia aperta
direttamente dalla applicazione</p></li>
<li><p>Come pagina Web erogata da un server.
Ad esempio, il server <em>javalin</em> embedded in <a class="reference internal" href="#outinws"><span class="std std-ref">OutInWs</span></a> potrebe attìvare anche la parte <code class="docutils literal notranslate"><span class="pre">HTTP</span></code>
e fornire un metodo <code class="docutils literal notranslate"><span class="pre">server.get(&quot;/&quot;,</span> <span class="pre">ctx-&gt;</span> <span class="pre">...</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">protected</span> <span class="n">void</span> <span class="n">activateHTTP</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">server</span> <span class="o">=</span> <span class="n">Javalin</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">config</span> <span class="o">-&gt;</span> <span class="p">{</span>
  <span class="o">//</span><span class="n">config</span><span class="o">.</span><span class="n">bundledPlugins</span><span class="o">.</span><span class="n">enableCors</span><span class="p">(</span><span class="n">cors</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">cors</span><span class="o">.</span><span class="n">addRule</span><span class="p">(</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">it</span><span class="o">.</span><span class="n">anyHost</span><span class="p">());});</span>

    <span class="n">config</span><span class="o">.</span><span class="n">jetty</span><span class="o">.</span><span class="n">modifyWebSocketServletFactory</span><span class="p">(</span><span class="n">factory</span> <span class="o">-&gt;</span> <span class="p">{</span>
      <span class="n">factory</span><span class="o">.</span><span class="n">setIdleTimeout</span><span class="p">(</span><span class="n">Duration</span><span class="o">.</span><span class="n">ofMinutes</span><span class="p">(</span><span class="mi">30</span><span class="p">));</span>
    <span class="p">});</span>
    <span class="n">config</span><span class="o">.</span><span class="n">staticFiles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">staticFiles</span> <span class="o">-&gt;</span> <span class="p">{</span>
        <span class="n">staticFiles</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="s2">&quot;C:/.../src/main/java/conway/io&quot;</span><span class="p">;</span>
        <span class="n">staticFiles</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">Location</span><span class="o">.</span><span class="n">EXTERNAL</span><span class="p">;</span>
     <span class="p">});</span>
  <span class="p">})</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span>

  <span class="n">server</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span>  <span class="p">{</span>
      <span class="n">Path</span> <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">of</span><span class="p">(</span><span class="s2">&quot;./src/main/java/conway/io/ConwayInOutPage.html&quot;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">Files</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="p">{</span>
          <span class="n">ctx</span><span class="o">.</span><span class="n">contentType</span><span class="p">(</span><span class="s2">&quot;text/html&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="n">Files</span><span class="o">.</span><span class="n">newInputStream</span><span class="p">(</span><span class="n">path</span><span class="p">));</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="n">ctx</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="s2">&quot;File non trovato nel file system&quot;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
<section id="concetto-di-self-contained-service-servizio-auto-contenuto">
<h4>concetto di “Self-Contained Service” (Servizio Auto-contenuto).<a class="headerlink" href="#concetto-di-self-contained-service-servizio-auto-contenuto" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>Assenza di configurazioni CORS: Se la pagina HTML e la WebSocket provengono dallo stesso server e
dalla stessa porta (es. 8080), il browser non bloccherà mai la connessione per motivi di sicurezza
(<em>Same-Origin Policy</em>).</p></li>
<li><p>Versionamento atomico: Se si aggiorna la logica del gioco nel server Java, l’utente riceve
anche la versione corretta della GUI. Non si corre il rischio che una vecchia pagina HTML cerchi di
parlare con un nuovo server.</p></li>
<li><p>Semplicità per l’utente: L’utente deve solo ricordare un indirizzo (ad esempio <code class="docutils literal notranslate"><span class="pre">http://localhost:8080/conway</span></code>)
e il sistema si “auto-installa” nel browser.</p></li>
</ul>
<p>Visto che la pagina è servita dal server stesso, si può fare in modo che lo JavaScript non debba “indovinare”
l’indirizzo IP del server.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">window</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">host</span> <span class="n">prende</span> <span class="n">automaticamente</span> <span class="n">l</span><span class="s1">&#39;IP e la porta corretti</span>
<span class="o">//</span> <span class="p">(</span><span class="n">es</span><span class="o">.</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span> <span class="n">o</span> <span class="mf">192.168.1.50</span><span class="p">:</span><span class="mi">8080</span><span class="p">)</span>
<span class="n">const</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">new</span> <span class="n">WebSocket</span><span class="p">(</span><span class="s2">&quot;ws://&quot;</span> <span class="o">+</span> <span class="n">window</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">host</span> <span class="o">+</span> <span class="s2">&quot;/eval&quot;</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>
<section id="protoattori">
<span id="id130"></span><h1>Protoattori<a class="headerlink" href="#protoattori" title="Permalink to this heading">¶</a></h1>
<p>Il  <a class="reference internal" href="#un-progetto-esplicito"><span class="std std-ref">Progetto esplicito</span></a> relativo al <a class="reference internal" href="#refactoring-del-sistemas"><span class="std std-ref">Refactoring del sistemaS</span></a>,
può costituire il punto di partenza per la introduzione di componenti ispirati al modello
ad <a class="reference internal" href="#gli-attori-come-nuovo-paradigma"><span class="std std-ref">attori</span></a>.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 55%" />
<col style="width: 45%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>.</p>
<a class="reference internal image-reference" href="_images/SystemSAsActorMqtt.png"><img alt="_images/SystemSAsActorMqtt.png" class="align-center" src="_images/SystemSAsActorMqtt.png" style="width: 100%;" /></a>
</td>
<td><p>L’idea è introdurre un componente che:</p>
<ul class="simple">
<li><p>sia <em>intrinsecamene capace</em> di ricevere messaggio via rete</p></li>
<li><p>sia dotato di una struttura interna che pone in <em>foregorund</em> la logica applicativa
lasciando nascosti (in <em>background</em>) i diversi meccanismi di comunicazione via rete</p></li>
<li><p>sia anche capace di <em>comportamenti autonomi</em>, cioè non legati alla ricezione di messaggi</p></li>
</ul>
<p>La classe astratta  <code class="docutils literal notranslate"><span class="pre">AbstractProtoactorMsgdriven.java</span></code> costitusice una sorta
di <strong>Micro-framework</strong> che usa <a class="reference internal" href="#dependency-inversion"><span class="std std-ref">Inversione di Controllo</span></a>
per attivare operazioni applicative di gestione
dei messaggi ricevuti via HTTP, WS e MQTT e posti nella coda del worker applicativo.</p>
</td>
</tr>
</tbody>
</table>
<p>Prima di procedere alla definizione della classe astratta  <code class="docutils literal notranslate"><span class="pre">AbstractProtoactorMsgdriven.java</span></code>
definendo in modo esplicito la coda <code class="docutils literal notranslate"><span class="pre">applMsgQueue</span></code> e il Thread <code class="docutils literal notranslate"><span class="pre">ApplLogicWorker</span></code>,
osserviamo che Java introduce supporti utili alla realizzazione implicita della coppia
<code class="docutils literal notranslate"><span class="pre">applMsgQueue</span> <span class="pre">+</span> <span class="pre">ApplLogicWorker</span></code>: gli Executors.</p>
<section id="java-executors">
<span id="id131"></span><h2>Java Executors<a class="headerlink" href="#java-executors" title="Permalink to this heading">¶</a></h2>
<p>Java8 introduce la interfaccia <a class="reference external" href="https://www.baeldung.com/java-executor-service-tutorial">ExecutorService</a> (<em>java.util.concurrent</em>) come strato di più alto livello nella
gestione dei Thread.
Inoltre, l’interfaccia <strong>ScheduledExecutorService</strong>
estende <strong>ExecutorService</strong> per pianificare l’esecuzione di task dopo un determinato ritardo (delay) o in modo periodico.</p>
<p>La classe <strong>Executors</strong> definisce diversi metodi factory per creare
un <em>ExecutorService</em> predefinito che soddisfi casi d’uso specifici.
Ad esempio, l’executor creato come segue:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ScheduledExecutorService</span> <span class="n">executor</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="n">newSingleThreadScheduledExecutor</span><span class="p">()</span>
</pre></div>
</div>
<p>è un “worker” che rimane in attesa di compiti (task) che gli sono accodati
mediante il metodo <a class="reference internal" href="#submit"><span class="std std-ref">submit</span></a>.
Essendo <em>executor</em> “SingleThread”, si ha la garanzia che non ci siano due task che interferiscono
tra loro (niente problemi di sincronizzazione/race conditions).</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 25%" />
<col style="width: 30%" />
<col style="width: 45%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Caratteristica</p></td>
<td><p>new Thread()</p></td>
<td><p>SingleThreadScheduledExecutor</p></td>
</tr>
<tr class="row-even"><td><p>Riutilizzo</p></td>
<td><p>No (un thread per ogni task)</p></td>
<td><p>Sì (lo stesso thread riutilizzato per più task)</p></td>
</tr>
<tr class="row-odd"><td><p>Pianificazione</p></td>
<td><p>Solo esecuzione immediata</p></td>
<td><p>Ritardata o Periodica (es. “fai questo ogni 10 sec”)</p></td>
</tr>
<tr class="row-even"><td><p>Resilienza</p></td>
<td><p>Se fallisce, il thread muore</p></td>
<td><p>Se fallisce, l’executor ne crea uno nuovo per i task successivi</p></td>
</tr>
<tr class="row-odd"><td><p>Costo</p></td>
<td><p>Elevato (creare un thread OS è costoso)</p></td>
<td><p>Basso (si paga il prezzo di creazione una sola volta)</p></td>
</tr>
</tbody>
</table>
<section id="submit">
<span id="id132"></span><h3>submit<a class="headerlink" href="#submit" title="Permalink to this heading">¶</a></h3>
<p>Questo metodo è il modo più evoluto per “dare lavoro” a un executor.
A differenza di un semplice comando “esegui”, submit trestituisce un contratto (chiamato <strong>Future</strong>)
che permette di monitorare, annullare o ottenere il risultato di quel lavoro (task).</p>
<p>Un task può essere un <strong>Runnable</strong> quando occorre eseguire
un compito di tipo fire-and-forget,
oppure <strong>Callable</strong> quando il compito da eseguire deve dare una risposta.</p>
<p><strong>Esempio nel caso Runnable</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(()</span> <span class="o">-&gt;</span> <span class="p">{</span>
  <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;Salvataggio dati in corso...&quot;</span><span class="p">);</span>
  <span class="n">Thread</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
  <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;Dati salvati!&quot;</span><span class="p">);</span>
<span class="p">});</span>
<span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;Proseguo subito con altre operazioni!&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Esempio nel caso Callable</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Future</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">futuroRisultato</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(()</span> <span class="o">-&gt;</span> <span class="p">{</span>
    <span class="n">Thread</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">42</span><span class="p">;</span> <span class="o">//</span> <span class="n">Il</span> <span class="n">valore</span> <span class="n">che</span> <span class="n">verrà</span> <span class="n">restituito</span>
<span class="p">});</span>

<span class="o">//</span> <span class="n">Posso</span> <span class="n">fare</span> <span class="n">altro</span> <span class="n">nel</span> <span class="n">frattempo</span><span class="o">...</span>

<span class="o">//</span> <span class="n">Quando</span> <span class="n">serve</span> <span class="n">il</span> <span class="n">valore</span><span class="p">,</span> <span class="n">chiedo</span> <span class="n">al</span> <span class="s2">&quot;Future&quot;</span>
<span class="o">//</span> <span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="n">è</span> <span class="n">bloccante</span><span class="p">:</span> <span class="n">aspetta</span> <span class="n">che</span> <span class="n">il</span> <span class="n">task</span> <span class="n">finisca</span>
<span class="n">Integer</span> <span class="n">risultato</span> <span class="o">=</span> <span class="n">futuroRisultato</span><span class="o">.</span><span class="n">get</span><span class="p">();</span>
<span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;Il risultato è: &quot;</span> <span class="o">+</span> <span class="n">risultato</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Esempio di annullamento</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Future&lt;?&gt; taskLungo = executor.submit(() -&gt; {
    // ...operazione lunga...
});

// Se dopo un po&#39; non serve più
taskLungo.cancel(true);
</pre></div>
</div>
<p>Se si usa solo <strong>submit()</strong>, lo ScheduledExecutor si comporta esattamente come un normale
<em>SingleThreadExecutor</em>. Tuttavia, la <strong>versione “Scheduled”</strong> dà un vantaggio: eseguire
compiti che new Thread non può fare facilmente:</p>
<ul class="simple">
<li><p>Esecuzione periodica (es. Heartbeat/Ping)</p></li>
<li><p>Esecuzione ritardata (Delay)</p></li>
</ul>
<p>Se, in futuro, l’applicazione volesse far partire un task dopo un certo tempo,
si avrebbe già lo strumento pronto.</p>
<p><strong>Come opera un executor newSingleThreadScheduledExecutor</strong></p>
<p>L’executor utilizza una coda interna (una <em>DelayedWorkQueue</em>).</p>
<ul class="simple">
<li><p>Quando si invoca <strong>submit()</strong>, i task vengono messi in coda nell’ordine in cui arrivano.</p></li>
<li><p>Poiché c’è un solo thread disponibile, l’executor torna a prelevare dalla alla coda
solo quando il task corrente è terminato.</p></li>
<li><p>Se il task corrente  lancia un’eccezione non gestita,
l’executor non si blocca, ma cree uno nuovo thread
e passa ad eseguire il nuovo task.</p></li>
<li><p>Un Executor crea thread di tipo “User” (non-daemon). La JVM rimane accesa finché
c’è almeno un thread di questo tipo attivo. Per <strong>terminare</strong>, occorre chiamare:</p>
<ul>
<li><p><strong>executor.shutdown()</strong>: Finisce i compiti che hai già in coda, ma non ne accetta di nuovi”.
Una volta svuotata la coda, il conponente morirà</p></li>
<li><p><strong>executor.shutdownNow()</strong>: Tenta di interrompere i compiti in corso e svuota la coda immediatamente.</p></li>
</ul>
</li>
</ul>
<p><strong>Come terminare in modo automatico un executor</strong></p>
<p>Se si vuole che un Executor si chiuda automaticamente non appena
il programma principale si ferma (senza dover chiamare esplicitamente <em>shutdown</em>),
lo si puoò configurare usando una <em>ThreadFactory</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ScheduledExecutorService</span> <span class="n">executor</span> <span class="o">=</span>
 <span class="n">Executors</span><span class="o">.</span><span class="n">newSingleThreadScheduledExecutor</span><span class="p">(</span><span class="n">runnable</span> <span class="o">-&gt;</span> <span class="p">{</span>
  <span class="n">Thread</span> <span class="n">t</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Thread</span><span class="p">(</span><span class="n">runnable</span><span class="p">);</span>
  <span class="n">t</span><span class="o">.</span><span class="n">setDaemon</span><span class="p">(</span><span class="n">true</span><span class="p">);</span> <span class="o">//</span><span class="n">Questo</span> <span class="n">rende</span> <span class="n">il</span> <span class="n">thread</span> <span class="n">un</span> <span class="s2">&quot;servitore&quot;</span> <span class="n">che</span> <span class="n">muore</span> <span class="n">col</span> <span class="n">main</span>
  <span class="k">return</span> <span class="n">t</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Con <code class="docutils literal notranslate"><span class="pre">setDaemon(true)</span></code>, non appena il thread principale si chiude, anche l’executor
verrà terminato forzatamente dal sistema.</p>
</section>
</section>
<section id="un-progetto-con-gli-executors">
<h2>Un progetto con gli executors<a class="headerlink" href="#un-progetto-con-gli-executors" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 55%" />
<col style="width: 45%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>.</p>
<a class="reference internal image-reference" href="_images/AbstractProtoactorExecutor.png"><img alt="_images/AbstractProtoactorExecutor.png" class="align-center" src="_images/AbstractProtoactorExecutor.png" style="width: 100%;" /></a>
</td>
<td><p>L’idea è introdurre un componente che:</p></td>
</tr>
</tbody>
</table>
<p>Nel package <strong>main.java.protoactor</strong> definiamo le seguenti classi:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 37%" />
<col style="width: 63%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">AbstractProtoactor.java</span></code></p></td>
<td><p>Classe astratta che lascia non definiti i metodi di gestione messaggi
<code class="docutils literal notranslate"><span class="pre">elabDispatch</span></code>, <code class="docutils literal notranslate"><span class="pre">elabRequest</span></code> ed <code class="docutils literal notranslate"><span class="pre">elabEvent</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">SystemSAsPProtoactor.java</span></code></p></td>
<td><p>Specializza  <code class="docutils literal notranslate"><span class="pre">AbstractProtoactor</span></code> definendo la logica applicativa</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CallerMqtt.java</span></code></p></td>
<td><p>Un cliente Java che invoca sistemaS usando mqtt</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CallerProtoactor.html</span></code></p></td>
<td><p>Un cliente HTML che invoca sistemaS usando WS e HTTP</p></td>
</tr>
</tbody>
</table>
</section>
<section id="abstractprotoactor">
<span id="id133"></span><h2>AbstractProtoactor<a class="headerlink" href="#abstractprotoactor" title="Permalink to this heading">¶</a></h2>
<p>Costruiamo una classe che operi come un <strong>MicroFramework</strong> per la costruzione
di componenti ispirati al modello ad <a class="reference internal" href="#gli-attori-come-nuovo-paradigma"><span class="std std-ref">attori</span></a>,
reattivi a messaggi e proattivi.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 70%" />
<col style="width: 30%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">abstract</span> <span class="k">class</span> <span class="nc">AbstractProtoactor</span>
                        <span class="n">implements</span> <span class="n">InteractionBasic</span><span class="p">{</span>
      <span class="n">protected</span> <span class="n">Javalin</span> <span class="n">server</span>  <span class="o">=</span> <span class="n">null</span><span class="p">;</span>
<span class="o">/*</span><span class="mi">1</span><span class="o">*/</span> <span class="n">protected</span> <span class="n">ScheduledExecutorService</span> <span class="n">taskexecutor</span><span class="o">=</span>
        <span class="n">Executors</span><span class="o">.</span><span class="n">newSingleThreadScheduledExecutor</span><span class="p">();</span>
<span class="o">/*</span><span class="mi">2</span><span class="o">*/</span> <span class="n">public</span> <span class="n">AbstractProtoactor</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">){</span>
          <span class="n">this</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
<span class="o">/*</span><span class="mi">3</span><span class="o">*/</span>     <span class="n">configureJavalin</span><span class="p">();</span>
      <span class="p">}</span>
<span class="o">/*</span><span class="mi">4</span><span class="o">*/</span><span class="n">protected</span> <span class="n">abstract</span> <span class="n">void</span> <span class="n">elabDispatch</span><span class="p">(</span><span class="n">IApplMessage</span> <span class="n">m</span><span class="p">);</span>
    <span class="n">protected</span> <span class="n">abstract</span> <span class="n">IApplMessage</span> <span class="n">elabRequest</span><span class="p">(</span><span class="n">IApplMessage</span> <span class="n">req</span><span class="p">);</span>
    <span class="n">protected</span> <span class="n">abstract</span> <span class="n">void</span> <span class="n">elabEvent</span><span class="p">(</span><span class="n">IApplMessage</span> <span class="n">ev</span> <span class="p">);</span>

<span class="o">/*</span><span class="mi">5</span><span class="o">*/</span> <span class="n">protected</span> <span class="n">void</span> <span class="n">configureJavalin</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">setWorkHTTP</span><span class="p">();</span>
        <span class="n">setWorkWS</span><span class="p">(</span> <span class="p">);</span>
      <span class="p">}</span>

        <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
<td><ol class="arabic simple">
<li><p>la classe implementa la interfaccia <a class="reference internal" href="#interactionbasic"><span class="std std-ref">InteractionBasic</span></a>,
come fatto in <a class="reference internal" href="#interazioni-locali"><span class="std std-ref">Interazioni locali</span></a> come anticipazione di
<span class="xref std std-ref">Comunicazioni basate sui nomi dei componenti</span></p></li>
<li><p>creazione dell’executor dei task applicativi</p></li>
<li><p>costruttore che riceve un <strong>nome</strong> da dare al componente</p></li>
<li><p>invocazione del metodo che inizializza la variabile <strong>server</strong> ad un server javalin</p></li>
<li><p>metodi <strong>abstract</strong> che devono essere definiti da classi specializate</p></li>
<li><p>inzializzazione del server javalin per gestire sia HTTP sia WS</p></li>
</ol>
</td>
</tr>
</tbody>
</table>
<p>Grazie a javalin, i componenti potranno erogare pagine HTML e
ricevere messaggi via WebSocket.</p>
<p>La classe implementa la interfaccia <a class="reference internal" href="#interactionbasic"><span class="std std-ref">InteractionBasic</span></a> per permettere
anche la ricezioni di messaggi da parte di componenti locali alla stessa JVM,
come già discusso in <a class="reference internal" href="#interazioni-locali"><span class="std std-ref">Interazioni locali</span></a>.</p>
<p id="comunicazioni-basate-sui-nomi-dei-coponenti">In prosepttiva, si vuole generalizzare l’idea di un componente software con cui interagire inviando
messaggi, anche quando questi gli sono recapitati usando la memoria locale.</p>
<ul class="simple">
<li><p>Ovviamente le interazioni su memoria locale sono possibili solo da parte di clienti/caller che
condividono la steaa JVM del componente. Un esempio è mostrato in <span class="xref std std-ref">MainConwayLifeCmdOnmemory</span>.</p></li>
</ul>
<p>Notiamo che questa possibilità di interazione supera l’idea che per comunicare
con un ‘attore’ software sia necessario avare una conessione di rete.</p>
<p>Si fa strada l’idea che per comunicare con un componente dotato di un nome (ad esempio <em>‘service’</em>)
sia solo necessario conosecrne il nome, lasciando alla ‘parte sommersa’ il compito
di scegliere la via tecnologica più opportuna per recapitare il messaggio al componente
con quel nome.</p>
<p>Viene subito alla mente, come analogia, il DNS delle reti di calcolatori.
Noi introdurremo supporti simili in un futuro capitolo.</p>
<section id="gestione-dei-messaggi-via-ws">
<h3>Gestione dei messaggi via WS<a class="headerlink" href="#gestione-dei-messaggi-via-ws" title="Permalink to this heading">¶</a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 70%" />
<col style="width: 30%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="o">/*</span><span class="mi">1</span><span class="o">*/</span><span class="n">ws</span><span class="o">.</span><span class="n">onMessage</span><span class="p">(</span><span class="n">ctx</span> <span class="o">-&gt;</span> <span class="p">{</span>
<span class="o">/*</span><span class="mi">2</span><span class="o">*/</span><span class="n">IApplMessage</span> <span class="n">am</span> <span class="o">=</span> <span class="n">readInputWS</span><span class="p">(</span> <span class="n">ctx</span><span class="o">.</span><span class="n">message</span><span class="p">()</span> <span class="p">);</span>
<span class="o">/*</span><span class="mi">3</span><span class="o">*/</span><span class="k">if</span><span class="p">(</span> <span class="n">am</span><span class="o">.</span><span class="n">isEvent</span><span class="p">()</span> <span class="o">||</span> <span class="n">am</span><span class="o">.</span><span class="n">isDispatch</span><span class="p">()</span> <span class="p">)</span> <span class="n">elabMsg</span><span class="p">(</span><span class="n">am</span><span class="p">);</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">am</span><span class="o">.</span><span class="n">isRequest</span><span class="p">()</span> <span class="p">)</span> <span class="n">elabRequest</span><span class="p">(</span> <span class="n">am</span><span class="p">,</span> <span class="n">ctx</span> <span class="p">);</span>
<span class="p">});</span>

<span class="o">/*</span><span class="mi">4</span><span class="o">*/</span><span class="n">protected</span> <span class="n">void</span> <span class="n">elabMsg</span><span class="p">(</span><span class="n">IApplMessage</span> <span class="n">am</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">am</span><span class="o">.</span><span class="n">isEvent</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">executeTask</span><span class="p">(</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">elabEvent</span><span class="p">(</span><span class="n">am</span><span class="p">)</span> <span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">am</span><span class="o">.</span><span class="n">isDispatch</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">executeTask</span><span class="p">(</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">elabDispatch</span><span class="p">(</span><span class="n">am</span><span class="p">)</span> <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="o">/*</span><span class="mi">5</span><span class="o">*/</span><span class="n">protected</span> <span class="n">void</span> <span class="n">executeTask</span><span class="p">(</span><span class="n">Runnable</span> <span class="n">applTask</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">taskexecutor</span><span class="o">.</span><span class="n">execute</span><span class="p">(()</span> <span class="o">-&gt;</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">applTask</span><span class="o">.</span><span class="n">run</span><span class="p">();</span>
        <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="ne">Exception</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{</span><span class="o">...</span> <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>

<span class="o">/*</span><span class="mi">6</span><span class="o">*/</span> <span class="n">protected</span> <span class="n">void</span> <span class="n">elabRequest</span><span class="p">(</span>
          <span class="n">IApplMessage</span> <span class="n">am</span><span class="p">,</span>  <span class="n">WsMessageContext</span> <span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">am</span><span class="o">.</span><span class="n">isRequest</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span> <span class="o">//</span><span class="n">defensive</span> <span class="n">programming</span>
        <span class="n">taskexecutor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="p">{</span>
<span class="o">/*</span><span class="mi">7</span><span class="o">*/</span>     <span class="n">IApplMessage</span> <span class="n">replyMsg</span> <span class="o">=</span> <span class="n">elabRequest</span><span class="p">(</span><span class="n">am</span><span class="p">);</span>
<span class="o">/*</span><span class="mi">8</span><span class="o">*/</span>     <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span> <span class="n">replyMsg</span><span class="o">.</span><span class="n">toJsonString</span><span class="p">()</span> <span class="p">);</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">}</span>
<span class="o">...</span>
</pre></div>
</div>
</td>
<td><ol class="arabic simple">
<li><p>javalin WS riceve un messaggio su una connessione</p></li>
<li><p>il messaggio viene letto come <em>ApplMesage</em></p></li>
<li><p>se il messaggio non richiede reply, lo si elabora (metodi 4,5) come evento o come dispatch
invocando i rispettivi metodi applicativi specializzati</p></li>
<li><p>metodo di gestione di messaggi non-request</p></li>
<li><p>metodo che esegue la procedura applicativa specializzata</p></li>
<li><p>metodo di gestione di una request</p></li>
<li><p>invocazione della procedura applicativa specializzata</p></li>
<li><p>invio della <strong>reply</strong> sulla connessione del richiedente</p></li>
</ol>
</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="sistemasasprotoactor">
<span id="id134"></span><h2>SistemaSAsProtoactor<a class="headerlink" href="#sistemasasprotoactor" title="Permalink to this heading">¶</a></h2>
<p>Grazie alla classe <code class="docutils literal notranslate"><span class="pre">AbstractProtoactor.java</span></code> tutti i dettagli tecnologici reltativi a <em>javalin</em>,
alle interazioni sincrone e/o asincrone e alla gestione dei messaggi che arrivano dalla rete è
ora introdotta nella ‘parte sommersa’ del componente.</p>
<p>Le operazioni <code class="docutils literal notranslate"><span class="pre">elabDispatch</span></code>, <code class="docutils literal notranslate"><span class="pre">elabEvent</span></code> e <code class="docutils literal notranslate"><span class="pre">elabRequest</span></code> contengono la logica applicativa
di gestione dei messaggi</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>package main.java.javalin.actor;
import unibo.basicomm23.interfaces.IApplMessage;
import unibo.basicomm23.utils.CommUtils;

public class SistemaSAsProtoactor extends AbstractProtoactor{

protected Future&lt;?&gt; myLocalTask;

  public SistemaSAsProtoactor(String name) {
    super(name);
    //myLocalTask = executor.submit( () -&gt; proactiveTask() );
  }

  protected double eval(double x) {
    CommUtils.outblue(name + &quot; | eval: &quot; + x);
    if (x &gt; 4.0) {
        CommUtils.outmagenta(name + &quot; | Simulo ritardo per x=&quot;+x);
        CommUtils.delay(10000);
      }
    return Math.sin(x) + Math.cos( Math.sqrt(3)*x);
  }

  @Override
  protected void elabEvent(IApplMessage ev ) {
  CommUtils.outblue(name + &quot; | elabEvent:&quot; + ev);
  }

  @Override
    protected IApplMessage elabRequest(IApplMessage req ) {
       if( req.msgId().equals(&quot;eval&quot;)){
        double x      = Double.parseDouble(req.msgContent());
        double result = eval(x);
        IApplMessage replyMsg =
          CommUtils.buildReply(name,req.msgId(),
                               &quot;&quot;+result,req.msgSender());
        return replyMsg;
      }else{
        IApplMessage replyMsg =
          CommUtils.buildReply(name,req.msgId(),
                         &quot;requestUnkown&quot;,req.msgSender());
        return replyMsg;
      }
    }

  @Override
    protected void elabDispatch(IApplMessage m ) {
      CommUtils.outblue(name + &quot; | elabDispatch from&quot; + m.msgSender());
    }

  protected void proactiveTask() {
    CommUtils.outgreenname + &quot; | proactiveTask doing nothing .....&quot;  );
  }

  public static void main(String[] args) {
      new SistemaSAsProtoactor(&quot;sistemaS&quot;) ;
   }
}
</pre></div>
</div>
<p>Questo componente opera in modo <strong>message-driven</strong> in quanto i suoi metodi sono invocati dalla ‘parte sommersa’
del <em>MIcro-framework</em> elabora in modo FIFO i messaggi.</p>
<ul class="simple">
<li><p>Le operazioni <code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">elabEvent(IApplMessage</span> <span class="pre">ev</span> <span class="pre">)</span></code> e <code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">elabDispatch(IApplMessage</span> <span class="pre">ev</span> <span class="pre">)</span></code>
contengono la logica applicativa relativa alla gestione di un evento e di un dispatch rispettivamente.</p></li>
<li><p>La operazione <code class="docutils literal notranslate"><span class="pre">IApplMessage</span> <span class="pre">elabRequest(IApplMessage</span> <span class="pre">req)</span></code> deve reastituire la <strong>reply</strong> che
la parte ‘soomersa’ (ereditata) farà pervenire a chi aveva inviato la richiesta,
usando la relativa forma di comunicazione (WS o HTTP o MQTT).</p></li>
</ul>
<p>L’operazione <code class="docutils literal notranslate"><span class="pre">proactiveTask</span></code> viene introdotta per enfatizzare il <em>problema dei due padorni</em> che sorge
quando si introduce a livello applicativo un nuovo Thread ignorando che esiste un Thread ereditato
che implementa la <strong>Inversion of Control</strong> (IoC) e che quindi ‘inietta comportamenti’ a livello applicativo.</p>
<p>Ad esempio:</p>
<section id="proactivetask">
<span id="id135"></span><h3>proactiveTask<a class="headerlink" href="#proactivetask" title="Permalink to this heading">¶</a></h3>
<p>In questo esempio, l’operazione <em>proactiveTask</em> (che viene opzionalmente eseguita in un Thread autonomo alla costruzione)
emette, ogni 2 sec,  un evento cche segnala l’ora corrente.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="n">protected</span> <span class="n">void</span> <span class="n">proactiveTask</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">CommUtils</span><span class="o">.</span><span class="n">outgreen</span><span class="p">(</span><span class="s2">&quot;SistemaSAsProtoactor | proactiveTask started .....&quot;</span>  <span class="p">);</span>
  <span class="k">while</span><span class="p">(</span><span class="n">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">CommUtils</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">allConns</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">String</span> <span class="n">time</span> <span class="o">=</span> <span class="n">LocalTime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">getMinute</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span>  <span class="o">+</span> <span class="n">LocalTime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">getSecond</span><span class="p">();</span>
      <span class="n">CommUtils</span><span class="o">.</span><span class="n">outyellow</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; | emitInfo &quot;</span>  <span class="o">+</span> <span class="n">time</span><span class="p">);</span>
      <span class="n">emitInfo</span><span class="p">(</span> <span class="n">time</span> <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Per un esempio di interazione con iquesto componente si veda:
<code class="docutils literal notranslate"><span class="pre">main.java.protoactor.CallerProtoactor.html</span></code></p>
<p>In questo esempio, non vi sono’interferenze’ con il task di gestione dei messaggi.
Tuttavia, questo modo di organizzare la struttura interna del componente potrebbe creare un conflitto tra le azioni
di gestione dei messaggi  e il thread che segue <em>proactiveTask</em>.
Per questo motivo, in una futura evoluzione del micro-framework, si imposterà la esecuzione del componente
come un automa a stati finiti (FSM - <em>Finite State Machine</em>) .</p>
</section>
</section>
<section id="visualizziamo-quanto-emesso-dal-server">
<h2>Visualizziamo quanto emesso dal server<a class="headerlink" href="#visualizziamo-quanto-emesso-dal-server" title="Permalink to this heading">¶</a></h2>
<p>Il <a class="reference internal" href="#sistemasasprotoactor"><span class="std std-ref">SistemaSAsProtoactor</span></a> emette informazioni sulle connessioni WS attive
che fino ad ora sono state rese visibili
aprendo gli <strong>Strumenti per sviluppatori</strong> (tasto <strong>F12</strong>) di un browser.</p>
<p>Non è però complicato fare in modo che queste informazioni siano rese visibili mediante una pagina HTML,
come quella definita nel file <code class="docutils literal notranslate"><span class="pre">main.java.protoactor.SistemaSOutpage.html</span></code>: basta utilizzare la operazione
<a class="reference internal" href="#emitinfo"><span class="std std-ref">emitInfo</span></a> definita nella classe astratta <a class="reference internal" href="#abstractprotoactor"><span class="std std-ref">AbstractProtoactor</span></a>.</p>
<section id="sistemasoutpage-html">
<h3>SistemaSOutpage.html<a class="headerlink" href="#sistemasoutpage-html" title="Permalink to this heading">¶</a></h3>
<p>In questa pagina HTML definiamo un elemento <code class="docutils literal notranslate"><span class="pre">&lt;ol&gt;</span></code> denominato <strong>msgslist</strong>
che popoleremo di item che rappresentano le informazioni emesse dal server sulle connessioni WS attive.</p>
<p>la funzione <strong>addItem</strong> aggiunge dinamicamente un elemento alla lista; essa viene invocate dall’handler
<code class="docutils literal notranslate"><span class="pre">socketWS.onmessage</span></code> che a sua volta è attivato quando il server javalin del <a class="reference internal" href="#sistemasasprotoactor"><span class="std std-ref">SistemaSAsProtoactor</span></a>
‘scrive’ dati sulle connessioni WS attive.</p>
<p>Un <strong>button</strong> attiva, quando cliecked,  la funzione <strong>clearOutArea</strong> che svuota la lista</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;&lt;title&gt;SistemaSOutpage&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
  &lt;h2&gt;SistemaS outpage&lt;/h2&gt;
&lt;hr/&gt;
  &lt;!--  OUTPUT AREA --&gt;
    &lt;ol id=&quot;msgslist&quot;&gt;&lt;/ol&gt;
    &lt;button type=&quot;button&quot; onclick=
        clearOutArea()&gt;Remove Messages&lt;/button&gt;

&lt;script&gt;
  function  connectWS(){
  /*1*/const socketWS =
    new WebSocket(&quot;ws://localhost:8080/eval&quot;);

  /*2*/socketWS.onopen = () =&gt; {
      addItem(&quot;Connesso a eval&quot;);
    }

  /*3*/socketWS.onmessage = (event) =&gt; {
    if( event.data !== &quot;PING&quot; ){
          addItem(event.data);
      }
    }
  }//callWS

 //outarea.js
  const list = document.getElementById(&quot;msgslist&quot;)

  function addItem(item){
    const li = document.createElement(&#39;li&#39;);
    li.appendChild(document.createTextNode(item))
    list.appendChild(li);
  }

  function clearOutArea(){
    const lista = document.getElementById(&#39;msgslist&#39;);
    lista.innerHTML = &#39;&#39;; // Rimuovi tutti i nodi figli
  }

  connectWS();
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></div>
</div>
</section>
</section>
</section>
<section id="game-of-life-con-protoattori">
<span id="id136"></span><h1>Game of Life con protoattori<a class="headerlink" href="#game-of-life-con-protoattori" title="Permalink to this heading">¶</a></h1>
<p>Nella sezione <span class="xref std std-ref">Costruiamo il Game of Life in Java</span>
abbiamo realizzato un sistema software che realizza il gioco <span class="xref std std-ref">Game of Life di Conway</span>
impostandolo con una archicettura a oggetti, che riportiamo qui</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 55%" />
<col style="width: 45%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>.</p>
<a class="reference internal image-reference" href="_images/LifeGameJava+.jpg"><img alt="_images/LifeGameJava+.jpg" class="align-center" src="_images/LifeGameJava+.jpg" style="width: 100%;" /></a>
</td>
<td><ul class="simple">
<li><p><strong>Cell</strong>: elemento fondamentale del gioco</p></li>
<li><p><strong>Grid</strong>: aggregato di <code class="docutils literal notranslate"><span class="pre">Cell</span></code></p></li>
<li><p><strong>Life</strong>: regole del gioco</p></li>
<li><p><strong>IOutDev</strong>: contratto per la visualizzazione dello stato di una <code class="docutils literal notranslate"><span class="pre">Cell</span></code></p></li>
<li><p><strong>LifeController</strong>: controllo del gioco e visualizzazione della <code class="docutils literal notranslate"><span class="pre">Grid</span></code></p></li>
<li><p><strong>Gamecontroller</strong>: contratto che <code class="docutils literal notranslate"><span class="pre">LifeController</span></code> impone ai dispositivi in input</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Ridefiniamo ora il componente <a class="reference internal" href="#lifecontroller"><span class="std std-ref">LifeController</span></a> come una specializzazione
della classe <a class="reference internal" href="#abstractprotoactor"><span class="std std-ref">AbstractProtoactor</span></a>:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">LifeController</span></code> è un componente proattivo e reattivo che può elaborare messaggi
strutturati (di tipo <a class="reference internal" href="#iapplmessage"><span class="std std-ref">IApplMessage</span></a>) che gli giungono via WS sulla porta <code class="docutils literal notranslate"><span class="pre">8080</span></code></p></li>
<li><p>dunque <code class="docutils literal notranslate"><span class="pre">LifeController</span></code> può essere pensato come un <strong>proto-attore</strong> che riceve comandi
da una pagina HTML ad esso connessa via WS</p></li>
<li><p>la parte proattiva del <em>proto-attore</em> esegue il controllo del gioco, sensibile
ai cambiamenti apportati dalla parte reattiva ai comandi.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LifeController</span></code> eredita la possibilità di <strong>inviare</strong>
informazioni via WebSocket a una pagina <code class="docutils literal notranslate"><span class="pre">HTML</span></code> e <strong>ricevere</strong> da questa comendi di gsstione del gioco.</p></li>
</ol>
<p>Ciò elimina la necessità di introdurre dispositivi di I/O , portando l’architettura del sistema ad evolvere
come segue:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 55%" />
<col style="width: 45%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>.</p>
<a class="reference internal image-reference" href="_images/LifeControllerProtoactor.png"><img alt="_images/LifeControllerProtoactor.png" class="align-center" src="_images/LifeControllerProtoactor.png" style="width: 100%;" /></a>
</td>
<td><p>La pagina HTML funge da:</p>
<ul class="simple">
<li><p><strong>dispositvo di output</strong> per visualizzare lo stato della <code class="docutils literal notranslate"><span class="pre">Grid</span></code></p></li>
<li><p><strong>dispositivo di input</strong> per inviare comandi al <code class="docutils literal notranslate"><span class="pre">LifeControllerProtoactor</span></code>.</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p id="lifecontrollerprotoactor">Il <a class="reference internal" href="#proactivetask"><span class="std std-ref">proactiveTask</span></a> del componente diventa ora il <strong>task play</strong> che fa evolvere il gioco
secondo quanto discusso in <a class="reference internal" href="#evoluzione-di-goflife"><span class="std std-ref">Il processo di evoluzione del gioco</span></a></p>
<p id="mainconwaylifecmdonmemory">Il gioco può essere comandato anche da messaggi inviati ‘onmemory’:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>public class MainConwayLifeJavaOnmemory  {
  private String startMsg = &quot;msg(cmd,dispatch,caller1,lifectrl,start,0)&quot;;
  private String stopMsg  = &quot;msg(cmd,dispatch,caller1,lifectrl,stop,0)&quot;;
  private String m        = &quot;msg(cmd, dispatch, caller1, lifectrl, CELL, 0 )&quot;;
  private String nepoch   = &quot;msg(nepoch, request, caller1, lifectrl, nepoch, 0 )&quot;;

  public void doJob() {
      Life life                   = new Life( 20,20 );   //ncell in iomap.js
      LifeControllerProtoactor cc = new LifeControllerProtoactor(&quot;lifectrl&quot;,life);
      configureAndGo( cc );
  }
  protected void configureAndGo( LifeControllerProtoactor cc) {
    while( ! cc.isReady()) { //cc diventa ready quando è stata aperta la pagina
      CommUtils.delay(1000);
      CommUtils.outblue(&quot;configureAndGo waits ...&quot;);
    }
    /* Inizializza alcune celle vive */
    cc.forward( new ApplMessage( m.replace(&quot;CELL&quot;, &quot;cell(0,1)&quot;) ));
    cc.forward( new ApplMessage( m.replace(&quot;CELL&quot;, &quot;cell(1,1)&quot;) ));
    cc.forward( new ApplMessage( m.replace(&quot;CELL&quot;, &quot;cell(2,1)&quot;) ));
    /* Avvia il gioco */
    cc.forward( new ApplMessage(startMsg) );
    /* Lascia evolvere il gioco*/
    CommUtils.delay(3000);
    /* Richiede il numero di epoche trascorse */
    try {
      IApplMessage answer = cc.request( new ApplMessage( nepoch ));
      CommUtils.outblack(&quot;caller answer=&quot; + answer);
      CommUtils.delay(500);
      IApplMessage answer1 = cc.request( new ApplMessage( nepoch ));
      CommUtils.outblack(&quot;caller answer1=&quot; + answer1);
    } catch (Exception e) { e.printStackTrace(); }
    /* Lascia evolvere il gioco ancora un po&#39;*/
    CommUtils.delay(5000);
    /* Ferma il gioco */
    cc.forward(new ApplMessage(stopMsg));
    CommUtils.outblue(&quot;configureAndGo BYE&quot;);
  }

    public static void main(String[] args) {
      CommUtils.aboutThreads(&quot;MainConway | STARTS &quot; ); //Richiede dipendenze
      MainConwayLifeJavaOnmemory app = new MainConwayLifeJavaOnmemory();
      app.doJob();
    }
}
</pre></div>
</div>
<section id="oltre-comportamenti-message-driven">
<span id="id137"></span><h2>Oltre comportamenti message-driven<a class="headerlink" href="#oltre-comportamenti-message-driven" title="Permalink to this heading">¶</a></h2>
<p>Emerge dunque una nuova idea: abbandonare lo schema <em>messag-driven</em> e fare in modo che sia il componente a <strong>decidere</strong> quando
compiere azioni autonome oppure quando elaborare messaggi.</p>
<p>Questio obiettivo si può raggiungere strutturando il codice del componente come un <strong>automa a stati finiti</strong>.</p>
<p>E’ quello che faremo nel capitolo <a class="reference internal" href="#il-linguaggio-qak"><span class="std std-ref">Il linguaggio qak</span></a>, introducendo anche un <em>nuovo linguaggio</em>,
per espriemere in modo
esplicito tutti i concetti che fino ad ora sono stati implicitamente introdotti mediante le librerie.</p>
</section>
</section>
<section id="sistemi-a-microservizi">
<span id="id138"></span><h1>Sistemi a Microservizi<a class="headerlink" href="#sistemi-a-microservizi" title="Permalink to this heading">¶</a></h1>
<p>I sistemi software composti da microservizi rappresentano l’apice di un’evoluzione
che ha visto i sistemi informatici
trasformarsi da semplici programmi a complicate infrastrutture distribuite.</p>
<p>Le principali tappe che hanno segnato questo cambiamento possono essere visualizzate e riassunte come
riportato in <a class="reference external" href="_static/docs/msoIEEE.pdf">mshistory</a> .</p>
<p>Le motivazioni che spingono le aziende industriali verso i microservizi sono molteplici e spesso legate alla
necessità di gestire sistemi complessi e scalabili, migliorare la resilienza, accelerare l’innovazione,
e supportare la trasformazione digitale.</p>
<section id="motivazioni-all-uso-dei-microservizi">
<h2>Motivazioni all’uso dei microservizi<a class="headerlink" href="#motivazioni-all-uso-dei-microservizi" title="Permalink to this heading">¶</a></h2>
<p>L’architettura a microservizi offre la flessibilità necessaria
per rispondere a queste sfide, permettendo alle aziende di adattarsi più facilmente alle evoluzioni
del mercato e alle esigenze operative.</p>
<section id="scalabilita-e-prestazioni">
<h3>Scalabilità e Prestazioni<a class="headerlink" href="#scalabilita-e-prestazioni" title="Permalink to this heading">¶</a></h3>
<p>Le aziende industriali spesso gestiscono sistemi di produzione e automazione che richiedono una scalabilità
elevata per supportare un numero crescente di sensori, macchine, impianti o clienti.
L’architettura monolitica può diventare inefficiente quando i sistemi crescono in termini di carico e complessità.</p>
<p><strong>Microservizi</strong>: Permettono di scalare singoli componenti (servizi) indipendentemente,
senza dover scalare l’intera applicazione. Ciò è utile quando alcuni servizi, come
l’elaborazione dei dati dei sensori o l’analisi in tempo reale, richiedono più risorse
rispetto ad altri. Questo riduce i costi e ottimizza l’uso delle risorse.</p>
</section>
<section id="manutenibilita-e-aggiornamento">
<h3>Manutenibilità e Aggiornamento<a class="headerlink" href="#manutenibilita-e-aggiornamento" title="Permalink to this heading">¶</a></h3>
<p>I sistemi industriali tendono a diventare molto complessi e possono richiedere aggiornamenti continui
per adattarsi a nuove tecnologie o standard di settore.
La manutenzione di una grande applicazione monolitica può essere difficile e costosa, con rischi di downtime elevati.</p>
<p><strong>Microservizi</strong>: Consentono di aggiornare e mantenere singoli componenti senza interrompere l’intero sistema.
Le aziende possono effettuare modifiche e aggiornamenti a singoli servizi in maniera più rapida e con minori rischi,
migliorando la produttività e riducendo il rischio di guasti durante gli aggiornamenti.</p>
</section>
<section id="sviluppo-autonomo-e-time-to-market">
<h3>Sviluppo autonomo e Time-to-Market<a class="headerlink" href="#sviluppo-autonomo-e-time-to-market" title="Permalink to this heading">¶</a></h3>
<p>In ambito industriale, le aziende spesso necessitano di sviluppare nuove funzionalità in tempi rapidi
per rispondere a nuove richieste del mercato, integrare nuovi macchinari o tecnologie,
o offrire nuove soluzioni ai clienti. Gli approcci monolitici rallentano lo sviluppo perché
richiedono la coordinazione tra più team su un’unica base di codice.</p>
<p><strong>Microservizi</strong>: Permettono ai team di sviluppo di lavorare in parallelo su servizi separati,
con cicli di sviluppo indipendenti.
Questo riduce i tempi di rilascio delle nuove funzionalità, migliorando il time-to-market delle innovazioni,
e consente alle aziende di rispondere più rapidamente alle esigenze del settore.</p>
</section>
<section id="flessibilita-tecnologica">
<h3>Flessibilità Tecnologica<a class="headerlink" href="#flessibilita-tecnologica" title="Permalink to this heading">¶</a></h3>
<p>Le aziende industriali spesso utilizzano una vasta gamma di tecnologie e strumenti, che vanno dai
sistemi legacy agli impianti moderni basati su IoT (<a class="reference external" href="https://en.wikipedia.org/wiki/Internet_of_things">Internet of Things</a>) o AI.
Una singola tecnologia o piattaforma potrebbe non essere adatta per tutti i casi d’uso.</p>
<p><strong>Microservizi</strong>: Consentono di utilizzare diversi stack tecnologici per servizi diversi,
permettendo alle aziende di scegliere la tecnologia più adatta per ogni componente del sistema.
Questo offre una grande flessibilità e consente di integrare più facilmente nuovi strumenti
o tecnologie all’interno dell’architettura aziendale.</p>
</section>
<section id="resilienza-e-tolleranza-ai-guasti">
<h3>Resilienza e Tolleranza ai Guasti<a class="headerlink" href="#resilienza-e-tolleranza-ai-guasti" title="Permalink to this heading">¶</a></h3>
<p>Le aziende industriali richiedono un’alta affidabilità nei loro sistemi, poiché anche brevi interruzioni
nei processi produttivi possono causare perdite significative.
In un’applicazione monolitica, un errore in un singolo componente può bloccare l’intero sistema.</p>
<p><strong>Microservizi</strong>: Migliorano la resilienza poiché i servizi sono isolati e l’errore di un singolo
servizio non comporta necessariamente il fallimento dell’intero sistema.
Questo approccio permette di costruire architetture più robuste e con capacità di recupero automatico
(self-healing), minimizzando l’impatto di eventuali guasti.</p>
</section>
<section id="supporto-per-la-digital-transformation">
<h3>Supporto per la Digital Transformation<a class="headerlink" href="#supporto-per-la-digital-transformation" title="Permalink to this heading">¶</a></h3>
<p>La trasformazione digitale è una priorità per molte aziende industriali, che puntano a modernizzare
i loro impianti e processi tramite automazione, IoT, AI e analisi avanzata dei dati.
Un’architettura monolitica può essere difficile da adattare a queste esigenze, limitando l’integrazione di nuove tecnologie.</p>
<p><strong>Microservizi</strong>: Facilitano l’integrazione di nuovi paradigmi tecnologici come l’IoT,
l’Industria 4.0 e la manutenzione predittiva.
Offrono un’architettura flessibile per gestire grandi quantità di dati in tempo reale e
permettono alle aziende di implementare strategie di trasformazione digitale in modo più efficace.</p>
</section>
<section id="facilita-di-deployment-e-automazione">
<h3>Facilità di Deployment e Automazione<a class="headerlink" href="#facilita-di-deployment-e-automazione" title="Permalink to this heading">¶</a></h3>
<p>L’automazione e il deployment continuo sono fondamentali per aziende che gestiscono complessi sistemi
produttivi distribuiti in diverse località.
La configurazione e il deployment di una grande applicazione monolitica possono essere lenti e complessi.</p>
<p><strong>Microservizi</strong>: Si adattano bene agli approcci DevOps e CI/CD (Continuous Integration/Continuous Deployment).
Permettono di automatizzare il deployment di singoli servizi e di gestire in modo efficiente
l’infrastruttura distribuita tramite container e orchestratori come Docker e Kubernetes.
Ciò accelera il rilascio di nuove versioni e migliora l’efficienza operativa.</p>
</section>
<section id="conformita-e-regolamentazioni">
<h3>Conformità e Regolamentazioni<a class="headerlink" href="#conformita-e-regolamentazioni" title="Permalink to this heading">¶</a></h3>
<p>Le industrie devono spesso rispettare normative complesse (es. norme di sicurezza o ambientali)
che possono variare a seconda della regione o del mercato.
L’aggiornamento di un’applicazione monolitica per garantire la conformità in più giurisdizioni
può essere difficile e rischioso.</p>
<p><strong>Microservizi</strong>: Consentono alle aziende di implementare logiche di conformità e requisiti regolatori
specifici solo nei servizi necessari, senza dover modificare l’intero sistema.
Questo facilita l’adattamento delle applicazioni alle normative locali e alle regole settoriali.</p>
</section>
<section id="monitoraggio-e-analisi-in-tempo-reale">
<h3>Monitoraggio e Analisi in Tempo Reale<a class="headerlink" href="#monitoraggio-e-analisi-in-tempo-reale" title="Permalink to this heading">¶</a></h3>
<p>Il monitoraggio in tempo reale è cruciale per le aziende industriali che gestiscono processi produttivi,
dove il rilevamento immediato di guasti o inefficienze può prevenire danni o interruzioni.</p>
<p><strong>Microservizi</strong>: Facilitano il monitoraggio dettagliato di ogni servizio e componente, offrendo
una maggiore visibilità sui processi. I microservizi possono essere monitorati in modo indipendente,
permettendo di analizzare i problemi in tempo reale e migliorare le prestazioni del sistema globale.</p>
</section>
<section id="gestione-delle-dipendenze-e-interoperabilita">
<h3>Gestione delle Dipendenze e Interoperabilità<a class="headerlink" href="#gestione-delle-dipendenze-e-interoperabilita" title="Permalink to this heading">¶</a></h3>
<p>In ambito industriale, le applicazioni devono spesso integrarsi con una varietà di sistemi legacy,
impianti di produzione, robotica, sensori e strumenti di terze parti. Integrare queste dipendenze
in un’applicazione monolitica può essere complesso e richiede un approccio monolitico pesante.</p>
<p><strong>Microservizi</strong>: Ogni servizio può gestire la propria integrazione con strumenti e tecnologie specifiche,
riducendo la complessità e migliorando l’interoperabilità tra sistemi diversi.
L’uso di API ben definite facilita l’integrazione e la comunicazione tra i vari componenti.</p>
</section>
</section>
<section id="problematiche-dei-microservizi">
<h2>Problematiche dei microservizi<a class="headerlink" href="#problematiche-dei-microservizi" title="Permalink to this heading">¶</a></h2>
<section id="gestione-della-complessita">
<h3>Gestione della complessità<a class="headerlink" href="#gestione-della-complessita" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Con i POJO (monolitico): In un’architettura monolitica, tutti i componenti risiedono nello stesso processo, il che semplifica la gestione della complessità interna. Le interazioni tra oggetti e componenti avvengono attraverso semplici chiamate di metodo e la gestione degli errori è più lineare.</p></li>
<li><p>Con i microservizi: La complessità aumenta perché ogni microservizio è un’entità separata, e la comunicazione tra loro deve avvenire tramite chiamate di rete (HTTP, gRPC, messaggistica, ecc.). Questo introduce problemi di latenza, gestione degli errori distribuiti e coordinamento delle dipendenze tra i servizi.</p></li>
</ul>
</section>
<section id="comunicazione-distribuita">
<h3>Comunicazione distribuita<a class="headerlink" href="#comunicazione-distribuita" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Con i POJO: Le interazioni tra i componenti avvengono tramite invocazioni di metodi locali, che sono rapide e sicure, senza il rischio di fallimenti di rete.</p></li>
<li><p>Con i microservizi: La comunicazione tra i microservizi avviene tramite la rete, il che comporta latenza, errori di rete, timeout, e problematiche legate alla serializzazione/deserializzazione dei dati. Questo richiede anche la gestione delle API e protocolli di comunicazione, introducendo ulteriori livelli di complessità. Inoltre, è necessario implementare meccanismi di retry, circuit breaker, e gestione delle fallimenti parziali.</p></li>
</ul>
</section>
<section id="consistenza-dei-dati">
<h3>Consistenza dei dati<a class="headerlink" href="#consistenza-dei-dati" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Con i POJO: I dati sono gestiti in un database comune all’interno di un’applicazione monolitica. È possibile garantire consistenza transazionale in modo relativamente semplice utilizzando transazioni ACID.</p></li>
<li><p>Con i microservizi: Ogni microservizio potrebbe avere il proprio database, il che rende difficile garantire la consistenza transazionale globale (es. le transazioni distribuite). I microservizi spesso adottano modelli di consistenza eventuale attraverso la propagazione asincrona degli eventi o l’uso di saghe. Questo introduce complessità nella gestione dei dati e nella coerenza dei sistemi.</p></li>
</ul>
</section>
<section id="gestione-delle-dipendenze-e-orchestrazione">
<h3>Gestione delle dipendenze e orchestrazione<a class="headerlink" href="#gestione-delle-dipendenze-e-orchestrazione" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Con i POJO: Tutte le classi e i componenti risiedono nello stesso ambiente di runtime, e le dipendenze tra di loro possono essere gestite attraverso un gestore delle dipendenze (come Maven o Gradle).</p></li>
<li><p>Con i microservizi: Ogni microservizio è un’entità separata con le sue dipendenze. Questo può portare a problemi di compatibilità delle versioni tra servizi diversi. Inoltre, è necessario un sistema di orchestrazione per coordinare l’avvio, lo scaling, la gestione e l’aggiornamento di tutti i servizi, spesso con l’aiuto di strumenti come Kubernetes o Docker.</p></li>
</ul>
</section>
<section id="gestione-dello-stato">
<h3>Gestione dello stato<a class="headerlink" href="#gestione-dello-stato" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Con i POJO: Lo stato viene gestito in memoria o attraverso il database centralizzato, ed è facile mantenere lo stato condiviso tra diversi componenti dell’applicazione.</p></li>
<li><p>Con i microservizi: I microservizi dovrebbero essere stateless o mantenere uno stato isolato, poiché la gestione dello stato distribuito è complessa. Se un microservizio ha bisogno di gestire lo stato, deve fare affidamento su sistemi di storage distribuito o cache distribuita, il che introduce ulteriori complessità e sfide nella coerenza dello stato.</p></li>
</ul>
</section>
<section id="deployment-e-monitoraggio">
<h3>Deployment e monitoraggio<a class="headerlink" href="#deployment-e-monitoraggio" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Con i POJO: In un’applicazione monolitica, il deployment è semplice: si distribuisce un singolo artefatto (es. un file .war o .jar) su un server. Il monitoraggio è anch’esso più semplice perché tutte le informazioni sullo stato del sistema sono in un unico posto.</p></li>
<li><p>Con i microservizi: Ogni microservizio ha il proprio ciclo di vita di deployment e potrebbe essere distribuito indipendentemente. Questo richiede orchestrazione automatizzata, gestione delle versioni e coordinamento per evitare downtime. Inoltre, il monitoraggio diventa più complesso: è necessario tracciare il comportamento di ciascun microservizio, le loro dipendenze e le interazioni tra loro, spesso utilizzando strumenti come Prometheus, ELK stack o Jaeger per il tracing distribuito.</p></li>
</ul>
</section>
<section id="gestione-degli-errori-e-tolleranza-ai-guasti">
<h3>Gestione degli errori e tolleranza ai guasti<a class="headerlink" href="#gestione-degli-errori-e-tolleranza-ai-guasti" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Con i POJO: Gli errori e le eccezioni possono essere gestiti in modo centralizzato, e in un ambiente monolitico è più facile fare rollback completo o ripristinare uno stato coerente in caso di guasti.</p></li>
<li><p>Con i microservizi: Gli errori possono verificarsi in punti diversi del sistema, e devono essere gestiti a livello di ogni microservizio. Il fallimento di un servizio può non impattare l’intero sistema, ma i fallimenti parziali (ad es. un servizio chiave che non risponde) devono essere gestiti attentamente per evitare che il sistema vada in crash o degradi le performance. Tecniche come il circuit breaker, bulkhead pattern e retry sono essenziali per garantire la resilienza dell’architettura.</p></li>
</ul>
</section>
<section id="test-e-debugging">
<h3>Test e debugging<a class="headerlink" href="#test-e-debugging" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Con i POJO: Il testing di un’applicazione monolitica è relativamente semplice. Si possono eseguire test unitari e di integrazione sull’intero sistema in un unico ambiente. Il debugging è diretto, poiché tutte le classi e i componenti sono parte dello stesso processo.</p></li>
<li><p>Con i microservizi: Il testing diventa più complicato, poiché è necessario testare non solo i singoli servizi (test unitari) ma anche le interazioni tra di essi (test di integrazione e contratti). Il debugging di un sistema distribuito è molto più difficile a causa della natura asincrona e della comunicazione tra processi separati. Tecniche come il contract testing e l’uso di strumenti di tracing distribuito diventano fondamentali.</p></li>
</ul>
</section>
<section id="sicurezza">
<h3>Sicurezza<a class="headerlink" href="#sicurezza" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Con i POJO: La sicurezza può essere gestita a livello di applicazione centralizzata, utilizzando autenticazione e autorizzazione in un unico punto.</p></li>
<li><p>Con i microservizi: Ogni microservizio potrebbe richiedere un proprio sistema di sicurezza, o deve integrarsi in un framework di sicurezza distribuito (ad es. OAuth, JWT). Questo introduce complessità nella gestione delle credenziali, autenticazione tra microservizi, e nella protezione dei dati durante le comunicazioni. La gestione della sicurezza deve essere implementata in maniera consistente su tutti i servizi.</p></li>
</ul>
</section>
<section id="sovraccarico-infrastrutturale">
<h3>Sovraccarico infrastrutturale<a class="headerlink" href="#sovraccarico-infrastrutturale" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Con i POJO: Le risorse di calcolo, memoria e archiviazione sono generalmente centralizzate in un’unica applicazione. La gestione delle risorse è relativamente semplice, poiché tutte le componenti condividono lo stesso ambiente.</p></li>
<li><p>Con i microservizi: Ogni microservizio richiede un proprio ambiente di esecuzione, che può comportare un aumento significativo del carico infrastrutturale. Ad esempio, potrebbero essere necessari più container, database separati, logging distribuito e capacità di gestione delle risorse. Questo può aumentare i costi operativi e richiede un’architettura cloud ben progettata per scalare in modo efficiente.</p></li>
</ul>
<p>I microservizi ntroducono anche diverse problematiche e sfide rispetto all’approccio monolitico tradizionale basato su POJO.</p>
</section>
</section>
<section id="dalla-documentazione-al-contratto">
<h2>Dalla “Documentazione” al “Contratto”<a class="headerlink" href="#dalla-documentazione-al-contratto" title="Permalink to this heading">¶</a></h2>
<p>Nel caso dei microservizi, l’API non è più solo una descrizione, ma un Contratto (Design-First API).
Lo standard permette di verificare che il contratto sia rispettato <strong>prima ancora di scrivere una riga di codice</strong>.</p>
<p>Ecco come i microservizi hanno guidato questa standardizzazione:</p>
<p><strong>OpenAPI: Lo standard de facto</strong></p>
<p>Prima dei microservizi, la documentazione delle API era spesso un file Word o un PDF scritto a mano.
Con i microservizi è nato il bisogno di una documentazione <strong>leggibile dalle macchine</strong>.</p>
<ul class="simple">
<li><p><strong>Perché:</strong> Se ho molti microservizi, non posso scrivere manualmente il client per ognuno.</p></li>
<li><p><strong>Risultato:</strong> È nato lo standard <strong>OpenAPI</strong>. Grazie a questo formato (JSON/YAML),
si può generare automaticamente il codice, i test e l’interfaccia grafica per testare l’API.</p></li>
</ul>
<p><strong>Standard per il trasporto e le prestazioni: gRPC</strong></p>
<p>REST (HTTP/JSON) è ottimo ma “pesante” per la comunicazione interna tra migliaia di microservizi.</p>
<ul class="simple">
<li><p><strong>L’innovazione:</strong> Google ha promosso <em>gRPC</em>, che utilizza <strong>Protocol Buffers (protobuf)</strong> come linguaggio
di descrizione dell’interfaccia.</p></li>
<li><p><strong>Lo standard:</strong> <em>gRPC</em> definisce in modo rigoroso come i servizi si chiamano tra loro,
garantendo che un servizio in Java possa parlare con uno in Go senza ambiguità e con prestazioni elevatissime.</p></li>
</ul>
<p><strong>Standard per gli Eventi: AsyncAPI</strong></p>
<p>Come abbiamo visto prima, le architetture software moderne sono spesso “Event-Driven”.</p>
<ul class="simple">
<li><p><strong>La necessità:</strong> Come standardizzare il formato dei messaggi che passano su Kafka o RabbitMQ?</p></li>
<li><p><strong>Risultato:</strong> È nato <strong>AsyncAPI</strong>, che ricalca la struttura di OpenAPI ma la adatta ai sistemi di messaggistica asincrona.</p></li>
</ul>
<p><strong>Standard per l’osservabilità: CloudEvents</strong></p>
<p>In un sistema a microservizi, un evento (es. “Ordine Creato”) può viaggiare tra sistemi diversi (AWS, Azure, server locali).</p>
<ul class="simple">
<li><p><strong>Il problema:</strong> Ogni sistema scriveva i metadati (ora, origine, ID) in modo diverso.</p></li>
<li><p><strong>Lo standard:</strong> La Cloud Native Computing Foundation (CNCF) ha creato <strong>CloudEvents</strong>,
un formato standard per descrivere i dati degli eventi in modo che siano interpretabili da qualsiasi piattaforma.</p></li>
</ul>
<p><strong>Standard per la sicurezza: OAuth2 e JWT</strong></p>
<p>Con centinaia di microservizi, non si può chiedere il login ogni volta che un servizio ne chiama un altro.</p>
<ul class="simple">
<li><p><strong>La soluzione:</strong> Si sono diffusi standard come <strong>OAuth2</strong> e <strong>OpenID Connect</strong>, insieme ai <strong>JWT (JSON Web Tokens)</strong>.
Questi standard permettono a un servizio di “fidarsi” dell’identità dell’utente passata da un altro servizio
tramite un “passaporto” digitale standardizzato.</p></li>
</ul>
</section>
<section id="progettazione-dei-microservizi">
<h2>Progettazione dei microservizi<a class="headerlink" href="#progettazione-dei-microservizi" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Richardson: <a class="reference external" href="https://microservices.io/index.html">https://microservices.io/index.html</a></p></li>
<li><p>Richardson Understanding Microservices (si veda il video):
<a class="reference external" href="https://microservices.io/microservices/2020/02/04/jfokus-geometry-of-microservices.html">https://microservices.io/microservices/2020/02/04/jfokus-geometry-of-microservices.html</a></p></li>
<li><p>Richardson Microservice architecture patern languages: <a class="reference external" href="https://microservices.io/patterns/index.html">https://microservices.io/patterns/index.html</a></p></li>
<li><p>Richardson Decomposizione per sottodominio: <a class="reference external" href="https://microservices.io/patterns/decomposition/decompose-by-subdomain.html">https://microservices.io/patterns/decomposition/decompose-by-subdomain.html</a> :</p></li>
<li><p>Richardson Microservice Architecture: <a class="reference external" href="https://microservices.io/patterns/microservices.html">https://microservices.io/patterns/microservices.html</a> :</p></li>
<li><p>Api Gateway, Service Discovery, Circuit Breaker, Event Sourcing, CQRS, Saga, etc.</p></li>
<li><p>Il concetto di <cite>aggregator</cite>. Un possibile riferimento
<a class="reference external" href="https://medium.com/nerd-for-tech/design-patterns-for-microservices-aggregator-pattern-99c122ac6b73">https://medium.com/nerd-for-tech/design-patterns-for-microservices-aggregator-pattern-99c122ac6b73</a></p></li>
</ul>
</section>
</section>
<section id="il-linguaggio-qak">
<span id="id139"></span><h1>Il linguaggio qak<a class="headerlink" href="#il-linguaggio-qak" title="Permalink to this heading">¶</a></h1>
<p>Nei capitoli precedenti abbiamo introdotto l’idea
che gran parte del software contemporaneo possa essere descritto come un ecosistema
di servizi e attori, considerando gli <strong>attori</strong>
come  un (nuovo) <a class="reference internal" href="#gli-attori-come-nuovo-paradigma"><span class="std std-ref">paradigma computazionale</span></a>
più adeguato ad affrontare le problematiche architetturali e computazionali
di questa nuova generazione di sistemi.</p>
<p>Su questa base, abbiamo definito alcune librerie e classi per cercare di colmare
<a class="reference internal" href="#l-abstraction-gap"><span class="std std-ref">L’Abstraction gap</span></a> che si manifesta rispetto a Java, la nostra tecnologia-base di riferimento.
Ricordiamo in particolare:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#unibo-basicomm23-1-0"><span class="std std-ref">unibo.basicomm23-1.0</span></a>.jar: un insieme di classi per superare le differenze tecnologiche relative
ai diversi protocolli di comunnicazione di rete, attraverso la introduzione del
concetto (astratto) di <a class="reference internal" href="#interconnessione"><span class="std std-ref">Interconnessione</span></a></p></li>
<li><p><a class="reference internal" href="#abstractprotoactor"><span class="std std-ref">AbstractProtoactor</span></a>:  una classe come un <em>MicroFramework</em> per la costruzione di componenti
ispirati al modello ad attori.</p></li>
</ul>
<p>Nella sezione <a class="reference internal" href="#oltre-comportamenti-message-driven"><span class="std std-ref">Oltre comportamenti message-driven</span></a>, abbiamo ipotizzato una <strong>evoluzione</strong>
del <em>MicroFramework</em> basata sulla idea che sia un attore a <strong>decidere quando elaborare</strong>
un messaggio, in modo da conciliare meglio il suo comportamento reattivo (di risposta ai messaggi)
con il suo comportamento proattivo.</p>
<p>Questo obiettivo può ancora essere raggiunto introducendo una libreria. Infatti:</p>
<ul class="simple">
<li><p>la libreria <strong>unibo.qakactor23-5.0.jar</strong>  fornisce il supporto che realizza il concetto
di attore come un <strong>Automa  Stati Finiti</strong>
(precisamente come una <a class="reference external" href="https://it.wikipedia.org/wiki/Macchina_di_Moore">Macchina di Moore</a>), le cui transizioni di stato possono essere
dovute a decisioni interne ed autonome e/o alla volontà dell’attore di elaborare un messaggio.</p></li>
</ul>
<section id="attori-qak">
<h2>Attori qak<a class="headerlink" href="#attori-qak" title="Permalink to this heading">¶</a></h2>
<p>Il concetto di attore che ‘emerge’ dalla libreria <em>unibo.qakactor23-5.0.jar</em> viene denominato <a class="reference internal" href="#qactor"><span class="std std-ref">QActor</span></a>.
La libreria implementa i componenti <em>QActor</em> come
specializzazione classe astratta <a class="reference internal" href="#it-unibo-kactor-actorbasicfsm-kt"><span class="std std-ref">it.unibo.kactor.ActorBasicFsm.kt</span></a>
che a sua volta specializza la classe astratta <strong>it.unibo.kactor.ActorBasic.kt</strong>.</p>
<p>La ragione del prefisso <strong>Q</strong> (che significa <strong>quasi</strong>) nasce percheè
vi sono molteplici modi di concepire il concetto di <em>QActor</em>,
che è <strong>interpretabile</strong> in modi diversi:</p>
<ol class="arabic simple">
<li><p>un <strong>macro-componente</strong> del sistema che opera seguendo il
<a class="reference internal" href="#gli-attori-come-nuovo-paradigma"><span class="std std-ref">paradigma computazionale degli attori</span></a></p></li>
<li><p>un <strong>nano-servizio</strong>  che interagsice con altri nano-servizi del suo ambiente locale (una JVM)
mediante canali Kotlin</p></li>
<li><p>un <strong>(micro)servizio</strong> che interagisce con il mondo esterno via TCP o MQTT</p></li>
<li><p>una <strong>risorsa CoAP</strong> che interagisce con il mondo esterno mediante il paradigma REST</p></li>
<li><p>un <strong>componente cognitivo</strong> dotato di una base di conoscenza interna e di capacità inferenziali
fornite da un interprete Prolog.</p></li>
</ol>
<p>Un QActor <strong>non è</strong> un <a class="reference internal" href="#agente"><span class="std std-ref">Agente</span></a> vero e proprio, ma possiede proprietà e meccanismi che
facilitiano la costruzione di agenti capaci di interagire tra loro e con l’ambiente.</p>
<p>Un <strong>QActor cognitivo</strong>  integra le sue azioni
con una base di conoscenza logica interna (<code class="docutils literal notranslate"><span class="pre">KB</span> <span class="pre">=</span> <span class="pre">fatti</span> <span class="pre">+</span> <span class="pre">regole</span></code>), che abilita ragionamento simbolico,
inferenza e decisione basata sul contesto.</p>
</section>
<section id="non-solo-libreria-il-liguaggio-qak">
<h2>Non solo libreria: il liguaggio qak<a class="headerlink" href="#non-solo-libreria-il-liguaggio-qak" title="Permalink to this heading">¶</a></h2>
<p>Ma ora, la novità importante è che i concetti e i meccanismi realizzati dalla libreiria
sono formalmente esprimibili medianate un linguggio, dotato di una precisa
sintassi e di una semantica operazionale definita proprio dalla libreria.</p>
<ul class="simple">
<li><p>la libreria smette di essere solo una collezione di strumenti e diventa
il <strong>runtime</strong> (sommerso) di un linguaggio denminato <strong>qak</strong>.</p></li>
<li><p>la sintassi astratta di <strong>qak</strong> viene mappate direttamente sulle chiamate alla libreria
(<strong>proiezione semantica</strong>).</p></li>
</ul>
<section id="il-q-e-il-k-in-qak">
<h3>Il q e il k in qak<a class="headerlink" href="#il-q-e-il-k-in-qak" title="Permalink to this heading">¶</a></h3>
<p>Il
prefisso <strong>q</strong>, che significa <strong>“quasi”</strong> (<strong>a</strong> sta per <strong>actor</strong>)
ha le stesse motivazioni del prefisso <strong>Q</strong> introdotte in precedenza.</p>
<p>Il suffisso <strong>k</strong>  significa <strong>Kotlin</strong> e richiama il fatto che ogni QActor è realizzato come
<a class="reference internal" href="#la-coroutine-un-nuovo-vecchio-concetto"><span class="std std-ref">coroutine</span></a> kotlin.
Ciò permette la attivazione in una stessa JVM di migliaia di QActor, agevolando
la sperimentazione di fenomeni emergenti in sistemi formati da molti attori.
(<a class="reference internal" href="#more-is-different"><span class="std std-ref">More is different</span></a>).</p>
</section>
<section id="la-proiezione-linguistica-della-libreria">
<h3>La Proiezione Linguistica della Libreria.<a class="headerlink" href="#la-proiezione-linguistica-della-libreria" title="Permalink to this heading">¶</a></h3>
<p>Proiettare la libreria in un linguaggio, implica operare una trasformazione dei livelli di astrazione:</p>
<ul class="simple">
<li><p><strong>Livello Operativo</strong> (libreria): Si concentra sui dettagli implementativi, sulla gestione dello stato
e sull’esecuzione (il “Come”). È complicato perché deve realizzare in modo opportuno
diversi meccanismi e poictiche di interazione.</p></li>
<li><p><strong>Livello Espressivo</strong> (linguaggio): Si concentra sull’intento del dominio. Eliminando il “rumore”
sintattico di Java (punti e virgola, tipi verbosi, boilerplate), si permette all’utente di
manipolare i concetti della libreria come se fossero <strong>primitive del pensiero</strong>.</p></li>
</ul>
<p>Inoltre, si può difre che:</p>
<ul class="simple">
<li><p>La libreria  definisce lo <strong>spazio delle possibilità</strong>, mentre il linguaggio <strong>qak</strong>
definisce il <strong>modo di navigare questo spazio</strong>.</p></li>
<li><p>Invece di forzare l’utente a scrivere codice Java, si offre una “lente” (il linguaggio)
che restringe il campo d’azione esattamente a ciò che la libreria sa fare
(si veda <a class="reference internal" href="#il-motto-di-alan-kay"><span class="std std-ref">ali e catene</span></a>),
potenziandone però la leggibilità e la verifica formale.</p>
</li>
</ul>
</section>
</section>
<section id="dalla-libreria-al-linguaggio">
<span id="come-e-stato-realizzato-qak"></span><h2>Dalla libreria al linguaggio<a class="headerlink" href="#dalla-libreria-al-linguaggio" title="Permalink to this heading">¶</a></h2>
<p>L’implementazione del Linguaggio Qak si basa du due parti principali:</p>
<ul class="simple">
<li><p>Il <strong>Metamodello Qak</strong>: definisce la sintassi e la semantica del linguanisceggio Qak,
basandosi sul framework <strong>Xtext</strong>. L’ecosistema <strong>Eclipse</strong> viene ampliato con appositi plugin
così da realizzare la <a class="reference internal" href="#qak-software-factory"><span class="std std-ref">Qak software factory</span></a>, che include
un <strong>editor guidato dalla sintassi</strong>, e
un generatore di codice Kotlin che realizza la semantica del linguaggio.</p></li>
<li><p>La <strong>Qak infrastructure</strong>: fornisce l’infrastruttura di runtime per eseguire i QActors
generati dal codice Qak.</p></li>
</ul>
<a class="reference internal image-reference" href="_images/qakSoftwareFactory.png"><img alt="_images/qakSoftwareFactory.png" class="align-center" src="_images/qakSoftwareFactory.png" style="width: 60%;" /></a>
<section id="qak-infrastructure">
<span id="id140"></span><h3>Qak infrastructure<a class="headerlink" href="#qak-infrastructure" title="Permalink to this heading">¶</a></h3>
<p>E’ defnita dalla libreria <strong>unibo.qakactor23-5.0.jar</strong> che
implementa i QActor applicativi come specializzazione classe astratta <a class="reference internal" href="#it-unibo-kactor-actorbasicfsm-kt"><span class="std std-ref">it.unibo.kactor.ActorBasicFsm.kt</span></a>
che a sua volta specializza la classe astratta <strong>it.unibo.kactor.ActorBasic.kt</strong>.</p>
</section>
<section id="qak-software-factory">
<span id="id141"></span><h3>Qak software factory<a class="headerlink" href="#qak-software-factory" title="Permalink to this heading">¶</a></h3>
<p>La factory (<strong>Qak software factory</strong>) genera il codice necessario
per ‘mappare’ i concetti di alto livello (espressi nel modello definito dall’utente)
in strutture di più basso livello, che possono essere eseguite avvelendosi di appositi supporti
e librerie di utilità  application-independent.</p>
<p>La <em>Qak software factory</em> è legata alla definizione del linguaggio <a class="reference internal" href="#qak-come-dsl"><span class="std std-ref">qak come DSL</span></a>.</p>
</section>
<section id="qak-come-dsl">
<span id="id142"></span><h3>qak come DSL<a class="headerlink" href="#qak-come-dsl" title="Permalink to this heading">¶</a></h3>
<p>Il <em>Linguaggio qak</em> è definito come un <a class="reference internal" href="#dsl-esterno"><span class="std std-ref">DSL Esterno</span></a> con lo scopo di:</p>
<ul class="simple">
<li><p>fornire agli ingegneri gli strumenti formali per definire e gestire
alcuni fondamentali ‘meccanismi semantici’ di comunicazione tra componenti software distribuiti</p></li>
<li><p>proseguire nel solco della <a class="reference external" href="https://en.wikipedia.org/wiki/Model-driven_engineering">Model-Driven engineering</a>, con lo scopo di agevolare
la rapida costruzione/prototipazione  di  <strong>modelli eseguibili</strong> di un sistema software,
utili (se non indispensabili) nelle fasi preliminari la progettazione, quali la analisi e la formalizzazione/
dei requisiti e l’analisi del problema applicativo da risolvere</p></li>
<li><p>assumere l’<a class="reference internal" href="#gli-attori-come-nuovo-paradigma"><span class="std std-ref">Actor Model</span></a> come modello computazionale di base</p>
</li>
</ul>
<p>L’idea alla base del <em>Linguaggio qak</em> è che un sistema software è composto da un insieme di
<a class="reference internal" href="#gli-attori-come-nuovo-paradigma"><span class="std std-ref">attori</span></a> (detti <strong>QActor</strong>)
che interagsicono mediante messaggi scambiati in modo <strong>asincrono</strong>.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 47%" />
<col style="width: 53%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Un sistema qak è composto da una collezioni di <a class="reference internal" href="#qactor"><span class="std std-ref">QActor</span></a>, attivati in uno o più <a class="reference internal" href="#context"><span class="std std-ref">Context</span></a>,
allocati in uno o piò nodi di elaborazione.</p></td>
<td><p>.</p>
<a class="reference internal image-reference" href="_images/Actor24sysqak.PNG"><img alt="_images/Actor24sysqak.PNG" class="align-center" src="_images/Actor24sysqak.PNG" style="width: 100%;" /></a>
</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="qactor">
<span id="id143"></span><h2>QActor<a class="headerlink" href="#qactor" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Un attore qak è un componente attivo che:</p>
<ul class="simple">
<li><p>nasce, vive e muore in un <span class="xref std std-ref">contesto</span> che può essere comune a (molti) altri attori;</p></li>
<li><p>ha un <strong>nome univoco</strong> nell’ambito di tutto il sistema;</p></li>
<li><p>è logicamente attivo, cioè dotato di flusso di controllo autonomo;</p></li>
<li><p>è capace di inviare messaggi ad un altro attore, di cui conosce il <strong>nome</strong>, incluso sè stesso;</p></li>
<li><p>è capace di eseguire elaborazioni autonome e/o elaborazioni di messaggi;</p></li>
<li><p>è dotato di una sua <cite>coda locale</cite> (<strong>msgQueue</strong>) in cui sono depositati i messaggi
a lui inviati da altri attori (dello stesso contesto o di contesti remoti)
oppure da componenti esterni al sistema.</p></li>
</ul>
</td>
<td><p>.</p>
<a class="reference internal image-reference" href="_images/actor24.png"><img alt="_images/actor24.png" class="align-center" src="_images/actor24.png" style="width: 90%;" /></a>
</td>
</tr>
</tbody>
</table>
</section>
<section id="context">
<span id="id144"></span><h2>Context<a class="headerlink" href="#context" title="Permalink to this heading">¶</a></h2>
<p>Un QActor fa sempre parte di un componente detto <strong>Context</strong> che assume
diversi, importanti ruoli. Un <strong>Context</strong>:</p>
<ol class="arabic simple">
<li><p>rappresenta un nodo di elaborazione, csstituito da una JVM che opera su un computer
fisico denotato da un indirizzo IP e una port</p></li>
<li><p>include una base di conoscenza Prolog (<code class="docutils literal notranslate"><span class="pre">SYSKB</span></code>) che descrive tutto il sistema come collezione di Context
e di QActor all’interno dei Context</p></li>
<li><p>funge da gestore dell’insiene di QActor locali al Context</p></li>
<li><p><strong>abilita le comunicazioni</strong> remote tra QActor, sfruttando la <code class="docutils literal notranslate"><span class="pre">SYSKB</span></code> per:</p>
<ul class="simple">
<li><p>conoscere il <em>Context</em> (e quindi il nodo computazionale) del destinario di un messaggio</p></li>
<li><p>recapitare un messaggio ricevuto con il <strong>protocollo di default TCP</strong>,
che abbia un suo QActor locale come destinatario</p></li>
</ul>
</li>
</ol>
<p>Il <em>Context</em> permette a un numero <code class="docutils literal notranslate"><span class="pre">N&gt;0</span></code> di QActor di <strong>condividere</strong> i supporti necessari
a rendere gli attori capaci di ricevere e trasmettere messaggi, sia attraverso la rete,
sia usando la memoria dalla JVM su cui operano.</p>
<p>In altre parole, rispetto alla architettura introdotta in <a class="reference internal" href="#protoattori"><span class="std std-ref">Protoattori</span></a> i server
del tipo javalin o i supporti MQTT <strong>non sono incapsulati</strong> in ogni QActor, ma sono
definiti una volta sola nel <em>Context</em>.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 70%" />
<col style="width: 30%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Un contesto rappresenta un nodo logico di elaborazione dotato di server e di un porta di ingresso,
su cui altri contesti possono stabilire una <a class="reference internal" href="#interconnessione"><span class="std std-ref">Interconnessione</span></a>, di solito basata su <code class="docutils literal notranslate"><span class="pre">TCP</span></code>,
<code class="docutils literal notranslate"><span class="pre">CoAP</span></code> e <code class="docutils literal notranslate"><span class="pre">MQTT</span></code>.</p>
<p>Un contesto deve essere allocato su un computer fisico o su un  virtual machine / container.</p>
</td>
<td><p>.</p>
<a class="reference internal image-reference" href="_images/actor24Ctx.png"><img alt="_images/actor24Ctx.png" class="align-center" src="_images/actor24Ctx.png" style="width: 100%;" /></a>
</td>
</tr>
<tr class="row-even"><td><p>Un contesto mantiene una tabella  (<strong>actorMap</strong>)  con i riferimento agli attori locali e una tabella
(<strong>proxyMap</strong>) con i riferimenti ai Proxy che mantengono una <a class="reference internal" href="#interconnessione"><span class="std std-ref">Interconnessione</span></a> con gli altri Context
del sistema.</p>
</td>
<td><p>.</p>
<a class="reference internal image-reference" href="_images/actor24CtxMaps.png"><img alt="_images/actor24CtxMaps.png" class="align-center" src="_images/actor24CtxMaps.png" style="width: 100%;" /></a>
</td>
</tr>
</tbody>
</table>
</section>
<section id="uno-sguardo-alla-sintassi-di-qak">
<h2>Uno sguardo alla sintassi di qak<a class="headerlink" href="#uno-sguardo-alla-sintassi-di-qak" title="Permalink to this heading">¶</a></h2>
<p>La descrizione della sintassi del linguaggio qak è riporata in <a class="reference external" href="_static/docs/Qactork_xtext.pdf">Qaksyntax</a>.</p>
<p>In Xtext, la grammatica è scritta in un dialetto della Notazione d:ref:<cite>Backus-Naur Estesa (EBNF)&lt;La analisi sintattica&gt;</cite>,
dove ogni regola non solo descrive cosa il parser deve leggere, ma anche <strong>come trasformarlo</strong>
in un oggetto Java (di classe-base <strong>EObject</strong>).</p>
<p>Riportare qui tutte le regole sintattiche non è opportuno; tuttavia può essere utile dare uno sguardo ad alcune regole,
utili per la specifica dei messaggi e per la gestione dei payload dei messaggi.</p>
<section id="messaggi-qak">
<span id="id145"></span><h3>Messaggi qak<a class="headerlink" href="#messaggi-qak" title="Permalink to this heading">¶</a></h3>
<p>I messaggi che i <strong>QActor</strong> possono scambiarsi
sono di tre tipi: <strong>Dispatch</strong>, <strong>Request</strong> (con <strong>Reply</strong>), ed <strong>Event</strong>,
caratterzzati dai seguenti <em>Pattern</em>:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 15%" />
<col style="width: 30%" />
<col style="width: 20%" />
<col style="width: 35%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Tipo msg</strong></p></td>
<td><p><strong>Destinatario</strong></p></td>
<td><p><strong>Risposta</strong></p></td>
<td><p><strong>Uso</strong></p></td>
</tr>
<tr class="row-even"><td><p><strong>Dispatch</strong></p></td>
<td><p>Esplicito</p></td>
<td><p>No</p></td>
<td><p>Comandi, notifiche</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Request</strong></p></td>
<td><p>Esplicito</p></td>
<td><p>si (<strong>Reply</strong>)</p></td>
<td><p>Query (asincrone)</p></td>
</tr>
<tr class="row-even"><td><p><strong>Event</strong></p></td>
<td><p>Implicito</p></td>
<td><p>No</p></td>
<td><p>Notifiche</p></td>
</tr>
</tbody>
</table>
<p>I messagi con destinatrio esplicito devono designare il nome (<code class="docutils literal notranslate"><span class="pre">ID</span></code>) del QActor destinatario.</p>
<p>La sintassi dei messaggi è definita dal seguente frammento della grammatica qak:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Message : BasicMessage | Event | OtherMsg;
BasicMessage: Dispatch | Request;
OtherMsg : Reply | ... ;

Event:    &quot;Event&quot;    name=ID &quot;:&quot; msg = PHead (cmt=STRING)?;
Dispatch: &quot;Dispatch&quot; name=ID &quot;:&quot; msg = PHead (cmt=STRING)?;
Request:  &quot;Request&quot;  name=ID &quot;:&quot; msg = PHead (cmt=STRING)?;
Reply:    &quot;Reply&quot;    name=ID &quot;:&quot; msg = PHead (&quot;for&quot; reqqq=[Request])?(cmt=STRING)?;
</pre></div>
</div>
<p>Il non-terminale <a class="reference internal" href="#phead"><span class="std std-ref">PHead</span></a> descrive <a class="reference internal" href="#notazioni-ispirate-ai-termini-prolog"><span class="std std-ref">Notazioni ispirate ai termini Prolog</span></a>.
Rimandando ulteriori dettagli alle sezioni relative, anticipamo qui che
sono espressi cone <strong>Atomi Prolog</strong>:</p>
<ul class="simple">
<li><p>i nomi dei <a class="reference internal" href="#qactor">QActor</a> (tutte minuscole, come ulteriore vincolo)</p></li>
<li><p>i nomi dei <a class="reference internal" href="#context">Context</a>  (tutte minuscole, come ulteriore vincolo)</p></li>
<li><p>i nomi dei messaggi e i nomi dei loro <strong>payload</strong></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Gli <strong>Atomi</strong> sono in  Prolog i <strong>Termini</strong> più semplici, quali ad esempio:</p>
<ul class="simple">
<li><p>un nome che inizia con una lettera minuscola
e può essere seguito da lettere (maiuscole o minuscole), cifre (<code class="docutils literal notranslate"><span class="pre">0-9</span></code>) e il carattere underscore (<code class="docutils literal notranslate"><span class="pre">_</span></code>).</p></li>
<li><p>qualsiasi sequenza di caratteri racchiusa tra virgolette singole</p></li>
<li><p>i simboli <code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">fail</span></code>, <code class="docutils literal notranslate"><span class="pre">[]</span></code> (lista vuota) .</p></li>
</ul>
</div>
</section>
</section>
<section id="descrivere-un-sistema-in-qak">
<h2>Descrivere un sistema in qak<a class="headerlink" href="#descrivere-un-sistema-in-qak" title="Permalink to this heading">¶</a></h2>
<p>Ricordando la <a class="reference internal" href="#visione-whitebox"><span class="std std-ref">Visione WhiteBox</span></a> di un sistema, possiamo sintetizzare le capacità espressive del <em>Linguaggio qak</em>
nella tabella che segue:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Struttura</strong></p></td>
<td><p>Un sistema qak è composto da enti computazionalmente completi detti <a class="reference internal" href="#qactor"><span class="std std-ref">QActor</span></a>,
contenuti in uno o più <a class="reference internal" href="#context"><span class="std std-ref">Context</span></a>.</p>
<p>Un <a class="reference internal" href="#qactor"><span class="std std-ref">QActor</span></a> può contenere ed usare uno o più oggetti espressi in <code class="docutils literal notranslate"><span class="pre">Java</span></code> e/o <code class="docutils literal notranslate"><span class="pre">Kotlin</span></code>,
con l’avvertenza che questi <strong>non devono introdurre accessi concorrenti</strong> a memoria comune</p>
</td>
</tr>
<tr class="row-even"><td><p><strong>Comportamento</strong></p></td>
<td><p>Un QActor si comporta (ed è strutturalmente organizzato) come un <strong>Automa  Stati Finiti</strong>
(precisamente come una <a class="reference external" href="https://it.wikipedia.org/wiki/Macchina_di_Moore">Macchina di Moore</a>) e
può eseguire azioni (<a class="reference internal" href="#azioni-di-un-qactor"><span class="std std-ref">Azioni di un QActor</span></a>) sia  di alto livello (<em>azioni qak</em>) sia di basso livello
(qualunque <em>azione kotlin</em>)</p>
<p>Il comportamento di QActor è:</p>
<ul class="simple">
<li><p><strong>proattivo</strong>, in quanto può eseguire azioni in autonomia, comportandosi di fatto come un <a class="reference internal" href="#agente"><span class="std std-ref">Agente</span></a></p></li>
<li><p><strong>reattivo</strong>, in quanto capace di reagire a messaggi che provengono da altri QActor o da
componenti software esterni al sistema.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><strong>Interazione</strong></p></td>
<td><p>I QActor interagiscono scambiandosi <a class="reference internal" href="#messaggi-qak"><span class="std std-ref">messaggi</span></a>, secondo il motto:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Non</span> <span class="n">comunicare</span> <span class="n">condividendo</span> <span class="n">la</span> <span class="n">memoria</span><span class="o">.</span>
<span class="n">Piuttosto</span><span class="p">,</span> <span class="n">condividi</span> <span class="n">memoria</span> <span class="n">comunicando</span><span class="o">.</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>La descrizione di un sistema software nel linguaggio qak esprime:</p>
<ol class="arabic simple">
<li><p>una <a class="reference internal" href="#vista-esterna"><span class="std std-ref">Vista esterna</span></a> del sistema, costituita dall’insieme dei <a class="reference internal" href="#messaggi-qak"><span class="std std-ref">Messaggi qak</span></a> usati dai <a class="reference internal" href="#qactor"><span class="std std-ref">QActor</span></a>
e dall’insieme dai <a class="reference internal" href="#context"><span class="std std-ref">Context</span></a> che compongono il sistema</p></li>
<li><p>una <a class="reference internal" href="#vista-interna"><span class="std std-ref">Vista interna</span></a> di ogni QActor, che ne rappresenta il comportamento come un
<a class="reference internal" href="#qactor-come-fsm"><span class="std std-ref">automa a stati finiti</span></a>
(<a class="reference external" href="https://it.wikipedia.org/wiki/Macchina_di_Moore">Macchina di Moore</a>)</p></li>
</ol>
<section id="azioni-di-un-qactor">
<span id="id146"></span><h3>Azioni di un QActor<a class="headerlink" href="#azioni-di-un-qactor" title="Permalink to this heading">¶</a></h3>
<p>Un QActor può eseguire <em>azioni qak</em> e <em>azioni Kotlin</em>.</p>
<ul class="simple">
<li><p>Le <strong>azioni qak</strong> che consideriamo al momento, sono principalmente connesse
alla trasmissione e ricezione di messaggi, trasparenti rispetto ai meccanismi implementativi
e alla dislocazione fisica dei QActor. <span class="xref std std-ref">Altre azioni qak</span> verranno introdotte in seguito.</p></li>
<li><p>Le <strong>azioni kotlin</strong> sono espresse da codice Kotlin racchiuso tra i simobli <strong>[#</strong> e <strong>#]</strong>.
La possibilità di esprimere queste azioni rende il linguaggio
<a class="reference internal" href="#computazionalmente-completo"><span class="std std-ref">Computazionalmente completo</span></a></p></li>
</ul>
</section>
<section id="azioni-per-la-trasmissione-dei-messaggi">
<span id="id147"></span><h3>Azioni per la trasmissione dei messaggi<a class="headerlink" href="#azioni-per-la-trasmissione-dei-messaggi" title="Permalink to this heading">¶</a></h3>
<p>A ciascun tipo di messaggio corrisponde, nel linguaggio qak, una specifica azione (sempre asincrona)
per la sua trasmissione.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>forward</strong></p></td>
<td><p>azione connessa all’invio di un <strong>dispatch</strong> a un destinatario, di cui si conosce il nome</p></td>
</tr>
<tr class="row-even"><td><p><strong>request</strong></p></td>
<td><p>azione connessa all’invio di una <strong>request</strong> a un destinatario, di cui si conosce il nome</p></td>
</tr>
<tr class="row-odd"><td><p><strong>replyTo</strong></p></td>
<td><p>azione connessa all’invio di una <strong>reply</strong> relativa a una specifica richiesta</p></td>
</tr>
<tr class="row-even"><td><p><strong>emit</strong></p></td>
<td><p>azione connessa alla emissione di un <strong>event</strong>  verso tutti i QActor del sistema</p></td>
</tr>
<tr class="row-odd"><td><p><strong>emitlocal</strong></p></td>
<td><p>azione connessa alla emissione di un <strong>event</strong>  verso i QActor dello <strong>stesso Context</strong> dell’emettitore</p></td>
</tr>
<tr class="row-even"><td><p><strong>emitlocalstream</strong></p></td>
<td><p>azione connessa alla emissione di un <strong>event</strong>  verso i QActor dello stesso Context dell’emettitore
che si sono <strong>eplicitamente dichiarati interessati</strong>.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="azioni-per-la-ricezione-dei-messaggi">
<span id="id148"></span><h3>Azioni per la ricezione dei messaggi<a class="headerlink" href="#azioni-per-la-ricezione-dei-messaggi" title="Permalink to this heading">¶</a></h3>
<p>Non esiste una azione esplicita (una <em>receive</em>) per la ricezione dei messaggi.
La ricezione dei messaggi è connessa alla specifica della <strong>transizione tra stati</strong>
dell’automa a stati finiti che modella il comportamento di un QActor.
Per un primo esempio, si veda <a class="reference internal" href="#un-esempio-di-sistama-qak-con-claude"><span class="std std-ref">Un esempio di sistama qak con Claude</span></a>.</p>
</section>
<section id="come-un-qactor-gestisce-i-messaggi-ricevuti">
<span id="id149"></span><h3>Come un QActor gestisce i messaggi ricevuti<a class="headerlink" href="#come-un-qactor-gestisce-i-messaggi-ricevuti" title="Permalink to this heading">¶</a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Un Server di contesto del <a class="reference internal" href="#context"><span class="std std-ref">Context</span></a> depone i messaggi <span class="xref std std-ref">IApplMessage</span>
ricevuti su una <a class="reference internal" href="#interconnessione"><span class="std std-ref">Interconnessione</span></a> sulla  <code class="docutils literal notranslate"><span class="pre">msgQueue</span></code>
dell’attore destinatario.</p>
<p>—</p>
<p>La figura mostra il caso di attori locali ad un nodo di elaborazione che possono
inviare/ricevere messaggi tra loro oppure elaborare messaggi inviati
da componenti remoti.</p>
</td>
<td><p>.</p>
<a class="reference internal image-reference" href="_images/Actors24SingleNodeAndCtx.png"><img alt="_images/Actors24SingleNodeAndCtx.png" class="align-center" src="_images/Actors24SingleNodeAndCtx.png" style="width: 100%;" /></a>
</td>
</tr>
</tbody>
</table>
<p>Il funzionamento di un QActor può essere descritto come segue:</p>
<ol class="arabic simple">
<li><p>Un QActor è dotato di una sua coda locale (<strong>msgQueue</strong>) in cui sono depositati i messaggi a lui inviati.</p></li>
<li><p>Un QActor possied una seconda coda (<strong>msgQueueStore</strong>),
in cui memorizza messaggi (di tipo <em>request</em> e <em>dispatch</em>) non ancora elaborati.</p></li>
<li><p>Ogni stato di un QActor può specificare una <strong>Transition</strong> in cui si specifica lo stato futuro da raggiungere
in corrispondenza alla ricezione di un messaggio con uno specifico identificatore <em>msgId</em>.</p></li>
<li><p>Al termine delle sue azioni, lo stato corrente del QActor consulta, nell’ordine,
le sue code <em>msgQueueStore</em> e <em>msgQueue</em>, ciascuna in modo FIFO.</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>Se l’identificatore del messaggio prelevato da una coda è uguale a un <em>msgId</em> della <em>Transition</em> dello stato corrente,
si attiva il passaggio allo stato futuro corrispondente.
Se no, un messaggio in  <em>msgQueueStore</em> viene lasciato dove è; oppure,
se è una <em>request</em> o un <em>dispatch</em> in <em>msgQueue</em>, viene trasferito in fondo alla coda <em>msgQueueStore</em>.</p></li>
<li><p>Un messaggio di tipo <strong>event</strong> in <em>msgQueue</em> il cui identificatore non compare nella <em>Transition</em> dello stato corrente,
viene scartato (e quindi <strong>ignorato e dimenticato</strong>).</p></li>
<li><p>Se nessuna transizione è attivabile in base ai messaggi nelle code, il QActor  rimane nello stato corrente;
all’arrivo di un nuovo messaggio, si riprende ad eseguire il punto 3.</p></li>
</ul>
</div></blockquote>
</section>
<section id="altre-azioni-qak">
<h3>Altre azioni qak<a class="headerlink" href="#altre-azioni-qak" title="Permalink to this heading">¶</a></h3>
<p>Oltre alla possibilità di specificare azioni di alto livello per la trasmissione di messaggi,
il linguaggio qak offre azioni ‘primitive’ che risultano importanti in molte appòicazioni.</p>
<p>In attessa di approfondire queste ulteiori azioni nei progetti che faremo, ne riportiamo qui un elenco:</p>
<ul class="simple">
<li><p>azioni di accesso al contenuto (payload) dei messaggi (si veda <a class="reference internal" href="#onmsg"><span class="std std-ref">onMsg</span></a>)</p></li>
<li><p>azioni condizionali (scelte)</p></li>
<li><p>operazioni per l’uso della base di conoscenza Prolog</p></li>
<li><p>azioni relative alla osservabilità dello stato interno di un QActor</p></li>
<li><p>azioni di delegazione di un messaggio ad un altro QActor dello stesso Context</p></li>
<li><p>azioni per la creazione deinamica di attori locali allo stesso Context</p></li>
<li><p>operazioni per l’uso di intereazioni mediante MQTT</p></li>
<li><p>operazione di ritorno da uno stato di gestione di un messaggio visto come interruzione</p></li>
</ul>
</section>
<section id="qactor-come-fsm">
<span id="id150"></span><h3>QActor come FSM<a class="headerlink" href="#qactor-come-fsm" title="Permalink to this heading">¶</a></h3>
<p>Il linguaggio qak forza la descrizione del comportamento di un QActor  come una <a class="reference external" href="https://it.wikipedia.org/wiki/Macchina_di_Moore">Macchina di Moore</a>
a stati finiti.</p>
<p>In altre parole, non sono i messaggi ricevuti a determinare il comportamento di un QActor,
ma è un QActor che <strong>decide</strong> quali azioni compiere e quali messaggi ricevere ed elaborare
in un dato momento (stato) della sua vita.</p>
<p>Ogni QActor:</p>
<ul class="simple">
<li><p>possiede uno  <strong>unico stato iniziale</strong></p></li>
<li><p>possiede uno <strong>stato corrente</strong> di esecuzione</p></li>
<li><p>può eseguire <strong>azioni</strong> in ogni stato</p></li>
<li><p>può eseguire <strong>transizioni</strong> tra stati, come conseguenza della ricezione di messaggi
o come decisione autonoma (<strong>Goto</strong>)</p></li>
</ul>
<p>Notiamo che</p>
<ul class="simple">
<li><p>la struttura a stati finiti (FSM) di un QActor non limita la sua capacità computazionale,
in quanto ogni stato può eseguire azioni di calcolo di complessità arbitraria;</p></li>
<li><p>la struttura FSM di un QActor facilita la comprensione del suo comportamento,
in quanto ogni stato può essere visto come una modalità operativa ben definita.</p></li>
<li><p>inoltre, la struttura FSM di un QActor facilita:</p>
<ul>
<li><p>la <strong>analisi</strong> e la <strong>verifica</strong> del suo comportamento,
in quanto è possibile esaminare tutte le transizioni tra stati e le azioni associate a ciascuno stato.</p></li>
<li><p>la <strong>progettazione</strong> e la <strong>implementazione</strong> del suo comportamento,
in quanto è possibile suddividere il comportamento complessivo in sotto-comportamenti associati a ciascuno stato.</p></li>
<li><p>la <strong>manutenzione e l’evoluzione</strong> del suo comportamento,
in quanto è possibile modificare o aggiungere stati e transizioni senza alterare l’intero comportamento.</p></li>
<li><p>il <strong>testing</strong> del suo comportamento,
in quanto è possibile isolare e testare singoli stati e transizioni.</p></li>
<li><p>la <strong>documentazione</strong> e la comunicazione del suo comportamento,
in quanto è anche possibile rappresentare graficamente il comportamento mediante diagrammi di stati.</p></li>
<li><p>l’<strong>ottimizzazione</strong> delle prestazioni,
in quanto è possibile identificare e migliorare gli stati e le transizioni critiche.</p></li>
</ul>
</li>
</ul>
<p>Osserviamo anche che:</p>
<ul class="simple">
<li><p>un QActor <strong>solo proattivo</strong> non esprime
transizioni basate sulla ricezione di messaggi, ma solo transizioni autonome (<strong>Goto</strong>).</p></li>
<li><p>un QActor che entra in un loop computazionale infinito in uno stato,
non è in grado di gestire messaggi ricevuti.</p></li>
</ul>
</section>
</section>
<section id="un-esempio-di-sistama-qak-con-claude">
<span id="id151"></span><h2>Un esempio di sistama qak con Claude<a class="headerlink" href="#un-esempio-di-sistama-qak-con-claude" title="Permalink to this heading">¶</a></h2>
<p>Da neofiti del linguaggio qk, proviamo a chidere a <em>Claude</em> (una AI versate nel coding) di costruire
per noi un primo sistema.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Prompt per Cluade: Vorrei il codice di un sistema espresso nel linguaggio qak in cui un attore  di nome ‘worker’
riceve la richiesta del valore dell’ora corrente nella forma HH::MM::SEC
da parte di un altro attore di nome ‘caller’.</p>
</div>
<p>Claude risponde fornendo il codice che segue:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>System timesystem

  // Messaggio di richiesta dell&#39;ora corrente
  Request gettime : gettime(X)
  // Messaggio di risposta con l&#39;ora corrente
  Reply currenttime : currenttime(TIME) for gettime
                          //(1) for clause (optional) Added

Context ctx ip [host=&quot;localhost&quot; port=8050]

  QActor caller context ctx {
    State s0 initial {
       delay 1000
        println(&quot;Caller: richiedo l&#39;ora corrente al worker&quot;)
        request worker -m gettime : gettime(now)
    }
    Transition t0 whenReply currenttime -&gt; handleResponse

    State handleResponse {
        onMsg(currenttime : currenttime(TIME)) {
          println(&quot;Caller: ho ricevuto l&#39;ora corrente: ${payloadArg(0)}&quot;)
        }
        [# System.exit(0) #] //(2) Added to terminate
        }
        //Goto s0  //(3) Removed to avoid loop
    }

  QActor worker context ctx {
    State s0 initial {
      println(&quot;Worker: in attesa di richieste...&quot;)
    }
    Transition t0 whenRequest gettime -&gt; sendTime

    State sendTime {
  /*4*/onMsg(gettime : gettime(X)) {
        println(&quot;Worker: ricevuta richiesta, invio l&#39;ora corrente&quot;)
        [# val now        = java.time.LocalTime.now().toString()
           val formatter  =
            java.time.format.DateTimeFormatter.ofPattern(&quot;HH:mm:ss&quot;)
          val CurrentTime = &quot;&#39;&quot;+now.format(formatter)+&quot;&#39;&quot;
                              //(5) Apici Added since Prolog term
        #]
        replyTo gettime with currenttime : currenttime($CurrentTime)
                              //(6) CurrentTime e non currentTime
        }
      }
      Goto s0
    }
</pre></div>
</div>
<p>Il codice è corretto tranne al punto <strong>(6)</strong>, in cui il nome della variabile deve
<strong>iniziare con una maiuscola</strong>, per vincoli sintattici sull’uso dell’operatore di referenziamento <code class="docutils literal notranslate"><span class="pre">$</span></code>
entro la specifica del payload della reply.</p>
<p>Le modifiche al codice negli altri punti sono migliorie opzionali:</p>
<ol class="arabic simple">
<li><p>La clausola for correla la <strong>reply</strong> a un precisa <strong>request</strong></p></li>
<li><p>Induce la terminazione del sistema, che rimerrebbe attivo per via dei server di contesto</p></li>
<li><p>Viene eliminato il ritorno allo stato  <code class="docutils literal notranslate"><span class="pre">s0</span></code> del <em>caller</em>, per evitare un ciclo infinito di richieste</p></li>
<li><p>La frase è corretta e permette di estrarre il valore del payload di un messaggio,
come spiegato in <a class="reference internal" href="#onmsg"><span class="std std-ref">onMsg</span></a> (si veda anche <a class="reference internal" href="#azioni-per-la-ricezione-dei-messaggi"><span class="std std-ref">Azioni per la ricezione dei messaggi</span></a>)</p></li>
<li><p>Il valore <em>CurrentTime</em> viene incluso tra apici, in quanto il payload della <em>reply</em>
deve essere espresso da un atomo Prolog.</p></li>
</ol>
<section id="onmsg">
<span id="id152"></span><h3>onMsg<a class="headerlink" href="#onmsg" title="Permalink to this heading">¶</a></h3>
<p>La frase qak:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">onMsg</span><span class="p">(</span> <span class="n">gettime</span> <span class="p">:</span> <span class="n">gettime</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="p">){</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>ubbidisce alla seguente <em>regola sintattica</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>MsgCond: &quot;onMsg&quot; &quot;(&quot; message=[Message] &quot;:&quot; msg = PHead &quot;)&quot;
   &quot;{&quot; ( condactions += StateAction )*  &quot;}&quot;
   (&quot;else&quot; ifnot = NoMsgCond )? ;

NoMsgCond: &quot;{&quot; (  notcondactions += StateAction )*  &quot;}&quot;;
</pre></div>
</div>
<p>La sua <strong>semantica</strong> è la seguente:</p>
<ul class="simple">
<li><p>esegue il body <em>condactions</em> solo se il messaggio corrente (variabile <strong>currentMsg</strong>)
ha msgId <code class="docutils literal notranslate"><span class="pre">gettime</span></code> (in questo caso)
e può essere <strong>unificato</strong> in Prolog con il <em>template</em> di messaggio definito nella dichiarazione
(<code class="docutils literal notranslate"><span class="pre">gettime(X)</span></code> nella Dichiarazione dei messagg)
e con il template specificato <cite>gettime(X)`</cite> (in questo caso).</p></li>
</ul>
</section>
<section id="dal-concentrato-al-distribuito">
<h3>Dal concentrato al distribuito<a class="headerlink" href="#dal-concentrato-al-distribuito" title="Permalink to this heading">¶</a></h3>
<p>L’esempio prodotto da Claude introduce due attori nello stesso contesto.
Lo scambio di messaggi tra questi attori avviene usando la memoria della JVM
in cui gli attori operano e non implicano l’uso della rete.</p>
<p>Volendo trasformare il sistema da concentrato a distribuito,
occorre introdurre un secondo Contesto (ad ese. <strong>ctx1</strong>) ed includere uno
dei due attori in questo nuovo contesto.</p>
<p>In questo modo si divide il sistema in due sottosistemi, che vengono concettualmente
‘legati’ dalla specifica dello stesso insieme di messaggi e dalla specifica
die contesti.
Ad esempio:</p>
<p><strong>Sottositema caller</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">System</span> <span class="n">timesystem</span>
  <span class="n">Request</span> <span class="n">gettime</span>   <span class="p">:</span> <span class="n">gettime</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
  <span class="n">Reply</span> <span class="n">currenttime</span> <span class="p">:</span> <span class="n">currenttime</span><span class="p">(</span><span class="n">TIME</span><span class="p">)</span> <span class="k">for</span> <span class="n">gettime</span>

<span class="n">Context</span> <span class="n">ctx</span>  <span class="n">ip</span> <span class="p">[</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span>    <span class="n">port</span><span class="o">=</span><span class="mi">8050</span><span class="p">]</span>
<span class="n">Context</span> <span class="n">ctx1</span> <span class="n">ip</span> <span class="p">[</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;192.168.22.2&quot;</span> <span class="n">port</span><span class="o">=</span><span class="mi">8060</span><span class="p">]</span>

  <span class="n">QActor</span> <span class="n">caller</span> <span class="n">context</span> <span class="n">ctx</span> <span class="p">{</span>
    <span class="n">State</span> <span class="n">s0</span> <span class="n">initial</span> <span class="p">{</span>
       <span class="n">delay</span> <span class="mi">1000</span>
        <span class="n">println</span><span class="p">(</span><span class="s2">&quot;Caller: richiedo l&#39;ora corrente al worker&quot;</span><span class="p">)</span>
        <span class="n">request</span> <span class="n">worker</span> <span class="o">-</span><span class="n">m</span> <span class="n">gettime</span> <span class="p">:</span> <span class="n">gettime</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">Transition</span> <span class="n">t0</span> <span class="n">whenReply</span> <span class="n">currenttime</span> <span class="o">-&gt;</span> <span class="n">handleResponse</span>

    <span class="n">State</span> <span class="n">handleResponse</span> <span class="p">{</span>
        <span class="n">onMsg</span><span class="p">(</span><span class="n">currenttime</span> <span class="p">:</span> <span class="n">currenttime</span><span class="p">(</span><span class="n">TIME</span><span class="p">))</span> <span class="p">{</span>
          <span class="n">println</span><span class="p">(</span><span class="s2">&quot;Caller: ho ricevuto l&#39;ora corrente: ${payloadArg(0)}&quot;</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="p">[</span><span class="c1"># System.exit(0) #]</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">ExternalQActor</span> <span class="n">worker</span> <span class="n">context</span> <span class="n">ctx1</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Il contesto <strong>ctx</strong>  opera ora sul nodo di indirizzo <code class="docutils literal notranslate"><span class="pre">IP=localhost</span></code> con porta di accesso <code class="docutils literal notranslate"><span class="pre">8050</span></code>.</p></li>
<li><p>Il contesto <strong>ctx1</strong> opera ora sul nodo di indirizzo <code class="docutils literal notranslate"><span class="pre">IP=192.168.22.2</span></code> con porta di accesso <code class="docutils literal notranslate"><span class="pre">8060</span></code>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Ciascun componente sarà ora sviluppato in un progetto Java specifico,
all’interno di un workspace specifico, in uno stesso computer o in due computer diversi.</p>
<p>La <a class="reference internal" href="#qak-software-factory"><span class="std std-ref">Qak software factory</span></a> genera codice solo per gli attori definiti in
un contesto che come IP il valore <strong>localhost</strong>.</p>
</div>
<p>La frase <code class="docutils literal notranslate"><span class="pre">ExternalQActor</span> <span class="pre">...</span></code> specifica che l’attore <strong>worker</strong> si trova su un  nodo
diverso da <em>caller</em> e può essere considerato come un altro componente del sistema,
di cui non si conosce la struttura interna.</p>
<p>Il codice di <strong>caller</strong> non cambia, anche se ora i messaggi dovranno essere scambiati via
rete (con protocollo di deafault <strong>TCP</strong>). A questo penserà la <a class="reference internal" href="#qak-infrastructure"><span class="std std-ref">Qak infrastructure</span></a>
sulla base delle <strong>conoscenze</strong> racchise nel <a class="reference internal" href="#context"><span class="std std-ref">Context</span></a>.</p>
<p>Il sottosistema che rappresenta il <em>worker</em> viene specificato in modo simile,
ma <strong>senza inrodurre</strong>:</p>
<ul class="simple">
<li><p>la specifica di <code class="docutils literal notranslate"><span class="pre">Context</span> <span class="pre">ctx</span></code></p></li>
<li><p>la frase <code class="docutils literal notranslate"><span class="pre">ExternalQActor</span> <span class="pre">...</span></code></p></li>
</ul>
<p>Infatti il <em>Sottositema worker</em> opera come un <strong>servizio</strong> a sè stante,
che può operare senza conoscere quali saranno i possibili ‘caller’ e dove
essi si potranno trovare.</p>
<p>L’unica <strong>conoscenza necessaria è l’insieme dei messaggi</strong> che garantiscono la
possibilità di comunicazione (comprensione) tra le diverse parti.</p>
<p><strong>Sottositema worker</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>System timesystem
  Request gettime   : gettime(X)
  Reply currenttime : currenttime(TIME) for gettime

Context ctx1 ip [host=&quot;192.168.22.2&quot; port=8060]

  QActor worker context ctx {
    State s0 initial {
      println(&quot;Worker: in attesa di richieste...&quot;)
    }
    Transition t0 whenRequest gettime -&gt; sendTime

    State sendTime {
      onMsg(gettime : gettime(X)) {
        println(&quot;Worker: ricevuta richiesta, invio l&#39;ora corrente&quot;)
        [# val now        = java.time.LocalTime.now().toString()
           val formatter  =
            java.time.format.DateTimeFormatter.ofPattern(&quot;HH:mm:ss&quot;)
          val CurrentTime = &quot;&#39;&quot;+now.format(formatter)+&quot;&#39;&quot;
        #]
        replyTo gettime with currenttime : currenttime($CurrentTime)
        }
      }
      Goto s0
    }
</pre></div>
</div>
<p>Notiamo che, dal punto di vista del <em>worker</em>, non si ha una chiara visione di quali
parti compongono il ‘sistema’ di cui fa parte.</p>
<p>Tuttavia il  <em>worker</em> ‘sa’ (o assume) che potranno ‘fare sistema’ con lui tutti i
componenti che <strong>‘parlano’ il suo stesso linguaggio</strong>,
come detto in <a class="reference internal" href="#conoscere-per-comunicare"><span class="std std-ref">Conoscere per comunicare</span></a>.</p>
</section>
</section>
<section id="impatto-di-qak-sul-processo-di-sviluppo">
<h2>Impatto di qak sul processo di sviluppo<a class="headerlink" href="#impatto-di-qak-sul-processo-di-sviluppo" title="Permalink to this heading">¶</a></h2>
<p>Come anticipato in <a class="reference internal" href="#qak-come-dsl"><span class="std std-ref">qak come DSL</span></a>, il linguaggio qak ha come scopo la definzione
di <strong>modelli eseguibili</strong> di un sistema software distribuito
e vuole fornire uno strumento più adatto (in quanto esplicitamente orientato allo scopo)
rispetto a UML per abbattere i costi di produzione di un sistema distribuito.</p>
<p>La possibilià di definire fin dalle fasi di analisi del problema l’<strong>architettura</strong> di un
sistema distribuito in termini di un modello eseguibile costitusice un solido punto di
partenza per la progettazione e la costruzione cooperativa di un sistema software.</p>
<p>Operatori umani diversi (customer, responsabili aziendali, sviluppatori) possono trovare
nel modello qak un <strong>punto di confronto e reciproca comprensione</strong>,
premessa indispensabile per uno sviluppo consapevole, condiviso e motivato del prodotto,
cioè per il passaggio da <strong>WHAT</strong> (cosa) a <strong>HOW</strong> (come).</p>
<p>Questo passaggio può essere visto e svolto come un <strong>processo evolutivo</strong> di
trasformazione/specializzazione di questa del modello di partenza (architettura logica del sistema)
prodotto in fase di analisi del problema.</p>
<p>L’architettura logica può essere anche il riferimento per la impostazione di <strong>piani di testing</strong>
(<em>TestPlans</em>) espressi in modo <strong>non discorsivo</strong> (in modo formale), comprensibile a una macchina.</p>
<p>Cerchiamo di approfondire questi punti, affrontando in qak la specifica, costruzione e testing
del sistema <code class="docutils literal notranslate"><span class="pre">S</span></code>  introdotto in <a class="reference internal" href="#interagire-con-un-sistema-software"><span class="std std-ref">Interagire con un sistema software</span></a>.</p>
<p>La struttura del <strong>modello qak</strong> del sistema <code class="docutils literal notranslate"><span class="pre">S</span></code>
deve essere espressa da una sequenza di dichiarazioni:</p>
<section id="dichiarazione-del-sistema-service-s">
<span id="id153"></span><h3>1) Dichiarazione del sistema service_s<a class="headerlink" href="#dichiarazione-del-sistema-service-s" title="Permalink to this heading">¶</a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 35%" />
<col style="width: 65%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">System</span>  <span class="n">service_s</span>
</pre></div>
</div>
</td>
<td><p>Il sistema ha nome <em>service_s</em>  (tutte minuscole)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="dichiarazione-dei-messaggi">
<span id="id154"></span><h3>2) Dichiarazione dei messaggi<a class="headerlink" href="#dichiarazione-dei-messaggi" title="Permalink to this heading">¶</a></h3>
<p>La specifica dei messaggi concorre a formare il <strong>Vocabolario del sistema</strong>
(si veda <a class="reference internal" href="#conoscere-per-comunicare"><span class="std std-ref">Conoscere per comunicare</span></a>)
e parte della <a class="reference internal" href="#vista-esterna"><span class="std std-ref">Vista esterna</span></a>.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Dispatch</span> <span class="n">insert</span> <span class="p">:</span> <span class="n">product</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="n">W</span><span class="p">)</span> <span class="s2">&quot;IN | inserire&quot;</span>
<span class="n">Dispatch</span> <span class="n">remove</span> <span class="p">:</span> <span class="n">pid</span><span class="p">(</span><span class="n">ID</span><span class="p">)</span>        <span class="s2">&quot;IN | rimuovere&quot;</span>

<span class="n">Request</span> <span class="n">search</span>  <span class="p">:</span> <span class="n">pid</span><span class="p">(</span> <span class="n">ID</span> <span class="p">)</span>    <span class="s2">&quot;IN | cercare&quot;</span>
<span class="n">Reply</span> <span class="n">searchAnswer</span><span class="p">:</span> <span class="n">product</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="n">W</span><span class="p">)</span> <span class="k">for</span> <span class="n">search</span>

<span class="n">Event</span> <span class="n">info</span> <span class="p">:</span> <span class="n">warning</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>  <span class="s2">&quot;OUT S=bufFull ...&quot;</span>
</pre></div>
</div>
</td>
<td><p>I messaggi con <strong>commento IN</strong> servono per <em>inserire, eliminare, cercare</em>
prodotti i cui attributi sono gli argomenti del payload <code class="docutils literal notranslate"><span class="pre">product</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ID</span></code> : identificatore</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">P</span></code> : nome</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">W</span></code> : peso</p></li>
</ul>
<p>I messaggi con <strong>commento OUT</strong> sono <em>notifiche</em> in forma di <strong>Event</strong> di nome <code class="docutils literal notranslate"><span class="pre">info</span></code>
e payload  <code class="docutils literal notranslate"><span class="pre">warning(S)</span></code> che il sistema può emettere.</p>
</td>
</tr>
</tbody>
</table>
</section>
<section id="dichiarazione-dei-contesti">
<span id="id155"></span><h3>3) Dichiarazione dei contesti<a class="headerlink" href="#dichiarazione-dei-contesti" title="Permalink to this heading">¶</a></h3>
<p>Il sistema è costituito da un singolo <a class="reference internal" href="#context"><span class="std std-ref">Context</span></a> di nome <code class="docutils literal notranslate"><span class="pre">ctx_s</span></code>,
dislocato sull’host di indirzzo <code class="docutils literal notranslate"><span class="pre">192.168.1.132</span></code> alla porta <code class="docutils literal notranslate"><span class="pre">8111</span></code></p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 98%" />
<col style="width: 2%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Context</span> <span class="n">ctx_s</span> <span class="n">ip</span> <span class="p">[</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;192.168.1.132&quot;</span> <span class="n">port</span><span class="o">=</span><span class="mi">8111</span><span class="p">]</span>
</pre></div>
</div>
</td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="dichiarazione-degi-attori">
<span id="dichiarazione-degli-attori"></span><h3>4) Dichiarazione degi attori<a class="headerlink" href="#dichiarazione-degi-attori" title="Permalink to this heading">¶</a></h3>
<p>Il sistema è costituito da un singolo <a class="reference internal" href="#qactor"><span class="std std-ref">QActor</span></a> di nome <code class="docutils literal notranslate"><span class="pre">productservice</span></code>,
che fa parte del <a class="reference internal" href="#context"><span class="std std-ref">Context</span></a> <code class="docutils literal notranslate"><span class="pre">ctx_s</span></code>.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">QActor</span> <span class="n">productservice</span> <span class="n">context</span> <span class="n">ctx_s</span><span class="p">{</span>
  <span class="n">State</span> <span class="n">s0</span> <span class="n">initial</span><span class="p">{</span>  <span class="o">//</span><span class="n">stato</span> <span class="n">iniziale</span> <span class="p">(</span><span class="n">UNICO</span><span class="p">)</span>
      <span class="n">println</span><span class="p">(</span><span class="s2">&quot;$name | STARTS&quot;</span><span class="p">)</span> <span class="n">color</span> <span class="n">blue</span>
  <span class="p">}</span>
  <span class="n">Goto</span> <span class="n">work</span> <span class="o">//</span><span class="n">Transizione</span> <span class="n">di</span> <span class="n">stato</span>

  <span class="o">//</span><span class="n">Altri</span> <span class="n">stati</span>
  <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
<td><p>Il comportamento di <code class="docutils literal notranslate"><span class="pre">productservice</span></code> è descritto come una <a class="reference external" href="https://it.wikipedia.org/wiki/Macchina_di_Moore">Macchina di Moore</a> a stati finiti,
il cui stato iniziale è <code class="docutils literal notranslate"><span class="pre">s0</span></code>, in cui viene stampato un messaggio di avvio.</p>
</td>
</tr>
</tbody>
</table>
<section id="vistae-esterna-di-service-s">
<h4>Vistae esterna di service_s<a class="headerlink" href="#vistae-esterna-di-service-s" title="Permalink to this heading">¶</a></h4>
<p>La <a class="reference internal" href="#dichiarazione-dei-messaggi"><span class="std std-ref">2) Dichiarazione dei messaggi</span></a> e la <a class="reference internal" href="#dichiarazione-dei-contesti"><span class="std std-ref">3) Dichiarazione dei contesti</span></a>
forniscono la <a class="reference internal" href="#vista-esterna"><span class="std std-ref">Vista esterna</span></a> del sistema <code class="docutils literal notranslate"><span class="pre">service_s</span></code>.</p>
<p>Da queste dichiarazioni un lettore umano e un computer possono ricavare
il <a class="reference internal" href="#conoscere-per-comunicare"><span class="std std-ref">vocabolario del sistema</span></a> e le modalità logiche di interazione con esso.</p>
<p>Notiamo che, al monento, <strong>non</strong> ci sono <em>capacità espressive esplcite</em> per qualificare se i
messaggi specificati in <span class="xref std std-ref">2. Dichiarazione dei messaggi</span>
si intendono <strong>inviati</strong> al servizio o <strong>emessi</strong> dal servizio. In questo esempio, si sono
usati i termini e <strong>IN</strong> e <strong>OUT</strong> nei commenti per cercare di ovviare a questa lacuna.</p>
<p>La <a class="reference internal" href="#vista-esterna"><span class="std std-ref">Vista esterna</span></a> del sistema è dunque limitata all’insieme dei messaggi <strong>usati globalmente</strong>
nel sistema stesso, ma ha elementi di ambiguità nel caso il sistema sia un servizio.
Ad esempio,  <em>service_s</em> potrebbe fare riferimento
a ciascun messaggio sia come <strong>ricevitore</strong> opuure come <strong>emettitore</strong> (o in entrambi i modi).
L’ambiguità potra, al momento, essere risolta solo esaminando la <a class="reference internal" href="#vista-interna"><span class="std std-ref">Vista interna</span></a> di ogni QActor.</p>
<p>Questa carenza di capacità espressiva indica che il <em>linguaggio qak</em>, come ogni prodotto informatico,
può essere ancora suscettibile di evoluzione.
Tuttavia , come si vedrà in seguito, il linguaggio è già sufficientemente espressivo per modellare
sistemi software di una certa complessità e per ragionare su di essi
(come analisti e come progettisti) senza perdersi in troppi dettagli.</p>
</section>
</section>
</section>
<section id="interagire-con-il-service-s">
<h2>Interagire con il service_s<a class="headerlink" href="#interagire-con-il-service-s" title="Permalink to this heading">¶</a></h2>
<p>Prima di addentrarci in ulteriori dettagli del linguaggio qak
e nella <a class="reference internal" href="#vista-interna-del-sistema-service-s"><span class="std std-ref">Vista interna del sistema service_s</span></a>, osserviamo che le attuali specifiche
permettono già di capire come un osservatore <code class="docutils literal notranslate"><span class="pre">Obs</span></code>  potrebbe interagire con il sistema .</p>
<section id="un-osservatore-alieno">
<h3>Un osservatore ‘alieno’<a class="headerlink" href="#un-osservatore-alieno" title="Permalink to this heading">¶</a></h3>
<p>Si può realizzare un client <code class="docutils literal notranslate"><span class="pre">Obs</span></code> usando un linguaggio di programmazione
qualsiasi (es. <em>Kotlin, Java, Python, JavaScript</em>, etc.), costruendo i messaggi secondo la sintassi
voluta dal servizio e inviandoli via
<strong>TCP</strong> al nodo di indirizzo <code class="docutils literal notranslate"><span class="pre">192.168.1.132</span></code> e porta <code class="docutils literal notranslate"><span class="pre">8111</span></code>.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">main</span><span class="o">.</span><span class="n">java</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">unibo.basicomm23.interfaces.IApplMessage</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">unibo.basicomm23.interfaces.Interaction</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">unibo.basicomm23.utils.CommUtils</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">unibo.basicomm23.utils.ConnectionFactory</span><span class="p">;</span>

<span class="n">public</span> <span class="k">class</span> <span class="nc">ObsClientJava</span> <span class="p">{</span>
  <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
<td><p>L’observer fa uso di molte classi de <span class="xref std std-ref">La libreria unibo.basicomm23</span>.</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>l’interfaccia <strong>IApplMessage</strong> per la rappresentazione dei messaggi applicativi</p></li>
<li><p>l’interfaccia <strong>Interaction</strong> per la rappresentazione di una connessione astraendo dal tipo di protocollo</p></li>
<li><p>la classe <strong>CommUtils</strong> che fornisce metodi statici per la costruzione e gestione dei messaggi</p></li>
<li><p>la classe <strong>ConnectionFactory</strong> che fornisce metodi statici per la creazione di connessioni con diversi protocolli</p></li>
</ul>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">ObsClientJava</span> <span class="p">{</span>
<span class="o">/*</span><span class="mi">1</span><span class="o">*/</span><span class="n">private</span> <span class="n">Interaction</span> <span class="n">conn</span> <span class="p">;</span>
<span class="o">/*</span><span class="mi">2</span><span class="o">*/</span><span class="n">private</span> <span class="n">IApplMessage</span> <span class="n">insertCmd</span> <span class="o">=</span>
     <span class="n">CommUtils</span><span class="o">.</span><span class="n">buildDispatch</span><span class="p">(</span>
      <span class="s2">&quot;obsclientjava&quot;</span><span class="p">,</span> <span class="s2">&quot;insert&quot;</span><span class="p">,</span>
      <span class="s2">&quot;product(p4,printer,40)&quot;</span><span class="p">,</span><span class="s2">&quot;productservice&quot;</span><span class="p">);</span>
<span class="o">/*</span><span class="mi">3</span><span class="o">*/</span><span class="n">private</span> <span class="n">IApplMessage</span> <span class="n">get</span> <span class="o">=</span>
      <span class="n">CommUtils</span><span class="o">.</span><span class="n">buildRequest</span><span class="p">(</span>
      <span class="s2">&quot;obsclientjava&quot;</span><span class="p">,</span> <span class="s2">&quot;search&quot;</span><span class="p">,</span>
      <span class="s2">&quot;pid(p4)&quot;</span><span class="p">,</span> <span class="s2">&quot;productservice&quot;</span><span class="p">);</span>

<span class="o">/*</span><span class="mi">4</span><span class="o">*/</span><span class="n">public</span> <span class="n">void</span> <span class="n">doJob</span><span class="p">()</span> <span class="p">{</span>
  <span class="o">...</span>
  <span class="p">}</span>

  <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ObsClientJava</span> <span class="n">client</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ObsClientJava</span><span class="p">();</span>
    <span class="n">client</span><span class="o">.</span><span class="n">doJob</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
<td><p>L’observer ‘alieno’ di classe <code class="docutils literal notranslate"><span class="pre">ObsClientJava</span></code> definisce:</p>
<ol class="arabic simple">
<li><p>variabile  di tipo <code class="docutils literal notranslate"><span class="pre">Interaction</span></code> per una connessione (TCP) verso il servizio <code class="docutils literal notranslate"><span class="pre">productservice</span></code></p></li>
<li><p>messaggio di tipo <strong>dispatch</strong> di nome <code class="docutils literal notranslate"><span class="pre">insert</span></code> al servizio <code class="docutils literal notranslate"><span class="pre">productservice</span></code>
con sender <code class="docutils literal notranslate"><span class="pre">obsclientjava</span></code>.
Il payload denota un prodotto con identificatore <code class="docutils literal notranslate"><span class="pre">p4</span></code>, nome <code class="docutils literal notranslate"><span class="pre">printer</span></code> e peso <code class="docutils literal notranslate"><span class="pre">40</span></code>.</p></li>
<li><p>messaggio di tipo <strong>request</strong> (bloccante) di nome <code class="docutils literal notranslate"><span class="pre">search</span></code> al servizio <code class="docutils literal notranslate"><span class="pre">productservice</span></code>
con sender <code class="docutils literal notranslate"><span class="pre">obsclientjava</span></code>. Il payload denota la ricerca del prodotto con identificatore <code class="docutils literal notranslate"><span class="pre">p4</span></code>.</p></li>
<li><p>metodo che include il codice per inviare i messaggi al servizio.</p></li>
</ol>
</td>
</tr>
</tbody>
</table>
<section id="il-comportamento-dell-osservatore-alieno">
<h4>Il comportamento dell’osservatore alieno<a class="headerlink" href="#il-comportamento-dell-osservatore-alieno" title="Permalink to this heading">¶</a></h4>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">void</span> <span class="n">doJob</span><span class="p">()</span> <span class="p">{</span>
<span class="k">try</span> <span class="p">{</span>
<span class="o">/*</span><span class="mi">1</span><span class="o">*/</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">ConnectionFactory</span><span class="o">.</span><span class="n">createClientSupport23</span><span class="p">(</span>
          <span class="n">unibo</span><span class="o">.</span><span class="n">basicomm23</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">ProtocolType</span><span class="o">.</span><span class="n">tcp</span><span class="p">,</span>
          <span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="s2">&quot;8111&quot;</span><span class="p">);</span>
<span class="o">/*</span><span class="mi">2</span><span class="o">*/</span> <span class="n">conn</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">insertCmd</span><span class="p">);</span>
<span class="o">/*</span><span class="mi">3</span><span class="o">*/</span> <span class="n">IApplMessage</span> <span class="n">answer</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">request</span><span class="p">(</span> <span class="n">get</span> <span class="p">);</span>
<span class="o">/*</span><span class="mi">4</span><span class="o">*/</span> <span class="n">CommUtils</span><span class="o">.</span><span class="n">outmagenta</span><span class="p">(</span><span class="s2">&quot;answer=&quot;</span>    <span class="o">+</span><span class="n">answer</span><span class="p">);</span>
<span class="p">}</span><span class="n">catch</span> <span class="p">(</span><span class="ne">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span> <span class="n">e</span><span class="o">.</span><span class="n">printStackTrace</span><span class="p">();</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
<td><ol class="arabic simple">
<li><p>stabilisce la connessione TCP verso il servizio <code class="docutils literal notranslate"><span class="pre">productservice</span></code></p></li>
<li><p>invia il messaggio di tipo <strong>dispatch</strong> di nome <code class="docutils literal notranslate"><span class="pre">insert</span></code></p></li>
<li><p>invia la <strong>request</strong> di nome <code class="docutils literal notranslate"><span class="pre">search</span></code></p></li>
<li><p>visualizza la risposta ricevuta dal servizio.</p></li>
</ol>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Un osservatore espresso da un
programma scritto in un linguaggio diverso dal linguaggio qak,
non potrà ricevere messaggi di tipo <strong>Event</strong>, a meno che <code class="docutils literal notranslate"><span class="pre">service_s</span></code> non li emetta
usando un broker MQTT (un argomento che affronteremo nel seguito).</p>
</div>
</section>
</section>
</section>
<section id="osservazione-e-testing">
<span id="id156"></span><h2>Osservazione e testing<a class="headerlink" href="#osservazione-e-testing" title="Permalink to this heading">¶</a></h2>
<p>La conoscenza del vocabolario di un sistema e della sua semnatica, fornisce una base
per <strong>validare</strong> il sistema, verificando che il comportamento osservato
sia quello  previsto.</p>
<p>La possibilità di esprimere una interazione con <code class="docutils literal notranslate"><span class="pre">service_s</span></code> sulla base della
<span class="xref std std-ref">logica della comunicazione</span>
legata ai messaggi specificati in <span class="xref std std-ref">2. Dichiarazione dei messaggi</span>
anche senza conoscere i dettagli implementativi del servizio,
costituisce un importante strumento per la pianificazione di <strong>test funzionali</strong>.</p>
<p>I test possono anche essere eseguiti <strong>in modo automatico</strong>, utilizzando un framework di test
come <a class="reference external" href="https://www.html.it/articoli/junit-unit-testing-per-applicazioni-java/">JUnit</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="n">junit</span><span class="o">.</span><span class="n">Assert</span><span class="o">.</span><span class="n">fail</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.junit.After</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Before</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.junit.BeforeClass</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">unibo.basicomm23.interfaces.IApplMessage</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">unibo.basicomm23.interfaces.Interaction</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">unibo.basicomm23.utils.CommUtils</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">unibo.basicomm23.utils.ConnectionFactory</span><span class="p">;</span>

<span class="n">public</span> <span class="k">class</span> <span class="nc">ObsAsTester</span> <span class="p">{</span>
  <span class="n">private</span> <span class="n">Interaction</span> <span class="n">conn</span> <span class="p">;</span>

    <span class="n">private</span> <span class="n">IApplMessage</span> <span class="n">insertCmd</span> <span class="o">=</span> <span class="n">CommUtils</span><span class="o">.</span><span class="n">buildDispatch</span><span class="p">(</span>
      <span class="s2">&quot;obsclientjava&quot;</span><span class="p">,</span> <span class="s2">&quot;insert&quot;</span><span class="p">,</span> <span class="s2">&quot;product(p4,printer,40)&quot;</span><span class="p">,</span> <span class="s2">&quot;productservice&quot;</span><span class="p">);</span>
    <span class="n">private</span> <span class="n">IApplMessage</span> <span class="n">get</span> <span class="o">=</span> <span class="n">CommUtils</span><span class="o">.</span><span class="n">buildRequest</span><span class="p">(</span>
      <span class="s2">&quot;obsclientjava&quot;</span><span class="p">,</span> <span class="s2">&quot;search&quot;</span><span class="p">,</span> <span class="s2">&quot;pid(p4)&quot;</span><span class="p">,</span> <span class="s2">&quot;productservice&quot;</span><span class="p">);</span>

  <span class="nd">@Before</span>
  <span class="n">public</span> <span class="n">void</span> <span class="n">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">ConnectionFactory</span><span class="o">.</span><span class="n">createClientSupport23</span><span class="p">(</span>
              <span class="n">unibo</span><span class="o">.</span><span class="n">basicomm23</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">ProtocolType</span><span class="o">.</span><span class="n">tcp</span><span class="p">,</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="s2">&quot;8111&quot;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nd">@After</span>
  <span class="n">public</span> <span class="n">void</span> <span class="n">down</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;down&quot;</span><span class="p">);</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">();</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="ne">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Connection close failed&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nd">@Test</span>
  <span class="n">public</span> <span class="n">void</span> <span class="n">testAsObs</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">String</span> <span class="n">expected</span> <span class="o">=</span> <span class="s2">&quot;product(p4,printer,40)&quot;</span><span class="p">;</span>
      <span class="n">CommUtils</span><span class="o">.</span><span class="n">outmagenta</span><span class="p">(</span><span class="s2">&quot;insert&quot;</span> <span class="p">);</span>
      <span class="n">conn</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">insertCmd</span><span class="p">);</span>
      <span class="n">CommUtils</span><span class="o">.</span><span class="n">outmagenta</span><span class="p">(</span><span class="s2">&quot;search&quot;</span> <span class="p">);</span>
      <span class="n">IApplMessage</span> <span class="n">answer</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">request</span><span class="p">(</span> <span class="n">get</span> <span class="p">);</span>
      <span class="n">CommUtils</span><span class="o">.</span><span class="n">outmagenta</span><span class="p">(</span><span class="s2">&quot;answer=&quot;</span>        <span class="o">+</span><span class="n">answer</span><span class="p">);</span>

      <span class="k">assert</span><span class="p">(</span> <span class="n">answer</span><span class="o">.</span><span class="n">msgContent</span><span class="p">()</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">expected</span><span class="p">)</span> <span class="p">);</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="ne">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span> <span class="n">e</span><span class="o">.</span><span class="n">printStackTrace</span><span class="p">();</span> <span class="p">}</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Il codice sopra riportato è un esempio di test funzionale
eseguito con il framework di test <a class="reference external" href="https://www.html.it/articoli/junit-unit-testing-per-applicazioni-java/">JUnit</a>.
Il test è definito in una classe di nome <code class="docutils literal notranslate"><span class="pre">ObsAsTester</span></code> che (in modo analogo a <code class="docutils literal notranslate"><span class="pre">ObsClientJava</span></code>):</p>
<ul>
<li><p>stabilisce una connessione TCP verso il servizio <code class="docutils literal notranslate"><span class="pre">productservice</span></code> nel metodo <code class="docutils literal notranslate"><span class="pre">setup()</span></code>.
Questo metodo viene eseguito prima di ogni test;</p></li>
<li><p>chiude la connessione nel metodo <code class="docutils literal notranslate"><span class="pre">down()</span></code>. Questo metodo viene eseguito dopo ogni test:</p></li>
<li><p>esegue il test nel metodo <code class="docutils literal notranslate"><span class="pre">testAsObs()</span></code> in cui:
- invia un messaggio di tipo <strong>dispatch</strong> di nome <code class="docutils literal notranslate"><span class="pre">insert</span></code>
- invia una <strong>request</strong> di nome <code class="docutils literal notranslate"><span class="pre">search</span></code>
- verifica che la risposta ricevuta sia quella attesa,</p>
<blockquote>
<div><p>cioè che il contenuto del messaggio di risposta sia uguale a <code class="docutils literal notranslate"><span class="pre">product(p4,printer,40)</span></code></p>
</div></blockquote>
</li>
</ul>
<p>Per chi volesse approfondire, si vedano anche <a class="reference external" href="http://sqa.fyicenter.com/FAQ/JUnit/What_Is_JUnit_.html">JUnit FAQ</a>.</p>
</section>
<section id="progettazione-e-sviluppo-come-processo-evolutivo">
<h2>Progettazione e sviluppo come processo evolutivo<a class="headerlink" href="#progettazione-e-sviluppo-come-processo-evolutivo" title="Permalink to this heading">¶</a></h2>
<p>L’uso dei modelli è utile (per non dire indispensabile) PER CONCENTRARE
l’attenzione SUGLI ASPETTI RITENUTI SALIENTI (tenendo conto anche
dei tempi, delle tecnologie disponibili  e dei costi).</p>
<p>Rispetto a UML, il linguaggio qak vuole fornire uno strumento  esplicitamente
orientato alla specifica e realizzazione di sistemi distributi basati
su attori e/o microservizi, allo scopo di
abbattere i costri di produzione di un sistema distribuito.</p>
<p>La possibilià di definire fin dalle fasi di analisi del problema l’architettura di un sistema distribuito
in termini di un modello eseguibile (qak) costitusice un solido punto di partenza
per la progettazione e la costruzione cooperativa di un sistema software.</p>
<p>Operatori umani diversi (<em>customer, responsabili aziendali, sviluppatori</em>) possono trovare
nel modello qak un punto di confronto e reciproca comprensione, premessa indispensabile
per uno sviluppo consapevole, condiviso e motivato del prodotto, cioè
per il passaggio da <strong>WHAT</strong> (cosa) a <strong>HOW</strong> (come).</p>
<p>Questo passaggio può essere visto e svolto come un <cite>processo evolutivo</cite> di trasformazione/specializzazione di questa
del modello di partenza (architettura logica del sistema) prodotto in fase di analisi del problema.</p>
<p>L’architettura logica può essere anche il riferimento per la impostazione di
PIANI di testing (<strong>TestPlans</strong>) espressi in MODO NON discorsivo (formale), comprensibile a una macchina.</p>
<section id="un-osservatore-come-qactor">
<h3>Un osservatore come QActor<a class="headerlink" href="#un-osservatore-come-qactor" title="Permalink to this heading">¶</a></h3>
<p>Ovviamente un osservatore di <code class="docutils literal notranslate"><span class="pre">service_s</span></code> dovrebbe essere un componente che opera al di fuori del sistema <code class="docutils literal notranslate"><span class="pre">service_s</span></code>.</p>
<p>Tuttavia, per agevolare la fase di messa a punto di un sistema, è spesso conveniente introdurre
un osservatore <strong>locale</strong> che operi nello stesso Context del sistema osservato.</p>
<p>In questo modo si facilita la sperimentazione e il debugging del sistema,
durante la sua fase di sviluppo e test.</p>
<p>Una volta che il sistema è stato validato, l’osservatore locale può essere
spostato in un Context diverso, senza dover modificare la specifica del suo comportamento.</p>
<p>Procediamo dunque a definire un QActor di nome <code class="docutils literal notranslate"><span class="pre">client_s</span></code> che opera nel Context <code class="docutils literal notranslate"><span class="pre">ctx_s</span></code>
e interagisce con il servizio <code class="docutils literal notranslate"><span class="pre">productservice</span></code></p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">QActor</span> <span class="n">client_s</span> <span class="n">context</span> <span class="n">ctx_s</span><span class="p">{</span>
  <span class="n">State</span> <span class="n">s0</span> <span class="n">initial</span><span class="p">{</span>
  <span class="o">/*</span><span class="mi">1</span><span class="o">*/</span> <span class="n">println</span><span class="p">(</span><span class="s2">&quot;$name | STARTS&quot;</span><span class="p">)</span> <span class="n">color</span> <span class="n">blue</span>
  <span class="o">/*</span><span class="mi">2</span><span class="o">*/</span>
    <span class="n">forward</span> <span class="n">productservice</span>
        <span class="o">-</span><span class="n">m</span> <span class="n">insert</span> <span class="p">:</span> <span class="n">product</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">lampadina</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">forward</span> <span class="n">productservice</span>
        <span class="o">-</span><span class="n">m</span> <span class="n">insert</span> <span class="p">:</span> <span class="n">product</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span><span class="n">computer</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">forward</span> <span class="n">productservice</span>
        <span class="o">-</span><span class="n">m</span> <span class="n">insert</span> <span class="p">:</span> <span class="n">product</span><span class="p">(</span><span class="n">p3</span><span class="p">,</span><span class="n">smartphone</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="o">/*</span><span class="mi">3</span><span class="o">*/</span><span class="n">Goto</span> <span class="n">work</span> <span class="o">//</span><span class="n">Transizione</span> <span class="n">di</span> <span class="n">stato</span>
</pre></div>
</div>
</td>
<td><p>Nello stato iniziale, <em>client_s</em>:</p>
<ol class="arabic simple">
<li><p>visualizza un messaggio di avvio usando l’azione qak <strong>println</strong>.
Il simbolo <strong>$</strong> permette di usare l’interpolazione di stringhe in kotlin.
<strong>name</strong> è una variabile qak che denota il nome del QActor che esegue l’azioneù</p></li>
<li><p>invia tre volte il messaggio di tipo <strong>dispatch</strong>
di nome <code class="docutils literal notranslate"><span class="pre">insert</span></code> al servizio <code class="docutils literal notranslate"><span class="pre">productservice</span></code>.
I payload denotano tre prodotti diversi.</p></li>
<li><p>Al termine delle azioni, transita nello stato <code class="docutils literal notranslate"><span class="pre">work</span></code>.</p></li>
</ol>
</td>
</tr>
</tbody>
</table>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">State</span> <span class="n">work</span> <span class="p">{</span>
    <span class="o">//</span><span class="n">chiedi</span> <span class="n">al</span> <span class="n">servizio</span> <span class="n">un</span> <span class="n">prodotto</span>
<span class="o">/*</span><span class="mi">1</span><span class="o">*/</span><span class="n">request</span>  <span class="n">productservice</span> <span class="o">-</span><span class="n">m</span> <span class="n">search</span> <span class="p">:</span> <span class="n">pid</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
<span class="p">}</span>
<span class="o">/*</span><span class="mi">2</span><span class="o">*/</span><span class="n">Transition</span> <span class="n">t0</span>
    <span class="n">whenReply</span> <span class="n">searchAnswer</span> <span class="o">-&gt;</span> <span class="n">handleAnswerSearch</span>
</pre></div>
</div>
</td>
<td><p>Nello stato  <em>work</em> , <em>client_s</em> :</p>
<ol class="arabic simple">
<li><p>usa l’azione qak <strong>request</strong> per inviare
una <strong>request</strong> di nome <code class="docutils literal notranslate"><span class="pre">search</span></code> al servizio <code class="docutils literal notranslate"><span class="pre">productservice</span></code>,
con <em>payload</em> che denota l’identificatore del prodotto da cercare (<code class="docutils literal notranslate"><span class="pre">p2</span></code>).</p></li>
<li><p>specifica una transizione di stato che si attiva alla ricezione
di una <strong>reply</strong> di nome <code class="docutils literal notranslate"><span class="pre">searchAnswer</span></code>,
che lo fa transitare nello stato <code class="docutils literal notranslate"><span class="pre">handleAnswerSearch</span></code>.</p></li>
</ol>
</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>esegue il body <em>condactions</em> solo se il messaggio corrente (<strong>currentMsg</strong>)
ha msgId <code class="docutils literal notranslate"><span class="pre">searchAnswer</span></code> (in questo caso)
e può essere unificato in Prolog con il <em>template</em> di messaggio definito nella dichiarazione
(<code class="docutils literal notranslate"><span class="pre">product(ID,P,W)</span></code> in <span class="xref std std-ref">2. Dichiarazione dei messaggi</span>)
e con il template specificato <code class="docutils literal notranslate"><span class="pre">product(ID,NAME,W)</span></code> (in questo caso).</p></li>
</ul>
</section>
<section id="osservazione-dell-evento-info">
<h3>Osservazione dell’evento info<a class="headerlink" href="#osservazione-dell-evento-info" title="Permalink to this heading">¶</a></h3>
<p>Il QActor <code class="docutils literal notranslate"><span class="pre">client_s</span></code> può essere facilmente modificato per osservare anche gli
eventi di nome <code class="docutils literal notranslate"><span class="pre">info</span></code> emessi dal servizio <code class="docutils literal notranslate"><span class="pre">productservice</span></code>.</p>
<p>Basta aggiungere una specifica di transizione nello stato <code class="docutils literal notranslate"><span class="pre">work</span></code>  relativa
di un messaggio di tipo <strong>event</strong> di nome <code class="docutils literal notranslate"><span class="pre">info</span></code>:</p>
<p>Osserviamo che <em>client_s</em> nello stato work potrebbe avere ricevuto sia una <strong>reply</strong> di nome <code class="docutils literal notranslate"><span class="pre">searchAnswer</span></code>
che una <strong>event</strong> di nome <code class="docutils literal notranslate"><span class="pre">info</span></code>.
In questo caso, la transizione viene decisa in base all’ordine di arrivo dei messaggi
(si veda <a class="reference internal" href="#come-un-qactor-gestisce-i-messaggi-ricevuti"><span class="std std-ref">Come un QActor gestisce i messaggi ricevuti</span></a>).</p>
</section>
</section>
<section id="vista-interna-del-sistema-service-s">
<span id="id157"></span><h2>Vista interna del sistema service_s<a class="headerlink" href="#vista-interna-del-sistema-service-s" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">QActor</span> <span class="n">productservice</span> <span class="n">context</span> <span class="n">ctx_s</span><span class="p">{</span>
  <span class="p">[</span><span class="c1"># var Product = &quot;&quot; #]</span>
  <span class="n">State</span> <span class="n">s0</span> <span class="n">initial</span><span class="p">{</span>
        <span class="n">println</span><span class="p">(</span><span class="s2">&quot;$name | STARTS&quot;</span><span class="p">)</span> <span class="n">color</span> <span class="n">blue</span>
<span class="n">Goto</span> <span class="n">work</span>

<span class="n">State</span> <span class="n">work</span><span class="p">{</span>

<span class="p">}</span>
<span class="n">Transition</span> <span class="n">t0</span>
  <span class="n">whenMsg</span> <span class="n">insert</span>        <span class="o">-&gt;</span> <span class="n">handleinsert</span>
  <span class="n">whenRequest</span> <span class="n">search</span>    <span class="o">-&gt;</span> <span class="n">handleSearch</span>
<span class="o">....</span>

<span class="p">}</span><span class="o">//</span><span class="n">QA</span>
</pre></div>
</div>
</td>
<td><p>#.
#.</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">QActor</span> <span class="n">productservice</span> <span class="n">context</span> <span class="n">ctx_s</span><span class="p">{</span>
  <span class="p">[</span><span class="c1"># var Product = &quot;&quot; #]</span>
  <span class="n">State</span> <span class="n">s0</span> <span class="n">initial</span><span class="p">{</span>
        <span class="n">println</span><span class="p">(</span><span class="s2">&quot;$name | STARTS&quot;</span><span class="p">)</span> <span class="n">color</span> <span class="n">blue</span>
<span class="n">Goto</span> <span class="n">work</span>

<span class="n">State</span> <span class="n">work</span><span class="p">{</span>

<span class="p">}</span>
<span class="n">Transition</span> <span class="n">t0</span>
  <span class="n">whenMsg</span> <span class="n">insert</span>        <span class="o">-&gt;</span> <span class="n">handleinsert</span>
  <span class="n">whenRequest</span> <span class="n">search</span>    <span class="o">-&gt;</span> <span class="n">handleSearch</span>

<span class="o">...</span>
</pre></div>
</div>
<p>}//QA</p>
</td>
<td><p>#.
#.</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>QActor productservice context ctx_s{
...
State handleinsert{
  [# var PID  = &quot;&quot;
    var NAME = &quot;&quot;
    var WEIGHT = &quot;&quot;

  #]
  printCurrentMessage color blue
  onMsg( insert : product( ID,NAME,WEIGHT ) ){
    [# PID    = payloadArg(0) #]
    [# NAME   = payloadArg(1) #]
    [# WEIGHT = payloadArg(2) #]

    [# Product = currentMsg.msgContent() #]
    println( &quot;$Product&quot; ) color green
    solve( assert(item($Product) ) )
    ifSolved{
      println( &quot;sol=$currentSolution&quot; ) color green
    }
    println( &quot;$name |insert PID=$PID&quot;) color blue
  }
  }
Goto work
...
</pre></div>
</div>
<p>}//QA</p>
</td>
<td><p>#.
#.</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>QActor productservice context ctx_s{
...

State handleSearch{
  [# var ProductFound = &quot;&quot; #]
  printCurrentMessage color blue
  onMsg( search : pid( ID ) ){
    [# val R = payloadArg(0) #]
    println(&quot;$name | handleSearch $R &quot;) color green
    solve( item(product($R,N,W)) )
      ifSolved{
        [# val N = getCurSol(&quot;N&quot;)
          val W = getCurSol(&quot;W&quot;)
        #]
          println( &quot;$N, $W&quot; ) color green
        [# ProductFound = &quot;product($R, $N, $W )&quot; #]
      //println( &quot;sol=$currentSolution&quot; ) color green
      println( &quot;found=$ProductFound&quot; ) color green


    }else{
      println( &quot;not found&quot; ) color red
    }
  }
  println(&quot;$name | reply &quot;) color green
  replyTo search with searchAnswer :  $ProductFound
  emit info : warning(search)
  //product( &#39;{\&quot;productId\&quot;:31,\&quot;name\&quot;:\&quot;p31\&quot;,\&quot;weight\&quot;:311}&#39; )
}
Goto work

...
}//QA
</pre></div>
</div>
</td>
<td><p>#.
#.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="id158">
<span id="id159"></span><h1>Come è stato realizzato Qak<a class="headerlink" href="#id158" title="Permalink to this heading">¶</a></h1>
<section id="la-sintassi-di-qak">
<h2>La sintassi di qak<a class="headerlink" href="#la-sintassi-di-qak" title="Permalink to this heading">¶</a></h2>
<p>In Xtext, la grammatica è scritta in un dialetto della Notazione di Backus-Naur Estesa (EBNF),
dove ogni regola non solo descrive cosa il parser deve leggere, ma anche come trasformarlo
in un oggetto Java (EObject).</p>
<p><strong>Keyword e Terminali</strong></p>
<p>La sintassi si avvale di un insieme di terminali definiti nella  <a class="reference external" href="https://eclipse.dev/Xtext/documentation/301_grammarlanguage.html">Xtext grammar</a> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grammar</span> <span class="n">it</span><span class="o">.</span><span class="n">unibo</span><span class="o">.</span><span class="n">Qactork</span> <span class="k">with</span> <span class="n">org</span><span class="o">.</span><span class="n">eclipse</span><span class="o">.</span><span class="n">xtext</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">Terminals</span>
</pre></div>
</div>
<p>Le stringhe fisse (<em>keyword</em>) sono racchiuse tra apici singoli: <code class="docutils literal notranslate"><span class="pre">'entity'</span></code>, <code class="docutils literal notranslate"><span class="pre">'{'</span></code>.
I terminali (come <code class="docutils literal notranslate"><span class="pre">ID,</span> <span class="pre">INT,</span> <span class="pre">STRING</span></code>) descrivono i mattoni base (<strong>token</strong>) definiti solitamente tramite
espressioni regolari a basso livello</p>
<p>A questi si aggiungono alcuni terminali definiti appositamente per il linguaggio qak:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">Identificatore</span> <span class="n">di</span> <span class="n">variabile</span>
<span class="n">terminal</span> <span class="n">VARID</span> <span class="p">:</span> <span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="o">..</span><span class="s1">&#39;Z&#39;</span><span class="o">|</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="o">..</span><span class="s1">&#39;z&#39;</span><span class="o">|</span><span class="s1">&#39;A&#39;</span><span class="o">..</span><span class="s1">&#39;Z&#39;</span><span class="o">|</span><span class="s1">&#39;_&#39;</span><span class="o">|</span><span class="s1">&#39;0&#39;</span><span class="o">..</span><span class="s1">&#39;9&#39;</span><span class="p">)</span><span class="o">*</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Operatori</strong></p>
<p>Xtext usa i classici operatori delle espressioni regolari per gestire la ripetizione degli elementi:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">?</span></code>: Opzionale (0 o 1).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*</span></code>: Da 0 a molti.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">+</span></code>: Almeno uno (1 o molti).</p></li>
</ul>
<p><strong>Feature Assignments</strong></p>
<p>A differenza della BNF classica, Xtext introduce il concetto di <strong>Feature Assignment</strong>.
Non ci si limita a dire che dopo una “Entity” segue un nome, ma si istruisce Xtext a salvare quel nome
in un attributo dell’oggetto.</p>
<p>Questa estensione, che permette di mappare i pezzi di sintassi alle proprietà della classe <strong>Ecore</strong> generata,
assume le seguenti forms:</p>
<ul class="simple">
<li><p>feature* <strong>=*</strong> Regola: Assegnamento semplice (per valori singoli).</p></li>
<li><p>feature <strong>+=</strong> Regola: Add-to-list (per collezioni/liste).</p></li>
<li><p>feature <strong>?=</strong> Regola: Boolean assignment (vero se l’elemento è presente).</p></li>
</ul>
<p><strong>Cross-References</strong>
Permette di riferirsi a un elemento definito altrove nel codice tramite il suo nome,
gestendo automaticamente il linking:</p>
<ul class="simple">
<li><p><strong>[**Request</strong>]**: Cerca un oggetto di tipo <em>Request</em> usando l’ID predefinito.</p></li>
</ul>
<p>Esempio: <code class="docutils literal notranslate"><span class="pre">req=[Request]</span></code>.</p>
<p>Dunque Xtext non si limita a definire la forma del linguaggio (la sintassi),
ma modella contemporaneamente la struttura dei dati (l’Abstract Syntax Tree o AST)
attraverso un’integrazione profonda con il framework EMF (<strong>Eclipse Modeling Framework</strong>).</p>
<p><strong>Regole di Enumerazione</strong>
Xtext permette di definire tipi enumerativi che mappano direttamente a Enum Java. Ad esempio:</p>
<p><code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">Severity:</span> <span class="pre">INFO</span> <span class="pre">|</span> <span class="pre">WARNING</span> <span class="pre">|</span> <span class="pre">ERROR;</span></code></p>
<p><strong>Azioni semplici</strong></p>
<p>Hanno la forma <strong>{**TipoOggetto</strong>}** e permettono di cambiare “al volo” il tipo dell’oggetto creato  durante il parsing.
Ad esempio:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Saluto</span><span class="p">:</span> <span class="p">{</span><span class="n">Buongiorno</span><span class="p">}</span> <span class="s1">&#39;ciao&#39;</span> <span class="o">|</span> <span class="p">{</span><span class="n">Arrivederci</span><span class="p">}</span> <span class="s1">&#39;addio&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Se il parser legge “ciao”, non crea un oggetto generico <em>Saluto</em>, ma un oggetto di tipo <em>Buongiorno</em>.</p>
<p><strong>Azioni Assegnate</strong>
Hanno la forma <em>{*TipoOggetto.**feature=current*</em>}* e permettono di costruire costruire
alberi sintattici in modo incrementale. Il termine <strong>current</strong> rappresenta l’oggetto che il parser ha appena
finito di costruire fino a quel punto.</p>
<p>Sono utili per superare il problema della <strong>ricorsione a sinistra</strong>, che esclude regole
del tipo:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Espressione</span><span class="p">:</span> <span class="n">Espressione</span> <span class="s1">&#39;+&#39;</span> <span class="n">Termine</span><span class="p">;</span>
</pre></div>
</div>
<p>Per gestire la precedenza degli operatori (es. la moltiplicazione prima dell’addizione),
Xtext usa le <em>Azioni Assegnate</em> per “impacchettare” ciò che ha appena letto in un nuovo oggetto.</p>
<p>Ad esempio:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Addizione</span><span class="p">:</span> <span class="n">Moltiplicazione</span> <span class="p">({</span><span class="n">Addizione</span><span class="o">.</span><span class="n">left</span><span class="o">=</span><span class="n">current</span><span class="p">}</span> <span class="s1">&#39;+&#39;</span> <span class="n">right</span><span class="o">=</span><span class="n">Moltiplicazione</span><span class="p">)</span><span class="o">*</span><span class="p">;</span>
</pre></div>
</div>
<p>Quando il parser legge <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">+</span> <span class="pre">2</span> <span class="pre">+</span> <span class="pre">3</span></code></p>
<ul class="simple">
<li><p>Legge 1: Viene creato un oggetto (es. Numero) tramite la regola Moltiplicazione.
Questo oggetto diventa il <em>current</em>.</p></li>
<li><p>Incontra il +: Scatta l’azione {<em>Addizione.left=current</em>}.</p>
<ul>
<li><p>Viene creato un nuovo oggetto di tipo Addizione.</p></li>
<li><p>Il “vecchio” <em>current</em> (il numero 1) viene assegnato alla proprietà <strong>left</strong> della nuova Addizione.</p></li>
<li><p>La nuova Addizione diventa il nuovo current.</p></li>
</ul>
</li>
<li><p>Legge 2: Viene assegnato alla proprietà right.</p></li>
<li><p>Incontra un altro +: Il processo si ripete. La Addizione appena creata (che contiene 1+2)
viene “impacchettata” nel <strong>left</strong> di una nuova Addizione più grande.</p></li>
</ul>
<p>In sintesi: L’azione {<code class="docutils literal notranslate"><span class="pre">...=current</span></code>} prende quello che hai in mano, lo mette in un nuovo contenitore
e restituisce il contenitore stesso.</p>
</div></blockquote>
<p>Un esempio più completo:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Espressione</span><span class="p">:</span>
  <span class="n">Addizione</span><span class="p">;</span>

<span class="n">Addizione</span> <span class="n">returns</span> <span class="n">Espressione</span><span class="p">:</span>
    <span class="n">Moltiplicazione</span> <span class="p">({</span><span class="n">Addizione</span><span class="o">.</span><span class="n">left</span><span class="o">=</span><span class="n">current</span><span class="p">}</span> <span class="s1">&#39;+&#39;</span> <span class="n">right</span><span class="o">=</span><span class="n">Moltiplicazione</span><span class="p">)</span><span class="o">*</span><span class="p">;</span>

<span class="n">Moltiplicazione</span> <span class="n">returns</span> <span class="n">Espressione</span><span class="p">:</span>
    <span class="n">Primario</span> <span class="p">({</span><span class="n">Moltiplicazione</span><span class="o">.</span><span class="n">left</span><span class="o">=</span><span class="n">current</span><span class="p">}</span> <span class="s1">&#39;*&#39;</span> <span class="n">right</span><span class="o">=</span><span class="n">Primario</span><span class="p">)</span><span class="o">*</span><span class="p">;</span>

<span class="n">Primario</span> <span class="n">returns</span> <span class="n">Espressione</span><span class="p">:</span>
    <span class="s1">&#39;(&#39;</span> <span class="n">Espressione</span> <span class="s1">&#39;)&#39;</span> <span class="o">|</span> <span class="p">{</span><span class="n">Numero</span><span class="p">}</span> <span class="n">valore</span><span class="o">=</span><span class="n">INT</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Scrivendo <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">+</span> <span class="pre">2</span> <span class="pre">*</span> <span class="pre">3</span></code>, il parser raggrupperà <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">*</span> <span class="pre">3</span></code> dentro un oggetto <em>Moltiplicazione</em>
prima di finire l’oggetto <em>Addizione</em>, rispettando le regole matematiche</p></li>
<li><p>L’uso di <strong>returns Espressione</strong> serve a far capire a Java che tutti questi oggetti
(<em>Addizione, Moltiplicazione, Numero</em>) appartengono alla stessa gerarchia di classi.</p></li>
</ul>
<section id="notazioni-ispirate-ai-termini-prolog">
<span id="id160"></span><h3>Notazioni ispirate ai termini Prolog<a class="headerlink" href="#notazioni-ispirate-ai-termini-prolog" title="Permalink to this heading">¶</a></h3>
<p>Molte elementi di qak usano notazioni ispirate ai <em>termini Prolog</em>
che  sono denotati dal non-terminale <a class="reference internal" href="#phead"><span class="std std-ref">PHead</span></a>.</p>
<section id="phead">
<span id="id161"></span><h4>PHead<a class="headerlink" href="#phead" title="Permalink to this heading">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PHead</span> <span class="p">:</span> <span class="n">PAtom</span> <span class="o">|</span> <span class="n">PStruct</span> <span class="o">|</span> <span class="o">...</span> <span class="p">;</span>
</pre></div>
</div>
</section>
<section id="atomi">
<h4>Atomi<a class="headerlink" href="#atomi" title="Permalink to this heading">¶</a></h4>
<p>I temini più semplici sono gli <strong>atomi</strong>:</p>
<ul class="simple">
<li><p>un nome che inizia con una lettera minuscola
e può essere seguito da lettere (maiuscole o minuscole), cifre (<code class="docutils literal notranslate"><span class="pre">0-9</span></code>) e il carattere underscore (<code class="docutils literal notranslate"><span class="pre">_</span></code>).</p></li>
<li><p>qualsiasi sequenza di caratteri racchiusa tra virgolette singole</p></li>
<li><p>i simboli <code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">fail</span></code>, <code class="docutils literal notranslate"><span class="pre">[]</span></code> (lista vuota) .</p></li>
</ul>
<p>Atomi sono usati in qak, per denotare:</p>
<ul class="simple">
<li><p>i nomi dei <a class="reference internal" href="#qactor">QActor</a> (tutte minuscole)</p></li>
<li><p>i nomi dei <a class="reference internal" href="#context">Context</a>  (tutte minuscole)</p></li>
<li><p>i nomi dei messaggi e i nomi dei loro <strong>payload</strong></p></li>
</ul>
<p>Numeri, identificatori di variabili e stringhe sono considerati in qak una sorta di atomi speciali.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PAtom</span> <span class="p">:</span> <span class="n">PAtomString</span> <span class="o">|</span> <span class="n">Variable</span> <span class="o">|</span>  <span class="n">PAtomic</span> <span class="o">|</span> <span class="n">PAtomNum</span>  <span class="o">...</span>

<span class="n">PAtomString</span> <span class="p">:</span> <span class="n">val</span> <span class="o">=</span> <span class="n">STRING</span> <span class="p">;</span>
<span class="n">Variable</span>    <span class="p">:</span> <span class="n">varName</span><span class="o">=</span> <span class="n">VARID</span> <span class="p">;</span>
<span class="n">PAtomic</span>     <span class="p">:</span> <span class="n">val</span> <span class="o">=</span> <span class="n">ID</span> <span class="p">;</span>
<span class="n">PAtomNum</span>    <span class="p">:</span> <span class="n">val</span> <span class="o">=</span> <span class="n">INT</span> <span class="p">;</span>
</pre></div>
</div>
</section>
<section id="strutture">
<h4>Strutture<a class="headerlink" href="#strutture" title="Permalink to this heading">¶</a></h4>
<p>Termini non atomici sono le <strong>strutture</strong> (<em>functor</em> con argomenti):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PStruct</span> <span class="p">:</span> <span class="n">functor</span><span class="o">=</span><span class="n">ID</span> <span class="s2">&quot;(&quot;</span> <span class="p">(</span><span class="n">msgArg</span> <span class="o">+=</span> <span class="n">PHead</span><span class="p">)</span> <span class="p">(</span><span class="s2">&quot;,&quot;</span> <span class="n">msgArg</span> <span class="o">+=</span> <span class="n">PHead</span><span class="p">)</span><span class="o">*</span> <span class="s2">&quot;)&quot;</span> <span class="p">;</span>
<span class="o">//</span><span class="n">qak</span> <span class="n">richiede</span> <span class="n">almeno</span> <span class="n">un</span> <span class="n">argomento</span> <span class="n">PHead</span>
</pre></div>
</div>
<p>Le strutture permettono di denotare messaggi con payload articolati, ad esempio:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">product</span><span class="p">(</span> <span class="n">ID</span><span class="p">,</span> <span class="n">Name</span><span class="p">,</span> <span class="n">Weight</span> <span class="p">)</span>
</pre></div>
</div>
<p>La struttura <code class="docutils literal notranslate"><span class="pre">product/3</span></code> ha nome <code class="docutils literal notranslate"><span class="pre">product</span></code> e tre argomenti, denotati dalle variabili
<code class="docutils literal notranslate"><span class="pre">ID</span></code>, <code class="docutils literal notranslate"><span class="pre">Name</span></code>, <code class="docutils literal notranslate"><span class="pre">Weight</span></code>. A ciascuna di queste variabili può essere associato un termine
specifico al momento dell’invio del messaggio. Ad esempio:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">product</span><span class="p">(</span> <span class="n">p1</span><span class="p">,</span> <span class="n">lampadina</span><span class="p">,</span> <span class="mi">10</span> <span class="p">)</span>
</pre></div>
</div>
<p>Si noti che le variabili non sono vincolate a un tipo: i tipi dei dati vengono determinati
dalla loro denotazione sintattica: <code class="docutils literal notranslate"><span class="pre">p1</span></code> e <code class="docutils literal notranslate"><span class="pre">lampadina</span></code> sono atomi, mentre <code class="docutils literal notranslate"><span class="pre">10</span></code> è un intero. Nella frase:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">product</span><span class="p">(</span> <span class="n">p2</span><span class="p">,</span> <span class="n">computer</span><span class="p">(</span><span class="n">memory</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span><span class="s2">&quot;for gaming&quot;</span><span class="p">),</span> <span class="mi">100</span> <span class="p">)</span>
</pre></div>
</div>
<p>il secondo argomento è una <em>struct</em> con due argomenti, di cui il primo è una <em>struct</em> e il secondo è una <em>PAtomString</em>.</p>
</section>
</section>
<section id="unificazione-prolog-in-qak">
<h3>Unificazione Prolog in qak<a class="headerlink" href="#unificazione-prolog-in-qak" title="Permalink to this heading">¶</a></h3>
<p>Il meccanisno di unificazione è usato in qak per realizzare
operazioni di matching tra messaggi ricevuti e messaggi attesi.</p>
<p>La frase qak:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">solve</span><span class="p">(</span> <span class="n">unify</span><span class="p">(</span> <span class="n">product</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span> <span class="p">,</span> <span class="n">product</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">lampadina</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
<p>esegue la unificazione delle due strutture Prolog, producendo, in caso di successo, l’assegnazione di
valori (termini <em>PHead</em>) alle variabili.</p>
<p>Questa frase viene tradotta nel seguente codice Kotlin.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">solve</span><span class="p">(</span><span class="s2">&quot;unify(product(p1,X,Y),product(ID,lampadina,10))&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Il metodo <code class="docutils literal notranslate"><span class="pre">solve</span></code> è
definito nella classe base (<code class="docutils literal notranslate"><span class="pre">QActorBasic</span></code>), da cui  ogni <a class="reference internal" href="#qactor">QActor</a>,
nella sua definizione Kotlin  di basso livello, eredita:</p>
<p>Il metodo invoca il motore di inferenza Prolog integrato nel QActor (variabile <strong>pengine</strong>)
per eseguire l’unificazione sintattica.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Il secondo argomento del metodo <code class="docutils literal notranslate"><span class="pre">solve</span></code> viene usato per denotare il nome di una variabile
del termine applicativo di cui interessa il valore. Tale valore viene memorizzato
nella variabile denominata <strong>resVar</strong> del QActor.</p>
<p>Se si passa la stringa vuota,
il valore di <code class="docutils literal notranslate"><span class="pre">resVar</span></code> sarà <em>success</em> nel caso la unificazioneo  si realizzi o <em>fail</em>
nel caso in cui le due strutture applicative non siano unificabili.</p>
<p>Ad esempio:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">solve</span><span class="p">(</span><span class="s2">&quot;unify(product(p1,X,Y),product(ID,lampadina,10))&quot;</span><span class="p">,</span><span class="s2">&quot;X&quot;</span><span class="p">)</span>
<span class="n">CommUtils</span><span class="o">.</span><span class="n">outblack</span><span class="p">(</span><span class="s2">&quot;res=$resVar&quot;</span><span class="p">)</span>    <span class="o">//</span><span class="n">res</span><span class="o">=</span><span class="n">lampadina</span>
</pre></div>
</div>
</div>
<p>Il risultato del metodo <code class="docutils literal notranslate"><span class="pre">solve</span></code> viene memorizzato nella variabile <strong>currentSolution</strong> del QActor,
che può essere interrogata mediante il metodo <code class="docutils literal notranslate"><span class="pre">getCurSol(varName:</span> <span class="pre">String)</span></code>.
Ad esempio, il seguente codice Kotlin:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CommUtils</span><span class="o">.</span><span class="n">outblack</span><span class="p">(</span><span class="s2">&quot;res=$resVar&quot;</span><span class="p">)</span>
<span class="n">CommUtils</span><span class="o">.</span><span class="n">outblue</span><span class="p">(</span><span class="s2">&quot;sol=$currentSolution&quot;</span><span class="p">)</span>
<span class="n">CommUtils</span><span class="o">.</span><span class="n">outblue</span><span class="p">(</span> <span class="s2">&quot;--------------------------------&quot;</span> <span class="p">)</span>
<span class="k">if</span><span class="p">(</span> <span class="n">currentSolution</span><span class="o">.</span><span class="n">isSuccess</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
  <span class="n">CommUtils</span><span class="o">.</span><span class="n">outblack</span><span class="p">(</span><span class="s2">&quot;ID=${getCurSol(&quot;</span><span class="n">ID</span><span class="s2">&quot;)} &quot;</span><span class="p">)</span>
  <span class="n">CommUtils</span><span class="o">.</span><span class="n">outblack</span><span class="p">(</span><span class="s2">&quot;X=${getCurSol(&quot;</span><span class="n">X</span><span class="s2">&quot;)}   &quot;</span><span class="p">)</span>
  <span class="n">CommUtils</span><span class="o">.</span><span class="n">outblack</span><span class="p">(</span><span class="s2">&quot;Y=${getCurSol(&quot;</span><span class="n">Y</span><span class="s2">&quot;)}   &quot;</span><span class="p">)</span>
<span class="p">}</span><span class="k">else</span><span class="p">{</span>
  <span class="n">CommUtils</span><span class="o">.</span><span class="n">outred</span><span class="p">(</span><span class="s2">&quot;unification failed&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>produce il seguente output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="o">=</span><span class="n">success</span>
<span class="n">sol</span><span class="o">=</span><span class="n">yes</span><span class="o">.</span>
<span class="n">X</span> <span class="o">/</span> <span class="n">lampadina</span>  <span class="n">Y</span> <span class="o">/</span> <span class="mi">10</span>  <span class="n">ID</span> <span class="o">/</span> <span class="n">p1</span>
<span class="o">--------------------------------</span>
<span class="n">X</span>  <span class="o">=</span> <span class="n">lampadina</span>
<span class="n">Y</span>  <span class="o">=</span> <span class="mi">10</span>
<span class="n">ID</span> <span class="o">=</span> <span class="n">p1</span>
</pre></div>
</div>
<p>L’accesso alla soluzione di <strong>solve</strong> può essere espresso direttamente in  qak. Ad esempio:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">solve</span><span class="p">(</span> <span class="n">unify</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span> <span class="p">,</span> <span class="n">product</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">computer</span><span class="p">(</span><span class="n">memory</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span><span class="s2">&quot;for gaming&quot;</span><span class="p">),</span><span class="mi">100</span><span class="p">))</span> <span class="p">)</span>
<span class="n">ifSolved</span><span class="p">{</span>
  <span class="n">println</span><span class="p">(</span> <span class="s2">&quot;sol=$currentSolution&quot;</span> <span class="p">)</span> <span class="n">color</span> <span class="n">blue</span>
  <span class="n">println</span><span class="p">(</span> <span class="s2">&quot;------------------------------------------------&quot;</span> <span class="p">)</span>
  <span class="n">println</span><span class="p">(</span> <span class="s2">&quot;ID=${getCurSol(</span><span class="se">\&quot;</span><span class="s2">ID</span><span class="se">\&quot;</span><span class="s2">)} &quot;</span> <span class="p">)</span>   <span class="o">//</span> <span class="n">ID</span><span class="o">=</span><span class="n">p1</span>
  <span class="n">println</span><span class="p">(</span> <span class="s2">&quot;X=${getCurSol(</span><span class="se">\&quot;</span><span class="s2">X</span><span class="se">\&quot;</span><span class="s2">)} &quot;</span>   <span class="p">)</span>   <span class="o">//</span> <span class="n">X</span><span class="o">=</span><span class="n">computer</span><span class="p">(</span><span class="n">memory</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span><span class="s1">&#39;for gaming&#39;</span><span class="p">)</span>
  <span class="n">println</span><span class="p">(</span> <span class="s2">&quot;Y=${getCurSol(</span><span class="se">\&quot;</span><span class="s2">Y</span><span class="se">\&quot;</span><span class="s2">)} &quot;</span>   <span class="p">)</span>   <span class="o">//</span> <span class="n">Y</span><span class="o">=</span><span class="mi">100</span>
<span class="p">}</span><span class="k">else</span><span class="p">{</span>
  <span class="n">println</span><span class="p">(</span> <span class="s2">&quot;unification failed&quot;</span> <span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>L’azione qak <code class="docutils literal notranslate"><span class="pre">getCurSol(V)</span></code> permette di ottenere il valore della variabile <code class="docutils literal notranslate"><span class="pre">V</span></code>.</p>
</section>
</section>
<section id="le-cassi-della-infrastruttura">
<h2>Le cassi della infrastruttura<a class="headerlink" href="#le-cassi-della-infrastruttura" title="Permalink to this heading">¶</a></h2>
<section id="it-unibo-kactor-actorbasic-kt">
<h3>it.unibo.kactor.ActorBasic.kt<a class="headerlink" href="#it-unibo-kactor-actorbasic-kt" title="Permalink to this heading">¶</a></h3>
<p>Realizza  il concetto di QActor come ente computazionale dotato di flusso di controllo autonomo,
capace di recevere e gestire messaggi locali e/o remoti.</p>
<ul class="simple">
<li><p>Per le interazioni tra QActor nello stesso Context, si
avvale delle <span class="xref std std-ref">coroutine</span> kotlin.
Gestisce i messaggi in modo FIFO, sfruttando un  <span class="xref std std-ref">Kotlin actor</span> incapsulato.</p></li>
</ul>
</section>
<section id="actor-channel">
<h3>actor channel<a class="headerlink" href="#actor-channel" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">actor</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">actor</span><span class="o">&lt;</span><span class="n">IApplMessage</span><span class="o">&gt;</span><span class="p">(</span> <span class="n">dispatcher</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">channelSize</span> <span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span><span class="p">(</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">channel</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">msg</span><span class="o">.</span><span class="n">msgContent</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;stopTheActor&quot;</span><span class="p">)</span> <span class="p">{</span>  <span class="n">channel</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="p">}</span>
    <span class="k">else</span> <span class="n">actorBody</span><span class="p">(</span> <span class="n">msg</span> <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Per i  meccanismi di comunicazione remota usa
<span class="xref std std-ref">La libreria unibo.basicomm23</span> che implementa il concetto astratto
di <strong>Interaction</strong> per diversi protocolli di comunicazione (es. <code class="docutils literal notranslate"><span class="pre">MQTT</span></code>, <code class="docutils literal notranslate"><span class="pre">CoAP</span></code>, <code class="docutils literal notranslate"><span class="pre">TCP</span></code>).</p></li>
</ul>
</section>
<section id="sendmessagetoactor">
<span id="id162"></span><h3>sendMessageToActor<a class="headerlink" href="#sendmessagetoactor" title="Permalink to this heading">¶</a></h3>
<p>Il metodo <code class="docutils literal notranslate"><span class="pre">sendMessageToActor</span></code> realizza l’invio di un messaggio ad un attore
di cui è noto il nome (destName) o la connessione (conn).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>suspend fun sendMessageToActor(msg : IApplMessage,
       destName: String, conn : Interaction? = null ) {
  val destactor = context!!.hasActor(destName)
  /*
    se destactor  è locale: destactor.kactor.send( msg )
    altrimenti usa il proxy verso il contesto di destactor
  */
}
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/ActorBasic.png"><img alt="_images/ActorBasic.png" class="align-center" src="_images/ActorBasic.png" style="width: 60%;" /></a>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 55%" />
<col style="width: 45%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span><span class="mi">1</span><span class="o">*/</span> <span class="n">abstract</span> <span class="k">class</span>  <span class="nc">ActorBasic</span><span class="p">(</span>
<span class="o">/*</span><span class="mi">2</span><span class="o">*/</span>   <span class="n">name</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span>
<span class="o">/*</span><span class="mi">3</span><span class="o">*/</span>   <span class="n">val</span> <span class="n">scope</span><span class="p">:</span><span class="n">CoroutineScope</span><span class="o">=</span><span class="n">GlobalScope</span><span class="p">,</span>
<span class="o">/*</span><span class="mi">4</span><span class="o">*/</span>   <span class="n">var</span> <span class="n">discardMessages</span> <span class="n">Boolean</span><span class="o">=</span><span class="n">false</span><span class="p">,</span>
<span class="o">/*</span><span class="mi">5</span><span class="o">*/</span>   <span class="n">val</span> <span class="n">confined</span> <span class="p">:</span>    <span class="n">Boolean</span> <span class="o">=</span> <span class="n">false</span><span class="p">,</span>
<span class="o">/*</span><span class="mi">6</span><span class="o">*/</span>   <span class="n">val</span> <span class="n">ioBound</span> <span class="p">:</span>     <span class="n">Boolean</span> <span class="o">=</span> <span class="n">false</span><span class="p">,</span>
<span class="o">/*</span><span class="mi">7</span><span class="o">*/</span>   <span class="n">val</span> <span class="n">channelSize</span> <span class="p">:</span> <span class="n">Int</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="p">)</span> <span class="p">:</span>
<span class="o">/*</span><span class="mi">8</span><span class="o">*/</span>     <span class="n">CoapResource</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
<span class="o">/*</span><span class="mi">9</span><span class="o">*/</span>      <span class="n">MqttCallback</span> <span class="p">{</span>
      <span class="o">...</span>
    <span class="o">//</span><span class="n">To</span> <span class="n">be</span> <span class="n">overridden</span> <span class="n">by</span> <span class="n">the</span> <span class="n">application</span>
<span class="o">/*</span><span class="mi">10</span><span class="o">*/</span> <span class="n">abstract</span> <span class="n">suspend</span> <span class="n">fun</span> <span class="n">actorBody</span><span class="p">(</span>
          <span class="n">msg</span><span class="p">:</span><span class="n">IApplMessage</span><span class="p">)</span>
  <span class="p">}</span>
</pre></div>
</div>
</td>
<td><ol class="arabic simple">
<li><p><cite>class ActorBasic</cite> Si veda <span class="xref std std-ref">Oggetti e classi</span> in <span class="xref std std-ref">KotlinNotes</span>.</p></li>
<li><p><cite>name</cite> Nome (<strong>univoco</strong> nel sistema) dell’attore</p></li>
<li><p><cite>scope</cite> Si veda <span class="xref std std-ref">Le coroutines</span> in <span class="xref std std-ref">KotlinNotes</span> e  <a href="#id192"><span class="problematic" id="id193">`kotlinUniboCoroutinesIntro`_</span></a> in <a href="#id194"><span class="problematic" id="id195">`kotlinUnibo`_</span></a>.</p></li>
<li><p><cite>discardMessages</cite> scarta o meno i messaggi non attesi. Usato principalmente in
<a class="reference internal" href="#it-unibo-kactor-actorbasicfsm-kt"><span class="std std-ref">ActorBasicFsm</span></a></p></li>
<li><p><cite>confined</cite> Si veda <span class="xref std std-ref">Confinamento</span> in <span class="xref std std-ref">KotlinNotes</span>.</p></li>
<li><p><cite>ioBound</cite> Si veda <span class="xref std std-ref">Confinamento</span> in <span class="xref std std-ref">KotlinNotes</span>.</p></li>
<li><p><cite>channelSize</cite>  Si veda <span class="xref std std-ref">I canali</span> in <span class="xref std std-ref">KotlinNotes</span>.</p></li>
<li><p><cite>CoapResource</cite>  Si veda <span class="xref std std-ref">Estende CoapResource</span></p></li>
<li><p><cite>MqttCallback</cite> Si veda <span class="xref std std-ref">Implementa MqttCallback</span></p></li>
<li><p><cite>actorBody</cite>  codice per la gestione dei messaggi <span class="xref std std-ref">IApplMessage</span>
ricevuti dall’attore.</p></li>
</ol>
</td>
</tr>
</tbody>
</table>
<p>La frase:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span>  <span class="nc">ActorBasic</span><span class="p">(</span> <span class="o">...</span> <span class="p">)</span> <span class="p">:</span> <span class="n">CoapResource</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">MqttCallback</span>
</pre></div>
</div>
<p>esprime in forma compatta che <em>ActorBasic</em> <cite>eredita</cite> dalla classe <a href="#id196"><span class="problematic" id="id197">`CoapResource`_</span></a> e
<cite>implementa</cite> l’interfaccia <a href="#id198"><span class="problematic" id="id199">`MqttCallback`_</span></a> (si veda <a href="#id200"><span class="problematic" id="id201">`kotlinInheritance`_</span></a>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Estende CoapResource</strong></p>
<p>Ogni attore è anche una risorsa CoAP, specializzazione della classe definita nella libreria
<a class="reference external" href="https://www.eclipse.org/californium/">https://www.eclipse.org/californium/</a>.</p>
<p><strong>Implementa MqttCallback</strong></p>
<p>Ogni attore implementa anche l’interfaccia
<code class="docutils literal notranslate"><span class="pre">org.eclipse.paho.client.mqttv3.MqttCallback</span></code>. Pertanto
ogni attore può gestire notifiche emesse da un MQTT client, attraverso il metodo
<span class="xref std std-ref">messageArrived</span>.</p>
<p><strong>evento kernel_rawmsg</strong></p>
<p>Nel caso in cui il metodo
<span class="xref std std-ref">messageArrived</span>
riceva una stringa <code class="docutils literal notranslate"><span class="pre">S</span></code> che non corrisponde a un messaggio di tipo
<span class="xref std std-ref">IApplMessage</span>,
l’attore emette un evento di tipo <code class="docutils literal notranslate"><span class="pre">kernel_rawmsg</span> <span class="pre">:</span> <span class="pre">kernel_rawmsg(</span> <span class="pre">S</span> <span class="pre">)</span></code>.</p>
<p>Il componente applicativo che percepisce questo evento può convertire la stringa <code class="docutils literal notranslate"><span class="pre">S</span></code> in un messaggio qak.
Per un esempio si veda <span class="xref std std-ref">cellOnRasp Punti salienti</span>.</p>
</div>
</section>
<section id="it-unibo-kactor-actorbasicfsm-kt">
<span id="id163"></span><h3>it.unibo.kactor.ActorBasicFsm.kt<a class="headerlink" href="#it-unibo-kactor-actorbasicfsm-kt" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">abstract</span> <span class="k">class</span> <span class="nc">ActorBasicFsm</span><span class="p">(</span>  <span class="n">qafsmname</span><span class="p">:</span>  <span class="n">String</span><span class="p">,</span>
            <span class="n">fsmscope</span><span class="p">:</span> <span class="n">CoroutineScope</span> <span class="o">=</span> <span class="n">GlobalScope</span><span class="p">,</span>
            <span class="n">discardMessages</span> <span class="p">:</span> <span class="n">Boolean</span> <span class="o">=</span> <span class="n">false</span><span class="p">,</span>
            <span class="n">confined</span> <span class="p">:</span>    <span class="n">Boolean</span> <span class="o">=</span> <span class="n">false</span><span class="p">,</span>
            <span class="n">ioBound</span> <span class="p">:</span>     <span class="n">Boolean</span> <span class="o">=</span> <span class="n">false</span><span class="p">,</span>
            <span class="n">channelSize</span> <span class="p">:</span> <span class="n">Int</span> <span class="o">=</span> <span class="mi">50</span>
<span class="p">):</span> <span class="n">ActorBasic</span><span class="p">(</span><span class="n">qafsmname</span><span class="p">,</span><span class="n">fsmscope</span><span class="p">,</span><span class="n">discardMessages</span><span class="p">,</span><span class="n">confined</span><span class="p">,</span><span class="n">ioBound</span><span class="p">,</span><span class="n">channelSize</span><span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Un attore che specializza questa classe opera come un automa a stati finiti (<a class="reference internal" href="#qactor-come-fsm"><span class="std std-ref">QActor come FSM</span></a>).</p></li>
<li><p>Il codice Kotlin viene generato dalla <a class="reference internal" href="#qak-software-factory"><span class="std std-ref">Qak software factory</span></a></p></li>
<li><p>I messaggi ricevuti sul canale Kotlin
(ereditato da <span class="xref std std-ref">ActorBasic</span>) sono gestiti in relazione
alle specifiche sulle transizioni associate allo stato corrrente dell’automa.</p></li>
</ul>
</section>
</section>
</section>
<section id="sistemi-su-raspberrypi">
<h1>Sistemi su RaspberryPi<a class="headerlink" href="#sistemi-su-raspberrypi" title="Permalink to this heading">¶</a></h1>
<p>Premessa: <span class="xref std std-ref">RaspberrySoftware</span> e <span class="xref std std-ref">RaspBasicCode</span>.</p>
<p><cite>Project it.unibo.raspIntro2024</cite></p>
<p>In questa sezione affrontimao i seguenti punti:</p>
<ol class="arabic simple">
<li><p>Costruzione di un sistena software Sonar-Led technology-dependent su RaspberryPi</p></li>
<li><p>Sofware per un Sonarche emette via MQTT la distanza rilevata  (<a href="#id202"><span class="problematic" id="id203">`SonarMqtt.py`_</span></a>)
che può essere visualizzata con un grafico ((<a href="#id204"><span class="problematic" id="id205">`mqttPlotQakEvents.py`_</span></a>)</p></li>
<li><p>Sistema <span class="xref std std-ref">SonarAndLed</span> locale technology-dependent per <span class="xref std std-ref">SistemaRilevamento</span></p></li>
</ol>
<p>Software da installare:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">paho</span><span class="o">-</span><span class="n">mqtt</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">U</span> <span class="n">pip</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">U</span> <span class="n">matplotlib</span>
</pre></div>
</div>
<section id="verifica-dispositivi">
<h2>Verifica dispositivi<a class="headerlink" href="#verifica-dispositivi" title="Permalink to this heading">¶</a></h2>
<p>Riportiamo qui codice per sperimentare la corretta installazione del <code class="docutils literal notranslate"><span class="pre">Led</span></code> e del  sonar
<span class="xref std std-ref">HC-SR04</span> su RaspberryPi.</p>
<section id="software-per-il-led">
<h3>Software per il Led<a class="headerlink" href="#software-per-il-led" title="Permalink to this heading">¶</a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a href="#id206"><span class="problematic" id="id207">`led25GpioTurnOn.sh`_</span></a>, <a href="#id208"><span class="problematic" id="id209">`led25GpioTurnOff.sh`_</span></a></p></td>
<td><p>Accensione/spegnimento in bash (NO su BullsEye)</p></td>
</tr>
<tr class="row-even"><td><p><a href="#id210"><span class="problematic" id="id211">`led25OnOff.sh`_</span></a></p></td>
<td><p>Blinking in bash (NO su BullsEye)</p></td>
</tr>
<tr class="row-odd"><td><p><a href="#id212"><span class="problematic" id="id213">`ledOnOff.c`_</span></a></p></td>
<td><p>Blinking in C</p></td>
</tr>
<tr class="row-even"><td><p><a href="#id214"><span class="problematic" id="id215">`ledPython25.py`_</span></a></p></td>
<td><p>Blinking in Python</p></td>
</tr>
</tbody>
</table>
</section>
<section id="software-per-il-sonar">
<h3>Software per il Sonar<a class="headerlink" href="#software-per-il-sonar" title="Permalink to this heading">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd"><cite>ATTENZIONE</cite><span class="colon">:</span></dt>
<dd class="field-odd"><p>per gli esempi in Python, si fa riferimento a <cite>Python3</cite>. Si veda</p>
</dd>
</dl>
<p><span class="xref std std-ref">Installazione del modulo GPIO per Python3</span></p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a href="#id216"><span class="problematic" id="id217">`SonarAlone.c`_</span></a></p></td>
<td><p>Software per il <code class="docutils literal notranslate"><span class="pre">sonarHCSR04</span></code> scritto in C</p></td>
</tr>
<tr class="row-even"><td><p><a href="#id218"><span class="problematic" id="id219">`sonar.py`_</span></a></p></td>
<td><p>Software per il <code class="docutils literal notranslate"><span class="pre">sonarHCSR04</span></code> scritto in Python</p></td>
</tr>
<tr class="row-odd"><td><p><a href="#id220"><span class="problematic" id="id221">`SonarMqtt.py`_</span></a></p>
</td>
<td><p>Software per il <code class="docutils literal notranslate"><span class="pre">sonarHCSR04</span></code> scritto in Python che pubblica sul broker MQTT
<cite>mqtt.eclipseprojects.io</cite> TOPIC= <cite>unibo/sonar/events</cite> l’evento
<code class="docutils literal notranslate"><span class="pre">msg(sonardata,event,sonar,none,distance(D),N)</span></code>.</p>
<p>Si veda <a href="#id222"><span class="problematic" id="id223">`mqttPlotQakEvents.py`_</span></a>  come possibile receiver.</p>
</td>
</tr>
<tr class="row-even"><td><p><a href="#id224"><span class="problematic" id="id225">`mqttPlotQakEvents.py`_</span></a></p></td>
<td><p>Un ricevitore che fa subscribe a TOPIC= <cite>unibo/sonar/events</cite> per visualizzare
su un grafico i dati del Sonar</p></td>
</tr>
<tr class="row-odd"><td><p><a href="#id226"><span class="problematic" id="id227">`ControllerMqtt.py`_</span></a></p></td>
<td><p>Un controller che libera il Sonar da compiti di interazione applicativa.
Da usarsi in una pipe insieme a <a href="#id228"><span class="problematic" id="id229">`LedDevice.py`_</span></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">sonar</span><span class="o">.</span><span class="n">py</span> <span class="o">|</span> <span class="n">python</span> <span class="n">ControllerMqtt</span><span class="o">.</span><span class="n">py</span> <span class="o">|</span> <span class="n">python</span> <span class="n">LedDevice</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>:<cite>Costruiamo applicazioni</cite></p>
</section>
<section id="sonarandled">
<h3>SonarAndLed<a class="headerlink" href="#sonarandled" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Sistema <a class="reference internal" href="#sonarandled">SonarAndLed</a> organizzato in funzioni  Python</p></li>
<li><p>Ciascuna funzione ha una precisa responsbilità</p></li>
<li><p>La funzione <code class="docutils literal notranslate"><span class="pre">doJob()</span></code> funge da coordinatore</p></li>
<li><p>La funzione <code class="docutils literal notranslate"><span class="pre">applLogic</span></code> definisce la logica applicativa</p></li>
<li><p>La funzione <code class="docutils literal notranslate"><span class="pre">forward</span></code> invia informazioni via MQTT</p></li>
</ul>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Inizializzazione</p></td>
<td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">RPi.GPIO</span> <span class="k">as</span> <span class="nn">GPIO</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">paho.mqtt.client</span> <span class="k">as</span> <span class="nn">paho</span>

<span class="c1">### CONFIGURATION FOR LED</span>
<span class="n">GPIO</span><span class="o">.</span><span class="n">setmode</span><span class="p">(</span><span class="n">GPIO</span><span class="o">.</span><span class="n">BCM</span><span class="p">)</span>
<span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="n">GPIO</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>

<span class="c1">### CONFIGURATION FOR SONAR</span>
<span class="n">GPIO</span><span class="o">.</span><span class="n">setmode</span><span class="p">(</span><span class="n">GPIO</span><span class="o">.</span><span class="n">BCM</span><span class="p">)</span>
<span class="n">GPIO</span><span class="o">.</span><span class="n">setwarnings</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">TRIG</span> <span class="o">=</span> <span class="mi">17</span>
<span class="n">ECHO</span> <span class="o">=</span> <span class="mi">27</span>
<span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">TRIG</span><span class="p">,</span><span class="n">GPIO</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>
<span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">ECHO</span><span class="p">,</span><span class="n">GPIO</span><span class="o">.</span><span class="n">IN</span><span class="p">)</span>

<span class="c1">### MQTT</span>
<span class="n">brokerAddr</span><span class="o">=</span><span class="s2">&quot;mqtt.eclipseprojects.io&quot;</span>
<span class="n">msg</span>       <span class="o">=</span> <span class="s2">&quot;msg(sonardata,event,sonar,none,distance(D),N)&quot;</span>
<span class="n">n</span>         <span class="o">=</span> <span class="mi">1</span>
<span class="n">client</span>    <span class="o">=</span> <span class="n">paho</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">paho</span><span class="o">.</span><span class="n">CallbackAPIVersion</span><span class="o">.</span><span class="n">VERSION1</span><span class="p">,</span><span class="s2">&quot;sonarAndLed&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
    <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">TRIG</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>   <span class="c1">#TRIG parte LOW</span>
    <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">brokerAddr</span><span class="p">,</span> <span class="mi">1883</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Waiting a few seconds for the sensor to settle&#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>Coordinatore e attivatore</p></td>
<td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">doJob</span><span class="p">():</span>
    <span class="n">init</span><span class="p">()</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">sonarWork</span><span class="p">()</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">d</span>  <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="mf">150.0</span> <span class="p">):</span> <span class="c1"># FILTRO</span>
            <span class="c1">#distance = d</span>
            <span class="nb">print</span> <span class="p">(</span> <span class="n">d</span>  <span class="p">)</span>
        <span class="n">applLogic</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>           <span class="c1"># LOGICA APPLICATIVA</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;sonarAndLed is starting ... &#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">doJob</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;sonarAndLed BYE ... &#39;</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>Logica applicativa</p></td>
<td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">applLogic</span><span class="p">(</span><span class="n">distance</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">distance</span>  <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="mf">5.0</span> <span class="p">):</span>
            <span class="n">ledOn</span><span class="p">()</span>
            <span class="n">forward</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ledOff</span><span class="p">()</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>Funzioni operative</p></td>
<td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ledOn</span><span class="p">():</span>
  <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="n">GPIO</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
  <span class="c1">##forward()  #QUI???</span>

<span class="k">def</span> <span class="nf">ledOff</span><span class="p">():</span>
  <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="n">GPIO</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">sonarWork</span><span class="p">():</span>
  <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">TRIG</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>    <span class="c1">#invia impulsoTRIG</span>
  <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.00001</span><span class="p">)</span>
  <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">TRIG</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

  <span class="c1">#attendi che ECHO parta e memorizza tempo</span>
  <span class="k">while</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="n">ECHO</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
      <span class="n">pulse_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

  <span class="c1"># register the last timestamp</span>
  <span class="k">while</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="n">ECHO</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
      <span class="n">pulse_end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

  <span class="n">pulse_duration</span> <span class="o">=</span> <span class="n">pulse_end</span> <span class="o">-</span> <span class="n">pulse_start</span>
  <span class="n">dist</span> <span class="o">=</span> <span class="n">pulse_duration</span> <span class="o">*</span> <span class="mi">17165</span>   <span class="c1">#distance = vt/2</span>
  <span class="k">return</span> <span class="n">dist</span>

<span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">distance</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">n</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">client</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="s2">&quot;unibo/sonar/events&quot;</span><span class="p">,</span>
     <span class="n">msg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">distance</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="progetto-sonarqak24">
<h2>Progetto sonarqak24<a class="headerlink" href="#progetto-sonarqak24" title="Permalink to this heading">¶</a></h2>
<p><cite>Progetto unibo.sonarqak24</cite></p>
<p>Goal: sviluppare un componente software che utilizza il <span class="xref std std-ref">SONAR HC-SR04</span>
e che sia in grado di:</p>
<ul class="simple">
<li><p>ricevere via rete ed eseguire comandi di <code class="docutils literal notranslate"><span class="pre">sonarstart/sonarstop</span></code></p></li>
<li><p>inviare ad altri componenti software i vaori di distanza rilevati, filtrati in modo che ogni valore
<code class="docutils literal notranslate"><span class="pre">D</span></code> emesso sia un valore intero tale che <code class="docutils literal notranslate"><span class="pre">0&lt;D&lt;=150</span></code></p></li>
</ul>
<section id="sonarqak24-analisi-del-problema">
<h3>sonarqak24: analisi del problema<a class="headerlink" href="#sonarqak24-analisi-del-problema" title="Permalink to this heading">¶</a></h3>
<ol class="arabic">
<li><p>Disponiamo di codice di basso livello <a href="#id230"><span class="problematic" id="id231">`sonar.py`_</span></a> che attiva il sonar fisico e scrive sul dispositivo
standard di output, a intervalli temporali fissi, i valori della distanza corrente rilevata.</p></li>
<li><p>Il codice <a href="#id232"><span class="problematic" id="id233">`sonar.py`_</span></a>  non è in grado di inviare informazioi in rete nè di ricevere comandi di <code class="docutils literal notranslate"><span class="pre">sonarstart/sonarstop</span></code>.
Ha inoltre una forma di filtraggio dei valori molto limitata.</p></li>
<li><p>Non si ritiene opportuno modificare il codice di basso livello per rispondere alle esigenze applicative.
Si ritiene invece più opportuno procedere in modo top down, partendo dalla definizione di un
componente di alto livello, denominato <code class="docutils literal notranslate"><span class="pre">sonar24</span></code> e modellato come un Actor capace di gestire
i seguenti dispatch:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Dispatch</span> <span class="n">sonarstart</span> <span class="p">:</span> <span class="n">sonarstart</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">Dispatch</span> <span class="n">sonarstop</span>  <span class="p">:</span> <span class="n">sonarstop</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Ricordando i concetti de <span class="xref std std-ref">La Clean Architecture</span>, occorre ora rispondere alla seguente domanda:</p>
<p>come <code class="docutils literal notranslate"><span class="pre">sonar24</span></code> <cite>intende ricevere i valori D della distanza misurata</cite>?</p>
<p>Per motivi di modularità ed estendiblità, si propende per l’uso di un event:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Event</span> <span class="n">sonardata</span> <span class="p">:</span> <span class="n">distance</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
</pre></div>
</div>
<p>Eventi di questo tipo si suppongono  generati da un altro componente, denominato <code class="docutils literal notranslate"><span class="pre">sonardevice</span></code>,
anch’esso modellato come un Actor</p>
</li>
<li><p>Per motivi di efficienza e per evitare l’inutile trasmissione di eventi via rete, si
ritiene opportuno utilizzare il concetto di <span class="xref std std-ref">Attori streamer</span>,
e le primitive <span class="xref std std-ref">subscribeTo</span>
e <span class="xref std std-ref">emitLocalstream</span></p></li>
<li><p>Il componente <code class="docutils literal notranslate"><span class="pre">sonardevice</span></code> può incapsulare il codice di basso livello <a href="#id234"><span class="problematic" id="id235">`sonar.py`_</span></a>
e implementare i comandi <code class="docutils literal notranslate"><span class="pre">sonarstart/sonarstop</span></code>, che gli possono essere delegati
da <code class="docutils literal notranslate"><span class="pre">sonar24</span></code></p></li>
</ol>
<p>Ne consegue la seguente Architettura Logica:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_images/sonar24Analisi.PNG"><img alt="_images/sonar24Analisi.PNG" class="align-center" src="_images/sonar24Analisi.PNG" style="width: 100%;" /></a>
</td>
<td><p>La emissione di eventi con <span class="xref std std-ref">emitLocalstream</span>
non viene  visualizzata. Se fosse emesso con <span class="xref std std-ref">emit</span>
si avrebbe:</p>
<a class="reference internal image-reference" href="_images/sonar24AnalisiEv.PNG"><img alt="_images/sonar24AnalisiEv.PNG" class="align-center" src="_images/sonar24AnalisiEv.PNG" style="width: 100%;" /></a>
</td>
</tr>
</tbody>
</table>
</section>
<section id="sonarqak24-progettazione">
<h3>sonarqak24:progettazione<a class="headerlink" href="#sonarqak24-progettazione" title="Permalink to this heading">¶</a></h3>
<p>Il componente <code class="docutils literal notranslate"><span class="pre">sonardevice</span></code> può essere realizzato in due modi:</p>
<ul class="simple">
<li><p>in modo esplicito, definendo un Actor nel modello applicativo</p></li>
<li><p>in modo ‘sommerso’, definendo un <span class="xref std std-ref">CodedQActor</span>  come <a href="#id236"><span class="problematic" id="id237">`sonarHCSR04Support23.kt`_</span></a></p></li>
</ul>
<p>Inoltre  un filtraggio più accurato dei valori di distanza può essere ottenuto
costruendo una pipe di attori che ha  <cite>sonardevice</cite> come sorgente-dati e
un componente <cite>dataCleaner</cite> che provvede a eliminare dati spuri.</p>
<p>L’architettura logica di progetto diventa:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 80%" />
<col style="width: 20%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_images/sonar24Progetto.PNG"><img alt="_images/sonar24Progetto.PNG" class="align-center" src="_images/sonar24Progetto.PNG" style="width: 80%;" /></a>
</td>
<td><p>La emissione di eventi con <span class="xref std std-ref">emitLocalstream</span>
viene  visualizzata</p></td>
</tr>
</tbody>
</table>
<p>Inoltre, la pipe può essere estesa introducendo un componente terminale
<cite>distancefilter</cite> capace di generare eventi significativi per il livello applicativo,
quali ad esenpio:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Event</span> <span class="n">obstacle</span>  <span class="p">:</span> <span class="n">obstacle</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><span class="worktodo">TODO: affrontare la progettazione</span> del <span class="xref std std-ref">SistemaRilevamento</span>.</p>
<p>Iniziamo com <a href="#id238"><span class="problematic" id="id239">`sonarqak24base`_</span></a>. I key-points sono:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 40%" />
<col style="width: 60%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_images/sonar24ProgettoBase.PNG"><img alt="_images/sonar24ProgettoBase.PNG" class="align-center" src="_images/sonar24ProgettoBase.PNG" style="width: 80%;" /></a>
</td>
<td><ul class="simple">
<li><p>definizione esplicita a livello di modello di <code class="docutils literal notranslate"><span class="pre">sonardevice</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sonar24</span></code> fa <code class="docutils literal notranslate"><span class="pre">subscribeTo</span> <span class="pre">sonardevice</span> <span class="pre">for</span> <span class="pre">sonardata</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sonardevice</span></code> fa <span class="xref std std-ref">emitLocalstream</span> dell’evento <code class="docutils literal notranslate"><span class="pre">sonardata</span></code></p></li>
<li><p>uso di <a href="#id240"><span class="problematic" id="id241">`sonar.py`_</span></a> come dispositivo di basso livello attivato all’interno di <code class="docutils literal notranslate"><span class="pre">sonardevice</span></code></p></li>
<li><p>uso della feature :<cite>lateinit</cite> di Koltlin</p></li>
<li><p>uso di :<cite>autodispatch</cite> <code class="docutils literal notranslate"><span class="pre">doread</span></code> per continuare a consumare i valori
che  <a href="#id242"><span class="problematic" id="id243">`sonar.py`_</span></a> scrive sul dispositivo di output</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Una volta verificato che questo sistema minimale funziona, aggiungiamo i comandi di <code class="docutils literal notranslate"><span class="pre">sonarstart/sonarstop</span></code>
e in componente esplicita a livello di modello di <code class="docutils literal notranslate"><span class="pre">datacleaner</span></code>, come proposto
nella  architettura logica di <span class="xref std std-ref">progetto</span></p>
<p>Si veda: <a href="#id244"><span class="problematic" id="id245">`sonarqak24`_</span></a>. I key-points sono:</p>
<ul class="simple">
<li><p>…</p></li>
</ul>
</section>
</section>
</section>
<section id="virtualrobot23">
<h1>VirtualRobot23<a class="headerlink" href="#virtualrobot23" title="Permalink to this heading">¶</a></h1>
<p><cite>Progetto it.unibo.virtualRobot2023</cite></p>
<section id="virtualrobot23-project">
<h2>VirtualRobot23 project<a class="headerlink" href="#virtualrobot23-project" title="Permalink to this heading">¶</a></h2>
<p>Nel progetto  <cite>it.unibo.virtualRobot2023</cite>, il DISI ha sviluppato un ambiente virtuale (denominato <code class="docutils literal notranslate"><span class="pre">WEnv</span></code>)
che include un simulatore di <em>Differential Drive robot</em> (<strong>DDR</strong>).</p>
<p>Un <a href="#id246"><span class="problematic" id="id247">`DDR Robot`_</span></a> -&gt; possiede due ruote motrici sullo stesso asse e una terza ruota condotta (non motrice).
La  tecnica <em>differential drive</em> consiste nel far muovere le ruote motrici a velocità
indipendenti l’una dall’altra.</p>
<p><code class="docutils literal notranslate"><span class="pre">WEnv</span></code> fa riferimento a una forma semplificata di DDR in cui le possibìili mosse sono:</p>
<ul class="simple">
<li><p>muoversi avanti-indietro lungo una direzione costante</p></li>
<li><p>fermarsi</p></li>
<li><p>ruotare di 90° a destra o sinistra</p></li>
</ul>
<p>Queste mosse sono realizzate inviando opportuni comandi al robot simulato.</p>
<p>Il robot virtuale (e in futuro anche quelli reali) viene considerato</p>
<p>:<cite>un oggetto inscrivibile in un cerchio di raggio R</cite>.</p>
<p><cite>Usare WEnv</cite></p>
</section>
<section id="la-scena-di-wenv">
<h2>La scena di WEnv<a class="headerlink" href="#la-scena-di-wenv" title="Permalink to this heading">¶</a></h2>
<p>La scena del WEnv è costruita da una descrizione che può essere facilmente definita da un progettista di applicazioni
modificando il file <code class="docutils literal notranslate"><span class="pre">node\WEnv\WebGLScene\sceneConfig.js</span></code>.</p>
<p>Nel seguito, faremo riferimento a una stanza rettangolare (vuota o con ostacoli), racchiusa entro quattro pareti.
Procedendo dal bordo superiore e muovendoci in senso orario, i nomi delle pareti sono:
<code class="docutils literal notranslate"><span class="pre">wallUp,</span> <span class="pre">wallRight,</span> <span class="pre">wallDown,</span> <span class="pre">wallLeft</span></code>.</p>
<p>La scena può anche presentare uno o più dispositivi <cite>Sonar</cite> che rilevano la presenza del robot e ne misurano la distanza.</p>
<p>Si veda <span class="xref std std-ref">NaiveGui page</span>.</p>
</section>
<section id="come-attivare-wenv">
<h2>Come attivare WEnv<a class="headerlink" href="#come-attivare-wenv" title="Permalink to this heading">¶</a></h2>
<p>:<cite>Usando il progetto it.unibo.virtualRobot2023</cite></p>
<ul class="simple">
<li><p>Installare <a href="#id248"><span class="problematic" id="id249">`Node.js`_</span></a></p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">it.unibo.virtualRobot2023\node\WEnv\server</span></code>, eseguire <strong>npm install</strong></p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">it.unibo.virtualRobot2023\node\WEnv\WebGLScene</span></code>, eseguire <strong>npm install</strong></p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">it.unibo.virtualRobot2023\node\WEnv\server\src</span></code>, eseguire <strong>node WebpageServer.js</strong></p></li>
</ul>
<p>:<cite>Usando Docker</cite></p>
<p>WEnv viene anche distribuito come immagine Docker, attivabile direttamente o con <em>docker-compose</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">ti</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8090</span><span class="p">:</span><span class="mi">8090</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8091</span><span class="p">:</span><span class="mi">8091</span> <span class="o">--</span><span class="n">rm</span>  <span class="n">docker</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">natbodocker</span><span class="o">/</span><span class="n">virtualrobotdisi23</span><span class="p">:</span><span class="mf">1.0</span>
<span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="o">-</span><span class="n">f</span> <span class="n">virtualRobot23</span><span class="o">.</span><span class="n">yaml</span>  <span class="n">up</span>
<span class="o">//</span><span class="n">Per</span> <span class="n">terminare</span><span class="p">:</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="o">-</span><span class="n">f</span> <span class="n">virtualRobot23</span><span class="o">.</span><span class="n">yaml</span>  <span class="n">down</span>
</pre></div>
</div>
<section id="virtualrobot23-yaml">
<h3>virtualRobot23.yaml<a class="headerlink" href="#virtualrobot23-yaml" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">version</span><span class="p">:</span> <span class="s1">&#39;3&#39;</span>
<span class="n">services</span><span class="p">:</span>
  <span class="n">wenv</span><span class="p">:</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">docker</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">natbodocker</span><span class="o">/</span><span class="n">virtualrobotdisi23</span><span class="p">:</span><span class="mf">1.0</span>
    <span class="n">ports</span><span class="p">:</span>
      <span class="o">-</span> <span class="mi">8090</span><span class="p">:</span><span class="mi">8090</span>
      <span class="o">-</span> <span class="mi">8091</span><span class="p">:</span><span class="mi">8091</span>
</pre></div>
</div>
<p>## ————————————————————-
## TODO See <a class="reference external" href="https://docs.docker.com/compose/startup-order/">https://docs.docker.com/compose/startup-order/</a>
## Compose does not wait until a container is “ready” (whatever that means for your particular application)
## - only until it’s running. There’s a good reason for this.
## The best solution is to perform this check in your application code,
## ————————————————————-
## docker-compose -f virtualRobot23.yaml up
## docker-compose down
## docker-compose run –service-ports wenv    starts wenv</p>
<p>Per un overview su Docker e DockerCompose si veda: <a href="#id250"><span class="problematic" id="id251">`Introduction to Docker and DockerCompose`_</span></a>.</p>
</section>
</section>
<section id="come-interagire-con-wenv">
<h2>Come interagire con WEnv<a class="headerlink" href="#come-interagire-con-wenv" title="Permalink to this heading">¶</a></h2>
<p>Stringhe che esprimono comandi di movimento al robot possono essere  inviate a WEnv in due modi:</p>
<ul class="simple">
<li><p>come messaggi HTTP POST inviati sulla porta <strong>8090</strong>. E’ una forma di comunicazione <cite>sincrona</cite> (<cite>request-response</cite>).</p></li>
<li><p>come messaggi inviati su un Websocket alla porta <strong>8091</strong>.
E’ una forma di comunicazione <cite>asincrona</cite> (<cite>fire-and-forget</cite>) che implica l’emissione,
da parte di WEnv, di un <span class="xref std std-ref">Messaggio di stato</span></p></li>
</ul>
<a class="reference internal image-reference" href="_images/logicInteraction.PNG"><img alt="_images/logicInteraction.PNG" class="align-center" src="_images/logicInteraction.PNG" style="width: 80%;" /></a>
<p>:<cite>WEnv non acetta altre connessioni hhtp://HOSTADDR:8090  oltre la prima</cite></p>
<section id="naivegui-html">
<h3>NaiveGui.html<a class="headerlink" href="#naivegui-html" title="Permalink to this heading">¶</a></h3>
<p>Per consentire agli utenti umani prove di interazione con WEnv,
il progetto definisce una pagina HTML (file <code class="docutils literal notranslate"><span class="pre">node/clients/NaiveGui.html</span></code>)  che permette di:</p>
<ul class="simple">
<li><p>visualizzare la scena corrente (il virtual robot deve essere stato attivato);</p></li>
<li><p>inviare comandi <span class="xref std std-ref">cril</span> al VirtualRobot in modo sincrono (via HTTP)
e in modo asicrono (via WebSocket)</p></li>
<li><p>visualizzare nella <code class="docutils literal notranslate"><span class="pre">DisplayArea</span></code> le informazioni emesse da WEnv (<span class="xref std std-ref">Messaggio di stato</span>).</p></li>
</ul>
<p>Ponendo il mouse sulla scena, si possono inviare al robot comandi tramite tastiera:</p>
<ul class="simple">
<li><p>tasto <cite>w</cite>: avanti</p></li>
<li><p>tasto <cite>s</cite>: indietro</p></li>
<li><p>tasto <cite>a</cite>: ruota a sinistra di <cite>90°</cite></p></li>
<li><p>tasto <cite>d</cite>: ruota a destra di <cite>90°</cite></p></li>
</ul>
<p>Sulla scena compare un menu <cite>Open controls</cite> che presenta comandi con cui modificare la scena,
inserendo/eliminando oggetti. Le modifiche vengono perse al reload della pagina.</p>
<section id="naivegui-page">
<h4>NaiveGui page<a class="headerlink" href="#naivegui-page" title="Permalink to this heading">¶</a></h4>
<p>La pagina si presenta come segue:</p>
<a class="reference internal image-reference" href="_images/NaiveGui.PNG"><img alt="_images/NaiveGui.PNG" class="align-center" src="_images/NaiveGui.PNG" style="width: 50%;" /></a>
<p>Attraverso questa GUI possiamo effettuare esperimenti come quelli che seguono:</p>
<ul class="simple">
<li><p>inviare un comando SYNCH e vedere l’esito sulla DISPLAY AREA</p></li>
<li><p>inviare un comando SYNCH e interromperlo con i pulsanti HALTPOST oppure HALT</p></li>
<li><p>inviare un comando SYNCH e subito dopo un altro comando ASYNCH o SYNCH (not allowed)</p></li>
<li><p>inviare un comando ASYNCH e vedere l’esito sulla DISPLAY AREA.</p></li>
<li><p>inviare un comando ASYNCH e subito dopo un  comando SYNCH (not allowed)</p></li>
</ul>
<p>Si noti che un valore di tempo <code class="docutils literal notranslate"><span class="pre">-1</span></code> significa ‘forever’ e occorre sempre inviare un comando HALT
per poterne effettuare un altro. Si consiglia di evitare l’uso del valore -1, a favore di valori
interi positivi adeguatamenti alti in relazione al dominio applicativo.</p>
</section>
<section id="esperimento-misto">
<h4>Esperimento misto<a class="headerlink" href="#esperimento-misto" title="Permalink to this heading">¶</a></h4>
<ol class="arabic">
<li><p>Eseguire il comando</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">d</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">robotmove</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">moveForward</span><span class="se">\&quot;</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">time</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">2000</span><span class="se">\&quot;</span><span class="s2">}&quot;</span>
     <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Content-Type: application/json&quot;</span>  <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8090</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">move</span>
</pre></div>
</div>
</li>
<li><p>Entro <code class="docutils literal notranslate"><span class="pre">2000</span></code> msec premere il pulsante <code class="docutils literal notranslate"><span class="pre">HALT</span></code> (o <code class="docutils literal notranslate"><span class="pre">HALTPOST</span></code>) di <span class="xref std std-ref">NaiveGui.html</span></p></li>
</ol>
<p>WEnv invia la risposta <code class="docutils literal notranslate"><span class="pre">{&quot;endmove&quot;:false,&quot;move&quot;:&quot;moveForward-interrupted&quot;}</span></code> per il comando curl e la stessa
informazione ai client-WS (che viene visualizzata sulla DISPLAY AREA di <span class="xref std std-ref">NaiveGui.html</span>):</p>
<p><cite>Il linguaggio-base del vritual robot</cite></p>
</section>
</section>
<section id="comandi-base-per-il-robot-in-cril">
<h3>Comandi-base per il robot in cril<a class="headerlink" href="#comandi-base-per-il-robot-in-cril" title="Permalink to this heading">¶</a></h3>
<p>Il linguaggio per esprimere comandi di movimento del robot virtuale
viene detto <cite>cril</cite> (<em>concrete-robot interaction language</em>) e consiste di
stringhe JSON secondo la sintassi che segue:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;robotmove&quot;</span><span class="p">:</span><span class="s2">&quot;CMDMOVE&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span><span class="n">T</span><span class="p">}</span>
<span class="n">CMDMOVE</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;turnLeft&quot;</span> <span class="o">|</span> <span class="s2">&quot;turnRight&quot;</span> <span class="o">|</span> <span class="s2">&quot;moveForward&quot;</span> <span class="o">|</span> <span class="s2">&quot;moveBackward&quot;</span> <span class="o">|</span> <span class="s2">&quot;alarm&quot;</span>
<span class="n">T</span>    <span class="p">:</span><span class="o">:=</span> <span class="o">&lt;</span><span class="n">NaturalNum</span><span class="o">&gt;</span>
</pre></div>
</div>
<section id="alarm">
<h4>alarm<a class="headerlink" href="#alarm" title="Permalink to this heading">¶</a></h4>
<p>Il comando <strong>“alarm”</strong> non è stato denominato <code class="docutils literal notranslate"><span class="pre">halt</span></code> per introdurre l’idea che il robot può fermarsi anche in caso
di situazioni anomale, come ad esempio un calo dell’alimentazione o un incendio.</p>
<p><cite>Parlare con il vritual robot in modo sincrono o asicrono</cite></p>
<ul class="simple">
<li><p>Il comando <em>alarm</em> inviato con <span class="xref std std-ref">Interazione sincrona</span> produce sempre la risposta <code class="docutils literal notranslate"><span class="pre">{&quot;endmove&quot;:true,&quot;move&quot;:&quot;halt&quot;}</span></code>.</p></li>
<li><p>Il comando <em>alarm</em> inviato con <span class="xref std std-ref">Interazione asincrona</span> non produce messaggi di risposta.</p></li>
</ul>
<p><cite>Comandi di tipo sincrono</cite></p>
</section>
</section>
<section id="interazione-sincrona">
<h3>Interazione sincrona<a class="headerlink" href="#interazione-sincrona" title="Permalink to this heading">¶</a></h3>
<p>In una interazione request-response, la <cite>risposta</cite> è espressa in forme di stringhe JSON che assumono valori diversi
in relazione alle situazioni che si possono avere.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;endmove&quot;</span><span class="p">:</span><span class="s2">&quot;RESULT&quot;</span><span class="p">,</span> <span class="s2">&quot;move&quot;</span><span class="p">:</span><span class="s2">&quot;MINFO&quot;</span> <span class="p">}</span>
<span class="n">RESULT</span>  <span class="p">:</span><span class="o">:=</span> <span class="n">true</span> <span class="o">|</span> <span class="n">false</span>  <span class="o">|</span> <span class="n">notallowed</span>
<span class="n">MINFO</span>   <span class="p">:</span><span class="o">:=</span> <span class="n">MOVEID</span> <span class="o">|</span> <span class="n">MOVEID</span><span class="o">-</span><span class="n">collision</span> <span class="o">|</span> <span class="n">MOVEID</span><span class="o">-</span><span class="n">interrupted</span>
<span class="n">MOVEID</span>  <span class="p">:</span><span class="o">:=</span> <span class="n">moveForward</span> <span class="o">|</span> <span class="n">moveBackward</span> <span class="o">|</span> <span class="n">turnLeft</span> <span class="o">|</span> <span class="n">turnRight</span>
</pre></div>
</div>
<p>Un comando attivato con <code class="docutils literal notranslate"><span class="pre">HTTP</span> <span class="pre">POST</span></code> con durata <code class="docutils literal notranslate"><span class="pre">T</span></code>, potrebbe terminare prima del tempo  <code class="docutils literal notranslate"><span class="pre">T</span></code> in quanto:</p>
<ul class="simple">
<li><p>il robot ha ricevuto (prima del tempo  <code class="docutils literal notranslate"><span class="pre">T</span></code>)  il comando <span class="xref std std-ref">alarm</span>.</p></li>
</ul>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><img alt="_images/MoveForwardOk.png" src="_images/MoveForwardOk.png" />
</td>
<td><p>mossa che termina con successo</p></td>
</tr>
<tr class="row-even"><td><img alt="_images/MoveForwardHalted.png" src="_images/MoveForwardHalted.png" />
</td>
<td><p>mossa interrotta da <span class="xref std std-ref">alarm</span></p></td>
</tr>
</tbody>
</table>
<p>Nel caso di interazione sincrona, si ha che:</p>
<ul class="simple">
<li><p>:<cite>Non si può interrompere un comando con un altro comando sincrono diverso da alarm.</cite></p></li>
</ul>
</section>
<section id="collision">
<h3>Collision<a class="headerlink" href="#collision" title="Permalink to this heading">¶</a></h3>
<p>Se un comando provoca il contatto del robot con un ostacolo,
il comando ha comunque durata <code class="docutils literal notranslate"><span class="pre">T</span></code>.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><img alt="_images/MoveForwardCollision.png" src="_images/MoveForwardCollision.png" />
</td>
<td><p>mossa sincrona che provoca collisione</p></td>
</tr>
</tbody>
</table>
<p>Tuttavia, i client-WS ricevono ANCHE l’informazione (<span class="xref std std-ref">Messaggio di stato</span>) <em>collision</em>, che assume la forma che segue:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">{&quot;collision&quot;:&quot;moveForward&quot;,&quot;target&quot;:&quot;OBSTACLEID&quot;}</span></code></p>
</div></blockquote>
<p>Il mondo virtuale permette di inserire nel messaggio anche il nome dell’ostacolo (<code class="docutils literal notranslate"><span class="pre">OBSTACLEID</span></code>). Questo ovviamente
non è possibile nel mondo reale, ma al momento può essere utile per comprendere meglio il comportamento
delle applicazioni.</p>
<p>:<cite>Esempi di comandi di tipo sincrono</cite></p>
<p>Riportiamo nel seguito  alcuni casi rilevanti, dopo avere collocato il robot nello stato iniziale convenzionale <cite>HOME</cite>.</p>
<p><cite>HOME</cite></p>
</section>
<section id="stato-iniziale-del-virtualrobot">
<h3>Stato iniziale del virtualrobot<a class="headerlink" href="#stato-iniziale-del-virtualrobot" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>il robot è rivolto verso il basso e si trova
nell’angolo superiore sinistro (locazione denotata d’ora in poi come <cite>HOME</cite>).</p></li>
</ul>
<section id="esempi-di-comandi-sincroni-al-virtualrobot23">
<h4>Esempi di comandi sincroni al VirtualRobot23<a class="headerlink" href="#esempi-di-comandi-sincroni-al-virtualrobot23" title="Permalink to this heading">¶</a></h4>
<p>I comandi sono inviati, al momento, usando il tool <a href="#id252"><span class="problematic" id="id253">`curl`_</span></a> e hanno la forma:</p>
<p><code class="docutils literal notranslate"><span class="pre">curl</span> <span class="pre">CMD</span>&#160; <span class="pre">-H</span> <span class="pre">&quot;Content-Type:</span> <span class="pre">application/json&quot;</span> <span class="pre">-X</span> <span class="pre">POST</span> <span class="pre">http://localhost:8090/api/move</span></code></p>
<p>Gli esempi che seguono sono riferiti alla scena-base del progetto <cite>it.unibo.virtualRobot2023</cite>;
in essi riporteremo solo la forma di <code class="docutils literal notranslate"><span class="pre">CMD</span></code>.</p>
<ol class="arabic">
<li><ul>
<li><p>Movimento in avanti normale</p>
<dl class="simple">
<dt><strong>Comando</strong>: muovi in avanti per <cite>1300 msec</cite>:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">curl</span> <span class="pre">-d</span> <span class="pre">&quot;{\&quot;robotmove\&quot;:\&quot;moveForward\&quot;,</span> <span class="pre">\&quot;time\&quot;:\&quot;1300\&quot;}&quot;</span> <span class="pre">...</span></code></p>
</dd>
<dt><strong>Risposta</strong>:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">{&quot;endmove&quot;:true,&quot;move&quot;:&quot;moveForward&quot;}</span></code></p>
</dd>
</dl>
</li>
</ul>
</li>
<li><ul>
<li><p>Movimento in avanti che provoca collisione con la parete <em>wallDown</em>:</p>
<dl class="simple">
<dt><strong>Comando</strong>: muovi in avanti per <cite>2200 msec</cite>:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">curl</span> <span class="pre">-d</span> <span class="pre">&quot;{\&quot;robotmove\&quot;:\&quot;moveForward\&quot;,</span> <span class="pre">\&quot;time\&quot;:\&quot;2200\&quot;}&quot;</span> <span class="pre">...</span></code></p>
</dd>
<dt><strong>Risposta</strong>:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">{&quot;endmove&quot;:false,&quot;move&quot;:&quot;moveForward-collision&quot;}</span></code></p>
</dd>
</dl>
</li>
</ul>
</li>
<li><ul>
<li><p>Movimento in avanti con interruzione</p>
<dl class="simple">
<dt><strong>Comando</strong>: <em>comando1</em> seguito da <span class="xref std std-ref">alarm</span> prima della fine:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">curl</span> <span class="pre">-d</span> <span class="pre">&quot;{\&quot;robotmove\&quot;:\&quot;alarm\&quot;,</span> <span class="pre">\&quot;time\&quot;:\&quot;10\&quot;}&quot;</span> <span class="pre">...</span></code></p>
</dd>
<dt><strong>Risposta</strong>:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">{&quot;endmove&quot;:false,&quot;move&quot;:&quot;moveForward-interrupted&quot;}</span></code></p>
</dd>
</dl>
</li>
</ul>
</li>
<li><ul>
<li><p>Ritazione a sinistra normale</p>
<dl class="simple">
<dt><strong>Comando</strong>:ruota a sinistra con time <cite>300 msec</cite>:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">curl</span> <span class="pre">-d</span> <span class="pre">&quot;{\&quot;robotmove\&quot;:\&quot;turnLeft\&quot;,</span> <span class="pre">\&quot;time\&quot;:\&quot;300\&quot;}</span> <span class="pre">...&quot;</span></code></p>
</dd>
<dt><strong>Risposta</strong>:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">{&quot;endmove&quot;:true,&quot;move&quot;:&quot;turnLeft&quot;}</span></code></p>
</dd>
</dl>
</li>
</ul>
</li>
<li><ul class="simple">
<li><p>Movimento in avanti subito seguito da rotazione</p></li>
</ul>
<blockquote>
<div><p><strong>Comando</strong>: <em>comando1</em> seguito (prima della fine) da <em>comando4</em> o  altro comando SYNCH, diverso da <code class="docutils literal notranslate"><span class="pre">HALTPOST</span></code>
<strong>Risposta</strong>:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">{&quot;endmove&quot;:&quot;notallowed&quot;,&quot;move&quot;:&quot;turnLeft&quot;}</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">{&quot;endmove&quot;:true,&quot;move&quot;:&quot;moveForward&quot;}</span></code></p>
</div></blockquote>
</div></blockquote>
</li>
</ol>
<p>Esempi di interazione sincrona con WEnv basati su programmi Java saranno introdotti nella sezione
<span class="xref std std-ref">TestMovesUsingHttp</span>.</p>
<p><cite>Comandi di tipo asincrono</cite></p>
</section>
</section>
<section id="interazione-asincrona">
<h3>Interazione asincrona<a class="headerlink" href="#interazione-asincrona" title="Permalink to this heading">¶</a></h3>
<p>Inviare un comando in modo <cite>fire-and-forget</cite> significa non attendere risposta.</p>
<section id="messaggio-di-stato">
<h4>Messaggio di stato<a class="headerlink" href="#messaggio-di-stato" title="Permalink to this heading">¶</a></h4>
<p>Una volta eseguto il comando, il server WEnv invia a tutti i client connessi attraverso la connessione Websocket
informazioni sull’esito del comando  (<em>Messaggio di stato</em>), con la seguente sintassi:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;endmove&quot;</span><span class="p">:</span><span class="s2">&quot;RESULT&quot;</span><span class="p">,</span> <span class="s2">&quot;move&quot;</span><span class="p">:</span><span class="s2">&quot;MINFO&quot;</span><span class="p">}</span>
<span class="n">RESULT</span>  <span class="p">:</span><span class="o">:=</span> <span class="n">true</span> <span class="o">|</span> <span class="n">false</span>
<span class="n">MINFO</span>   <span class="p">:</span><span class="o">:=</span> <span class="n">MOVEID</span> <span class="o">|</span>  <span class="n">MOVEID_notallowed</span> <span class="p">(</span><span class="n">asynch</span><span class="p">)</span> <span class="o">|</span> <span class="n">MOVEID</span><span class="o">-</span><span class="n">interrupted</span>
<span class="n">MOVEID</span>  <span class="p">:</span><span class="o">:=</span> <span class="n">moveForward</span> <span class="o">|</span> <span class="n">moveBackward</span> <span class="o">|</span> <span class="n">turnLeft</span> <span class="o">|</span> <span class="n">turnRight</span>
</pre></div>
</div>
<p>Il significato dei valori di <code class="docutils literal notranslate"><span class="pre">MINFO</span></code> è il seguente:</p>
<ul class="simple">
<li><p><strong>MOVEID-interrupted</strong>: mossa <code class="docutils literal notranslate"><span class="pre">MOVEID</span></code> interrotta perchè il robot ha ricevuto un comando  <code class="docutils literal notranslate"><span class="pre">alarm</span></code></p></li>
<li><p><strong>MOVEID_notallowed (asynch)</strong>: mossa <code class="docutils literal notranslate"><span class="pre">MOVEID</span></code> rifiutata (non eseguita) in quanto la mossa relativa al comando precedente
non è ancora terminata.</p></li>
</ul>
<p>L’invio asincrono di un comando non blocca il chiamante; di conseguenza, un client può inviare un nuovo
comando su Websocket prima che il precedente sia terminato o sia stato interrotto.
Vale la seguente regola:</p>
<ul class="simple">
<li><p>:<cite>Wenv NON esegue un comando, se un comando precedente non è terminato.</cite></p></li>
</ul>
<p>Dunque:</p>
<ul class="simple">
<li><p>si invio un comando che dura un tempo <code class="docutils literal notranslate"><span class="pre">T</span></code> e questo provoca <strong>collisione</strong>, non posso inviare un altro
comando (che non sia <span class="xref std std-ref">alarm</span>) prima della scadenza di <code class="docutils literal notranslate"><span class="pre">T</span></code>.</p></li>
</ul>
</section>
<section id="esempi-di-comandi-asincronit-al-virtualrobot23">
<h4>Esempi di comandi asincronit al VirtualRobot23<a class="headerlink" href="#esempi-di-comandi-asincronit-al-virtualrobot23" title="Permalink to this heading">¶</a></h4>
<p>Test di interazione asincrona con WEnv basati su programmi Java saranno <cite>introdotti più avanti</cite> (si veda
<span class="xref std std-ref">TestMovesUsingWs</span>).</p>
</section>
<section id="messaggio-dall-ambiente">
<h4>Messaggio dall’ambiente<a class="headerlink" href="#messaggio-dall-ambiente" title="Permalink to this heading">¶</a></h4>
<p>Un cliente connesso a WEnv mediante Websocket può ricevere anche <em>informazioni
su variazioni dello stato del ‘mondo’</em>, quali:</p>
<ul class="simple">
<li><p>dati emessi dai <em>sonar</em> presenti nella scena quando rilevano un oggetto in movimento;</p></li>
<li><p>dati emessi dai <em>sensori di impatto</em> posti davanti e dietro al robot, quando rilevano un ostacolo.
Questi dati sono automaticamente convertiti in messaggi <span class="xref std std-ref">Collision</span>.</p></li>
</ul>
<p>Se nell’ambiente è presente un sonar e il robot vi passa davanti, WEnv genera:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;sonarName&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;sonarName&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;axis&quot;</span><span class="p">:</span> <span class="s2">&quot;AXIS&quot;</span> <span class="p">}</span>
<span class="n">AXIS</span> <span class="o">=</span> <span class="n">x</span> <span class="o">|</span> <span class="n">y</span>  <span class="o">//</span><span class="n">a</span> <span class="n">seconda</span> <span class="n">dell</span><span class="s1">&#39;orientamento del sonar</span>

<span class="o">//</span><span class="n">Esempio</span><span class="p">:</span>
<span class="p">{</span><span class="s2">&quot;sonarName&quot;</span><span class="p">:</span><span class="s2">&quot;sonar1&quot;</span><span class="p">,</span><span class="s2">&quot;distance&quot;</span><span class="p">:</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="s2">&quot;axis&quot;</span><span class="p">:</span><span class="s2">&quot;y&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p><cite>Come è fatto WEnv</cite></p>
</section>
</section>
</section>
<section id="wenv-note-di-implementazione">
<h2>WEnv - note di implementazione<a class="headerlink" href="#wenv-note-di-implementazione" title="Permalink to this heading">¶</a></h2>
<p>L’implementazione di WEnv si basa su due componenti principali:</p>
<ul class="simple">
<li><p><strong>server</strong>: che definisce il programma <code class="docutils literal notranslate"><span class="pre">WebpageServer.js</span></code> scritto con il framework  <a href="#id254"><span class="problematic" id="id255">`Node Express`_</span></a>  -&gt;</p></li>
<li><p><strong>WebGLScene</strong>: componente che gestisce la scena</p></li>
</ul>
<section id="architettura-di-wenv">
<h3>Architettura di WEnv<a class="headerlink" href="#architettura-di-wenv" title="Permalink to this heading">¶</a></h3>
<a class="reference internal image-reference" href="_images/WenvArch.PNG"><img alt="_images/WenvArch.PNG" class="align-center" src="_images/WenvArch.PNG" style="width: 100%;" /></a>
<p><code class="docutils literal notranslate"><span class="pre">WebpageServer.js</span></code> utilizza due diversi tipi  di WebSocket:</p>
<ul>
<li><p>un socket (detto <strong>sceneSocket</strong>) basato sulla libreria <a href="#id256"><span class="problematic" id="id257">`socket.io`_</span></a> che viene utilizzato per gestire
l’interazione con <strong>WebGLScene</strong>.</p>
<p>:<cite>socket.io non è un’implementazione WebSocket.</cite></p>
<p>Sebbene <a href="#id258"><span class="problematic" id="id259">`socket.io`_</span></a> utilizzi effettivamente WebSocket come trasporto quando possibile,
aggiunge alcuni metadati a ciascun pacchetto: il tipo di pacchetto, lo spazio dei nomi
e l’ID di riconoscimento quando è necessario un riconoscimento del messaggio.
Ecco perché un client WebSocket non sarà in grado di connettersi correttamente a un server Socket.IO
e un client <a href="#id260"><span class="problematic" id="id261">`socket.io`_</span></a> non sarà in grado di connettersi a un server WebSocket.</p>
</li>
<li><p>il websocker <strong>8091</strong> basato sulla libreria <a href="#id262"><span class="problematic" id="id263">`ws`_</span></a> : questo socket viene utilizzato per gestire comandi
applicativi asincroni per muovere il robot inviati da client remoti e per inviare a client remoti un
<span class="xref std std-ref">Messaggio di stato</span>.</p>
<p>WEnv utilizza la libreria Node <a href="#id264"><span class="problematic" id="id265">`einaros`_</span></a> per accettare questi comendi.</p>
<dl class="field-list simple">
<dt class="field-odd"><a href="#id164"><span class="problematic" id="id165">`</span></a>Il modulo ws non funziona nel browser<span class="colon">:</span></dt>
<dd class="field-odd"><p>bisogna utilizzare l’oggetto WebSocket nativo.`</p>
</dd>
</dl>
</li>
</ul>
<p>Quando <code class="docutils literal notranslate"><span class="pre">WebvGLScene</span></code> rileva una collisione tra il robot virtuale e un ostacolo,
invoca l’utilità <code class="docutils literal notranslate"><span class="pre">eventBus.js</span></code> per ‘emettere un evento collisione’
oltre lo <strong>sceneSocket</strong>.</p>
<p>Questo evento è gestito da un apposito handler (vedi <code class="docutils literal notranslate"><span class="pre">sceneSocketInfoHandler</span></code> in <code class="docutils literal notranslate"><span class="pre">WebpageServer.js</span></code>),
che reindirizza le informazioni a tutti i client connessi sulla  <code class="docutils literal notranslate"><span class="pre">8091</span></code>.</p>
</section>
<section id="wenv-come-immagine-docker">
<h3>WEnv come immagine docker<a class="headerlink" href="#wenv-come-immagine-docker" title="Permalink to this heading">¶</a></h3>
<p>WEnv viene anche distribuito come immagine Docker.</p>
<section id="dockerfile-e-creazione-dell-immagine">
<h4>Dockerfile e creazione dell’immagine<a class="headerlink" href="#dockerfile-e-creazione-dell-immagine" title="Permalink to this heading">¶</a></h4>
<p>Il file di nome <strong>Dockerfile</strong> nella directory <code class="docutils literal notranslate"><span class="pre">it.unibo.virtualRobot2020</span></code> contiene le istruzioni per creare una
immagine Docker (per una introduizione a Docker si veda <a href="#id266"><span class="problematic" id="id267">`Introduction to Docker and DockerCompose`_</span></a>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">node</span><span class="p">:</span><span class="mi">17</span><span class="o">-</span><span class="n">alpine</span>
<span class="n">RUN</span> <span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">node</span>
<span class="n">EXPOSE</span> <span class="mi">8090</span>
<span class="n">EXPOSE</span> <span class="mi">8091</span>
<span class="n">COPY</span> <span class="o">./</span><span class="n">node</span><span class="o">/</span><span class="n">WEnv</span><span class="o">/</span><span class="n">server</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">node</span><span class="o">/</span><span class="n">WEnv</span><span class="o">/</span><span class="n">server</span>
<span class="n">COPY</span> <span class="o">./</span><span class="n">node</span><span class="o">/</span><span class="n">WEnv</span><span class="o">/</span><span class="n">WebGLScene</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">node</span><span class="o">/</span><span class="n">WEnv</span><span class="o">/</span><span class="n">WebGLScene</span>
<span class="c1">#set default dir so that next commands executes in it</span>
<span class="n">WORKDIR</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">node</span><span class="o">/</span><span class="n">WEnv</span><span class="o">/</span><span class="n">WebGLScene</span>
<span class="n">RUN</span> <span class="n">npm</span> <span class="n">install</span>
<span class="n">WORKDIR</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">node</span><span class="o">/</span><span class="n">WEnv</span><span class="o">/</span><span class="n">server</span>
<span class="n">RUN</span> <span class="n">npm</span> <span class="n">install</span>
<span class="n">WORKDIR</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">node</span><span class="o">/</span><span class="n">WEnv</span><span class="o">/</span><span class="n">server</span><span class="o">/</span><span class="n">src</span>
<span class="n">CMD</span> <span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">,</span> <span class="s2">&quot;WebpageServer&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>L’immagine Docker può essere creata sul proprio PC eseguendo il comando (nella directory che contiene il <em>Dockerfile</em>):</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">build</span> <span class="pre">-t</span> <span class="pre">virtualrobotdisi23:1.0</span> <span class="pre">.</span></code>    //Notare il .</p>
</div></blockquote>
</section>
<section id="esecuzione-della-immagine">
<h4>Esecuzione della immagine<a class="headerlink" href="#esecuzione-della-immagine" title="Permalink to this heading">¶</a></h4>
<p>L’immagine Docker di WEnv può essere attivata sul PC con il comando:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">ti</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8090</span><span class="p">:</span><span class="mi">8090</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8091</span><span class="p">:</span><span class="mi">8091</span> <span class="o">--</span><span class="n">rm</span>  <span class="n">virtualrobotdisi23</span><span class="p">:</span><span class="mf">1.0</span>
</pre></div>
</div>
<p>Il comando:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">ti</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8090</span><span class="p">:</span><span class="mi">8090</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8091</span><span class="p">:</span><span class="mi">8091</span>
              <span class="o">--</span><span class="n">rm</span>  <span class="n">virtualrobotdisi23</span><span class="p">:</span><span class="mf">1.0</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span>
</pre></div>
</div>
<p>permette di ispezionare il contenuto della macchina virtuale e di attivare manualmente il sistema
(eseguendo  <code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">WebpageServer.js</span></code>).</p>
</section>
<section id="modificare-la-scena-nella-immagine">
<h4>Modificare la scena nella immagine<a class="headerlink" href="#modificare-la-scena-nella-immagine" title="Permalink to this heading">¶</a></h4>
<p>Una volta attivata l’immagine docker, il comando</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">dockerps</span> <span class="pre">ps</span> <span class="pre">-a</span></code></p>
</div></blockquote>
<p>restituisce una tabella con 7 campi:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">CONTAINERID</span>&#160;&#160; <span class="pre">IMAGE</span>&#160;&#160;&#160;&#160; <span class="pre">COMMAND</span>&#160;&#160; <span class="pre">CREATED</span>&#160;&#160; <span class="pre">STATUS</span>&#160;&#160;&#160; <span class="pre">PORTS</span>&#160;&#160;&#160;&#160; <span class="pre">NAMES</span></code></p>
</div></blockquote>
<p>Per modificare il file che definisce la scena, si può copiare una nuova versione attraverso il comando <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">cp</span></code>
e rendere permanente la modifica salvando il container.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">change</span> <span class="n">the</span> <span class="n">scene</span>
<span class="n">docker</span> <span class="n">cp</span> <span class="n">sceneConfig</span><span class="o">.</span><span class="n">js</span>
       <span class="n">CONTAINERID</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">node</span><span class="o">/</span><span class="n">WEnv</span><span class="o">/</span><span class="n">WebGLScene</span><span class="o">/</span><span class="n">sceneConfig</span><span class="o">.</span><span class="n">js</span>
<span class="o">//</span><span class="n">Save</span> <span class="n">the</span> <span class="n">cotainer</span>
<span class="n">docker</span> <span class="n">commit</span>  <span class="n">CONTAINERID</span>
</pre></div>
</div>
<p><cite>Programmi naive di uso di WEnv</cite></p>
</section>
</section>
</section>
<section id="programmi-naive">
<h2>Programmi naive<a class="headerlink" href="#programmi-naive" title="Permalink to this heading">¶</a></h2>
<p>L’ambiente WEnv verrà utilizzato nello sviluppo di applicazioni proattive/reattive basate su
componenti che interagiscono a scambio di messaggi con interazioni sincrone e/o asincrone.</p>
<p>Durante lo sviluppo di queste applicazioni, a complessità via via crescente, avremo modo di costruire
infrastrutture di supporto e astrazioni di comunicazione capaci di agevolare il compito dell’application-designer.</p>
<p>Prima di procedere in questa direzione, introduciamo alcuni esempi di controllo del robot attraverso programmi
Java scritti in modo ‘naive’, :<cite>avvalendoci nel modo più semplice e diretto
delle librerie</cite> disponibili come supporto alle comunicazioni vie rete.</p>
<p>:<cite>Uso di HTTP library</cite></p>
<section id="testmovesusinghttp">
<h3>TestMovesUsingHttp<a class="headerlink" href="#testmovesusinghttp" title="Permalink to this heading">¶</a></h3>
<p>In <code class="docutils literal notranslate"><span class="pre">javasrc/it/unibo/virtualRobot2023/clients</span></code></p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>:<cite>TestMovesUsingHttp.java</cite></p>
<p>Esegue  mosse di base del robot inviando vie <code class="docutils literal notranslate"><span class="pre">HTTP</span></code>
comandi espressi in in <span class="xref std std-ref">cril</span></p>
</td>
<td><p><cite>Key point</cite>: Richiesta <cite>sincrona</cite>.</p>
<p>Richiede 1 thread.</p>
</td>
</tr>
</tbody>
</table>
<p>Dal punto di vista ‘sistemistico’ osserviamo che:</p>
<ul class="simple">
<li><p>Il codice di comunicazione è scritto completamente dal progettista dell’applicazione che usa la libreria <em>org.apache.http</em>.</p></li>
<li><p>La gestione delle risposte JSON viene eseguita utilizzando la libreria  <a href="#id268"><span class="problematic" id="id269">`json-simple`_</span></a>.</p></li>
</ul>
<p>Dal punto di vista ‘applicativo’, osserviamo che:</p>
<ul class="simple">
<li><p>Il chiamante esegue comandi nella forma <em>request-response</em>.</p></li>
<li><p>Un eventuale <span class="xref std std-ref">Messaggio di stato</span> inviato da WEnv non viene percepito.</p></li>
<li><p>E’ possibile <cite>interrompere</cite> la esecuzione di una mossa inviando il comando <span class="xref std std-ref">alarm</span>.</p></li>
<li><p>Una mossa che termina prima del tempo indicato nel comando (per interruzione o <span class="xref std std-ref">Collision</span>,
restituisce la risposta <code class="docutils literal notranslate"><span class="pre">{&quot;endmove&quot;:&quot;false&quot;,</span> <span class="pre">&quot;move&quot;:&quot;MINFO&quot;</span> <span class="pre">}</span></code> introdotta in <span class="xref std std-ref">Interazione sincrona</span>.</p></li>
</ul>
<p>L’interazione mediante <code class="docutils literal notranslate"><span class="pre">HTTP</span></code> viene realizzata da un client <code class="docutils literal notranslate"><span class="pre">org.apache.http.client</span></code> invocato entro
una procedura di utilità definita come segue:</p>
<section id="callhttp">
<h4>callHTTP<a class="headerlink" href="#callhttp" title="Permalink to this heading">¶</a></h4>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">private</span>  <span class="n">JSONParser</span> <span class="n">simpleparser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONParser</span><span class="p">();</span>

<span class="kd">protected</span> <span class="n">JSONObject</span> <span class="nf">callHTTP</span><span class="p">(</span> <span class="n">String</span> <span class="n">crilCmd</span> <span class="p">)</span>  <span class="p">{</span>
<span class="n">JSONObject</span> <span class="n">jsonEndmove</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
 <span class="k">try</span> <span class="p">{</span>
   <span class="n">StringEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringEntity</span><span class="p">(</span><span class="n">crilCmd</span><span class="p">);</span>
   <span class="n">HttpUriRequest</span> <span class="n">httppost</span> <span class="o">=</span> <span class="n">RequestBuilder</span><span class="p">.</span><span class="na">post</span><span class="p">()</span>
      <span class="p">.</span><span class="na">setUri</span><span class="p">(</span><span class="k">new</span> <span class="n">URI</span><span class="p">(</span><span class="n">URL</span><span class="p">))</span>
      <span class="p">.</span><span class="na">setHeader</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span> <span class="s">&quot;application/json&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="na">setHeader</span><span class="p">(</span><span class="s">&quot;Accept&quot;</span><span class="p">,</span> <span class="s">&quot;application/json&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="na">setEntity</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>
      <span class="p">.</span><span class="na">build</span><span class="p">();</span>
   <span class="n">CloseableHttpResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">httpclient</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">httppost</span><span class="p">);</span>
   <span class="n">String</span> <span class="n">jsonStr</span> <span class="o">=</span> <span class="n">EntityUtils</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span> <span class="n">response</span><span class="p">.</span><span class="na">getEntity</span><span class="p">()</span> <span class="p">);</span>
   <span class="n">jsonEndmove</span>    <span class="o">=</span> <span class="p">(</span><span class="n">JSONObject</span><span class="p">)</span> <span class="n">simpleparser</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="n">jsonStr</span><span class="p">);</span>
 <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">){...}</span>
 <span class="k">return</span> <span class="n">jsonEndmove</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>:<cite>Operazioni di test</cite></p>
</section>
<section id="testmovesusinghttp-tests">
<h4>TestMovesUsingHttp tests<a class="headerlink" href="#testmovesusinghttp-tests" title="Permalink to this heading">¶</a></h4>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 40%" />
<col style="width: 60%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><img alt="_images/testHttpForwardOk.png" src="_images/testHttpForwardOk.png" />
</td>
<td><p><cite>Muovi in avanti senza collisioni</cite></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">doForward</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">String</span> <span class="n">forwardcmd</span><span class="o">=</span><span class="s">&quot;{\&quot;robotmove\&quot;:\&quot;moveForward\&quot;,\&quot;time\&quot;:\&quot;1000\&quot;}&quot;</span><span class="p">;</span>
  <span class="n">CommUtils</span><span class="p">.</span><span class="na">waitTheUser</span><span class="p">(</span><span class="s">&quot;PUT ROBOT in HOME  and hit&quot;</span><span class="p">);</span>
  <span class="n">JSONObject</span> <span class="n">result</span> <span class="o">=</span> <span class="n">callHTTP</span><span class="p">(</span>  <span class="n">forwardcmd</span>  <span class="p">);</span>
  <span class="n">CommUtils</span><span class="p">.</span><span class="na">outblue</span><span class="p">(</span><span class="s">&quot;moveForward endmove=&quot;</span> <span class="o">+</span> <span class="n">result</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><img alt="_images/testHttpForwardCollision.png" src="_images/testHttpForwardCollision.png" />
</td>
<td><p><cite>Muovi in avanti con collisione</cite></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">doCollision</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">String</span> <span class="n">forwardcmd</span><span class="o">=</span><span class="s">&quot;{\&quot;robotmove\&quot;:\&quot;moveForward\&quot;,\&quot;time\&quot;:\&quot;3000\&quot;}&quot;</span><span class="p">;</span>
  <span class="n">JSONObject</span> <span class="n">result</span> <span class="o">=</span> <span class="n">callHTTP</span><span class="p">(</span>  <span class="n">forwardcmd</span>  <span class="p">);</span>
  <span class="n">CommUtils</span><span class="p">.</span><span class="na">outblue</span><span class="p">(</span><span class="s">&quot;moveForward endmove=&quot;</span> <span class="o">+</span> <span class="n">result</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><img alt="_images/testHttpForwardHalted.png" src="_images/testHttpForwardHalted.png" />
</td>
<td><p><cite>Muovi in avanti e ferma prima della fine</cite></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">doHalt</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">String</span> <span class="n">forwardcmd</span><span class="o">=</span><span class="s">&quot;{\&quot;robotmove\&quot;:\&quot;moveForward\&quot;,\&quot;time\&quot;:\&quot;3000\&quot;}&quot;</span><span class="p">;</span>
  <span class="n">sendAlarmAfter</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
  <span class="n">JSONObject</span> <span class="n">result</span> <span class="o">=</span> <span class="n">callHTTP</span><span class="p">(</span>  <span class="n">forwardcmd</span> <span class="p">);</span>
  <span class="n">CommUtils</span><span class="p">.</span><span class="na">outblue</span><span class="p">(</span><span class="s">&quot;moveForward endmove=&quot;</span> <span class="o">+</span> <span class="n">result</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<section id="invio-di-alarm">
<h5>Invio di alarm<a class="headerlink" href="#invio-di-alarm" title="Permalink to this heading">¶</a></h5>
<p>Per inviare al robot un comando <em>halt</em> (messaggio <span class="xref std std-ref">alarm</span>) si possono usare diversi modi:</p>
<ul>
<li><p>Usare <span class="xref std std-ref">NaiveGui.html</span>.</p></li>
<li><p>Lanciare una nuova applicazione Java.</p></li>
<li><p>Attivare (come fatto in <code class="docutils literal notranslate"><span class="pre">doHalt</span></code>) un Thread interno a <span class="xref std std-ref">TestMovesUsingHttp</span>, ma <strong>senza riusare</strong>
lo stesso metodo <span class="xref std std-ref">callHTTP</span>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">sendAlarmAfter</span><span class="p">(</span> <span class="kt">int</span> <span class="n">time</span> <span class="p">){</span>
  <span class="k">new</span> <span class="n">Thread</span><span class="p">(){</span>
    <span class="kd">protected</span> <span class="n">JSONObject</span> <span class="nf">mycallHTTP</span><span class="p">(</span> <span class="n">String</span> <span class="n">crilCmd</span> <span class="p">)</span>  <span class="p">{</span>
     <span class="p">...</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">(){</span>
      <span class="n">CommUtils</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="n">time</span><span class="p">);</span>
      <span class="n">JSONObject</span> <span class="n">result</span> <span class="o">=</span> <span class="n">mycallHTTP</span><span class="p">(</span>  <span class="n">haltcmd</span>  <span class="p">);</span>
      <span class="n">CommUtils</span><span class="p">.</span><span class="na">outgreen</span><span class="p">(</span><span class="s">&quot;sendAlarmAfter result=&quot;</span> <span class="o">+</span> <span class="n">result</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}.</span><span class="na">start</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="automatictesthttp">
<h4>AutomaticTestHTTP<a class="headerlink" href="#automatictesthttp" title="Permalink to this heading">¶</a></h4>
<p>Grazie a JUnit, possiamo includere le azioni di <span class="xref std std-ref">TestMovesUsingHttp tests</span>
all’interno di una unità di testing che le esegue in modo automatizzato.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.junit.Before</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="p">;</span>
<span class="n">public</span> <span class="k">class</span> <span class="nc">AutomaticTestHTTP</span> <span class="p">{</span>

<span class="n">private</span> <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span><span class="p">;</span>

 <span class="nd">@Before</span>
 <span class="n">public</span> <span class="n">void</span> <span class="n">init</span><span class="p">(){</span>
     <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="n">createDefault</span><span class="p">();</span>
     <span class="o">//</span><span class="n">ASSUNZIONE</span><span class="p">:</span> <span class="n">prima</span> <span class="n">di</span> <span class="n">ogni</span> <span class="n">test</span> <span class="n">il</span> <span class="n">robot</span> <span class="n">deve</span> <span class="n">essere</span> <span class="ow">in</span> <span class="n">HOME</span>
 <span class="p">}</span>

 <span class="nd">@Test</span>
 <span class="n">public</span> <span class="n">void</span> <span class="n">doForward</span><span class="p">()</span> <span class="p">{</span>
     <span class="n">JSONObject</span> <span class="n">result</span> <span class="o">=</span> <span class="n">callHTTP</span><span class="p">(</span>  <span class="n">forwardcmd</span>  <span class="p">);</span>
     <span class="k">assert</span><span class="p">(</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;endmove&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="s2">&quot;true&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;move&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="s2">&quot;moveForward&quot;</span><span class="p">))</span> <span class="p">;</span>
     <span class="o">//</span><span class="n">BACK</span> <span class="n">TO</span> <span class="n">HOME</span>
     <span class="n">JSONObject</span> <span class="n">result1</span> <span class="o">=</span> <span class="n">callHTTP</span><span class="p">(</span>  <span class="n">backwardcmd</span>  <span class="p">);</span>
     <span class="k">assert</span><span class="p">(</span> <span class="n">result1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;move&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;moveBackward&quot;</span><span class="p">))</span> <span class="p">;</span>
 <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>:<cite>Uso di  websocket</cite></p>
</section>
</section>
<section id="testmovesusingws">
<h3>TestMovesUsingWs<a class="headerlink" href="#testmovesusingws" title="Permalink to this heading">¶</a></h3>
<p>In <code class="docutils literal notranslate"><span class="pre">javasrc/it/unibo/virtualRobot2023/clients</span></code></p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>:<cite>TestMovesUsingWs.java</cite></p>
<p>Esegue  mosse di base del robot inviando via <code class="docutils literal notranslate"><span class="pre">WebSocket</span></code>  comandi espressi in <span class="xref std std-ref">cril</span></p>
</td>
<td><p><cite>Key point</cite>: Richiesta <cite>asincrona</cite></p>
<p>Richiede 4 thread, a causa della libreria <code class="docutils literal notranslate"><span class="pre">javax.websocket</span></code>.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Dal punto di vista ‘sistemistico’</strong>, osserviamo che:</p>
<ul class="simple">
<li><p>Il codice di comunicazione è scritto completamente dal progettista dell’applicazione, che utilizza
la libreria <code class="docutils literal notranslate"><span class="pre">javax.websocket</span></code>  (vedi anche <a href="#id270"><span class="problematic" id="id271">`I WebSocket Comunicazione Asincrona Full-Duplex Per Il Web`_</span></a>)</p></li>
</ul>
<section id="uso-di-annotazioni">
<h4>Uso di annotazioni<a class="headerlink" href="#uso-di-annotazioni" title="Permalink to this heading">¶</a></h4>
<blockquote>
<div><p>Gli eventi del ciclo di vita dell’endpoint WebSocket sono gestiti mediante <span class="xref std std-ref">Annotazioni</span>
secondo lo schema che segue:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>@ClientEndpoint  //La classe viene trattata come un client WebSocket
public class ... {
   @OnOpen //chiamato quando si avvia una nuova connessione WebSocket
   public void onOpen(Session userSession){ ... }

   @OnMessage //chiamato quando  arriva un  messaggio di stato
   public void onMessage(String message){ ... }

   @OnError //chiamato quando si verifica un problema con la comunicazione
   public void onError (sessione di sessione, errore lanciabile){...}

   @Chiudi //chiamato alla chiusura della connessione WebSocket
   public void onClose(Session userSession,CloseReason reason){...}
 }
</pre></div>
</div>
</div></blockquote>
<p><strong>Dal punto di vista ‘applicativo’</strong>, osserviamo che:</p>
<ul class="simple">
<li><p>Il chiamante esegue concettualmente una <em>fire-and-forget</em>.</p></li>
<li><p>Un eventuale <span class="xref std std-ref">Messaggio di stato</span> viene ‘iniettato’ nell’applicazione tramite una chiamata al metodo annotato
con <code class="docutils literal notranslate"><span class="pre">&#64;OnMessage</span></code>.</p></li>
<li><p>E’ possibile <cite>interrompere</cite> la esecuzione di una mossa inviando il comando <span class="xref std std-ref">alarm</span>.</p></li>
<li><p>Per una mossa che termina prima del tempo indicato nel comando (per interruzione o <span class="xref std std-ref">Collision</span>,
vengono percepiti due <span class="xref std std-ref">Messaggio di stato</span>: <code class="docutils literal notranslate"><span class="pre">{&quot;collision&quot;:MOVEID,</span> <span class="pre">&quot;target&quot;:&quot;...&quot;</span> <span class="pre">}</span></code>
e <code class="docutils literal notranslate"><span class="pre">{&quot;endmove&quot;:&quot;false&quot;,</span> <span class="pre">&quot;move&quot;:&quot;MINFO&quot;</span> <span class="pre">}</span></code></p></li>
</ul>
<p>L’interazione mediante <code class="docutils literal notranslate"><span class="pre">WebSocket</span></code> viene realizzata dalla libreria <code class="docutils literal notranslate"><span class="pre">javax.websocket</span></code> invocato entro
una procedura di utilità definita come segue:</p>
</section>
<section id="callws">
<h4>callWS<a class="headerlink" href="#callws" title="Permalink to this heading">¶</a></h4>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">//Fase iniziale di connessione</span>
<span class="kd">private</span> <span class="n">Session</span> <span class="n">userSession</span>  <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="n">WebSocketContainer</span> <span class="n">container</span> <span class="o">=</span> <span class="n">ContainerProvider</span><span class="p">.</span><span class="na">getWebSocketContainer</span><span class="p">();</span>
<span class="n">container</span><span class="p">.</span><span class="na">connectToServer</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">new</span> <span class="n">URI</span><span class="p">(</span><span class="s">&quot;ws://&quot;</span><span class="o">+</span><span class="n">addr</span><span class="p">));</span>

<span class="nd">@OnOpen</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onOpen</span><span class="p">(</span><span class="n">Session</span> <span class="n">userSession</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">this</span><span class="p">.</span><span class="na">userSession</span> <span class="o">=</span> <span class="n">userSession</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">callWS</span><span class="p">(</span><span class="n">String</span> <span class="n">msg</span> <span class="p">)</span>   <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">userSession</span><span class="p">.</span><span class="na">getAsyncRemote</span><span class="p">().</span><span class="na">sendText</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
    <span class="c1">// try {</span>
    <span class="c1">//   this.userSession.getBasicRemote().sendText(msg);</span>
    <span class="c1">//   //synch version: blocks until the message has been transmitted</span>
    <span class="c1">// }catch(Exception e) {}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="testmovesusingws-onmesage">
<h4>TestMovesUsingWs onMesage<a class="headerlink" href="#testmovesusingws-onmesage" title="Permalink to this heading">¶</a></h4>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@OnMessage</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onMessage</span><span class="p">(</span><span class="n">String</span> <span class="n">message</span><span class="p">)</span>  <span class="p">{</span>
    <span class="kt">long</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span> <span class="o">-</span> <span class="n">startTime</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="c1">//{&quot;collision&quot;:&quot;true &quot;,&quot;move&quot;:&quot;...&quot;} or</span>
      <span class="c1">//{&quot;sonarName&quot;:&quot;sonar2&quot;,&quot;distance&quot;:19,&quot;axis&quot;:&quot;x&quot;}</span>
      <span class="n">JSONObject</span> <span class="n">jsonObj</span> <span class="o">=</span> <span class="p">(</span><span class="n">JSONObject</span><span class="p">)</span> <span class="n">simpleparser</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">jsonObj</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;endmove&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="p">)</span> <span class="p">{</span>
            <span class="kt">boolean</span> <span class="n">endmove</span> <span class="o">=</span> <span class="n">jsonObj</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;endmove&quot;</span><span class="p">).</span><span class="na">toString</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;true&quot;</span><span class="p">);</span>
            <span class="n">String</span>  <span class="n">move</span>    <span class="o">=</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="n">jsonObj</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;move&quot;</span><span class="p">)</span> <span class="p">;</span>
            <span class="n">CommUtils</span><span class="p">.</span><span class="na">outgreen</span><span class="p">(</span><span class="s">&quot;TestMovesUsingWs | endmove:&quot;</span> <span class="o">+</span> <span class="n">endmove</span> <span class="o">+</span> <span class="s">&quot; move=&quot;</span><span class="o">+</span><span class="n">move</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">count</span><span class="o">++</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span> <span class="c1">//test</span>
                <span class="n">callWS</span><span class="p">(</span>  <span class="n">turnleftcmd</span>  <span class="p">);</span><span class="n">CommUtils</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">350</span><span class="p">);</span>
                <span class="n">callWS</span><span class="p">(</span>  <span class="n">turnrightcmd</span>  <span class="p">);</span>
            <span class="p">}</span>
      <span class="p">}</span><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">jsonObj</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;collision&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="p">)</span> <span class="p">{</span>
            <span class="n">String</span> <span class="n">move</span>   <span class="o">=</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="n">jsonObj</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;collision&quot;</span><span class="p">);</span>
            <span class="n">String</span> <span class="n">target</span> <span class="o">=</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="n">jsonObj</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;target&quot;</span><span class="p">);</span>
            <span class="c1">//halt();</span>
            <span class="c1">//senza halt il msg {&quot;endmove&quot;:&quot;false&quot;,&quot;move&quot;:&quot;moveForward-collision&quot;} arriva dopo T</span>
      <span class="p">}</span><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">jsonObj</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;sonarName&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="p">)</span> <span class="p">{</span> <span class="c1">//JUST TO SHOW ...</span>
            <span class="n">String</span> <span class="n">sonarName</span> <span class="o">=</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="n">jsonObj</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;sonarName&quot;</span><span class="p">)</span> <span class="p">;</span>
            <span class="n">String</span> <span class="n">distance</span>  <span class="o">=</span> <span class="n">jsonObj</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;distance&quot;</span><span class="p">).</span><span class="na">toString</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">CommUtils</span><span class="p">.</span><span class="na">outred</span><span class="p">(</span><span class="s">&quot;onMessage &quot;</span> <span class="o">+</span> <span class="n">message</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="testmovesusingws-tests">
<h4>TestMovesUsingWs tests<a class="headerlink" href="#testmovesusingws-tests" title="Permalink to this heading">¶</a></h4>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 40%" />
<col style="width: 60%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><img alt="_images/testHttpForwardOk.png" src="_images/testHttpForwardOk.png" />
</td>
<td><p><cite>Muovi in avanti senza collisioni</cite></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">doForward</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">String</span> <span class="n">forwardcmd</span><span class="o">=</span><span class="s">&quot;{\&quot;robotmove\&quot;:\&quot;moveForward\&quot;,\&quot;time\&quot;:\&quot;1000\&quot;}&quot;</span><span class="p">;</span>
  <span class="n">CommUtils</span><span class="p">.</span><span class="na">waitTheUser</span><span class="p">(</span><span class="s">&quot;PUT ROBOT in HOME  and hit&quot;</span><span class="p">);</span>
  <span class="n">startTime</span> <span class="o">=</span> <span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span>
  <span class="n">callWS</span><span class="p">(</span>  <span class="n">forwardcmd</span>  <span class="p">);</span>
  <span class="n">CommUtils</span><span class="p">.</span><span class="na">waitTheUser</span><span class="p">(</span><span class="s">&quot;Hit to terminate doForward&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//MESSAGGI DI STATO</span>
<span class="nl">onMessage</span><span class="p">:{</span><span class="s">&quot;endmove&quot;</span><span class="p">:</span><span class="s">&quot;true&quot;</span><span class="p">,</span><span class="s">&quot;move&quot;</span><span class="p">:</span><span class="s">&quot;moveForward&quot;</span><span class="p">}</span> <span class="n">duration</span><span class="o">=</span><span class="mi">1055</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><img alt="_images/testWsForwardCollision.png" src="_images/testWsForwardCollision.png" />
<img alt="_images/testWsForwardCollisionWithHalt.png" src="_images/testWsForwardCollisionWithHalt.png" />
</td>
<td><p><cite>Muovi in avanti con collisione</cite></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">doCollision</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">String</span> <span class="n">forwardcmd</span>   <span class="o">=</span> <span class="s">&quot;{\&quot;robotmove\&quot;:\&quot;moveForward\&quot;, \&quot;time\&quot;:\&quot;3000\&quot;}&quot;</span><span class="p">;</span>
  <span class="n">startTime</span> <span class="o">=</span> <span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span>
  <span class="n">callWS</span><span class="p">(</span>  <span class="n">forwardcmd</span>  <span class="p">);</span>
<span class="p">}</span>

<span class="c1">//MESSAGGI DI STATO</span>
<span class="c1">//SENZA halt in onMessage relativo a collision</span>
<span class="nl">onMessage</span><span class="p">:{</span><span class="s">&quot;collision&quot;</span><span class="p">:</span><span class="s">&quot;moveForward&quot;</span><span class="p">,</span><span class="s">&quot;target&quot;</span><span class="p">:</span><span class="s">&quot;wallDown&quot;</span><span class="p">}</span> <span class="n">duration</span><span class="o">=</span><span class="mi">841</span>
<span class="nl">onMessage</span><span class="p">:{</span><span class="s">&quot;endmove&quot;</span><span class="p">:</span><span class="s">&quot;false&quot;</span><span class="p">,</span><span class="s">&quot;move&quot;</span><span class="p">:</span><span class="s">&quot;moveForward-collision&quot;</span><span class="p">}</span> <span class="n">duration</span><span class="o">=</span><span class="mi">3019</span>

<span class="c1">//CON halt in onMessage relativo a collision</span>
<span class="nl">onMessage</span><span class="p">:{</span><span class="s">&quot;collision&quot;</span><span class="p">:</span><span class="s">&quot;moveForward&quot;</span><span class="p">,</span><span class="s">&quot;target&quot;</span><span class="p">:</span><span class="s">&quot;wallDown&quot;</span><span class="p">}</span> <span class="n">duration</span><span class="o">=</span><span class="mi">1256</span>
<span class="nl">onMessage</span><span class="p">:{</span><span class="s">&quot;endmove&quot;</span><span class="p">:</span><span class="s">&quot;false&quot;</span><span class="p">,</span><span class="s">&quot;move&quot;</span><span class="p">:</span><span class="s">&quot;moveForward-collision&quot;</span><span class="p">}</span> <span class="n">duration</span><span class="o">=</span><span class="mi">1310</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><img alt="_images/testWsNotallowed.png" src="_images/testWsNotallowed.png" />
</td>
<td><p><cite>Muovi in avanti e ruota a sinistra prima della fine</cite></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">doNotAllowed</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">String</span> <span class="n">forwardcmd</span><span class="o">=</span><span class="s">&quot;{\&quot;robotmove\&quot;:\&quot;moveForward\&quot;,\&quot;time\&quot;:\&quot;1200\&quot;}&quot;</span><span class="p">;</span>
  <span class="n">callWS</span><span class="p">(</span>  <span class="n">forwardcmd</span>  <span class="p">);</span>
  <span class="n">CommUtils</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">400</span><span class="p">);</span>
  <span class="n">callWS</span><span class="p">(</span>  <span class="n">turnleftcmd</span>  <span class="p">);</span>
<span class="p">}</span>

<span class="c1">//MESSAGGI DI STATO</span>
<span class="nl">onMessage</span><span class="p">:{</span><span class="s">&quot;endmove&quot;</span><span class="p">:</span><span class="s">&quot;false&quot;</span><span class="p">,</span><span class="s">&quot;move&quot;</span><span class="p">:</span><span class="s">&quot;turnLeft_notallowed (asynch)&quot;</span><span class="p">}</span>
<span class="nl">onMessage</span><span class="p">:{</span><span class="s">&quot;endmove&quot;</span><span class="p">:</span><span class="s">&quot;true&quot;</span><span class="p">,</span><span class="s">&quot;move&quot;</span><span class="p">:</span><span class="s">&quot;moveForward&quot;</span><span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><img alt="_images/testHttpForwardHalted.png" src="_images/testHttpForwardHalted.png" />
</td>
<td><p><cite>Muovi in avanti e ferma prima della fine</cite></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">doHalt</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">String</span> <span class="n">forwardcmd</span><span class="o">=</span><span class="s">&quot;{\&quot;robotmove\&quot;:\&quot;moveForward\&quot;,\&quot;time\&quot;:\&quot;3000\&quot;}&quot;</span><span class="p">;</span>
  <span class="n">callWS</span><span class="p">(</span>  <span class="n">forwardcmd</span>  <span class="p">);</span>
  <span class="n">CommUtils</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
  <span class="n">callWS</span><span class="p">(</span>  <span class="n">haltcmd</span>  <span class="p">);</span>
<span class="p">}</span>

<span class="c1">//MESSAGGI DI STATO</span>
<span class="nl">onMessage</span><span class="p">:{</span><span class="s">&quot;endmove&quot;</span><span class="p">:</span><span class="s">&quot;false&quot;</span><span class="p">,</span><span class="s">&quot;move&quot;</span><span class="p">:</span><span class="s">&quot;moveForward-interrupted&quot;</span><span class="p">}</span> <span class="n">duration</span><span class="o">=</span><span class="mi">1028</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
<section id="automatictestws">
<h4>AutomaticTestWs<a class="headerlink" href="#automatictestws" title="Permalink to this heading">¶</a></h4>
<p>La definizione di una classe di testing automatizzato analoga <span class="xref std std-ref">AutomaticTestHTTP</span> potrebbe non essere
di immediata realizzazione. Il lettore è inviatato a individuare i problemi che sorgono a livello di scrittura
del codice, sui quali noi torneremo in seguito.</p>
<p><cite>Programmi applicativi di uso di WEnv</cite></p>
</section>
</section>
</section>
<section id="programmi-applicativi-di-uso-del-virtualrobot">
<h2>Programmi applicativi di uso del VirtualRobot<a class="headerlink" href="#programmi-applicativi-di-uso-del-virtualrobot" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Si veda il <cite>progetto</cite> <span class="xref std std-ref">VirtualRobotUsage25</span></p></li>
</ol>
</section>
</section>
<section id="virtualrobotusage25">
<h1>VirtualRobotUsage25<a class="headerlink" href="#virtualrobotusage25" title="Permalink to this heading">¶</a></h1>
<section id="verso-l-uso-del-virtualrobot">
<h2>Verso l’uso del VirtualRobot<a class="headerlink" href="#verso-l-uso-del-virtualrobot" title="Permalink to this heading">¶</a></h2>
<p>Procediamo in modo top-down definendo le interazioni
<cite>dal punto di vista del livello applicativo</cite>.</p>
<blockquote>
<div><table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>:<cite>Protocolli</cite></p>
<p>L’applicazione vuole comunicare con il robot senza conoscere i dettagli della comunicazione.</p>
<p>A tal fine ricordiamo <span class="xref std std-ref">unibo.basicomm23.interfaces.Interaction</span>.</p>
</td>
<td><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">ProtocolType</span> <span class="n">protocol</span> <span class="o">=</span> <span class="n">ProtocolType</span><span class="p">.</span><span class="na">ws</span><span class="p">;</span>
<span class="c1">//ProtocolType protocol = ProtocolType.http;</span>
<span class="n">Interaction</span> <span class="n">conn</span> <span class="o">=</span>
<span class="n">ConnectionFactory</span><span class="p">.</span><span class="na">createClientSupport</span><span class="p">(</span>
     <span class="n">protocol</span><span class="p">,</span> <span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="s">&quot;8090/api/move&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Per un esempio si veda: <a href="#id272"><span class="problematic" id="id273">`TestMovesUsingWs.java`_</span></a>, in cui i comandi sono esprressi in
<span class="xref std std-ref">cril</span>.</p>
</td>
</tr>
<tr class="row-even"><td><p>:<cite>Informazioni da WEnv</cite></p>
<p>L’applicazione potrebbe voler ricevere le informazioni di stato
dovute al robot ( (<span class="xref std std-ref">Messaggio di stato</span>)  e da <span class="xref std std-ref">WEnv</span> in
forma di eventi</p>
</td>
<td><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Event</span> <span class="n">vrinfo</span> <span class="p">:</span> <span class="n">vrinfo</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>:<cite>Comandi di movimento</cite></p>
<p>L’applicazione vorrebbe inviare al robot i comandi di movimento come dispatch</p>
</td>
<td><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Dispatch</span> <span class="n">move</span> <span class="p">:</span> <span class="n">move</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>  <span class="s">&quot;M = w|s|a|d!r!l&quot;</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>:<cite>Console</cite></p>
<p>L’applicazione vorrebbe rendere disponibile ad un utente umano  una console per inviare comandi al robot
e per visualizzare ogni <span class="xref std std-ref">Messaggio di stato</span></p>
</td>
<td><p>Si veda  <a class="reference internal" href="#naivegui-html">NaiveGui.html</a></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p><cite>Per avvicinarci ai desideri del livello applicativo</cite>:</p>
<p>All <cite>parola ‘robot’</cite> possono corrispondere diversi tipi di <strong>componenti software</strong> che
ne realizzano il significato in termni di struttura, interazione e funzionamento.</p>
<p>Nel seguito, introduciamo i seguenti componenti:</p>
</section>
<section id="vrobotllmoves24-robot-come-pojo-a-eventi-qak">
<h2>VrobotLLMoves24: Robot come POJO a eventi qak<a class="headerlink" href="#vrobotllmoves24-robot-come-pojo-a-eventi-qak" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><span class="xref std std-ref">VrobotLLMoves24</span></p></td>
<td><p>un POJO che <strong>può possedere</strong> un <cite>owner</cite> di tipo <span class="xref std std-ref">ActorBasic</span>
che realizza i comandi di movimento definiti dalla interfaccia <code class="docutils literal notranslate"><span class="pre">IVrobotLLMoves</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">interface</span> <span class="n">IVrobotLLMoves</span> <span class="p">{</span>
  <span class="o">//</span><span class="n">Ispirate</span> <span class="n">da</span> <span class="n">VirtualRobot23</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">turnLeft</span><span class="p">()</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">turnRight</span><span class="p">()</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">forward</span><span class="p">(</span> <span class="nb">int</span> <span class="n">time</span> <span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">backward</span><span class="p">(</span> <span class="nb">int</span> <span class="n">time</span> <span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">halt</span><span class="p">()</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>

  <span class="o">//</span><span class="n">Nuove</span> <span class="n">operazioni</span>
    <span class="n">public</span> <span class="n">boolean</span> <span class="n">step</span><span class="p">(</span><span class="n">long</span> <span class="n">time</span><span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Questo componente:</p>
<ul class="simple">
<li><p>converte i comandi di movimento in comandi per il virtual robot in
espressi con il <span class="xref std std-ref">cril</span></p></li>
<li><p>trasforma i <span class="xref std std-ref">messaggi di stato</span> emessi da <span class="xref std std-ref">WEnv:</span> in dispatch ed
eventi applicativi che possono
essere percepiti dall’owner, se esiste. In assenza di owner, gli <strong>eventi</strong> emessi
possono essere percipiti da altri aqttoriqak del sistema, mentre i dispatch non sono
generati.</p></li>
<li><p>introduce anche una nuova mossa: <code class="docutils literal notranslate"><span class="pre">step(time:int)</span></code> (si veda <span class="xref std std-ref">step</span>)</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</section>
<section id="vrobothlmoves24-robot-come-pojo-a-eventiqak-e-stepasynch">
<h2>VrobotHLMoves24: Robot come POJO a eventiqak e stepAsynch<a class="headerlink" href="#vrobothlmoves24-robot-come-pojo-a-eventiqak-e-stepasynch" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><span class="xref std std-ref">VrobotHLMoves24</span></p></td>
<td><p>un POJO che opera come <span class="xref std std-ref">VrobotLLMoves24</span> con le segeunti differenze:</p>
<ul>
<li><p>Implementa la interfaccia <code class="docutils literal notranslate"><span class="pre">IVrobotMoves</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">interface</span> <span class="n">IVrobotMoves</span> <span class="p">{</span>
  <span class="o">//</span><span class="n">Ispirate</span> <span class="n">da</span> <span class="n">VirtualRobot23</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">turnLeft</span><span class="p">()</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">turnRight</span><span class="p">()</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">forward</span><span class="p">(</span> <span class="nb">int</span> <span class="n">time</span> <span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">backward</span><span class="p">(</span> <span class="nb">int</span> <span class="n">time</span> <span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">halt</span><span class="p">()</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>

  <span class="o">//</span><span class="n">Nuove</span> <span class="n">operazioni</span>
    <span class="n">public</span> <span class="n">boolean</span> <span class="n">step</span><span class="p">(</span><span class="n">long</span> <span class="n">time</span><span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>
  <span class="n">public</span> <span class="n">void</span> <span class="n">stepAsynch</span><span class="p">(</span><span class="nb">int</span> <span class="n">time</span><span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>

  <span class="o">//</span><span class="n">Aril</span> <span class="p">(</span><span class="n">Abstract</span> <span class="n">Robot</span> <span class="n">Interaction</span> <span class="n">Lanaguage</span><span class="p">)</span>
  <span class="o">//</span><span class="n">cmd</span><span class="o">=</span><span class="n">w</span> <span class="o">|</span> <span class="n">s</span> <span class="o">|</span> <span class="n">l</span> <span class="o">|</span> <span class="n">r</span> <span class="o">|</span> <span class="n">h</span><span class="s2">&quot;</span>
  <span class="n">public</span> <span class="n">void</span> <span class="n">move</span><span class="p">(</span><span class="n">String</span> <span class="n">cmd</span> <span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>introduce comandi <cite>move</cite> che formano <span class="xref std std-ref">Il linguaggio aril</span>
(<strong>Abstract Robot Interaction Language</strong>)</p></li>
<li><p>definisce la nuova ‘mossa’ <cite>stepAsynch</cite>  basato sulle seguente specifica logica:
(si veda l’esempio <a href="#id274"><span class="problematic" id="id275">`vrusage25B.qak`_</span></a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span> <span class="n">step</span>       <span class="p">:</span> <span class="n">step</span><span class="p">(</span><span class="n">TIME</span><span class="p">)</span>
<span class="n">Reply</span> <span class="n">stepdone</span>     <span class="p">:</span> <span class="n">stepdone</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>                 <span class="k">for</span> <span class="n">step</span>
<span class="n">Reply</span> <span class="n">stepfailed</span>   <span class="p">:</span> <span class="n">stepfailed</span><span class="p">(</span><span class="n">DURATION</span><span class="p">,</span> <span class="n">CAUSE</span><span class="p">)</span> <span class="k">for</span> <span class="n">step</span>
</pre></div>
</div>
<p>Poichè il componente è un POJO, le <cite>reply</cite> sono emesse in forma di <strong>Dispatch</strong>
inviati all’onwer (se eisie).</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</section>
<section id="vrqak-robot-come-microservizio-base">
<h2>vrqak: Robot come microservizio-base<a class="headerlink" href="#vrqak-robot-come-microservizio-base" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><span class="xref std std-ref">vrqak</span></p></td>
<td><p>un MICROSERVIZIO che:</p>
<ul class="simple">
<li><p>permette l’uso remoto del <span class="xref std std-ref">VirtualRobot23</span>
attraverso invio di messaggi</p></li>
<li><p>opera come una :<cite>risorsa osservabile</cite>
che permette ai clienti di percepire informazioni di stato su robot
e sull’ambiente in cui il robot opera.</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</section>
<section id="basicrobot24-robot-come-agente-evoluto">
<h2>BasicRobot24: Robot come agente evoluto<a class="headerlink" href="#basicrobot24-robot-come-agente-evoluto" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><span class="xref std std-ref">BasicRobot24</span></p></td>
<td><p>un AGENTE SITUATO che  realizza  un robot che:</p>
<ul class="simple">
<li><p>risulta indipendente dalla tecnologia
con cui è realizzato uno specifico DDR robot (virtuale o reale)
attraverso l’uso di adapter e di un file di configurazione</p></li>
<li><p>estende in modo rilevante l’<span class="xref std std-ref">insieme di funzioni</span>
che è capace di eseguire, includendo sequenze di movimenti, posizionamenti
del robot ed esecuzione di piani di movimento mediante un <span class="xref std std-ref">planner</span> interno.</p></li>
<li><p>richiede la conoscenza di una <span class="xref std std-ref">mappa</span>
dell’area in cui il robot è chiamato a muoversi.</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<section id="ai-overview-dei-componenti-robot">
<h3>AI-Overview dei componenti-robot<a class="headerlink" href="#ai-overview-dei-componenti-robot" title="Permalink to this heading">¶</a></h3>
<p>Per un ulteriore sommario (prodotto dalla AI), si veda: <span class="xref std std-ref">VirtualRobotUsage25Survey</span>.</p>
</section>
</section>
<section id="vrobotllmoves24">
<h2>VrobotLLMoves24<a class="headerlink" href="#vrobotllmoves24" title="Permalink to this heading">¶</a></h2>
<ul>
<li><p>Definiamo un adapter (<span class="xref std std-ref">VrobotLLMoves24</span>) che converta comandi di movimento in comandi per il robot in
<span class="xref std std-ref">cril</span>
e che trasformi i messaggi di stato in eventi applicativi.</p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/VrobotLLMsgStatocomando24.png"><img alt="_images/VrobotLLMsgStatocomando24.png" class="align-center" src="_images/VrobotLLMsgStatocomando24.png" style="width: 60%;" /></a>
</div></blockquote>
<p>Questo adapter introduce anche una nuova mossa: <code class="docutils literal notranslate"><span class="pre">step(time:int)</span></code> (si veda <span class="xref std std-ref">step</span>)</p>
</li>
</ul>
</section>
<section id="esempi-di-uso-di-vrobotllmoves24">
<h2>Esempi di uso di VrobotLLMoves24<a class="headerlink" href="#esempi-di-uso-di-vrobotllmoves24" title="Permalink to this heading">¶</a></h2>
<p>Progetto <cite>virtualrobotusage25</cite></p>
<ul>
<li><p>Gli esempi sono elencati in ordine crescente di ‘astrazione’.</p></li>
<li><p><span class="slidekp">KEY-POINT-1</span>: il supporto <span class="xref std std-ref">VrobotLLMoves24</span> fornisce metodi per muovere
il robot usando il linguaggio <span class="xref std std-ref">cril</span>
ed :<cite>emette informazioni</cite> (messaggi ed eventi) nel caso abbia un <em>actorqak</em>  come owner.</p>
<p>L’<cite>owner svolge il ruolo di una  “mente”</cite> capace di svolgere compiti applicativi
tenendo conto di ‘dati sensoriali’ provenienti dal robot e dall’ambiente.</p>
</li>
<li><p><span class="slidekp">KEY-POINT-2</span>: esempi ‘evoluti’ usano il metodo <cite>step</cite> che
può rendere più semplice la progrewttazione e la realizzazione di applicazioni.</p></li>
<li><p><span class="slidekp">KEY-POINT-3</span>: il metodo <cite>step</cite> viene realizzato in modo <strong>sincrono</strong>
dal supporto <span class="xref std std-ref">VrobotLLMoves24</span> e viene realizzato in modo :<cite>asincrono</cite>
dal nuovo supporto <span class="xref std std-ref">VrobotHLMoves24</span> che estende il linguaggio comprensibile al robot
con <span class="xref std std-ref">Il linguaggio aril</span>.</p></li>
<li><p><span class="slidekp">KEY-POINT-4</span>: gli esempi costituiscono la <cite>“premessa evolutiva”</cite> per la
defiizione di un micro-servizio (<span class="xref std std-ref">Il microservizio vrqak24</span>)
che  permettere l’uso remoto del robot da parte di componenti applicativi
mediante <span class="xref std std-ref">Il linguaggio aril</span>.</p></li>
</ul>
<section id="robot-come-agente-che-provoca-eventi">
<h3>Robot come agente che provoca eventi<a class="headerlink" href="#robot-come-agente-che-provoca-eventi" title="Permalink to this heading">¶</a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 40%" />
<col style="width: 60%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a href="#id276"><span class="problematic" id="id277">`TestVrrobotLLMoves24.java`_</span></a></p></td>
<td><p>Un programma Java che usa il supporto senza owner qak.</p>
<p>Le informazioni emesse dal supporto NON sono visibili a livello applicativo, ma
possono essere visualizzate ponendo <code class="docutils literal notranslate"><span class="pre">setTrace(true)</span></code></p>
</td>
</tr>
<tr class="row-even"><td><p><a href="#id278"><span class="problematic" id="id279">`BoundaryWalkNaiveUsingWs.java`_</span></a></p></td>
<td><p>Un programma Java che usa il supporto senza owner qak e muove il robot
lungo il perimetro (privo di ostacoli) della stanza, inviando un comando <code class="docutils literal notranslate"><span class="pre">forward</span></code>
di durata tale da garantire l’incontro del robot col muro di front</p></td>
</tr>
<tr class="row-odd"><td><p><a href="#id280"><span class="problematic" id="id281">`vrusage25_basic.qak`_</span></a></p></td>
<td><p>Un attore qak che opera come owner di <span class="xref std std-ref">VrobotLLMoves24</span> eseguendo
mosse-base che provocano l’emissione delle seguenti info:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;endmove&quot;</span><span class="p">:</span><span class="s2">&quot;true&quot;</span><span class="p">,</span><span class="s2">&quot;move&quot;</span><span class="p">:</span><span class="s2">&quot;turnLeft&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;sonarName&quot;</span><span class="p">:</span><span class="s2">&quot;sonar1&quot;</span><span class="p">,</span><span class="s2">&quot;distance&quot;</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="s2">&quot;axis&quot;</span><span class="p">:</span><span class="s2">&quot;y&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;collision&quot;</span><span class="p">:</span><span class="s2">&quot;moveForward&quot;</span><span class="p">,</span><span class="s2">&quot;target&quot;</span><span class="p">:</span><span class="s2">&quot;wallRight&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;endmove&quot;</span><span class="p">:</span><span class="s2">&quot;false&quot;</span><span class="p">,</span><span class="s2">&quot;move&quot;</span><span class="p">:</span><span class="s2">&quot;moveForward-collision&quot;</span><span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
<section id="robot-come-agente-proattivo-reattivo">
<h3>Robot come agente proattivo-reattivo<a class="headerlink" href="#robot-come-agente-proattivo-reattivo" title="Permalink to this heading">¶</a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 40%" />
<col style="width: 60%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a href="#id282"><span class="problematic" id="id283">`vrusage25A.qak`_</span></a></p></td>
<td><p>Un attore qak che opera come owner di <span class="xref std std-ref">VrobotLLMoves24</span>.
Induce il robot a percorrere il boundary della stanza (SUPPOSTO PRIVO DI OSTACOLI)
fermandolo per <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">sec</span></code> quando rilevato dal SONAR della stanza</p>
<p>Le informazioni emesse dal supporto sono  percepite a livello applicativo come:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Dispatch</span> <span class="n">vrinfo</span>  <span class="p">:</span> <span class="n">vrinfo</span><span class="p">(</span><span class="n">MOVE</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>        <span class="s2">&quot;inviato dal supporto dopo mossa ok &quot;</span>
<span class="n">Dispatch</span> <span class="n">vrinfo</span>  <span class="p">:</span> <span class="n">vrinfo</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">collision</span><span class="p">)</span>   <span class="s2">&quot;inviato dal supporto dopo mossa ko &quot;</span>

<span class="n">Event</span> <span class="n">vrinfo</span>   <span class="p">:</span> <span class="n">vrinfo</span><span class="p">(</span><span class="n">obstacle</span><span class="p">,</span><span class="n">unknown</span><span class="p">)</span>   <span class="s2">&quot;emesso dal supportp dopo collisione&quot;</span>
<span class="n">Event</span> <span class="n">obstacle</span> <span class="p">:</span> <span class="n">obstacle</span><span class="p">(</span><span class="n">unknown</span><span class="p">)</span>          <span class="s2">&quot;emesso dal supporto dopo mossa ko&quot;</span>
</pre></div>
</div>
<p>L’owner usa il comando  <cite>step sincrono</cite> e invia un <code class="docutils literal notranslate"><span class="pre">autodispatch</span></code> alla
ricezione del risultato.</p>
<p><span class="slidekp">OSSERVO CHE</span> la reattività richiede che l’agente non esegua azioni che lo rendono
insensibile agli eventi. Per questo una mossa <strong>step</strong> a tempo limitato è opportuna.</p>
</td>
</tr>
<tr class="row-even"><td><p><a href="#id284"><span class="problematic" id="id285">`vrusage25B.qak`_</span></a></p></td>
<td><p>Un attore qak che opera come <a href="#id286"><span class="problematic" id="id287">`vrusage25A.qak`_</span></a> usando il supporto <span class="xref std std-ref">VrobotHLMoves24</span>
ed il comando <cite>stepAsynch(370)`</cite> da questi definito, che implica
l’invio all’owner di un messaggio di <strong>reply</strong> da parte del supporto.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span> <span class="n">step</span>       <span class="p">:</span> <span class="n">step</span><span class="p">(</span><span class="n">TIME</span><span class="p">)</span>    <span class="o">//</span><span class="n">LOGICAMENTE</span> <span class="n">eseguito</span> <span class="n">da</span> <span class="n">stepAsynch</span>
<span class="n">Reply</span> <span class="n">stepdone</span>     <span class="p">:</span> <span class="n">stepdone</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>                 <span class="k">for</span> <span class="n">step</span>  <span class="o">//</span><span class="n">emesoo</span> <span class="n">dal</span> <span class="n">supporto</span>
<span class="n">Reply</span> <span class="n">stepfailed</span>   <span class="p">:</span> <span class="n">stepfailed</span><span class="p">(</span><span class="n">DURATION</span><span class="p">,</span> <span class="n">CAUSE</span><span class="p">)</span> <span class="k">for</span> <span class="n">step</span>  <span class="o">//</span><span class="n">emesoo</span> <span class="n">dal</span> <span class="n">supporto</span>
</pre></div>
</div>
<p><span class="slidekp">OSSERVO CHE</span>
<strong>stepAsynch</strong> ‘libera’ l’owner dall’onere di generare <code class="docutils literal notranslate"><span class="pre">autodispatch</span></code> al termine di uno <strong>step sincrono</strong>
e rende l’owner capace di gestire allarmi che sorgono durante la esecuzione di uno <em>step</em>.</p>
<p>Concettualmente, una invocazione <cite>stepAsynch(370)`</cite> è una <strong>request</strong> al supporto,
che è obbligato a risondere con una <strong>reply</strong>  all’owner.</p>
</td>
</tr>
</tbody>
</table>
</section>
<section id="il-microservizio-vrqak24">
<h3>Il microservizio vrqak24<a class="headerlink" href="#il-microservizio-vrqak24" title="Permalink to this heading">¶</a></h3>
<ul>
<li><p>Definiamo un servizio <span class="xref std std-ref">vrqak24</span> per permettere l’uso remoto del <span class="xref std std-ref">VirtualRobot23</span>.</p>
<p>Per un esempio, si veda: <a href="#id288"><span class="problematic" id="id289">`vrqak24.qak`_</span></a> nel <cite>progetto vrqak24</cite>.</p>
<p>Questo servizio può costituire il punto di partenza per la realizzazione di un servizio più esteso,
che includa anche la gestione di uno specifico robot fisico.
(d’ora in poi denominato :<cite>basicrobot</cite>)</p>
</li>
<li><p>Usiamo il <strong>nuovoadapter</strong> (<span class="xref std std-ref">VrobotHLMoves24</span>)</p></li>
</ul>
<p><span class="slidekp">1- OSSERVO CHE</span>: l’analisi e la progettazione del (micro)servizio cominciano
dalla <cite>specifica della interazione</cite> tramite messaggi. Ad esempio:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/*!*/ Dispatch move : move(M)

/*2*/ Request step     :step(TIME)
/*2a*/ Reply stepdone  :stepdone(V)          for step
/*2b*/ Reply stepfailed:stepfailed(T, CAUSE) for step

/*3*/ Event  sonarval : distance( DISTANCE )
</pre></div>
</div>
</td>
<td><ol class="arabic simple">
<li><p>Comando in <span class="xref std std-ref">aril</span>: <code class="docutils literal notranslate"><span class="pre">M</span> <span class="pre">=</span> <span class="pre">w|s|a|d|p</span></code></p></li>
<li><p>Comando ASINCRONO con due possibili risposte</p></li>
<li><p>Evento emesso dal servizio per segnalare che il <code class="docutils literal notranslate"><span class="pre">SONAR</span></code> (di <strong>WEnnv</strong>)
ha calacolato la distanza di un ostacolo mobile (il robot)</p></li>
</ol>
</td>
</tr>
</tbody>
</table>
<p><span class="slidekp">2- OSSERVO CHE</span>: la specifica dei messaggi di interazione corrisponde alla specifica
di una <cite>Interface</cite> di un POJO:</p>
<p><span class="slidekp">3- OSSERVO CHE</span>: in accordo con Alan Kay, possiamo dire che :slide3`Languages are like wings and chains.`</p>
<p>In effetti,
il linguaggio Qak :<cite>abilita</cite> alla costruzione di (modelli di) sistemi distributi (nascondendo dettagli rilevanti come
la realizzazione delle comunicazioni locali e remote tra attori) mentre :<cite>costringe</cite> il programmatore a impostare
il codice come un Aitoma a Stati Finiti. Questa :<cite>costrizione è voluta</cite> per ‘indirizzare’ lo sviluppatore del software
a una impostazione ‘pulita’ del codice (e prima ancora dei suoi pensieri …).</p>
<p><span class="slidekp">4- OSSERVO CHE</span>: la costruzione di un (micro)servizio in linguaggio Qak consente di utilizzare questo componente
<cite>anche a livello locale</cite>. Si veda come esempio: <a href="#id290"><span class="problematic" id="id291">`mapobstconservice.qak`_</span></a> in <span class="xref std std-ref">RobotMap</span>.</p>
</section>
<section id="vrobothlmoves24">
<h3>VrobotHLMoves24<a class="headerlink" href="#vrobothlmoves24" title="Permalink to this heading">¶</a></h3>
<p>Questo adapter opera come <span class="xref std std-ref">VrobotLLMoves24</span> con due differenze:</p>
<blockquote>
<div><ul>
<li><p>introduce comandi nel <span class="xref std std-ref">Il linguaggio aril</span> (<strong>Abstract Robot Interaction Language</strong>)</p></li>
<li><p>permette l’invio di un comando <cite>stepAsynch</cite>  basato sulle seguente specifica
(si veda l’esempio <a href="#id292"><span class="problematic" id="id293">`vrusage25B.qak`_</span></a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span> <span class="n">step</span>       <span class="p">:</span> <span class="n">step</span><span class="p">(</span><span class="n">TIME</span><span class="p">)</span>
<span class="n">Reply</span> <span class="n">stepdone</span>     <span class="p">:</span> <span class="n">stepdone</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>                 <span class="k">for</span> <span class="n">step</span>
<span class="n">Reply</span> <span class="n">stepfailed</span>   <span class="p">:</span> <span class="n">stepfailed</span><span class="p">(</span><span class="n">DURATION</span><span class="p">,</span> <span class="n">CAUSE</span><span class="p">)</span> <span class="k">for</span> <span class="n">step</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</section>
<section id="il-linguaggio-aril">
<h3>Il linguaggio aril<a class="headerlink" href="#il-linguaggio-aril" title="Permalink to this heading">¶</a></h3>
<p>Poichè l’uso di un robot virtuale è <strong>solo un passo intermedio</strong> verso un robot fisico,
che potrebbe avere  un linguaggio di comando diverso,
può essere opportuno introdurre un linguaggio di comando ‘technology-independent’,
che  denominiamo <cite>linguaggio aril</cite> (<strong>Abstract Robot Interaction Lanaguage</strong>)
con cui esprimere i comandi-base di spostamento con la sintassi che segue:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MOVE</span> <span class="o">=</span> <span class="n">w</span> <span class="o">|</span> <span class="n">s</span> <span class="o">|</span> <span class="n">l</span> <span class="o">|</span> <span class="n">a</span> <span class="o">|</span> <span class="n">r</span> <span class="o">|</span> <span class="n">d</span><span class="o">|</span> <span class="n">h</span> <span class="o">|</span> <span class="n">p</span>

<span class="n">w</span> <span class="p">:</span> <span class="n">muove</span> <span class="n">avanti</span> <span class="n">per</span> <span class="mi">2500</span> <span class="n">msec</span>
<span class="n">s</span><span class="p">:</span> <span class="n">muove</span> <span class="n">indietro</span> <span class="n">per</span> <span class="mi">2500</span> <span class="n">msec</span>
<span class="n">l</span><span class="p">,</span><span class="n">a</span><span class="p">:</span>  <span class="n">gira</span> <span class="n">a</span> <span class="n">sinistra</span> <span class="n">di</span> <span class="mi">90</span> <span class="n">per</span> <span class="mi">300</span> <span class="n">msec</span>
<span class="n">r</span><span class="p">,</span><span class="n">d</span><span class="p">:</span>  <span class="n">gira</span> <span class="n">a</span> <span class="n">destra</span> <span class="n">di</span> <span class="mi">90</span> <span class="n">per</span> <span class="mi">300</span> <span class="n">msec</span>
<span class="n">p</span><span class="p">:</span> <span class="n">step</span> <span class="n">asincrono</span> <span class="n">per</span> <span class="mi">370</span> <span class="n">msec</span>
</pre></div>
</div>
</section>
</section>
<section id="mappa-della-stanza">
<h2>Mappa della stanza<a class="headerlink" href="#mappa-della-stanza" title="Permalink to this heading">¶</a></h2>
<p>Un (micro)servizio relativo al robot potrebbe/dovrebbe incudere anche comandi per</p>
<ul class="simple">
<li><p>posizionare il robot in uno specifico punto della stanza</p></li>
<li><p>muovere il robot da un punto A a un punto B della stanza (liberi da ostacoli)</p></li>
</ul>
<p>Un premessa utile al raggiungimento di questi obiettivi è la costruzione di una
<strong>rappresentazione a livello software della stanza</strong>.</p>
<p><span class="slidekp">OSSERVO CHE</span> la rappresentazione software di entità “del mondo reale” quali la stanza o il robot
conduce rapidamente all’idea del <cite>Gemello digitale</cite> (si veda <a href="#id294"><span class="problematic" id="id295">`Digital twin`_</span></a>).</p>
<p>Per la costruzione di una mappa, si veda <span class="xref std std-ref">RoomMap</span>.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">protobook</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Protobook</a></li>
<li class="toctree-l1"><a class="reference internal" href="#preludio">Preludio</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#c-e-ancora-possibilita-di-lavoro">C’è ancora possibilità di lavoro?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#cosa-si-intende-per-sistema">Cosa si intende per Sistema</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#descrivere-e-classificare">Descrivere e classificare</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sistemi-semplici">Sistemi semplici</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sistemi-complicati">Sistemi complicati</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sistemi-complessi">Sistemi complessi</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sistemi-caotici">Sistemi caotici</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#macchine-agenti-organismi">Macchine, agenti, organismi</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#come-si-descrive-un-sistema">Come si descrive un sistema</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#visione-blackbox">Visione BlackBox</a></li>
<li class="toctree-l3"><a class="reference internal" href="#visione-whitebox">Visione WhiteBox</a></li>
<li class="toctree-l3"><a class="reference internal" href="#visione-sistemica">Visione sistemica</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#perche-i-sistemi-complessi">Perchè i sistemi complessi</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#la-sinergetica">La sinergetica</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id31">Teoria delle reti</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#modelli-formali">Modelli formali</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#il-motto-di-alan-kay">Il motto di Alan Kay</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dai-modelli-ai-linguaggi">Dai modelli ai linguaggi</a></li>
<li class="toctree-l2"><a class="reference internal" href="#macchine-astratte">Macchine astratte</a></li>
<li class="toctree-l2"><a class="reference internal" href="#la-macchina-di-minsky">La Macchina di Minsky</a></li>
<li class="toctree-l2"><a class="reference internal" href="#problemi-non-riducibili-indecidibili">Problemi non riducibili (Indecidibili)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#il-teorema-di-rice">Il Teorema di Rice</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cosa-significa-costruire">Cosa significa ‘costruire’</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#computazionalmente-completo">Computazionalmente completo</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#teoria-algoritmica-dell-informazione">Teoria Algoritmica dell’Informazione</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#applicazione-all-intelligenza-artificiale">Applicazione all’Intelligenza Artificiale</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#perche-la-storia-non-si-e-fermata-a-turing">Perché la storia non si è fermata a Turing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#evoluzione-del-concetto-di-ccmputazione">Evoluzione del concetto di Ccmputazione</a></li>
<li class="toctree-l3"><a class="reference internal" href="#verso-la-definizione-di-sistemi-che-calcolano">Verso la definizione di ‘sistemi che calcolano’</a></li>
<li class="toctree-l3"><a class="reference internal" href="#alcuni-dei-promotori">Alcuni dei promotori</a></li>
<li class="toctree-l3"><a class="reference internal" href="#oltre-la-macchina-di-von-neumann">Oltre la macchina di Von Neumann</a></li>
<li class="toctree-l3"><a class="reference internal" href="#quantum-computer">Quantum computer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#modelli-formali-necessari-ma-non-sufficienti">Modelli formali: necessari ma non sufficienti</a></li>
<li class="toctree-l2"><a class="reference internal" href="#la-coroutine-un-nuovo-vecchio-concetto">La coroutine un nuovo vecchio concetto</a></li>
<li class="toctree-l2"><a class="reference internal" href="#un-esempio-csp-e-go">Un esempio: CSP e GO</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#csp-processi-sequenziali">CSP: Processi sequenziali</a></li>
<li class="toctree-l3"><a class="reference internal" href="#come-csp-ha-influenzato-go">Come CSP ha influenzato Go</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#famiglie-di-formalismi">Famiglie di formalismi</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#formalismi-funzionali">Formalismi funzionali</a></li>
<li class="toctree-l3"><a class="reference internal" href="#formalismi-concorrenti">Formalismi concorrenti</a></li>
<li class="toctree-l3"><a class="reference internal" href="#formalismi-distribuiti">Formalismi distribuiti</a></li>
<li class="toctree-l3"><a class="reference internal" href="#formalismi-per-la-mobilita">Formalismi per la mobilità</a></li>
<li class="toctree-l3"><a class="reference internal" href="#formalismi-stocastici">Formalismi stocastici</a></li>
<li class="toctree-l3"><a class="reference internal" href="#formalismi-field-based-e-global-behavior">Formalismi field-based e global behavior</a></li>
<li class="toctree-l3"><a class="reference internal" href="#formalismi-per-sistemi-complessi-e-dinamiche-non-lineari">Formalismi per sistemi complessi e dinamiche non lineari</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#i-linguaggi">I linguaggi</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#linguaggi-naturali">Linguaggi naturali</a></li>
<li class="toctree-l2"><a class="reference internal" href="#i-large-language-models">I Large Language Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="#linguaggi-di-programmazione">Linguaggi di programmazione</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#una-frase-misteriosa">Una frase misteriosa</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sintassi-e-semantica">Sintassi e semantica</a></li>
<li class="toctree-l3"><a class="reference internal" href="#linguaggi-per-descrivere-linguaggi">Linguaggi per descrivere linguaggi</a></li>
<li class="toctree-l3"><a class="reference internal" href="#la-analisi-sintattica">La analisi sintattica</a></li>
<li class="toctree-l3"><a class="reference internal" href="#descrivere-la-semantica">Descrivere la semantica</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#compilatori-e-interpreti">Compilatori e interpreti</a></li>
<li class="toctree-l2"><a class="reference internal" href="#general-processing-programming-languages">General Processing Programming Languages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#stili-paradigni-di-programmazione">Stili (paradigni) di programmazione</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#gli-attori-come-nuovo-paradigma">Gli attori come nuovo paradigma?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#non-determinismo">Non determinismo</a></li>
<li class="toctree-l2"><a class="reference internal" href="#influenza-di-un-ldp-sul-progettista-del-software">Influenza di un LdP sul progettista del software</a></li>
<li class="toctree-l2"><a class="reference internal" href="#l-astrazione">L’astrazione</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#realta-vs-modello">Realtà vs. Modello</a></li>
<li class="toctree-l3"><a class="reference internal" href="#l-abstraction-gap">L’Abstraction gap</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modelli-e-linguaggi-di-modellazione">Modelli e Linguaggi di modellazione</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id51">UML</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#domain-specific-languages-dsl">Domain-Specific Languages (DSL)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dsl-interno">DSL Interno</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dsl-esterno">DSL Esterno</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#i-dsl-e-i-digital-twins">I DSL e i Digital Twins</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#sistemi-software">Sistemi software</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#viste-di-un-sistema-software">Viste di un sistema software</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#vista-esterna">Vista esterna</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vista-interna">Vista interna</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vista-sommersa">Vista sommersa</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#componenti-software">Componenti software</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#componenti-software-di-base">Componenti software di base</a></li>
<li class="toctree-l3"><a class="reference internal" href="#oltre-gli-oggetti">Oltre gli oggetti</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#un-viaggio-nei-sistemi-software">Un viaggio nei sistemi software</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#punti-di-vista">Punti di vista</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sistemi-embedded-iot">Sistemi Embedded/IoT</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#capire-sperimentando">Capire sperimentando</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#capire-interagendo">Capire interagendo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interagire-con-un-sistema-software">Interagire con un sistema software</a></li>
<li class="toctree-l3"><a class="reference internal" href="#capire-implica-opportuni-livelli-di-conoscenza">Capire implica opportuni livelli di conoscenza</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conoscere-per-comunicare">Conoscere per comunicare</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#sistemi-software-come-servizi-ma-non-solo">Sistemi software come servizi (ma non solo)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#l-infrastruttura">L’infrastruttura</a></li>
<li class="toctree-l3"><a class="reference internal" href="#le-api">Le API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#representational-state-transfer-rest">Representational State Transfer (REST)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dai-servizi-ai-microservizi">Dai servizi ai microservizi</a></li>
<li class="toctree-l3"><a class="reference internal" href="#coap">CoAP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#websockets">WebSocket</a></li>
<li class="toctree-l3"><a class="reference internal" href="#openapi-specification">OpenAPI Specification</a></li>
<li class="toctree-l3"><a class="reference internal" href="#grpc">gRPC</a></li>
<li class="toctree-l3"><a class="reference internal" href="#grpc-vs-oas">gRPC vs. OAS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#sistemi-visti-dall-interno">Sistemi visti dall’interno</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dimensioni">Dimensioni</a></li>
<li class="toctree-l3"><a class="reference internal" href="#design-patterns">Design patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="#architettura-di-un-sistema">Architettura di un sistema</a></li>
<li class="toctree-l3"><a class="reference internal" href="#big-ball-of-mud">Big Ball of Mud</a></li>
<li class="toctree-l3"><a class="reference internal" href="#principi-solid">Principi SOLID</a></li>
<li class="toctree-l3"><a class="reference internal" href="#clean-architectures">Clean Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bounded-context-e-clean-architecture">Bounded Context e Clean Architecture</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#costruire-sistemi-software">Costruire sistemi software</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installare-su-pc">Installare su PC</a></li>
<li class="toctree-l2"><a class="reference internal" href="#il-ruolo-di-gradle">Il ruolo di Gradle</a></li>
<li class="toctree-l2"><a class="reference internal" href="#processi-agili-e-incrementali">Processi agili e incrementali</a></li>
<li class="toctree-l2"><a class="reference internal" href="#il-testing">Il testing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dal-testing-a-devops">Dal testing a DevOps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#il-metodo-di-lavoro">Il metodo di lavoro</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#il-diario-di-bordo">Il diario di bordo</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#game-of-life-di-conway">Game of Life di Conway</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#il-gioco-in-javascript">Il gioco in  JavaScript</a></li>
<li class="toctree-l2"><a class="reference internal" href="#il-gioco-produce-complessita">Il gioco produce complessità</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#il-gioco-e-turing-completo">Il gioco è Turing-completo</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#il-problema-della-vista-del-gioco">Il problema della vista del gioco</a></li>
<li class="toctree-l2"><a class="reference internal" href="#il-gioco-come-caso-di-studio">Il gioco come caso di studio</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#progetto-conway26java">Progetto conway26Java</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-gradle-e-main-di-conway26java">build.gradle e Main di conway26Java</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conway26java-testing">conway26Java testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lifecontroller">LifeController</a></li>
<li class="toctree-l3"><a class="reference internal" href="#la-interfaccia-ioutdev">La interfaccia IOutDev</a></li>
<li class="toctree-l3"><a class="reference internal" href="#la-interfaccia-gamecontroller">La interfaccia GameController</a></li>
<li class="toctree-l3"><a class="reference internal" href="#una-gui-con-swing">Una GUI con Swing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#da-una-funzione-a-un-servizio">Da una funzione a un servizio</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#framework-javalin-ali-e-catene">framework javalin: ali e catene</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#imitiamo-gli-esempi-documentali">Imitiamo gli esempi documentali</a></li>
<li class="toctree-l3"><a class="reference internal" href="#come-opera-javalin">Come opera javalin</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tempo-di-vita-di-una-connessione-ws-in-jetty">Tempo di vita di una connessione WS in Jetty</a></li>
<li class="toctree-l3"><a class="reference internal" href="#l-oggetto-ctx-di-javalin">L’oggetto ctx di javalin</a></li>
<li class="toctree-l3"><a class="reference internal" href="#javalin-gestisce-anche-http">javalin gestisce anche HTTP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#http-e-ws-sono-diversi">HTTP e WS sono diversi</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#progettiamo-il-sistema">Progettiamo il sistema</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#separazione-delle-responsabilita">Separazione delle Responsabilità</a></li>
<li class="toctree-l3"><a class="reference internal" href="#influenza-della-clean-architecture">Influenza della Clean Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sistemasjavalinbetter-soc">SistemaSJavalinBetter: SOC</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#uso-del-sistema-in-js">Uso del sistema in JS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prova-ws-in-javascript">Prova WS in Javascript</a></li>
<li class="toctree-l3"><a class="reference internal" href="#prova-http-in-javascript">Prova HTTP in Javascript</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dal-bottum-up-al-top-down">Dal bottum-up al top-down</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#interaction">Interaction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#unibo-basicomm23-1-0">unibo.basicomm23-1.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tipi-di-messaggi">Tipi di messaggi</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#iapplmessage">IApplMessage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#applmessage">ApplMessage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rappresentazione-dei-messaggi-come-string">Rappresentazione dei messaggi come String</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rappresentazione-dei-messaggi-in-json">Rappresentazione dei messaggi in JSON</a></li>
<li class="toctree-l3"><a class="reference internal" href="#esempi-di-uso-in-js">Esempi di uso in JS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#esempio-di-uso-in-java">Esempio di uso in Java</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#interconnessione">Interconnessione</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#connection">Connection</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#interface-interaction">Interface Interaction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#interactionbasic">InteractionBasic</a></li>
<li class="toctree-l3"><a class="reference internal" href="#protocolli">Protocolli</a></li>
<li class="toctree-l3"><a class="reference internal" href="#connectionfactory">ConnectionFactory</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#nuove-impostazioni-progettuali">Nuove impostazioni progettuali</a></li>
<li class="toctree-l2"><a class="reference internal" href="#refactoring-del-sistemas">Refactoring del sistemaS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dalla-logica-al-progetto">Dalla logica al progetto</a></li>
<li class="toctree-l3"><a class="reference internal" href="#completablefuture">CompletableFuture</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#un-progetto-esplicito">Un progetto esplicito</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sistemasjavalapplmsgsqueued">SistemaSJavalApplMsgsQueued</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sistemasjavalapplmsgsqueued-ws-onconnect">SistemaSJavalApplMsgsQueued ws.onConnect</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sistemasjavalapplmsgsqueued-ws-onmessage">SistemaSJavalApplMsgsQueued ws.onMessage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#worker-thread-message-driven">Worker thread message-driven</a></li>
<li class="toctree-l3"><a class="reference internal" href="#refactoring-dei-client">Refactoring dei client</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#interazioni-locali">Interazioni locali</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#calleronmemory">CallerOnMemory</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#un-servizio-per-comunicazioni-pub-sub">Un servizio per comunicazioni pub/sub</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mqttconnectoptions">MqttConnectOptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#qos-di-mqtt">QoS di MQTT</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mqttsender">MqttSender</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mqttreceiver">MqttReceiver</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mqttsupport">MqttSupport</a></li>
<li class="toctree-l3"><a class="reference internal" href="#non-solo-eventi">Non solo eventi</a></li>
<li class="toctree-l3"><a class="reference internal" href="#response-topic">Response Topic</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mqttinteraction">MqttInteraction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#una-gui-html-per-game-of-life">Una GUI HTML per Game of Life</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#conwaygui-analisi-del-problema">conwaygui: analisi del problema</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configurazione-di-goflife-con-html">Configurazione di GofLife con HTML</a></li>
<li class="toctree-l2"><a class="reference internal" href="#iojavalin">IoJavalin</a></li>
<li class="toctree-l2"><a class="reference internal" href="#outinws">OutInWs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#come-rappresentare-la-griglia-in-html-js">Come rappresentare la griglia in HTML/JS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#una-griglia-granulare">Una griglia granulare</a></li>
<li class="toctree-l3"><a class="reference internal" href="#una-griglia-globale">Una griglia globale</a></li>
<li class="toctree-l3"><a class="reference internal" href="#comunicazioni-server-to-pagina">Comunicazioni server to pagina</a></li>
<li class="toctree-l3"><a class="reference internal" href="#comunicazioni-pagina-to-server">Comunicazioni pagina to server</a></li>
<li class="toctree-l3"><a class="reference internal" href="#come-inviare-lo-stato-della-griglia">Come inviare lo stato della griglia</a></li>
<li class="toctree-l3"><a class="reference internal" href="#come-la-pagina-invia-dati">Come la pagina invia dati</a></li>
<li class="toctree-l3"><a class="reference internal" href="#come-rendere-disponibile-la-pagina-html">Come rendere disponibile la pagina HTML</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#protoattori">Protoattori</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#java-executors">Java Executors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#submit">submit</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#un-progetto-con-gli-executors">Un progetto con gli executors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#abstractprotoactor">AbstractProtoactor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#gestione-dei-messaggi-via-ws">Gestione dei messaggi via WS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#sistemasasprotoactor">SistemaSAsProtoactor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#proactivetask">proactiveTask</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#visualizziamo-quanto-emesso-dal-server">Visualizziamo quanto emesso dal server</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sistemasoutpage-html">SistemaSOutpage.html</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#game-of-life-con-protoattori">Game of Life con protoattori</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#oltre-comportamenti-message-driven">Oltre comportamenti message-driven</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#sistemi-a-microservizi">Sistemi a Microservizi</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#motivazioni-all-uso-dei-microservizi">Motivazioni all’uso dei microservizi</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#scalabilita-e-prestazioni">Scalabilità e Prestazioni</a></li>
<li class="toctree-l3"><a class="reference internal" href="#manutenibilita-e-aggiornamento">Manutenibilità e Aggiornamento</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sviluppo-autonomo-e-time-to-market">Sviluppo autonomo e Time-to-Market</a></li>
<li class="toctree-l3"><a class="reference internal" href="#flessibilita-tecnologica">Flessibilità Tecnologica</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resilienza-e-tolleranza-ai-guasti">Resilienza e Tolleranza ai Guasti</a></li>
<li class="toctree-l3"><a class="reference internal" href="#supporto-per-la-digital-transformation">Supporto per la Digital Transformation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#facilita-di-deployment-e-automazione">Facilità di Deployment e Automazione</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conformita-e-regolamentazioni">Conformità e Regolamentazioni</a></li>
<li class="toctree-l3"><a class="reference internal" href="#monitoraggio-e-analisi-in-tempo-reale">Monitoraggio e Analisi in Tempo Reale</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gestione-delle-dipendenze-e-interoperabilita">Gestione delle Dipendenze e Interoperabilità</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#problematiche-dei-microservizi">Problematiche dei microservizi</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#gestione-della-complessita">Gestione della complessità</a></li>
<li class="toctree-l3"><a class="reference internal" href="#comunicazione-distribuita">Comunicazione distribuita</a></li>
<li class="toctree-l3"><a class="reference internal" href="#consistenza-dei-dati">Consistenza dei dati</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gestione-delle-dipendenze-e-orchestrazione">Gestione delle dipendenze e orchestrazione</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gestione-dello-stato">Gestione dello stato</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deployment-e-monitoraggio">Deployment e monitoraggio</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gestione-degli-errori-e-tolleranza-ai-guasti">Gestione degli errori e tolleranza ai guasti</a></li>
<li class="toctree-l3"><a class="reference internal" href="#test-e-debugging">Test e debugging</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sicurezza">Sicurezza</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sovraccarico-infrastrutturale">Sovraccarico infrastrutturale</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dalla-documentazione-al-contratto">Dalla “Documentazione” al “Contratto”</a></li>
<li class="toctree-l2"><a class="reference internal" href="#progettazione-dei-microservizi">Progettazione dei microservizi</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#il-linguaggio-qak">Il linguaggio qak</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#attori-qak">Attori qak</a></li>
<li class="toctree-l2"><a class="reference internal" href="#non-solo-libreria-il-liguaggio-qak">Non solo libreria: il liguaggio qak</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#il-q-e-il-k-in-qak">Il q e il k in qak</a></li>
<li class="toctree-l3"><a class="reference internal" href="#la-proiezione-linguistica-della-libreria">La Proiezione Linguistica della Libreria.</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dalla-libreria-al-linguaggio">Dalla libreria al linguaggio</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#qak-infrastructure">Qak infrastructure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#qak-software-factory">Qak software factory</a></li>
<li class="toctree-l3"><a class="reference internal" href="#qak-come-dsl">qak come DSL</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#qactor">QActor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#context">Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="#uno-sguardo-alla-sintassi-di-qak">Uno sguardo alla sintassi di qak</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#messaggi-qak">Messaggi qak</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#descrivere-un-sistema-in-qak">Descrivere un sistema in qak</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#azioni-di-un-qactor">Azioni di un QActor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#azioni-per-la-trasmissione-dei-messaggi">Azioni per la trasmissione dei messaggi</a></li>
<li class="toctree-l3"><a class="reference internal" href="#azioni-per-la-ricezione-dei-messaggi">Azioni per la ricezione dei messaggi</a></li>
<li class="toctree-l3"><a class="reference internal" href="#come-un-qactor-gestisce-i-messaggi-ricevuti">Come un QActor gestisce i messaggi ricevuti</a></li>
<li class="toctree-l3"><a class="reference internal" href="#altre-azioni-qak">Altre azioni qak</a></li>
<li class="toctree-l3"><a class="reference internal" href="#qactor-come-fsm">QActor come FSM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#un-esempio-di-sistama-qak-con-claude">Un esempio di sistama qak con Claude</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#onmsg">onMsg</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dal-concentrato-al-distribuito">Dal concentrato al distribuito</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#impatto-di-qak-sul-processo-di-sviluppo">Impatto di qak sul processo di sviluppo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dichiarazione-del-sistema-service-s">1) Dichiarazione del sistema service_s</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dichiarazione-dei-messaggi">2) Dichiarazione dei messaggi</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dichiarazione-dei-contesti">3) Dichiarazione dei contesti</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dichiarazione-degi-attori">4) Dichiarazione degi attori</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#interagire-con-il-service-s">Interagire con il service_s</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#un-osservatore-alieno">Un osservatore ‘alieno’</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#osservazione-e-testing">Osservazione e testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#progettazione-e-sviluppo-come-processo-evolutivo">Progettazione e sviluppo come processo evolutivo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#un-osservatore-come-qactor">Un osservatore come QActor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#osservazione-dell-evento-info">Osservazione dell’evento info</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#vista-interna-del-sistema-service-s">Vista interna del sistema service_s</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#id158">Come è stato realizzato Qak</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#la-sintassi-di-qak">La sintassi di qak</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#notazioni-ispirate-ai-termini-prolog">Notazioni ispirate ai termini Prolog</a></li>
<li class="toctree-l3"><a class="reference internal" href="#unificazione-prolog-in-qak">Unificazione Prolog in qak</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#le-cassi-della-infrastruttura">Le cassi della infrastruttura</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#it-unibo-kactor-actorbasic-kt">it.unibo.kactor.ActorBasic.kt</a></li>
<li class="toctree-l3"><a class="reference internal" href="#actor-channel">actor channel</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sendmessagetoactor">sendMessageToActor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#it-unibo-kactor-actorbasicfsm-kt">it.unibo.kactor.ActorBasicFsm.kt</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#sistemi-su-raspberrypi">Sistemi su RaspberryPi</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#verifica-dispositivi">Verifica dispositivi</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#software-per-il-led">Software per il Led</a></li>
<li class="toctree-l3"><a class="reference internal" href="#software-per-il-sonar">Software per il Sonar</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sonarandled">SonarAndLed</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#progetto-sonarqak24">Progetto sonarqak24</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sonarqak24-analisi-del-problema">sonarqak24: analisi del problema</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sonarqak24-progettazione">sonarqak24:progettazione</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#virtualrobot23">VirtualRobot23</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#virtualrobot23-project">VirtualRobot23 project</a></li>
<li class="toctree-l2"><a class="reference internal" href="#la-scena-di-wenv">La scena di WEnv</a></li>
<li class="toctree-l2"><a class="reference internal" href="#come-attivare-wenv">Come attivare WEnv</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#virtualrobot23-yaml">virtualRobot23.yaml</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#come-interagire-con-wenv">Come interagire con WEnv</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#naivegui-html">NaiveGui.html</a></li>
<li class="toctree-l3"><a class="reference internal" href="#comandi-base-per-il-robot-in-cril">Comandi-base per il robot in cril</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interazione-sincrona">Interazione sincrona</a></li>
<li class="toctree-l3"><a class="reference internal" href="#collision">Collision</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stato-iniziale-del-virtualrobot">Stato iniziale del virtualrobot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interazione-asincrona">Interazione asincrona</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#wenv-note-di-implementazione">WEnv - note di implementazione</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#architettura-di-wenv">Architettura di WEnv</a></li>
<li class="toctree-l3"><a class="reference internal" href="#wenv-come-immagine-docker">WEnv come immagine docker</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#programmi-naive">Programmi naive</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#testmovesusinghttp">TestMovesUsingHttp</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testmovesusingws">TestMovesUsingWs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#programmi-applicativi-di-uso-del-virtualrobot">Programmi applicativi di uso del VirtualRobot</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#virtualrobotusage25">VirtualRobotUsage25</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#verso-l-uso-del-virtualrobot">Verso l’uso del VirtualRobot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vrobotllmoves24-robot-come-pojo-a-eventi-qak">VrobotLLMoves24: Robot come POJO a eventi qak</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vrobothlmoves24-robot-come-pojo-a-eventiqak-e-stepasynch">VrobotHLMoves24: Robot come POJO a eventiqak e stepAsynch</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vrqak-robot-come-microservizio-base">vrqak: Robot come microservizio-base</a></li>
<li class="toctree-l2"><a class="reference internal" href="#basicrobot24-robot-come-agente-evoluto">BasicRobot24: Robot come agente evoluto</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ai-overview-dei-componenti-robot">AI-Overview dei componenti-robot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#vrobotllmoves24">VrobotLLMoves24</a></li>
<li class="toctree-l2"><a class="reference internal" href="#esempi-di-uso-di-vrobotllmoves24">Esempi di uso di VrobotLLMoves24</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#robot-come-agente-che-provoca-eventi">Robot come agente che provoca eventi</a></li>
<li class="toctree-l3"><a class="reference internal" href="#robot-come-agente-proattivo-reattivo">Robot come agente proattivo-reattivo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#il-microservizio-vrqak24">Il microservizio vrqak24</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vrobothlmoves24">VrobotHLMoves24</a></li>
<li class="toctree-l3"><a class="reference internal" href="#il-linguaggio-aril">Il linguaggio aril</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mappa-della-stanza">Mappa della stanza</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">protobook documentation</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2025, AN-ED.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/Protobook.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>